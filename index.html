<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ortho</title>
    <script type="module" crossorigin>(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))t(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function o(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerPolicy&&(i.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?i.credentials="include":l.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(l){if(l.ep)return;l.ep=!0;const i=o(l);fetch(l.href,i)}})();const Et=e=>{if(e.length===0)return 0;let n=0;for(let t=0;t<e.length;t++)n+=e[t]*e[t];const o=Math.sqrt(n/e.length);return Math.min(1,Math.max(0,o))},It=.15,Qe=80,ze=600,Rt=(e,n)=>{const o=Math.min(Math.floor(e.length/2),n),t=new Float32Array(o);for(let l=0;l<o;l++){let i=0;for(let a=0;a<o;a++){const s=e[a]-e[a+l];i+=s*s}t[l]=i}return t},kt=e=>{const n=new Float32Array(e.length);n[0]=1;let o=0;for(let t=1;t<e.length;t++)o+=e[t],n[t]=o===0?0:e[t]*t/o;return n},Ft=(e,n,o)=>{for(let t=n;t<e.length-1;t++)if(e[t]<o){for(;t+1<e.length&&e[t+1]<e[t];)t++;return t}return-1},Ot=(e,n)=>{if(n<=0||n>=e.length-1)return n;const o=e[n-1],t=e[n],l=e[n+1],i=.5*(o-l)/(o-2*t+l);return Number.isFinite(i)?n+i:n},_t=(e,n)=>{if(e.length<2)return null;const o=Math.floor(n/Qe),t=Math.floor(n/ze);if(e.length<2*o)return null;const l=Rt(e,o),i=kt(l),a=Ft(i,t,It);if(a===-1)return null;const s=Ot(i,a);if(s<=0)return null;const r=n/s;return r<Qe||r>ze?null:r},xe=[{vowel:"a",f1:1e3,f2:1600},{vowel:"e",f1:500,f2:2600},{vowel:"ɛ",f1:700,f2:2300},{vowel:"i",f1:350,f2:2800},{vowel:"o",f1:600,f2:1100},{vowel:"u",f1:400,f2:1100},{vowel:"y",f1:350,f2:2200}],Lt=.01,en=.001,Bt=e=>{const n=e.length,o=new Float32Array(n);for(let t=0;t<n;t++){const l=.54-.46*Math.cos(2*Math.PI*t/(n-1));o[t]=e[t]*l}return o},Dt=(e,n=.97)=>{const o=new Float32Array(e.length);o[0]=e[0];for(let t=1;t<e.length;t++)o[t]=e[t]-n*e[t-1];return o},Wt=e=>{const n=Gt(e.length),o=new Float32Array(n),t=new Float32Array(n);o.set(e.subarray(0,Math.min(e.length,n))),jt(o,t,n);for(let a=2;a<=n;a*=2){const s=a/2,r=-2*Math.PI/a;for(let f=0;f<n;f+=a)for(let c=0;c<s;c++){const h=r*c,d=Math.cos(h),p=Math.sin(h),v=f+c,A=f+c+s,_=d*o[A]-p*t[A],k=d*t[A]+p*o[A];o[A]=o[v]-_,t[A]=t[v]-k,o[v]=o[v]+_,t[v]=t[v]+k}}const l=n/2+1,i=new Float32Array(l);for(let a=0;a<l;a++)i[a]=Math.sqrt(o[a]*o[a]+t[a]*t[a]);return i},nn=(e,n,o,t)=>{const l=(e.length-1)*2,i=n/l,a=Math.max(1,Math.ceil(o/i)),s=Math.min(e.length-1,Math.floor(t/i));let r=a,f=e[a];for(let c=a+1;c<=s;c++)e[c]>f&&(f=e[c],r=c);if(r>a&&r<s){const c=e[r-1],h=e[r],d=e[r+1],p=c-2*h+d;if(p!==0){const v=.5*(c-d)/p;return(r+v)*i}}return r*i},Nt=(e,n)=>{let o=xe[0].vowel,t=1/0;for(const l of xe){const i=e-l.f1,a=n-l.f2,s=i*i+a*a;s<t&&(t=s,o=l.vowel)}return o},Ht=(e,n)=>{if($t(e)<Lt)return{vowel:null,formants:null};const o=Dt(e),t=Bt(o),l=Wt(t),i=nn(l,n,200,1200),a=i+200,s=nn(l,n,a,2800),r=tn(l,n,i),f=tn(l,n,s),c=(l.length-1)*2,h={magnitudes:l,sampleRate:n,fftSize:c,f1:i,f2:s};return r<en||f<en?{vowel:null,formants:h}:{vowel:Nt(i,s),formants:h}},$t=e=>{let n=0;for(let o=0;o<e.length;o++)n+=e[o]*e[o];return Math.sqrt(n/e.length)},Gt=e=>{let n=1;for(;n<e;)n*=2;return n},jt=(e,n,o)=>{const t=Math.log2(o);for(let l=0;l<o;l++){const i=Ut(l,t);if(i>l){const a=e[l];e[l]=e[i],e[i]=a;const s=n[l];n[l]=n[i],n[i]=s}}},Ut=(e,n)=>{let o=0;for(let t=0;t<n;t++)o=o<<1|e&1,e>>=1;return o},tn=(e,n,o)=>{const t=(e.length-1)*2,l=Math.round(o*t/n),i=Math.max(0,Math.min(e.length-1,l));return e[i]},ke={isVoicing:!1,currentDuration:0},Yt=(e,n,o)=>e?{isVoicing:!0,currentDuration:o.currentDuration+n}:{isVoicing:!1,currentDuration:0},Vt=.01,Xt=2048,qt=()=>{let e=null,n=null,o=null,t=null,l=ke,i=0;const a=new Set,s=d=>{for(const p of a)p(d)},r=d=>{if(n===null||e===null)return;const p=i===0?0:(d-i)/1e3;i=d;const v=new Float32Array(n.fftSize);n.getFloatTimeDomainData(v);const A={buffer:v,sampleRate:e.sampleRate},_=Et(A.buffer),k=_t(A.buffer,A.sampleRate),{vowel:g,formants:y}=Ht(A.buffer,A.sampleRate),m=_>Vt;l=Yt(m,p,l);const T={volume:_,pitch:k,vowel:g,isVoicing:m,duration:l.currentDuration,formants:y};s(T),t=requestAnimationFrame(r)};return{start:async()=>{const d=await navigator.mediaDevices.getUserMedia({audio:!0});o=d;const p=new AudioContext;e=p;const v=p.createAnalyser();v.fftSize=Xt,n=v,p.createMediaStreamSource(d).connect(v),i=0,l=ke,t=requestAnimationFrame(r)},stop:()=>{if(t!==null&&(cancelAnimationFrame(t),t=null),o!==null){for(const d of o.getTracks())d.stop();o=null}e!==null&&(e.close(),e=null),n=null,l=ke,i=0},subscribe:d=>(a.add(d),()=>{a.delete(d)})}},Kt=e=>{let n=e;const o=new Set;return{get:()=>n,set:a=>{n=a,o.forEach(s=>s(n))},subscribe:a=>(o.add(a),()=>{o.delete(a)})}},on=()=>window.location.hash.replace(/^#/,"")||"menu",Zt=(e,n)=>{let o=null;const t=s=>n.find(r=>r.id===s),l=s=>{for(o&&o.unmount();e.firstChild;)e.removeChild(e.firstChild);const r=t(s)??t("menu")??null;o=r,r&&r.mount(e),window.location.hash=`#${(r==null?void 0:r.id)??s}`},i=()=>o,a=()=>{l(on())};return window.addEventListener("hashchange",a),l(on()),{navigate:l,getCurrentGame:i}},M=(e,n,...o)=>{const t=document.createElement(e);if(n)for(const[l,i]of Object.entries(n))t.setAttribute(l,i);for(const l of o)typeof l=="string"?t.appendChild(document.createTextNode(l)):t.appendChild(l);return t},Jt=(e,n=document)=>{const o=n.querySelector(e);if(!o)throw new Error(`Element not found: ${e}`);return o},ot=e=>{for(;e.firstChild;)e.removeChild(e.firstChild)},C={bg:"#f0f4ff",text:"#2d3748",primary:"#6366f1",secondary:"#f472b6",green:"#34d399",surface:"#ffffff",muted:"#94a3b8"},Y={a:"#ef4444",e:"#f59e0b",ɛ:"#f97316",i:"#22c55e",o:"#3b82f6",u:"#8b5cf6",y:"#ec4899"},u=(e,n)=>{const o=Math.max(0,Math.min(1,n)),t=parseInt(e.slice(1,3),16),l=parseInt(e.slice(3,5),16),i=parseInt(e.slice(5,7),16);return`rgba(${t}, ${l}, ${i}, ${o})`},ln=["#818cf8","#f472b6","#34d399","#fbbf24","#60a5fa"],Qt=e=>ln[e%ln.length],zt=e=>{Object.assign(e.style,{display:"flex",flexDirection:"column",alignItems:"center",minHeight:"100%",padding:"32px 16px",backgroundColor:C.bg,fontFamily:"inherit",overflowY:"auto"})},xt=e=>{Object.assign(e.style,{fontSize:"3rem",fontWeight:"800",color:C.primary,margin:"0 0 8px 0",letterSpacing:"-0.02em"})},eo=e=>{Object.assign(e.style,{fontSize:"1.5rem",fontWeight:"500",color:C.muted,margin:"0 0 40px 0"})},no=e=>{Object.assign(e.style,{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"24px",width:"100%",maxWidth:"800px"})},to=(e,n)=>{Object.assign(e.style,{backgroundColor:n,borderRadius:"16px",padding:"32px 24px",cursor:"pointer",border:"none",textAlign:"left",transition:"transform 0.15s ease, box-shadow 0.15s ease",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"}),e.addEventListener("mouseenter",()=>{e.style.transform="scale(1.04)",e.style.boxShadow="0 8px 24px rgba(0, 0, 0, 0.15)"}),e.addEventListener("mouseleave",()=>{e.style.transform="scale(1)",e.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.1)"})},oo=e=>{Object.assign(e.style,{fontSize:"1.6rem",fontWeight:"700",color:"#ffffff",margin:"0 0 8px 0"})},lo=e=>{Object.assign(e.style,{fontSize:"1.1rem",fontWeight:"400",color:"rgba(255, 255, 255, 0.9)",margin:"0",lineHeight:"1.4"})},ao=(e,n)=>{const o=M("p",{},e.name);oo(o);const t=M("p",{},e.description);lo(t);const l=M("button",{},o,t);return to(l,Qt(n)),l.addEventListener("click",()=>{window.location.hash="#"+e.id}),l},io=e=>({id:"menu",name:"Accueil",description:"Choisis un jeu !",mount:l=>{ot(l);const i=M("div",{});zt(i);const a=M("h1",{},"Ortho");xt(a);const s=M("p",{},"Choisis un jeu !");eo(s);const r=M("div",{});no(r),e.forEach((f,c)=>{r.appendChild(ao(f,c))}),i.appendChild(a),i.appendChild(s),i.appendChild(r),l.appendChild(i)},unmount:()=>{},update:l=>{}}),fe=["background: "+C.surface,"border-radius: 16px","padding: 24px","box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08)","display: flex","flex-direction: column","gap: 12px"].join("; "),ce=["font-size: 14px","font-weight: 600","color: "+C.muted,"text-transform: uppercase","letter-spacing: 1px"].join("; "),an=["font-size: 32px","font-weight: 700","color: "+C.text].join("; "),so=["display: grid","grid-template-columns: 1fr 1fr","gap: 20px","padding: 24px","max-width: 720px","margin: 0 auto","font-family: system-ui, -apple-system, sans-serif"].join("; "),ro=["display: flex","align-items: center","justify-content: center","position: relative","padding: 20px 24px 4px","max-width: 720px","margin: 0 auto"].join("; "),fo=["position: absolute","left: 24px","top: 20px","background: none","border: none","font-size: 16px","color: "+C.primary,"cursor: pointer","padding: 8px 12px","border-radius: 8px","font-weight: 600","transition: background 0.15s"].join("; "),co=["font-size: 24px","font-weight: 700","color: "+C.text,"margin: 0"].join("; "),ho=["width: 100%","height: 24px","background: "+C.bg,"border-radius: 12px","overflow: hidden"].join("; "),uo=["height: 100%","border-radius: 12px","transition: width 0.05s linear, background 0.15s","width: 0%"].join("; "),po=["width: 120px","height: 120px","border-radius: 50%","display: flex","align-items: center","justify-content: center","font-size: 48px","font-weight: 700","color: white","margin: 0 auto","transition: background-color 0.15s","background: "+C.bg].join("; "),go=["display: flex","flex-wrap: wrap","gap: 6px","min-height: 32px","align-items: center"].join("; "),mo=["width: 28px","height: 28px","border-radius: 50%","display: flex","align-items: center","justify-content: center","font-size: 13px","font-weight: 700","color: white"].join("; "),bo=e=>{const n=Math.round(255*(1-e));return`rgb(${Math.round(255*e)}, ${n}, 80)`},So=20,sn={a:{f1:1e3,f2:1600},e:{f1:500,f2:2600},ɛ:{f1:700,f2:2300},i:{f1:350,f2:2800},o:{f1:600,f2:1100},u:{f1:400,f2:1100},y:{f1:350,f2:2200}},yo=(e,n,o,t)=>{const l=window.devicePixelRatio||1,i=n.width/l,a=n.height/l;e.clearRect(0,0,i,a);const{magnitudes:s,sampleRate:r,fftSize:f}=o,c=3500,h=r/f,d=Math.min(s.length-1,Math.ceil(c/h));let p=0;for(let m=0;m<=d;m++){const T=Math.log10(1+s[m]*500);T>p&&(p=T)}p===0&&(p=1);const v=e.createLinearGradient(0,0,0,a);v.addColorStop(0,u(C.primary,.8)),v.addColorStop(1,u(C.primary,.05)),e.beginPath(),e.moveTo(0,a);for(let m=0;m<=d;m++){const w=m*h/c*i,b=Math.log10(1+s[m]*500),P=a-b/p*(a-20);e.lineTo(w,P)}e.lineTo(d*h/c*i,a),e.closePath(),e.fillStyle=v,e.fill(),e.beginPath();for(let m=0;m<=d;m++){const w=m*h/c*i,b=Math.log10(1+s[m]*500),P=a-b/p*(a-20);m===0?e.moveTo(w,P):e.lineTo(w,P)}if(e.strokeStyle=C.primary,e.lineWidth=1.5,e.stroke(),t&&sn[t]){const m=sn[t],T=Y[t]??C.primary,w=100,b=(m.f1-w)/c*i,P=(m.f1+w)/c*i;e.fillStyle=u(T,.18),e.fillRect(b,0,P-b,a);const S=(m.f2-w)/c*i,E=(m.f2+w)/c*i;e.fillStyle=u(T,.18),e.fillRect(S,0,E-S,a),e.fillStyle=u(T,.7),e.font="11px system-ui, sans-serif",e.textAlign="center",e.fillText("F1 cible",(b+P)/2,14),e.fillText("F2 cible",(S+E)/2,14)}const{f1:A,f2:_}=o,k=t&&Y[t]?Y[t]:C.primary,g=A/c*i;e.beginPath(),e.moveTo(g,0),e.lineTo(g,a),e.strokeStyle=k,e.lineWidth=2,e.stroke(),e.fillStyle=k,e.font="bold 11px system-ui, sans-serif",e.textAlign="left",e.fillText("F1: "+Math.round(A)+" Hz",g+4,30);const y=_/c*i;e.beginPath(),e.moveTo(y,0),e.lineTo(y,a),e.strokeStyle=k,e.lineWidth=2,e.stroke(),e.fillStyle=k,e.font="bold 11px system-ui, sans-serif",e.textAlign="right",e.fillText("F2: "+Math.round(_)+" Hz",y-4,30),e.fillStyle=C.muted,e.font="10px system-ui, sans-serif",e.textAlign="center";for(let m=500;m<=3e3;m+=500){const T=m/c*i;e.fillText(m+"",T,a-4)}},wo=()=>{let e=null,n=null,o=null,t=null,l=null,i=null,a=null,s=null,r=null;return{id:"dashboard",name:"Dashboard",description:"Tableau de bord diagnostique — visualise le pipeline audio en temps réel",mount:d=>{const p=M("div",{style:"background: "+C.bg+"; min-height: 100vh;"}),v=M("div",{style:ro}),A=M("button",{style:fo},"← Accueil");A.addEventListener("click",()=>{window.location.hash="#menu"}),A.addEventListener("mouseenter",()=>{A.style.background=u(C.primary,.1)}),A.addEventListener("mouseleave",()=>{A.style.background="none"});const _=M("h1",{style:co},"Dashboard");v.appendChild(A),v.appendChild(_),p.appendChild(v);const k=M("div",{style:so}),g=M("div",{style:fe}),y=M("span",{style:ce},"Volume"),m=M("div",{style:ho});e=M("div",{style:uo}),m.appendChild(e),g.appendChild(y),g.appendChild(m);const T=M("div",{style:fe}),w=M("span",{style:ce},"Pitch");n=M("span",{style:an},"—"),T.appendChild(w),T.appendChild(n);const b=M("div",{style:fe}),P=M("span",{style:ce},"Voyelle");o=M("div",{style:po}),t=M("span",{},"—"),o.appendChild(t),b.appendChild(P),b.appendChild(o);const S=M("div",{style:fe}),E=M("span",{style:ce},"Durée");l=M("span",{style:an},"0.0 s"),S.appendChild(E),S.appendChild(l),k.appendChild(g),k.appendChild(T),k.appendChild(b),k.appendChild(S),p.appendChild(k);const R=M("div",{style:"padding: 0 24px 20px; max-width: 720px; margin: 0 auto;"}),F=M("div",{style:fe}),I=M("span",{style:ce},"Spectre");a=document.createElement("canvas"),a.style.cssText="width: 100%; height: 180px; border-radius: 8px; background: "+C.bg;const D=window.devicePixelRatio||1;a.width=672*D,a.height=180*D;const j=a.getContext("2d");j&&j.scale(D,D),s=j,F.appendChild(I),F.appendChild(a),R.appendChild(F),p.appendChild(R);const q=new ResizeObserver(N=>{for(const U of N){const se=U.contentRect;if(a&&s){const ne=window.devicePixelRatio||1;a.width=se.width*ne,a.height=180*ne,s.scale(ne,ne)}}});q.observe(F),r=q;const B=M("div",{style:"padding: 0 24px 24px; max-width: 720px; margin: 0 auto;"}),W=M("div",{style:fe}),H=M("span",{style:ce},"Historique voyelles");i=M("div",{style:go}),W.appendChild(H),W.appendChild(i),B.appendChild(W),p.appendChild(B),ot(d),d.appendChild(p)},update:d=>{if(e){const p=Math.round(d.volume*100);e.style.width=p+"%",e.style.background=bo(d.volume)}if(n&&(n.textContent=d.pitch!==null?Math.round(d.pitch)+" Hz":"—"),o&&t)if(d.vowel!==null){const p=Y[d.vowel]??C.muted;o.style.background=p,t.textContent=d.vowel,t.style.color="white"}else o.style.background=C.bg,t.textContent="—",t.style.color=C.muted;if(l&&(l.textContent=d.duration.toFixed(1)+" s"),i&&d.vowel!==null){const p=Y[d.vowel]??C.muted,v=M("div",{style:mo+"; background: "+p},d.vowel);for(i.insertBefore(v,i.firstChild);i.children.length>So;)i.removeChild(i.lastChild)}s&&a&&d.formants&&yo(s,a,d.formants,d.vowel)},unmount:()=>{r&&(r.disconnect(),r=null),e=null,n=null,o=null,t=null,l=null,i=null,a=null,s=null}}},J=e=>{const n=document.createElement("canvas"),o=n.getContext("2d");if(!o)throw new Error("Failed to get 2D rendering context");e.appendChild(n);const{width:t,height:l}=X(n,o);return{canvas:n,ctx:o,width:t,height:l}},ee=(e,n,o)=>{e.clearRect(0,0,n,o)},X=(e,n)=>{const o=e.parentElement;if(!o)throw new Error("Canvas must be mounted in a parent element");const t=window.devicePixelRatio||1,l=o.clientWidth,i=o.clientHeight;return e.width=l*t,e.height=i*t,e.style.width=`${l}px`,e.style.height=`${i}px`,n.setTransform(t,0,0,t,0,0),{width:l,height:i}},vo=6,To=.003,Po=.05,Co=10,Mo=50,Ao=-1,Eo=-3,rn=.5,Io=.3,Ro=.7,ko=.8,dn=(e,n)=>e+Math.random()*(n-e),Fo=(e,n,o,t)=>({x:dn(e*Io,e*Ro),y:n,radius:Co+o*Mo,color:t&&Y[t]?Y[t]:C.primary,alpha:ko,vy:Ao+o*Eo,vx:dn(-rn,rn)}),Oo=e=>({...e,y:e.y+e.vy,x:e.x+e.vx,alpha:e.alpha-To,radius:e.radius+Po}),_o=e=>e.alpha>0&&e.y+e.radius>0,Lo=(e,n)=>{e.beginPath(),e.arc(n.x,n.y,n.radius,0,Math.PI*2),e.fillStyle=u(n.color,n.alpha),e.fill()},Bo=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:C.bg})},Do=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:C.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u(C.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Wo=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u(C.primary,.5),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},No=()=>{let e=null,n=null,o=0,t=0,l=[],i=null,a=null,s=0,r=null;const f=()=>{if(n){ee(n,o,t),l=l.map(Oo).filter(_o);for(const v of l)Lo(n,v);i=requestAnimationFrame(f)}},c=()=>{if(!e||!n)return;const v=X(e,n);o=v.width,t=v.height};return{id:"bubbles",name:"Bulles",description:"Fais monter des bulles avec ta voix !",mount:v=>{const A=M("div",{});Bo(A),a=M("button",{},"← Accueil"),Do(a),a.addEventListener("click",()=>{window.location.hash="#menu"});const _=M("p",{},"Bulles");Wo(_),A.appendChild(a),A.appendChild(_),v.appendChild(A);const k=J(A);e=k.canvas,n=k.ctx,o=k.width,t=k.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),r=c,window.addEventListener("resize",r),l=[],s=0,f()},unmount:()=>{i!==null&&(cancelAnimationFrame(i),i=null),r&&(window.removeEventListener("resize",r),r=null),e=null,n=null,a=null,l=[],s=0,o=0,t=0},update:v=>{if(!v.isVoicing){s=0;return}s+=1,s>=vo&&(s=0,l.push(Fo(o,t,v.volume,v.vowel)))}}},fn=120,Ho=.08,Me=36,lt=56,$o=3,Go=.03,cn=3,hn=2.5,jo=3,Uo=8,un=.08,Yo=.12,Vo=.08,at="#0f0e2e",Xo="#1a3a2a",qo="#2d5a3a",pn=["#ff6b35","#ffa500","#ffcc00","#ff4444","#ffee88"],Ko=[{x:.78,y:.7,radius:18,color:"#66bb6a",label:"",ringColor:null},{x:.2,y:.5,radius:24,color:"#ffa726",label:"",ringColor:"#ffcc80"},{x:.82,y:.32,radius:20,color:"#ab47bc",label:"",ringColor:null},{x:.35,y:.15,radius:30,color:"#42a5f5",label:"",ringColor:"#90caf9"}],Zo=(e,n,o)=>e+(n-e)*o,de=(e,n)=>e+Math.random()*(n-e),gn=e=>Array.from({length:e},()=>({x:Math.random(),y:Math.random(),size:de(.5,2.5),twinkleSpeed:de(.01,.04),twinkleOffset:Math.random()*Math.PI*2})),Jo=(e,n,o)=>({x:e+de(-Me*.3,Me*.3),y:n+de(0,4),vx:de(-cn,cn),vy:de(hn*.5,hn)*(.5+o*.5),life:1,size:de(jo,Uo)*(.6+o*.8),color:pn[Math.floor(Math.random()*pn.length)]}),Qo=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,life:e.life-Go,size:e.size*.97}),zo=e=>e.life>0&&e.size>.5,xo=(e,n,o,t,l)=>{for(const i of n){const a=.4+.6*Math.abs(Math.sin(l*i.twinkleSpeed+i.twinkleOffset));e.beginPath(),e.arc(i.x*o,i.y*t,i.size,0,Math.PI*2),e.fillStyle=u("#ffffff",a),e.fill()}},el=(e,n,o,t)=>{const l=n.x*o,i=n.y*t,a=e.createRadialGradient(l,i,n.radius*.5,l,i,n.radius*2);a.addColorStop(0,u(n.color,.2)),a.addColorStop(1,u(n.color,0)),e.beginPath(),e.arc(l,i,n.radius*2,0,Math.PI*2),e.fillStyle=a,e.fill(),e.beginPath(),e.arc(l,i,n.radius,0,Math.PI*2),e.fillStyle=n.color,e.fill(),n.ringColor&&(e.beginPath(),e.ellipse(l,i,n.radius*1.8,n.radius*.35,-.3,0,Math.PI*2),e.strokeStyle=u(n.ringColor,.6),e.lineWidth=2,e.stroke())},nl=(e,n,o)=>{const t=o*(1-un);e.fillStyle=Xo,e.fillRect(0,t,n,o*un),e.fillStyle=qo,e.fillRect(0,t,n,3)},tl=(e,n,o)=>{const t=Me/2,l=lt;e.save(),e.translate(n,o),e.beginPath(),e.moveTo(0,-l),e.lineTo(-t*.5,-l*.55),e.lineTo(t*.5,-l*.55),e.closePath(),e.fillStyle="#ef4444",e.fill(),e.beginPath(),e.moveTo(-t*.5,-l*.55),e.lineTo(-t*.5,0),e.lineTo(t*.5,0),e.lineTo(t*.5,-l*.55),e.closePath(),e.fillStyle="#e0e0e0",e.fill(),e.fillStyle=C.primary,e.fillRect(-t*.5,-l*.4,Me*.5,l*.12),e.beginPath(),e.arc(0,-l*.42,t*.28,0,Math.PI*2),e.fillStyle="#81d4fa",e.fill(),e.beginPath(),e.arc(0,-l*.42,t*.28,0,Math.PI*2),e.strokeStyle="#4fc3f7",e.lineWidth=1.5,e.stroke(),e.beginPath(),e.moveTo(-t*.5,-l*.08),e.lineTo(-t,l*.08),e.lineTo(-t*.5,0),e.closePath(),e.fillStyle="#ef4444",e.fill(),e.beginPath(),e.moveTo(t*.5,-l*.08),e.lineTo(t,l*.08),e.lineTo(t*.5,0),e.closePath(),e.fillStyle="#ef4444",e.fill(),e.beginPath(),e.moveTo(-t*.3,0),e.lineTo(-t*.2,l*.08),e.lineTo(t*.2,l*.08),e.lineTo(t*.3,0),e.closePath(),e.fillStyle="#78909c",e.fill(),e.restore()},ol=(e,n)=>{for(const o of n)e.beginPath(),e.arc(o.x,o.y,o.size,0,Math.PI*2),e.fillStyle=u(o.color,o.life*.8),e.fill()},ll=(e,n,o,t,l,i)=>{const a=1-(t-l)/(i-l),s=n-24,r=o*.08,f=o*.84,c=8;e.fillStyle=u("#ffffff",.1),e.beginPath(),e.roundRect(s-c/2,r,c,f,4),e.fill();const h=f*Math.max(0,Math.min(1,a)),d=e.createLinearGradient(0,r+f,0,r);d.addColorStop(0,"#34d399"),d.addColorStop(.5,"#fbbf24"),d.addColorStop(1,"#ef4444"),e.fillStyle=d,e.beginPath(),e.roundRect(s-c/2,r+f-h,c,h,4),e.fill()},al=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:at})},il=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:"#a5b4fc",cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u("#1e1b4b",.7),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},sl=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u("#a5b4fc",.6),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},rl=()=>{let e=null,n=null,o=0,t=0,l=null,i=null,a=[],s=0,r=0,f=[],c=0,h=!1,d=0;const p=()=>t*(1-Yo),v=()=>t*Vo+lt,A=()=>o/2,_=()=>{if(n){if(d+=1,s=Zo(s,r,Ho),f=f.map(Qo).filter(zo),h&&c>.01){const T=Math.ceil($o*(.5+c*1.5));for(let w=0;w<T;w++)f.push(Jo(A(),s,c))}ee(n,o,t),n.fillStyle=at,n.fillRect(0,0,o,t),xo(n,a,o,t,d);for(const T of Ko)el(n,T,o,t);nl(n,o,t),ol(n,f),tl(n,A(),s),ll(n,o,t,s,v(),p()),l=requestAnimationFrame(_)}},k=()=>{if(!e||!n)return;const T=p(),w=v(),b=T>w?(s-w)/(T-w):1,P=X(e,n);o=P.width,t=P.height;const S=p(),E=v();s=E+b*(S-E),r=s,a=gn(fn)};return{id:"rocket",name:"Fusée",description:"Fais décoller la fusée avec ta voix !",mount:T=>{const w=M("div",{});al(w);const b=M("button",{},"← Accueil");il(b),b.addEventListener("click",()=>{window.location.hash="#menu"});const P=M("p",{},"Fusée");sl(P),w.appendChild(b),w.appendChild(P),T.appendChild(w);const S=J(w);e=S.canvas,n=S.ctx,o=S.width,t=S.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),a=gn(fn),s=p(),r=s,f=[],c=0,h=!1,d=0,i=k,window.addEventListener("resize",i),_()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),i&&(window.removeEventListener("resize",i),i=null),e=null,n=null,a=[],f=[],c=0,h=!1,d=0,o=0,t=0},update:T=>{c=T.volume,h=T.isVoicing;const w=p(),b=v();T.isVoicing&&T.volume>.01?r=w-T.volume*(w-b):r=w}}},mn=["#f9a8d4","#a5b4fc","#86efac","#fcd34d","#fca5a5","#c4b5fd","#67e8f9","#fdba74","#d8b4fe","#6ee7b7"],bn=["star","heart","butterfly","flower"],dl=9,fl=15,Fe=20,cl=.45,hl=.06,ul=.25,$e="#0a0e1a",Sn=.04,Te=(e,n)=>e+Math.random()*(n-e),yn=(e,n,o,t)=>Math.sqrt((o-e)**2+(t-n)**2),wn=(e,n,o)=>Math.max(n,Math.min(o,e)),pl=(e,n)=>{const t=[];for(let l=0;l<dl;l++)t.push({x:Te(60,e-60),y:Te(110,n-60),kind:bn[l%bn.length],color:mn[l%mn.length],size:Te(18,30),discovered:!1,glowPhase:Te(0,Math.PI*2)});return t},gl=(e,n,o,t,l,i)=>{const s=t,r=t*.45;e.save(),e.globalAlpha=i,e.fillStyle=l,e.beginPath();for(let f=0;f<10;f++){const c=f%2===0?s:r,h=Math.PI*f/5-Math.PI/2,d=n+Math.cos(h)*c,p=o+Math.sin(h)*c;f===0?e.moveTo(d,p):e.lineTo(d,p)}e.closePath(),e.fill(),e.restore()},ml=(e,n,o,t,l,i)=>{const a=t*.6;e.save(),e.globalAlpha=i,e.fillStyle=l,e.beginPath(),e.moveTo(n,o+a*.3),e.bezierCurveTo(n,o-a*.3,n-a,o-a*.3,n-a,o+a*.1),e.bezierCurveTo(n-a,o+a*.6,n,o+a*.9,n,o+a*1.1),e.bezierCurveTo(n,o+a*.9,n+a,o+a*.6,n+a,o+a*.1),e.bezierCurveTo(n+a,o-a*.3,n,o-a*.3,n,o+a*.3),e.closePath(),e.fill(),e.restore()},bl=(e,n,o,t,l,i)=>{const a=t*.7;e.save(),e.globalAlpha=i,e.fillStyle=l,e.beginPath(),e.ellipse(n-a*.45,o-a*.25,a*.5,a*.35,-Math.PI/6,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(n+a*.45,o-a*.25,a*.5,a*.35,Math.PI/6,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(n-a*.35,o+a*.25,a*.35,a*.25,Math.PI/6,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(n+a*.35,o+a*.25,a*.35,a*.25,-Math.PI/6,0,Math.PI*2),e.fill(),e.fillStyle=u(l,i*.8),e.beginPath(),e.ellipse(n,o,a*.08,a*.45,0,0,Math.PI*2),e.fill(),e.restore()},Sl=(e,n,o,t,l,i)=>{const s=t*.35,r=t*.2,f=t*.35;e.save(),e.globalAlpha=i,e.fillStyle=l;for(let c=0;c<6;c++){const h=Math.PI*2*c/6,d=n+Math.cos(h)*f,p=o+Math.sin(h)*f;e.beginPath(),e.arc(d,p,s,0,Math.PI*2),e.fill()}e.fillStyle=u("#fef08a",i),e.beginPath(),e.arc(n,o,r,0,Math.PI*2),e.fill(),e.restore()},yl=(e,n,o,t)=>{const l=n.size*t;({star:()=>gl(e,n.x,n.y,l,n.color,o),heart:()=>ml(e,n.x,n.y,l,n.color,o),butterfly:()=>bl(e,n.x,n.y,l,n.color,o),flower:()=>Sl(e,n.x,n.y,l,n.color,o)})[n.kind]()},wl=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:$e})},vl=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:"#a5b4fc",cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u("#1e1b4b",.7),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Tl=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u("#c7d2fe",.6),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},Pl=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",fontSize:"1.1rem",fontWeight:"600",color:"#fcd34d",margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:u("#1e1b4b",.7),borderRadius:"8px"})},Cl=()=>{let e=null,n=null,o=0,t=0,l=[],i=null,a=null,s=null,r=0,f=0,c=0,h=0;const d=S=>{const E=Math.min(o,t)*cl;return Fe+S*S*E},p=S=>{l=l.map(E=>{if(E.discovered)return E;const R=yn(c,h,E.x,E.y),F=S-E.size-fl;return R<F?{...E,discovered:!0}:E})},v=()=>{if(!s)return;const S=l.filter(E=>E.discovered).length;s.textContent=`${S} / ${l.length}`},A=S=>{S.fillStyle=$e,S.fillRect(0,0,o,t)},_=(S,E)=>{if(E<=Fe)return;const R=S.createRadialGradient(c,h,0,c,h,E);R.addColorStop(0,u("#2a3a6a",.9)),R.addColorStop(.3,u("#1a2550",.7)),R.addColorStop(.7,u("#101830",.4)),R.addColorStop(1,u($e,0)),S.save(),S.globalCompositeOperation="lighter",S.fillStyle=R,S.beginPath(),S.arc(c,h,E,0,Math.PI*2),S.fill(),S.restore()},k=(S,E,R)=>{for(const F of l){const I=yn(c,h,F.x,F.y);let D;if(F.discovered&&E<=Fe)D=Sn*3;else if(I>E+F.size)D=F.discovered?Sn*2:0;else if(I>E-F.size){const q=(E+F.size-I)/(F.size*2);D=wn(q,0,1)*.9}else{const q=1-I/E*.3;D=wn(q,.5,.95)}if(D<=0)continue;let j=1;F.discovered&&(j=1+Math.sin(R*hl+F.glowPhase)*ul,D=Math.min(D+.15,1)),yl(S,F,D,j)}},g=(S,E)=>{if(l.filter(I=>I.discovered).length>0)return;const F=.25+Math.sin(E*.03)*.1;S.save(),S.fillStyle=u("#c7d2fe",F),S.font="1.1rem system-ui, sans-serif",S.textAlign="center",S.fillText("Parle pour allumer la lampe !",o/2,t/2+60),S.restore()};let y=0;const m=()=>{n&&(y+=1,ee(n,o,t),r+=(f-r)*.12,A(n),_(n,r),k(n,r,y),g(n,y),p(r),v(),i=requestAnimationFrame(m))},T=()=>{if(!e||!n)return;const S=X(e,n);o=S.width,t=S.height,c=o/2,h=t/2};return{id:"lamp",name:"Lampe Magique",description:"Illumine l’obscurité avec ta voix pour découvrir des créatures cachées !",mount:S=>{const E=M("div",{});wl(E);const R=M("button",{},"← Accueil");vl(R),R.addEventListener("click",()=>{window.location.hash="#menu"});const F=M("p",{},"Lampe Magique");Tl(F),s=M("p",{},"0 / 0"),Pl(s),E.appendChild(R),E.appendChild(F),E.appendChild(s),S.appendChild(E);const I=J(E);e=I.canvas,n=I.ctx,o=I.width,t=I.height,c=o/2,h=t/2,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),l=pl(o,t),r=0,f=0,y=0,a=T,window.addEventListener("resize",a),v(),m()},unmount:()=>{i!==null&&(cancelAnimationFrame(i),i=null),a&&(window.removeEventListener("resize",a),a=null),e=null,n=null,s=null,l=[],r=0,f=0,y=0,o=0,t=0},update:S=>{S.isVoicing?f=d(S.volume):f=0}}},vn=7,Ml=.15,Al=60,El=1/Al,Il=.03,Rl=180,kl=80,Fl=.08,Ol=.006,_l=.3,Ll=.008,Bl=8,Tn=.08,Dl=.12,Pn=["#fca5a5","#a5b4fc","#86efac","#fcd34d","#f9a8d4","#67e8f9","#fdba74"],Cn=["#f472b6","#a78bfa","#34d399","#fbbf24","#60a5fa","#f87171","#2dd4bf","#fb923c"],it="#2d1b33",Wl="#4a2c2a",Nl="#5c3a2e",Hl="#7a5040",V=(e,n)=>e+Math.random()*(n-e),Pe=(e,n,o)=>Math.max(n,Math.min(o,e)),$l=e=>Array.from({length:e},(n,o)=>({x:0,bodyColor:Pn[o%Pn.length],flameScale:1,extinguished:!1,blowAccumulator:0})),Mn=(e,n)=>{const o=n*.12,t=(n-o*2)/(e.length-1);return e.map((l,i)=>({...l,x:o+i*t}))},Gl=e=>{const n=e.findIndex(o=>!o.extinguished);return n===-1?null:n},jl=(e,n)=>({x:e+V(-3,3),y:n-V(2,8),vx:V(-.3,.3),vy:V(-.8,-.3),alpha:V(.3,.6),size:V(3,6)}),Ul=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,alpha:e.alpha-Ll,size:e.size+.03}),Yl=e=>e.alpha>0,Vl=(e,n)=>Array.from({length:kl},()=>({x:V(0,e),y:V(-n*.3,n*.1),vx:V(-2,2),vy:V(1,3),rotation:V(0,Math.PI*2),rotationSpeed:V(-.1,.1),color:Cn[Math.floor(Math.random()*Cn.length)],alpha:1,width:V(6,12),height:V(3,6)})),Xl=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,vy:e.vy+Fl,rotation:e.rotation+e.rotationSpeed,alpha:e.alpha-Ol}),ql=e=>e.alpha>0,Kl=(e,n,o)=>{const t=e.createLinearGradient(0,0,0,o);t.addColorStop(0,it),t.addColorStop(1,Wl),e.fillStyle=t,e.fillRect(0,0,n,o)},Zl=(e,n,o,t)=>{const l=e.createLinearGradient(0,t,0,o);l.addColorStop(0,Hl),l.addColorStop(.15,Nl),l.addColorStop(1,"#3d2518"),e.fillStyle=l,e.beginPath(),e.roundRect(0,t,n,o-t,[8,8,0,0]),e.fill(),e.strokeStyle=u("#a07050",.4),e.lineWidth=1.5,e.beginPath(),e.moveTo(0,t),e.lineTo(n,t),e.stroke()},Jl=(e,n,o,t,l,i)=>{const a=n-t/2,s=o-l;e.fillStyle=i,e.beginPath(),e.roundRect(a,s,t,l,[4,4,0,0]),e.fill(),e.fillStyle=u("#ffffff",.15),e.beginPath(),e.roundRect(a+2,s,t*.25,l,[3,0,0,0]),e.fill(),e.strokeStyle="#4a3728",e.lineWidth=2,e.beginPath(),e.moveTo(n,s),e.lineTo(n,s-8),e.stroke()},Ql=(e,n,o,t,l)=>{if(t<=.01)return;const i=22*t,a=9*t,s=o-i,r=l*3*t;e.save();const f=20*t,c=e.createRadialGradient(n+r,o-i*.5,0,n+r,o-i*.5,f);c.addColorStop(0,u("#fef08a",.25*t)),c.addColorStop(1,u("#fef08a",0)),e.fillStyle=c,e.beginPath(),e.arc(n+r,o-i*.5,f,0,Math.PI*2),e.fill(),e.fillStyle=u("#fb923c",.85),e.beginPath(),e.moveTo(n-a*.6+r*.5,o),e.quadraticCurveTo(n-a+r*.8,o-i*.5,n+r,s),e.quadraticCurveTo(n+a+r*.8,o-i*.5,n+a*.6+r*.5,o),e.closePath(),e.fill();const h=.65;e.fillStyle=u("#fef08a",.9),e.beginPath(),e.moveTo(n-a*.35+r*.3,o),e.quadraticCurveTo(n-a*h+r*.5,o-i*.45,n+r*.7,s+i*.2),e.quadraticCurveTo(n+a*h+r*.5,o-i*.45,n+a*.35+r*.3,o),e.closePath(),e.fill();const d=e.createRadialGradient(n+r*.5,o-i*.2,0,n+r*.5,o-i*.2,a*.4);d.addColorStop(0,u("#ffffff",.6*t)),d.addColorStop(1,u("#fef9c3",0)),e.fillStyle=d,e.beginPath(),e.arc(n+r*.5,o-i*.2,a*.4,0,Math.PI*2),e.fill(),e.restore()},zl=(e,n)=>{for(const o of n)e.beginPath(),e.arc(o.x,o.y,o.size,0,Math.PI*2),e.fillStyle=u("#9ca3af",o.alpha),e.fill()},xl=(e,n)=>{for(const o of n)e.save(),e.translate(o.x,o.y),e.rotate(o.rotation),e.fillStyle=u(o.color,o.alpha),e.fillRect(-o.width/2,-o.height/2,o.width,o.height),e.restore()},ea=(e,n,o)=>{if(n<=0)return;const t=n===1?"1 fois":`${n} fois`;e.save(),e.font="600 1rem system-ui, sans-serif",e.textAlign="center";const l=e.measureText(t).width,i=12,a=o/2-l/2-i,s=50;e.fillStyle=u("#1e1b4b",.6),e.beginPath(),e.roundRect(a,s,l+i*2,32,8),e.fill(),e.fillStyle=u("#fcd34d",.85),e.fillText(t,o/2,s+22),e.restore()},na=(e,n,o,t,l)=>{if(l)return;const i=.3+Math.sin(t*.04)*.1;e.save(),e.fillStyle=u("#fef9c3",i),e.font="1.1rem system-ui, sans-serif",e.textAlign="center",e.fillText("Souffle pour éteindre les bougies !",n/2,o*.15),e.restore()},ta=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:it})},oa=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:"#fcd34d",cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u("#1e1b4b",.7),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},la=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u("#fef9c3",.6),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},aa=()=>{let e=null,n=null,o=0,t=0,l=null,i=null,a=[],s=new Map,r=[],f=0,c=0,h=!1,d=0,p=!1,v=0;const A=()=>t*.7,_=()=>Pe(o/(vn*2.5),16,36),k=()=>Pe(t*.18,50,120),g=()=>{a=a.map(S=>({...S,flameScale:1,extinguished:!1,blowAccumulator:0})),s=new Map,h=!1,p=!1,d=0},y=()=>{p=!0,h=!0,d=0,f+=1,r=Vl(o,t)},m=()=>{if(!n)return;c+=1,ee(n,o,t);const S=A(),E=_(),R=k(),F=S-R-8;Kl(n,o,t),Zl(n,o,t,S);for(const[I,D]of s.entries()){const j=D.map(Ul).filter(Yl);j.length===0?s.delete(I):s.set(I,j)}for(let I=0;I<a.length;I++){const D=a[I];if(D.extinguished&&Math.random()<_l){const j=s.get(I)??[];j.length<Bl&&s.set(I,[...j,jl(D.x,F)])}}for(let I=0;I<a.length;I++){const D=a[I];if(Jl(n,D.x,S,E,R,D.bodyColor),!D.extinguished){const q=Math.sin(c*Tn+I*1.7),B=Math.sin(c*Tn*1.6+I*2.3)*.5,W=(q+B)*Dl;Ql(n,D.x,F,D.flameScale,W)}const j=s.get(I);j&&zl(n,j)}a=a.map((I,D)=>{if(I.extinguished)return I;if(Gl(a)===D&&v>Ml){const N=I.blowAccumulator+1,U=Pe(1-N*El,0,1);return U<=0?{...I,flameScale:0,extinguished:!0,blowAccumulator:0}:{...I,flameScale:U,blowAccumulator:N}}const W=Pe(I.flameScale+Il,0,1),H=Math.max(0,I.blowAccumulator-.5);return{...I,flameScale:W,blowAccumulator:H}}),!h&&a.every(I=>I.extinguished)&&y(),p&&(r=r.map(Xl).filter(ql),xl(n,r),d+=1,d>=Rl&&g()),na(n,o,t,c,h),ea(n,f,o),l=requestAnimationFrame(m)},T=()=>{if(!e||!n)return;const S=X(e,n);o=S.width,t=S.height,a=Mn(a,o)};return{id:"candles",name:"Bougies",description:"Souffle pour éteindre les bougies",mount:S=>{const E=M("div",{});ta(E);const R=M("button",{},"← Accueil");oa(R),R.addEventListener("click",()=>{window.location.hash="#menu"});const F=M("p",{},"Bougies");la(F),E.appendChild(R),E.appendChild(F),S.appendChild(E);const I=J(E);e=I.canvas,n=I.ctx,o=I.width,t=I.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),a=Mn($l(vn),o),s=new Map,r=[],f=0,c=0,h=!1,d=0,p=!1,v=0,i=T,window.addEventListener("resize",i),m()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),i&&(window.removeEventListener("resize",i),i=null),e=null,n=null,a=[],s=new Map,r=[],f=0,c=0,h=!1,d=0,p=!1,v=0,o=0,t=0},update:S=>{v=S.volume}}},st=80,ia=600,sa=ia-st,ra=1.5,An=4,da=30,fa=1.5,ca=.35,Oe=["#ef4444","#f97316","#eab308","#22c55e","#06b6d4","#3b82f6","#8b5cf6"],rt=e=>Math.max(0,Math.min(1,(e-st)/sa)),ha=(e,n)=>{const t=n-80,l=rt(e);return 40+t*(1-l)},ua=e=>{const n=rt(e),o=Math.min(Oe.length-1,Math.floor(n*Oe.length));return Oe[o]},pa=e=>An+e*(da-An),ga=(e,n,o,t,l)=>{const i=e.createRadialGradient(n,o,0,n,o,t);i.addColorStop(0,u(l,.85)),i.addColorStop(.5,u(l,.5)),i.addColorStop(1,u(l,0)),e.beginPath(),e.arc(n,o,t,0,Math.PI*2),e.fillStyle=i,e.fill()},ma=(e,n,o)=>{e.beginPath(),e.moveTo(n,0),e.lineTo(n,o),e.strokeStyle=u(C.text,ca),e.lineWidth=fa,e.stroke()},ba=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:C.bg})},Sa=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:C.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u(C.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},ya=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u(C.primary,.5),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},wa=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1rem",fontWeight:"600",color:C.secondary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u(C.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},va=()=>{let e=null,n=null,o=0,t=0,l=null,i=null,a=null,s=null,r=0,f=!0;const c=()=>{if(!e||(a||(a=document.createElement("canvas"),s=a.getContext("2d")),!a||!s))return;const g=window.devicePixelRatio||1;if(a.width!==e.width||a.height!==e.height){const y=document.createElement("canvas");y.width=a.width,y.height=a.height;const m=y.getContext("2d");m&&a.width>0&&a.height>0&&m.drawImage(a,0,0),a.width=e.width,a.height=e.height,s.setTransform(g,0,0,g,0,0),y.width>0&&y.height>0&&(s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(y,0,0,a.width,a.height),s.setTransform(g,0,0,g,0,0),s.restore())}},h=()=>{if(!s||!a)return;s.save(),s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,a.width,a.height),s.restore();const g=window.devicePixelRatio||1;s.setTransform(g,0,0,g,0,0),r=0,f=!0},d=()=>{if(!n||!a)return;n.fillStyle=C.bg,n.fillRect(0,0,o,t),n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(a,0,0),n.restore();const g=window.devicePixelRatio||1;n.setTransform(g,0,0,g,0,0),ma(n,r,t)},p=()=>{n&&(f&&(d(),f=!1),l=requestAnimationFrame(p))},v=()=>{if(!e||!n)return;const g=X(e,n);o=g.width,t=g.height,c(),f=!0};return{id:"piano",name:"Piano Visuel",description:"Peins avec ta voix",mount:g=>{const y=M("div",{});ba(y);const m=M("button",{},"← Accueil");Sa(m),m.addEventListener("click",()=>{window.location.hash="#menu"});const T=M("p",{},"Piano Visuel");ya(T);const w=M("button",{},"Effacer");wa(w),w.addEventListener("click",h),y.appendChild(m),y.appendChild(T),y.appendChild(w),g.appendChild(y);const b=J(y);e=b.canvas,n=b.ctx,o=b.width,t=b.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),c(),r=0,f=!0,i=v,window.addEventListener("resize",i),p()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),i&&(window.removeEventListener("resize",i),i=null),e=null,n=null,a=null,s=null,r=0,f=!1,o=0,t=0},update:g=>{if(s){if(r+=ra,r>o&&(r=0),g.isVoicing&&g.pitch!==null){const y=ha(g.pitch,t),m=pa(g.volume),T=ua(g.pitch);ga(s,r,y,m,T)}f=!0}}}},Ta=1.3,Pa=.06,Ca=.03,Ma=.6,En=6,In=2.5,Aa=.015,Ea=10,dt=50,Ia=4,K=(e,n,o,t,l,i,a,s)=>{e.beginPath(),e.moveTo(n,o),e.lineTo(t,l),e.lineTo(i,a),e.closePath(),e.fillStyle=s,e.fill()},Ae=(e,n,o,t,l,i)=>{e.beginPath(),e.ellipse(n,o,t,l,0,0,Math.PI*2),e.fillStyle=i,e.fill()},L=(e,n,o,t,l)=>{e.beginPath(),e.arc(n,o,t,0,Math.PI*2),e.fillStyle=l,e.fill()},Ra=(e,n,o,t,l)=>{L(e,n,o,t,l),K(e,n-t*.7,o-t*.4,n-t*.35,o-t*1.15,n-t*.05,o-t*.55,l),K(e,n+t*.05,o-t*.55,n+t*.35,o-t*1.15,n+t*.7,o-t*.4,l);const i=u("#fca5a5",.8);K(e,n-t*.58,o-t*.48,n-t*.38,o-t*.95,n-t*.15,o-t*.58,i),K(e,n+t*.15,o-t*.58,n+t*.38,o-t*.95,n+t*.58,o-t*.48,i),L(e,n-t*.3,o-t*.15,t*.13,"#2d3748"),L(e,n+t*.3,o-t*.15,t*.13,"#2d3748"),L(e,n-t*.26,o-t*.2,t*.045,"#ffffff"),L(e,n+t*.34,o-t*.2,t*.045,"#ffffff"),K(e,n,o+t*.05,n-t*.08,o+t*.15,n+t*.08,o+t*.15,"#f472b6"),e.beginPath(),e.moveTo(n,o+t*.15),e.lineTo(n-t*.12,o+t*.3),e.moveTo(n,o+t*.15),e.lineTo(n+t*.12,o+t*.3),e.strokeStyle="#2d3748",e.lineWidth=1.5,e.stroke(),e.beginPath(),e.moveTo(n-t*.3,o+t*.1),e.lineTo(n-t*.85,o+t*0),e.moveTo(n-t*.3,o+t*.2),e.lineTo(n-t*.85,o+t*.25),e.moveTo(n+t*.3,o+t*.1),e.lineTo(n+t*.85,o+t*0),e.moveTo(n+t*.3,o+t*.2),e.lineTo(n+t*.85,o+t*.25),e.strokeStyle="#94a3b8",e.lineWidth=1.2,e.stroke()},ka=(e,n,o,t,l)=>{L(e,n,o,t,l),L(e,n,o+t*.2,t*.6,u("#fef3c7",.9));const i=t*.3;L(e,n-t*.32,o-t*.15,i,"#ffffff"),L(e,n+t*.32,o-t*.15,i,"#ffffff"),L(e,n-t*.32,o-t*.15,i*.55,"#2d3748"),L(e,n+t*.32,o-t*.15,i*.55,"#2d3748"),L(e,n-t*.26,o-t*.22,i*.2,"#ffffff"),L(e,n+t*.38,o-t*.22,i*.2,"#ffffff"),e.beginPath(),e.arc(n-t*.32,o-t*.15,i,0,Math.PI*2),e.strokeStyle=u("#2d3748",.3),e.lineWidth=1.5,e.stroke(),e.beginPath(),e.arc(n+t*.32,o-t*.15,i,0,Math.PI*2),e.stroke(),K(e,n,o+t*.05,n-t*.1,o+t*.2,n+t*.1,o+t*.2,"#f59e0b"),K(e,n-t*.55,o-t*.65,n-t*.35,o-t*1.1,n-t*.15,o-t*.65,l),K(e,n+t*.15,o-t*.65,n+t*.35,o-t*1.1,n+t*.55,o-t*.65,l)},Fa=(e,n,o,t,l)=>{L(e,n,o,t*.85,l),L(e,n-t*.6,o-t*.7,t*.5,l),L(e,n+t*.6,o-t*.7,t*.5,l),L(e,n-t*.6,o-t*.7,t*.32,u("#fca5a5",.7)),L(e,n+t*.6,o-t*.7,t*.32,u("#fca5a5",.7)),L(e,n-t*.25,o-t*.15,t*.12,"#2d3748"),L(e,n+t*.25,o-t*.15,t*.12,"#2d3748"),L(e,n-t*.21,o-t*.2,t*.04,"#ffffff"),L(e,n+t*.29,o-t*.2,t*.04,"#ffffff"),L(e,n,o+t*.15,t*.1,"#f472b6"),e.beginPath(),e.moveTo(n-t*.2,o+t*.15),e.lineTo(n-t*.75,o+t*.05),e.moveTo(n-t*.2,o+t*.22),e.lineTo(n-t*.75,o+t*.28),e.moveTo(n+t*.2,o+t*.15),e.lineTo(n+t*.75,o+t*.05),e.moveTo(n+t*.2,o+t*.22),e.lineTo(n+t*.75,o+t*.28),e.strokeStyle="#94a3b8",e.lineWidth=1,e.stroke(),e.beginPath(),e.moveTo(n+t*.5,o+t*.6),e.quadraticCurveTo(n+t*1.5,o+t*.2,n+t*1.3,o-t*.3),e.strokeStyle=l,e.lineWidth=2.5,e.lineCap="round",e.stroke()},Oa=(e,n,o,t,l)=>{L(e,n-t*.65,o-t*.65,t*.32,l),L(e,n+t*.65,o-t*.65,t*.32,l),L(e,n-t*.65,o-t*.65,t*.18,u("#d4a574",.8)),L(e,n+t*.65,o-t*.65,t*.18,u("#d4a574",.8)),L(e,n,o,t,l),Ae(e,n,o+t*.15,t*.4,t*.3,u("#d4a574",.7)),L(e,n-t*.3,o-t*.15,t*.11,"#2d3748"),L(e,n+t*.3,o-t*.15,t*.11,"#2d3748"),L(e,n-t*.27,o-t*.2,t*.04,"#ffffff"),L(e,n+t*.33,o-t*.2,t*.04,"#ffffff"),Ae(e,n,o+t*.05,t*.11,t*.08,"#2d3748"),e.beginPath(),e.moveTo(n,o+t*.13),e.lineTo(n-t*.08,o+t*.25),e.moveTo(n,o+t*.13),e.lineTo(n+t*.08,o+t*.25),e.strokeStyle="#2d3748",e.lineWidth=1.2,e.stroke()},_a=(e,n,o,t,l)=>{Ae(e,n,o,t*.9,t,l),Ae(e,n,o+t*.2,t*.55,t*.55,u("#fef3c7",.8)),e.beginPath(),e.ellipse(n-t*.55,o-t*.05,t*.5,t*.28,-.3,0,Math.PI*2),e.fillStyle=u(l,.7),e.fill(),L(e,n+t*.15,o-t*.25,t*.12,"#2d3748"),L(e,n+t*.19,o-t*.3,t*.04,"#ffffff"),K(e,n+t*.55,o-t*.15,n+t*.55,o+t*.05,n+t*.95,o-t*.05,"#f59e0b"),K(e,n-t*.7,o-t*.3,n-t*1.15,o-t*.65,n-t*.5,o-t*.6,l),K(e,n-t*.75,o-t*.15,n-t*1.25,o-t*.35,n-t*.6,o-t*.45,u(l,.8))},te=[{name:"Chat",vowel:"a",label:"AAA",draw:Ra},{name:"Hibou",vowel:"o",label:"OOO",draw:ka},{name:"Souris",vowel:"i",label:"III",draw:Fa},{name:"Ours",vowel:"u",label:"UUU",draw:Oa},{name:"Oiseau",vowel:"e",label:"EEE",draw:_a}],La=(e,n,o)=>{const t=[];for(let l=0;l<En;l++){const i=Math.PI*2*l/En+(Math.random()-.5)*.5;t.push({x:e,y:n-dt,vx:Math.cos(i)*In*(.7+Math.random()*.6),vy:Math.sin(i)*In*(.7+Math.random()*.6)-1.5,alpha:1,size:Ea*(.7+Math.random()*.6),kind:Math.random()>.5?"heart":"star",color:o})}return t},Ba=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,vy:e.vy+.04,alpha:e.alpha-Aa}),Da=e=>e.alpha>0,Wa=(e,n,o,t,l,i)=>{e.save(),e.globalAlpha=i,e.fillStyle=l,e.beginPath();const a=t*.5;e.moveTo(n,o+a*.3),e.bezierCurveTo(n,o-a*.2,n-a,o-a*.5,n-a,o+a*.1),e.bezierCurveTo(n-a,o+a*.6,n,o+a*.9,n,o+a*1.1),e.bezierCurveTo(n,o+a*.9,n+a,o+a*.6,n+a,o+a*.1),e.bezierCurveTo(n+a,o-a*.5,n,o-a*.2,n,o+a*.3),e.fill(),e.restore()},Na=(e,n,o,t,l,i)=>{e.save(),e.globalAlpha=i,e.fillStyle=l,e.beginPath();const a=5,s=t*.5,r=s*.4;for(let f=0;f<a*2;f++){const c=f%2===0?s:r,h=Math.PI*f/a-Math.PI/2,d=n+Math.cos(h)*c,p=o+Math.sin(h)*c;f===0?e.moveTo(d,p):e.lineTo(d,p)}e.closePath(),e.fill(),e.restore()},Ha=(e,n)=>{n.kind==="heart"?Wa(e,n.x,n.y,n.size,n.color,n.alpha):Na(e,n.x,n.y,n.size,n.color,n.alpha)},$a=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:C.bg})},Ga=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:C.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u(C.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},ja=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:C.text,margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},Rn=(e,n,o)=>{const t=e/(o+1),l=n*.42,i=[];for(let a=0;a<o;a++)i.push({x:t*(a+1),y:l});return i},Ua=()=>{let e=null,n=null,o=0,t=0,l=null,i=null,a=te.map(()=>({scale:1,targetScale:1,glowAlpha:0,feedCount:0,particles:[]})),s=0,r=null;const f=()=>{a=te.map(()=>({scale:1,targetScale:1,glowAlpha:0,feedCount:0,particles:[]})),s=0,r=null},c=()=>{const g=o/(te.length*2.5),y=t*.15;return Math.max(25,Math.min(dt,g,y))},h=()=>{if(!n)return;ee(n,o,t),n.fillStyle=C.bg,n.fillRect(0,0,o,t);const g=Rn(o,t,te.length),y=c();for(let m=0;m<te.length;m++){const T=te[m],w=a[m],b=g[m],P=Y[T.vowel]??C.primary;if(n.save(),w.glowAlpha>0){const F=y*1.6*w.scale,I=n.createRadialGradient(b.x,b.y,y*.3,b.x,b.y,F);I.addColorStop(0,u(P,w.glowAlpha*.5)),I.addColorStop(1,u(P,0)),n.fillStyle=I,n.fillRect(b.x-F,b.y-F,F*2,F*2)}n.translate(b.x,b.y),n.scale(w.scale,w.scale),n.translate(-b.x,-b.y),T.draw(n,b.x,b.y,y,P),n.restore();for(const F of w.particles)Ha(n,F);const S=b.y+y*1.6;n.font=`bold ${Math.round(y*.55)}px system-ui, -apple-system, sans-serif`,n.textAlign="center",n.textBaseline="top",n.fillStyle=P,n.fillText(T.label,b.x,S);const E=b.y-y*1.5;n.font=`600 ${Math.round(y*.38)}px system-ui, -apple-system, sans-serif`,n.fillStyle=C.text,n.fillText(T.name,b.x,E);const R=b.y+y*1.6+y*.65;n.font=`600 ${Math.round(y*.32)}px system-ui, -apple-system, sans-serif`,n.fillStyle=C.muted,n.fillText(`${w.feedCount}`,b.x,R)}},d=()=>{a=a.map(g=>{const y=g.scale+(g.targetScale-g.scale)*Pa*3,m=Math.max(0,g.glowAlpha-Ca),T=g.particles.map(Ba).filter(Da),w=Math.abs(g.scale-1)<.01&&g.targetScale>1||g.targetScale>1&&y>g.targetScale*.95?1:g.targetScale;return{...g,scale:y,targetScale:w,glowAlpha:m,particles:T}}),h(),l=requestAnimationFrame(d)},p=()=>{if(!e||!n)return;const g=X(e,n);o=g.width,t=g.height},v=g=>{const y=te[g],m=Rn(o,t,te.length)[g],T=Y[y.vowel]??C.primary;a=a.map((w,b)=>b!==g?w:{...w,targetScale:Ta,glowAlpha:Ma,feedCount:w.feedCount+1,particles:[...w.particles,...La(m.x,m.y,T)]})};return{id:"animals",name:"Nourrir les Animaux",description:"Nourris les animaux en prononçant la bonne voyelle !",mount:g=>{const y=M("div",{});$a(y);const m=M("button",{},"← Accueil");Ga(m),m.addEventListener("click",()=>{window.location.hash="#menu"});const T=M("p",{},"Nourrir les Animaux");ja(T),y.appendChild(m),y.appendChild(T),g.appendChild(y);const w=J(y);e=w.canvas,n=w.ctx,o=w.width,t=w.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),i=p,window.addEventListener("resize",i),f(),d()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),i&&(window.removeEventListener("resize",i),i=null),e=null,n=null,o=0,t=0,f()},update:g=>{if(!g.isVoicing||g.vowel===null){s=0,r=null;return}if(s+=1,s>=Ia&&g.vowel!==r){const y=te.findIndex(m=>m.vowel===g.vowel);y!==-1&&(v(y),r=g.vowel)}}}},ae=["a","e","i","o","u"],Ee=5,Ya=.04,kn=.18,ft=.88,Ye=.15,ct=.04,Va=.06,Xa=.03,qa=2,Ka=Math.round(qa*60),ht=.35,ut=3,Fn=["#ef4444","#f59e0b","#22c55e","#3b82f6","#ec4899","#f97316"],On=["#f472b6","#c084fc","#67e8f9","#fbbf24","#a78bfa"],_n=["#fbbf24","#fde047","#f59e0b","#fcd34d","#facc15"],Ln=["#93c5fd","#a5b4fc","#c4b5fd","#67e8f9","#7dd3fc"],G=(e,n)=>e+Math.random()*(n-e),_e=()=>ae.map(e=>({vowel:e,color:Y[e]??C.primary,openAmount:0,isOpening:!1,surpriseTime:0,surpriseFrame:0})),Ie=(e,n,o)=>{const t=n*Ya,l=t*(Ee+1),i=(n-l)/Ee,a=t+e*(i+t),s=o*kn,r=o*(ft-kn);return{x:a,y:s,w:i,h:r}},Za=(e,n)=>{const o=[];for(let l=0;l<18;l++){const i=Math.PI*2*l/18+G(-.2,.2),a=G(1.5,4);o.push({x:e,y:n,vx:Math.cos(i)*a,vy:Math.sin(i)*a,color:Fn[Math.floor(Math.random()*Fn.length)],alpha:1,size:G(3,7),life:1})}return o},Ja=(e,n,o)=>{const t=[];for(let i=0;i<8;i++)t.push({x:e+G(-20,20),y:n+G(0,o*.5),vx:G(-.8,.8),vy:G(-2,-.8),color:On[Math.floor(Math.random()*On.length)],alpha:1,size:G(6,12),life:1});return t},Qa=(e,n,o)=>{const t=[];for(let i=0;i<15;i++)t.push({x:e+G(-o*.4,o*.4),y:n-G(10,40),vx:G(-.5,.5),vy:G(1,3),color:_n[Math.floor(Math.random()*_n.length)],alpha:1,size:G(4,8),life:1});return t},za=(e,n,o)=>{const t=[];for(let i=0;i<10;i++)t.push({x:e+G(-15,15),y:n+G(0,o*.5),vx:G(-.3,.3),vy:G(-2.5,-1),color:Ln[Math.floor(Math.random()*Ln.length)],alpha:.85,size:G(5,14),life:1});return t},xa=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,alpha:Math.max(0,e.alpha-.008),life:Math.max(0,e.life-.008)}),ei=e=>e.life>0&&e.alpha>0,pt=(e,n,o,t,l,i,a,s)=>{e.beginPath(),e.moveTo(n,o+l),e.lineTo(n,o+i),e.arcTo(n,o,n+t/2,o,i),e.arcTo(n+t,o,n+t,o+i,i),e.lineTo(n+t,o+l),e.closePath(),e.fillStyle=a,e.fill(),e.strokeStyle=s,e.lineWidth=ut,e.stroke()},gt=(e,n,o,t,l,i)=>{const a=n+t*.75,s=o+l*.52;e.beginPath(),e.arc(a,s,i,0,Math.PI*2),e.fillStyle="#d4af37",e.fill(),e.strokeStyle="#b8960c",e.lineWidth=1.5,e.stroke(),e.beginPath(),e.arc(a-i*.25,s-i*.25,i*.35,0,Math.PI*2),e.fillStyle=u("#ffffff",.5),e.fill()},mt=(e,n,o,t,l,i,a)=>{e.font=`bold ${a}px sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillStyle=u("#ffffff",.9),e.fillText(n.toUpperCase(),o+l/2,t+i*.45)},ni=(e,n,o,t,l)=>{const{x:i,y:a,w:s,h:r}=Ie(o,t,l),f=r*Ye,c=s*ct;pt(e,i,a,s,r,f,n.color,u(n.color,.7)),gt(e,i,a,s,r,c),mt(e,n.vowel,i,a,s,r,s*ht)},ti=(e,n,o,t,l,i,a)=>{e.beginPath(),e.moveTo(n,o+l),e.lineTo(n,o+i),e.arcTo(n,o,n+t/2,o,i),e.arcTo(n+t,o,n+t,o+i,i),e.lineTo(n+t,o+l),e.closePath(),e.fillStyle=u(a,.12),e.fill(),e.strokeStyle=u(a,.4),e.lineWidth=ut,e.stroke()},oi=(e,n,o,t,l)=>{const{x:i,y:a,w:s,h:r}=Ie(o,t,l),f=r*Ye,c=n.openAmount;ti(e,i,a,s,r,f,n.color);const h=s*(1-c*.8),d=i+(s-h),p=h*ct,v=u("#000000",c*.15);e.save(),pt(e,d,a,h,r,f*(1-c*.3),n.color,u(n.color,.7)),e.beginPath(),e.moveTo(d,a+r),e.lineTo(d,a+f),e.arcTo(d,a,d+h/2,a,f*(1-c*.3)),e.arcTo(d+h,a,d+h,a+f,f*(1-c*.3)),e.lineTo(d+h,a+r),e.closePath(),e.fillStyle=v,e.fill(),c<.6&&(gt(e,d,a,h,r,p),mt(e,n.vowel,d,a,h,r,h*ht)),e.restore()},li=(e,n)=>{e.beginPath(),e.arc(n.x,n.y,n.size,0,Math.PI*2),e.fillStyle=u(n.color,n.alpha),e.fill()},ai=(e,n,o)=>{const t=Math.sin(o*.15+n.x)*4;e.save(),e.translate(n.x,n.y),e.fillStyle=u(n.color,n.alpha),e.beginPath(),e.ellipse(-n.size*.4,0,n.size*.5,n.size*.3+t*.3,-.3,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(n.size*.4,0,n.size*.5,n.size*.3+t*.3,.3,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(0,0,n.size*.12,n.size*.4,0,0,Math.PI*2),e.fillStyle=u("#4a3728",n.alpha),e.fill(),e.restore()},ii=(e,n,o)=>{const t=o*.03+n.x*.01,l=5,i=n.size,a=n.size*.45;e.save(),e.translate(n.x,n.y),e.rotate(t),e.beginPath();for(let s=0;s<l*2;s++){const r=Math.PI*s/l-Math.PI/2,f=s%2===0?i:a;s===0?e.moveTo(Math.cos(r)*f,Math.sin(r)*f):e.lineTo(Math.cos(r)*f,Math.sin(r)*f)}e.closePath(),e.fillStyle=u(n.color,n.alpha),e.fill(),e.restore()},si=(e,n,o,t,l,i)=>{const a=["#ef4444","#f97316","#fbbf24","#22c55e","#3b82f6","#8b5cf6","#a855f7"],s=n+t/2,r=o+l*.8,f=t*.45,c=f/(a.length+2),h=Math.PI*Math.min(i,1);e.save(),e.beginPath(),e.rect(n,o,t,l),e.clip();for(let d=0;d<a.length;d++){const p=f-d*c;e.beginPath(),e.arc(s,r,p,Math.PI,Math.PI+h,!1),e.strokeStyle=u(a[d],.8),e.lineWidth=c*.9,e.lineCap="round",e.stroke()}e.restore()},ri=(e,n)=>{e.beginPath(),e.arc(n.x,n.y,n.size,0,Math.PI*2),e.fillStyle=u(n.color,n.alpha*.4),e.fill(),e.strokeStyle=u(n.color,n.alpha*.7),e.lineWidth=1.5,e.stroke(),e.beginPath(),e.arc(n.x-n.size*.25,n.y-n.size*.25,n.size*.25,0,Math.PI*2),e.fillStyle=u("#ffffff",n.alpha*.6),e.fill()},di=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:C.bg})},fi=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:C.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u(C.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},ci=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u(C.primary,.5),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},hi=()=>{let e=null,n=null,o=0,t=0,l=null,i=null,a=[..._e()],s=ae.map(()=>[]),r=ae.map(()=>!1);const f=g=>{const y=a[g];y.isOpening||(a[g]={...y,isOpening:!0,surpriseTime:Ka,surpriseFrame:0},r[g]=!1)},c=()=>{a=a.map((g,y)=>{if(g.isOpening){const m=Math.min(1,g.openAmount+Va),T=g.surpriseTime-1,w=g.surpriseFrame+1;if(m>.4&&!r[y]){const b=Ie(y,o,t),P=b.x+b.w/2,S=b.y+b.h/2;switch(g.vowel){case"a":s[y]=Za(P,S);break;case"e":s[y]=Ja(P,S,b.h);break;case"i":s[y]=Qa(P,b.y,b.w);break;case"o":s[y]=[];break;case"u":s[y]=za(P,S,b.h);break}r[y]=!0}return T<=0?{...g,openAmount:m,isOpening:!1,surpriseTime:0,surpriseFrame:w}:{...g,openAmount:m,surpriseTime:T,surpriseFrame:w}}if(g.openAmount>0){const m=Math.max(0,g.openAmount-Xa);return m===0&&(s[y]=[],r[y]=!1),{...g,openAmount:m,surpriseFrame:g.surpriseFrame+1}}return g}),s=s.map(g=>g.map(xa).filter(ei))},h=()=>{if(n)for(let g=0;g<Ee;g++){const y=a[g];if(y.openAmount<.3)continue;const m=Ie(g,o,t);n.save();const T=m.h*Ye;switch(n.beginPath(),n.moveTo(m.x,m.y+m.h),n.lineTo(m.x,m.y+T),n.arcTo(m.x,m.y,m.x+m.w/2,m.y,T),n.arcTo(m.x+m.w,m.y,m.x+m.w,m.y+T,T),n.lineTo(m.x+m.w,m.y+m.h),n.closePath(),n.clip(),y.vowel){case"a":for(const w of s[g])li(n,w);break;case"e":for(const w of s[g])ai(n,w,y.surpriseFrame);break;case"i":for(const w of s[g])ii(n,w,y.surpriseFrame);break;case"o":{const w=Math.min(1,y.surpriseFrame/40);si(n,m.x,m.y,m.w,m.h,w);break}case"u":for(const w of s[g])ri(n,w);break}n.restore()}},d=()=>{if(!n)return;const g=t*ft;n.fillStyle=u(C.muted,.15),n.fillRect(0,g,o,t-g),n.strokeStyle=u(C.muted,.25),n.lineWidth=1,n.beginPath(),n.moveTo(0,g),n.lineTo(o,g),n.stroke()},p=()=>{if(n){ee(n,o,t),d(),c(),h();for(let g=0;g<Ee;g++){const y=a[g];y.openAmount>0?oi(n,y,g,o,t):ni(n,y,g,o,t)}l=requestAnimationFrame(p)}},v=()=>{if(!e||!n)return;const g=X(e,n);o=g.width,t=g.height};return{id:"doors",name:"Portes Magiques",description:"Ouvre les portes magiques avec ta voix !",mount:g=>{const y=M("div",{});di(y);const m=M("button",{},"← Accueil");fi(m),m.addEventListener("click",()=>{window.location.hash="#menu"});const T=M("p",{},"Portes Magiques");ci(T),y.appendChild(m),y.appendChild(T),g.appendChild(y);const w=J(y);e=w.canvas,n=w.ctx,o=w.width,t=w.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),i=v,window.addEventListener("resize",i),a=[..._e()],s=ae.map(()=>[]),r=ae.map(()=>!1),p()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),i&&(window.removeEventListener("resize",i),i=null),e=null,n=null,o=0,t=0,a=[..._e()],s=ae.map(()=>[]),r=ae.map(()=>!1)},update:g=>{if(!g.isVoicing||g.vowel===null)return;const y=g.vowel,m=ae.indexOf(y);m!==-1&&(g.volume<.05||f(m))}}},be=.15,ui=4,Ge=.55,Bn=18,Dn=10,pe=8,pi=14,gi=20,mi=.5,Wn=8,bi=60,Q=40,Nn=12,Hn=20,Ve=3,Xe=.002,$n=.3,bt=60,Gn=8,Le="#f472b6",ge=(e,n)=>e+Math.random()*(n-e),je=(e,n)=>Math.min(e/2,1)*n,jn=(e,n,o)=>({x:e,stemHeight:0,maxDuration:n,color:o,petalCount:n>=4?8:5,hasLeaves:n>=1,hasBud:n>=2,isOpen:n>=3,isFullBloom:n>=4,hasSparkles:n>=5}),Un=(e,n)=>({x:e+ge(-30,30),y:n+ge(-30,10),size:ge(2,5),alpha:1,vx:ge(-.5,.5),vy:ge(-1.5,-.3),life:bt}),Yn=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,alpha:e.life/bt,life:e.life-1}),Vn=e=>e.life>0,Si=(e,n,o)=>{const t=e.createLinearGradient(0,0,0,o);t.addColorStop(0,"#87CEEB"),t.addColorStop(.6,"#B0E0F0"),t.addColorStop(.85,"#d4f0d4"),e.fillStyle=t,e.fillRect(0,0,n,o)},yi=(e,n,o)=>{const t=o*(1-be),l=e.createLinearGradient(0,t,0,o);l.addColorStop(0,"#5cb85c"),l.addColorStop(1,"#3a8a3a"),e.fillStyle=l,e.fillRect(0,t,n,o*be),e.beginPath(),e.moveTo(0,t);for(let i=0;i<=n;i+=20){const a=t+Math.sin(i*.05)*4;e.lineTo(i,a)}e.lineTo(n,t+10),e.lineTo(0,t+10),e.closePath(),e.fillStyle="#5cb85c",e.fill()},wi=(e,n,o)=>{const t=n-70,l=70,i=1+Math.sin(o*.001)*.05,a=e.createRadialGradient(t,l,0,t,l,Q*2);a.addColorStop(0,u("#FFD700",.3)),a.addColorStop(1,u("#FFD700",0)),e.fillStyle=a,e.fillRect(t-Q*2,l-Q*2,Q*4,Q*4),e.save(),e.translate(t,l),e.rotate(o*3e-4);for(let s=0;s<Nn;s++){const r=s/Nn*Math.PI*2;e.beginPath(),e.moveTo(Math.cos(r)*Q*i,Math.sin(r)*Q*i),e.lineTo(Math.cos(r)*(Q+Hn)*i,Math.sin(r)*(Q+Hn)*i),e.strokeStyle=u("#FFD700",.6),e.lineWidth=3,e.stroke()}e.restore(),e.beginPath(),e.arc(t,l,Q*i,0,Math.PI*2),e.fillStyle="#FFD700",e.fill(),e.fillStyle="#E6A800",e.beginPath(),e.arc(t-12,l-8,4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(t+12,l-8,4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(t,l+2,14,.15*Math.PI,.85*Math.PI),e.strokeStyle="#E6A800",e.lineWidth=2.5,e.stroke()},vi=(e,n,o,t,l,i)=>{const a=o-t,s=Math.sin(l*Xe+i)*Ve,r=n+s,f=o-t*.5;e.beginPath(),e.moveTo(n,o),e.quadraticCurveTo(r,f,n+s,a),e.strokeStyle="#2d8a4e",e.lineWidth=ui,e.lineCap="round",e.stroke()},Ti=(e,n,o,t,l,i)=>{const a=Math.sin(l*Xe+i)*Ve,s=o-t*.4,r=n+a*.4-2;e.save(),e.translate(r,s),e.rotate(-.6),e.beginPath(),e.ellipse(0,0,Bn,Dn,0,0,Math.PI*2),e.fillStyle="#34d399",e.fill(),e.restore();const f=o-t*.65,c=n+a*.65+2;e.save(),e.translate(c,f),e.rotate(.6),e.beginPath(),e.ellipse(0,0,Bn,Dn,0,0,Math.PI*2),e.fillStyle="#34d399",e.fill(),e.restore()},Pi=(e,n,o,t)=>{e.save(),e.translate(n,o),e.beginPath(),e.ellipse(0,0,pe*.8,pe*1.2,0,0,Math.PI*2),e.fillStyle="#2d8a4e",e.fill(),e.beginPath(),e.ellipse(0,-pe*.3,pe*.5,pe*.5,0,0,Math.PI*2),e.fillStyle=u(t,.6),e.fill(),e.restore()},Ci=(e,n,o,t,l,i,a)=>{const s=i?gi:pi,r=s*mi,f=1+Math.sin(a*.003)*.03;e.save(),e.translate(n,o);for(let c=0;c<l;c++){const h=c/l*Math.PI*2;e.save(),e.rotate(h),e.beginPath(),e.ellipse(0,-s*.7*f,r*f,s*f,0,0,Math.PI*2),e.fillStyle=u(t,.85),e.fill(),e.beginPath(),e.ellipse(0,-s*.55*f,r*.5*f,s*.5*f,0,0,Math.PI*2),e.fillStyle=u("#ffffff",.25),e.fill(),e.restore()}e.beginPath(),e.arc(0,0,Wn*f,0,Math.PI*2),e.fillStyle="#FFD700",e.fill(),e.beginPath(),e.arc(-2,-2,Wn*.5*f,0,Math.PI*2),e.fillStyle=u("#ffffff",.4),e.fill(),e.restore()},Mi=(e,n)=>{e.save(),e.globalAlpha=n.alpha;const o=n.size;e.fillStyle="#FFD700",e.beginPath(),e.moveTo(n.x,n.y-o),e.lineTo(n.x+o*.3,n.y-o*.3),e.lineTo(n.x+o,n.y),e.lineTo(n.x+o*.3,n.y+o*.3),e.lineTo(n.x,n.y+o),e.lineTo(n.x-o*.3,n.y+o*.3),e.lineTo(n.x-o,n.y),e.lineTo(n.x-o*.3,n.y-o*.3),e.closePath(),e.fill(),e.restore()},Xn=(e,n,o,t,l)=>{const a=o*(1-be)+5,s=o*Ge,r=je(n.maxDuration,s),f=n.x*.1,c=Math.sin(t*Xe+f)*Ve,h=n.x+c,d=a-r;n.maxDuration>0&&vi(e,n.x,a,r,t,f),n.hasLeaves&&Ti(e,n.x,a,r,t,f),n.hasBud&&!n.isOpen&&Pi(e,h,d,n.color),n.isOpen&&Ci(e,h,d,n.color,n.petalCount,n.isFullBloom,t);for(const p of l)Mi(e,p)},Ai=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden"})},Ei=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:C.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u(C.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Ii=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u(C.text,.7),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:u(C.surface,.6),borderRadius:"12px",backdropFilter:"blur(4px)"})},Ri=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",fontSize:"1.1rem",fontWeight:"600",color:C.text,margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:u(C.surface,.8),borderRadius:"12px",backdropFilter:"blur(4px)"})},ki=(e,n)=>{if(e.length===0)return n/2;const o=n/2,t=e.length,l=t%2===0?1:-1,i=Math.ceil(t/2)*bi,a=o+l*i,s=40;return Math.max(s,Math.min(n-s,a))},Fi=()=>{let e=null,n=null,o=0,t=0,l=null,i=null,a=[],s=0,r=0,f=Le,c=!1,h=!1,d=new Map,p=null,v=0;const A=()=>{if(!p)return;const T=a.length;p.textContent=T===0?"Jardin: 0 fleur":T===1?"Jardin: 1 fleur":`Jardin: ${T} fleurs`},_=()=>{if(!n)return;const T=performance.now()-v;ee(n,o,t),Si(n,o,t),wi(n,o,T),yi(n,o,t);for(let w=0;w<a.length;w++){const b=a[w],P=d.get(w)??[];if(b.hasSparkles&&P.length<Gn&&Math.random()<$n){const E=t*(1-be),R=t*Ge,F=je(b.maxDuration,R),I=E+5-F;P.push(Un(b.x,I))}const S=P.map(Yn).filter(Vn);d.set(w,S),Xn(n,b,t,T,S)}if(h&&r>0){const w=jn(s,r,f),b=d.get(-1)??[];if(w.hasSparkles&&b.length<Gn&&Math.random()<$n){const S=t*(1-be),E=t*Ge,R=je(w.maxDuration,E),F=S+5-R;b.push(Un(s,F))}const P=b.map(Yn).filter(Vn);d.set(-1,P),Xn(n,w,t,T,P)}l=requestAnimationFrame(_)},k=()=>{if(!e||!n)return;const T=X(e,n);o=T.width,t=T.height};return{id:"flower",name:"Faire Pousser",description:"Fais pousser des fleurs avec ta voix !",mount:T=>{const w=M("div",{});Ai(w);const b=M("button",{},"← Accueil");Ei(b),b.addEventListener("click",()=>{window.location.hash="#menu"});const P=M("p",{},"Faire Pousser");Ii(P),p=M("p",{},"Jardin: 0 fleur"),Ri(p),w.appendChild(b),w.appendChild(P),w.appendChild(p),T.appendChild(w);const S=J(w);e=S.canvas,n=S.ctx,o=S.width,t=S.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),i=k,window.addEventListener("resize",i),a=[],d=new Map,r=0,f=Le,c=!1,h=!1,s=o/2,v=performance.now(),A(),_()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),i&&(window.removeEventListener("resize",i),i=null),e=null,n=null,p=null,a=[],d=new Map,r=0,c=!1,h=!1,o=0,t=0},update:T=>{const w=T.isVoicing;if(w)c||(h=!0,s=ki(a,o),r=0,f=Le,d.delete(-1)),r=T.duration,T.vowel!==null&&Y[T.vowel]&&(f=Y[T.vowel]);else if(c&&h&&r>.1){const b=jn(s,r,f);a.push(b);const P=d.get(-1)??[];d.set(a.length-1,P),d.delete(-1),h=!1,r=0,A()}else w||(h=!1,r=0,d.delete(-1));c=w}}},Be=20,Oi=130,_i=.72,Li=100,Bi=8,Di=.003,qn=2,Kn=3,oe=3,me=4,Wi=40,St=80,Ni=.12,Zn=["#ef4444","#f59e0b","#22c55e","#3b82f6","#8b5cf6","#ec4899","#f97316","#06b6d4","#FFD700","#ff6b6b"],Hi=5,$i=60,Gi=2e3,ji=-1.2,Jn=.3,Ui="#87CEEB",Yi="#B0E0F0",Vi="#d4f0d4",Xi="#ffffff",x=(e,n)=>e+Math.random()*(n-e),ue=(e,n,o)=>Math.max(n,Math.min(o,e)),De=e=>{if(e<=0)return Be;const n=ue(e/me,0,1);return Be+n*(Oi-Be)},qi=(e,n)=>{if(e<oe)return n;const o=ue((e-oe)/(me-oe),0,1),t=parseInt(n.slice(1,3),16),l=parseInt(n.slice(3,5),16),i=parseInt(n.slice(5,7),16),a=Math.round(t+(240-t)*o),s=Math.round(l+(80-l)*o),r=Math.round(i+(80-i)*o);return`rgb(${a}, ${s}, ${r})`},Ki=(e,n)=>({x:e,y:n,vx:x(-6,6),vy:x(-10,-2),size:x(4,10),color:Zn[Math.floor(Math.random()*Zn.length)],life:St,gravity:Ni,rotation:x(0,Math.PI*2),rotationSpeed:x(-.15,.15),shape:["circle","rect","star"][Math.floor(Math.random()*3)]}),Zi=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,vy:e.vy+e.gravity,vx:e.vx*.99,life:e.life-1,rotation:e.rotation+e.rotationSpeed}),Ji=e=>e.life>0,Qi=(e,n,o)=>{const t=x(0,Math.PI*2),l=x(o*.6,o*1.2);return{x:e+Math.cos(t)*l,y:n+Math.sin(t)*l,size:x(3,7),alpha:1,angle:t,speed:x(.3,.8)}},zi=e=>({...e,x:e.x+Math.cos(e.angle)*e.speed,y:e.y+Math.sin(e.angle)*e.speed,alpha:e.alpha-1/$i}),xi=e=>e.alpha>0,es=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,alpha:e.alpha-.004,stringAngle:e.stringAngle+.02}),ns=e=>e.alpha>0&&e.y+e.radiusY>-50,ts=(e,n,o)=>{const t=e.createLinearGradient(0,0,0,o);t.addColorStop(0,Ui),t.addColorStop(.6,Yi),t.addColorStop(1,Vi),e.fillStyle=t,e.fillRect(0,0,n,o)},We=(e,n,o,t)=>{e.save(),e.translate(n,o),e.scale(t,t),e.fillStyle=u(Xi,.6);const l=[{cx:0,cy:0,r:25},{cx:-22,cy:5,r:20},{cx:22,cy:5,r:20},{cx:-10,cy:-12,r:18},{cx:12,cy:-10,r:16}];for(const i of l)e.beginPath(),e.arc(i.cx,i.cy,i.r,0,Math.PI*2),e.fill();e.restore()},os=(e,n,o)=>{const t=o*.01;We(e,(n*.15+t)%(n+100)-50,60,1),We(e,(n*.55+t*.7)%(n+100)-50,90,.8),We(e,(n*.85+t*.5)%(n+100)-50,45,1.2)},ls=(e,n,o)=>{const t=o*.88,l=e.createLinearGradient(0,t,0,o);l.addColorStop(0,"#5cb85c"),l.addColorStop(1,"#3a8a3a"),e.fillStyle=l,e.fillRect(0,t,n,o-t),e.beginPath(),e.moveTo(0,t);for(let i=0;i<=n;i+=20){const a=t+Math.sin(i*.05)*4;e.lineTo(i,a)}e.lineTo(n,t+10),e.lineTo(0,t+10),e.closePath(),e.fillStyle="#5cb85c",e.fill()},yt=(e,n,o,t,l,i,a)=>{const s=(n+t)/2+Math.sin(i*Di)*Bi+a,r=(o+l)/2;e.beginPath(),e.moveTo(n,o),e.quadraticCurveTo(s,r,t,l),e.strokeStyle=u(C.text,.5),e.lineWidth=2,e.lineCap="round",e.stroke()},wt=(e,n,o,t,l,i,a)=>{e.save(),e.translate(n,o),e.rotate(a*.05),e.beginPath(),e.ellipse(0,0,t,l,0,0,Math.PI*2);const s=e.createRadialGradient(-t*.3,-l*.3,t*.1,0,0,l);s.addColorStop(0,u("#ffffff",.6)),s.addColorStop(.3,i),s.addColorStop(1,u(i,.85)),e.fillStyle=s,e.fill(),e.beginPath(),e.ellipse(-t*.3,-l*.35,t*.2,l*.15,-.4,0,Math.PI*2),e.fillStyle=u("#ffffff",.4),e.fill(),e.beginPath(),e.moveTo(-4,l),e.lineTo(0,l+8),e.lineTo(4,l),e.closePath(),e.fillStyle=i,e.fill(),e.restore()},as=(e,n,o,t,l)=>{const i=1+Math.sin(l*.008)*.15,a=t*1.5*i,s=e.createRadialGradient(n,o,t*.8,n,o,a);s.addColorStop(0,u(C.green,.25)),s.addColorStop(1,u(C.green,0)),e.fillStyle=s,e.beginPath(),e.arc(n,o,a,0,Math.PI*2),e.fill()},is=(e,n,o,t,l)=>{e.save(),e.globalAlpha=l,e.fillStyle="#FFD700",e.beginPath(),e.moveTo(n,o-t),e.lineTo(n+t*.3,o-t*.3),e.lineTo(n+t,o),e.lineTo(n+t*.3,o+t*.3),e.lineTo(n,o+t),e.lineTo(n-t*.3,o+t*.3),e.lineTo(n-t,o),e.lineTo(n-t*.3,o-t*.3),e.closePath(),e.fill(),e.restore()},ss=(e,n)=>{const o=ue(n.life/St,0,1);if(e.save(),e.translate(n.x,n.y),e.rotate(n.rotation),e.globalAlpha=o,n.shape==="circle")e.beginPath(),e.arc(0,0,n.size/2,0,Math.PI*2),e.fillStyle=n.color,e.fill();else if(n.shape==="rect")e.fillStyle=n.color,e.fillRect(-n.size/2,-n.size/4,n.size,n.size/2);else{e.fillStyle=n.color,e.beginPath();for(let t=0;t<5;t++){const l=t*2*Math.PI/5-Math.PI/2,i=l+Math.PI/5,a=n.size/2,s=n.size/4;t===0?e.moveTo(Math.cos(l)*a,Math.sin(l)*a):e.lineTo(Math.cos(l)*a,Math.sin(l)*a),e.lineTo(Math.cos(i)*s,Math.sin(i)*s)}e.closePath(),e.fill()}e.restore()},rs=(e,n,o)=>{e.save(),e.globalAlpha=n.alpha,wt(e,n.x,n.y,n.radiusX,n.radiusY,n.color,0);const t=n.x+Math.sin(n.stringAngle)*15,l=n.y+n.radiusY+8+Li*.6;yt(e,n.x,n.y+n.radiusY+8,t,l,o,Math.sin(n.stringAngle)*5),e.restore()},ds=(e,n,o,t)=>{const l=1+t*.02,i=ue(1-t/40,0,1);i<=0||(e.save(),e.translate(n,o-20-t*1.5),e.scale(l,l),e.globalAlpha=i,e.font="bold 28px inherit",e.textAlign="center",e.textBaseline="middle",e.fillStyle="#FFD700",e.strokeStyle=u("#ffffff",.8),e.lineWidth=3,e.strokeText("POP!",0,0),e.fillText("POP!",0,0),e.restore())},fs=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden"})},cs=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:C.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u(C.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},hs=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u(C.text,.7),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:u(C.surface,.6),borderRadius:"12px",backdropFilter:"blur(4px)"})},us=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",fontSize:"1.1rem",fontWeight:"600",color:C.text,margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:u(C.surface,.8),borderRadius:"12px",backdropFilter:"blur(4px)"})},ps=()=>{let e=null,n=null,o=0,t=0,l=null,i=null,a="idle",s=0,r=C.secondary,f=!1,c=0,h=null,d=[],p=[],v=[],A=0,_=0,k=0,g=!1,y=null,m=0;const T=()=>o/2,w=()=>t*_i,b=()=>t*.88,P=()=>{h&&(h.textContent=c===0?"Ballons: 0":`Ballons: ${c}`)},S=()=>{y!==null&&clearTimeout(y),y=setTimeout(()=>{a="idle",s=0,g=!1,y=null},Gi)},E=(B,W)=>{a="popped",_=B,k=W,A=0,g=!0;for(let H=0;H<Wi;H++)d.push(Ki(B,W));S()},R=(B,W,H,N)=>{a="floating",c+=1,P(),v.push({x:B,y:W,radiusX:H,radiusY:N,color:r,alpha:1,vx:x(-Jn,Jn),vy:ji,stringAngle:0}),S()},F=()=>{if(!n)return;m+=1,ee(n,o,t),ts(n,o,t),os(n,o,m),ls(n,o,t);const B=T(),W=w(),H=b();v=v.map(es).filter(ns);for(const N of v)rs(n,N,m);if(a==="inflating"||a==="idle"){const N=De(s),U=N*.85,se=N,ne=W-se;let re=0;if(s>=oe){const le=ue((s-oe)/(me-oe),0,1);re=Math.sin(m*.3)*le*12}const Mt=qi(s,r);s>=qn&&s<Kn&&as(n,B+re*.5,ne,N,m);const At=W+8;yt(n,B+re*.3,At,B,H,m,re*.2),wt(n,B+re*.5,ne,U,se,Mt,re),s>=qn&&s<Kn&&p.length<Hi&&Math.random()<.15&&p.push(Qi(B,ne,N)),p=p.map(zi).filter(xi);for(const le of p)is(n,le.x,le.y,le.size,le.alpha);if(s>=oe){const le=ue((s-oe)/(me-oe),0,1);n.save(),n.globalAlpha=le*.4,n.strokeStyle=u("#ffffff",.6),n.lineWidth=1.5;for(let Re=0;Re<3;Re++){const Ke=-.5+Re*.5,Ze=B+re*.5+Math.cos(Ke)*U*.7,Je=ne+Math.sin(Ke)*se*.5;n.beginPath(),n.moveTo(Ze-5,Je-3),n.lineTo(Ze+5,Je+3),n.stroke()}n.restore()}}d=d.map(Zi).filter(Ji);for(const N of d)ss(n,N);g&&(A+=1,ds(n,_,k,A),A>50&&(g=!1)),l=requestAnimationFrame(F)},I=()=>{if(!e||!n)return;const B=X(e,n);o=B.width,t=B.height};return{id:"balloon",name:"Ballon",description:"Gonfle le ballon sans le faire éclater",mount:B=>{const W=M("div",{});fs(W);const H=M("button",{},"← Accueil");cs(H),H.addEventListener("click",()=>{window.location.hash="#menu"});const N=M("p",{},"Ballon");hs(N),h=M("p",{},"Ballons: 0"),us(h),W.appendChild(H),W.appendChild(N),W.appendChild(h),B.appendChild(W);const U=J(W);e=U.canvas,n=U.ctx,o=U.width,t=U.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),i=I,window.addEventListener("resize",i),a="idle",s=0,r=C.secondary,f=!1,c=0,d=[],p=[],v=[],g=!1,A=0,m=0,P(),F()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),i&&(window.removeEventListener("resize",i),i=null),y!==null&&(clearTimeout(y),y=null),e=null,n=null,h=null,d=[],p=[],v=[],a="idle",s=0,f=!1,c=0,g=!1,m=0,o=0,t=0},update:B=>{const W=B.isVoicing;if(W){if(f||a==="idle"&&(a="inflating",s=0,p=[],r=C.secondary),a==="inflating"&&(s=B.duration,B.vowel!==null&&Y[B.vowel]&&(r=Y[B.vowel]),s>=me)){const H=De(s),N=w()-H;E(T(),N)}}else if(f&&a==="inflating"&&s>.1){const H=De(s),N=H*.85,U=H,se=w()-U;R(T(),se,N,U)}else!W&&a==="inflating"&&(a="idle",s=0,p=[]);f=W}}},we=.1,gs=8,ms=20,bs=500,Ss=5,ys=30,ws=-1.5,vs=.004,Ts=.02,Ps=20,Cs=.08,Ms=.02,As="#1a6b8a",vt="#0a2a3a",Es="#c2a66b",Is="#a08850",Rs="#2d8a4e",ks="#1d6a3e",Fs={a:"fish",e:"seahorse",i:"jellyfish",o:"starfish",u:"octopus",ɛ:"fish",y:"jellyfish"},Os={a:1.8,e:.5,i:.3,o:0,u:.6,ɛ:1.2,y:.4},$=(e,n)=>e+Math.random()*(n-e),_s=(e,n,o)=>{const t=e.createLinearGradient(0,0,0,o);t.addColorStop(0,As),t.addColorStop(1,vt),e.fillStyle=t,e.fillRect(0,0,n,o)},Ls=(e,n,o)=>{const t=o*(1-we),l=e.createLinearGradient(0,t,0,o);l.addColorStop(0,Es),l.addColorStop(1,Is),e.beginPath(),e.moveTo(0,o);for(let i=0;i<=n;i+=10){const a=t+Math.sin(i*.03)*3+Math.sin(i*.07)*2;e.lineTo(i,a)}e.lineTo(n,o),e.closePath(),e.fillStyle=l,e.fill()},Qn=(e,n)=>{const o=[],t=n*(1-we);for(let l=0;l<Ps;l++){const i=Math.floor($(100,170));o.push({x:$(10,e-10),y:$(t+5,n-5),rx:$(3,7),ry:$(2,4),color:`rgb(${i}, ${i-10}, ${i-20})`})}return o},Bs=(e,n)=>{for(const o of n)e.beginPath(),e.ellipse(o.x,o.y,o.rx,o.ry,0,0,Math.PI*2),e.fillStyle=o.color,e.fill()},zn=(e,n)=>{const o=[];for(let t=0;t<gs;t++)o.push({x:$(30,e-30),height:$(80,400),segments:Math.floor($(6,12)),phaseOffset:$(0,Math.PI*2)});return o},Ds=(e,n,o,t,l)=>{const i=o*(1-we);for(const a of n){const s=a.height/a.segments;e.beginPath(),e.moveTo(a.x,i);for(let r=1;r<=a.segments;r++){const f=r/a.segments,c=Math.sin(t*.002+a.phaseOffset+r*.5)*(20*f)*l,h=a.x+c,d=i-r*s;e.lineTo(h,d)}e.lineWidth=4,e.strokeStyle=Rs,e.lineCap="round",e.lineJoin="round",e.stroke();for(let r=2;r<a.segments;r+=2){const f=r/a.segments,c=Math.sin(t*.002+a.phaseOffset+r*.5)*(20*f)*l,h=a.x+c,d=i-r*s,p=r%4===0?1:-1;e.beginPath(),e.ellipse(h+p*8,d,10,4,p*.4,0,Math.PI*2),e.fillStyle=ks,e.fill()}}},Ws=(e,n,o)=>({x:$(e*.15,e*.85),y:n*(1-we)-5,radius:Ss+o*ys,alpha:.6,vy:ws-o*1.5,wobbleOffset:$(0,Math.PI*2),wobbleSpeed:$(.03,.06)}),Ns=(e,n)=>({...e,y:e.y+e.vy,x:e.x+Math.sin(n*e.wobbleSpeed+e.wobbleOffset)*.5,alpha:e.alpha-vs}),Hs=e=>e.alpha>0&&e.y>-e.radius,$s=(e,n,o)=>{e.save(),e.globalAlpha=n.alpha*o,e.beginPath(),e.arc(n.x,n.y,n.radius,0,Math.PI*2),e.fillStyle=u("#a5d8ff",.4),e.fill(),e.strokeStyle=u("#74c0fc",.6),e.lineWidth=1,e.stroke(),e.beginPath(),e.arc(n.x-n.radius*.3,n.y-n.radius*.3,n.radius*.25,0,Math.PI*2),e.fillStyle=u("#ffffff",.7),e.fill(),e.restore()},Gs=(e,n,o,t,l,i,a)=>{const s=i?1:-1;e.save(),e.beginPath(),e.ellipse(n,o,t*1.2,t*.7,0,0,Math.PI*2),e.fillStyle=l,e.fill(),e.beginPath();const r=n-s*t*1.2,f=Math.sin(a*.008+n)*3;e.moveTo(r,o),e.lineTo(r-s*t*.7,o-t*.5+f),e.lineTo(r-s*t*.7,o+t*.5+f),e.closePath(),e.fillStyle=l,e.fill();const c=n+s*t*.5,h=o-t*.15;e.beginPath(),e.arc(c,h,t*.18,0,Math.PI*2),e.fillStyle="#ffffff",e.fill(),e.beginPath(),e.arc(c+s*t*.05,h,t*.1,0,Math.PI*2),e.fillStyle="#1a1a2e",e.fill(),e.beginPath(),e.moveTo(n-s*t*.2,o-t*.7),e.lineTo(n+s*t*.3,o-t*.7),e.lineTo(n+s*t*.1,o-t*.35),e.closePath(),e.fillStyle=u(l,.7),e.fill(),e.restore()},js=(e,n,o,t,l,i)=>{e.save(),e.beginPath(),e.arc(n,o-t*.8,t*.4,0,Math.PI*2),e.fillStyle=l,e.fill(),e.beginPath(),e.ellipse(n+t*.5,o-t*.8,t*.25,t*.12,0,0,Math.PI*2),e.fillStyle=l,e.fill();const a=Math.sin(i*.003+n*.1)*3;for(let f=0;f<6;f++){const c=f/5,h=n+a*c,d=o-t*.5+f*t*.3,p=t*(.35-c*.08);e.beginPath(),e.arc(h,d,p,0,Math.PI*2),e.fillStyle=u(l,1-c*.2),e.fill()}e.beginPath();const s=n+a*.8,r=o+t*1;e.arc(s+t*.2,r,t*.2,0,Math.PI*1.5),e.strokeStyle=l,e.lineWidth=3,e.lineCap="round",e.stroke(),e.beginPath(),e.arc(n+t*.15,o-t*.9,t*.08,0,Math.PI*2),e.fillStyle="#1a1a2e",e.fill();for(let f=0;f<3;f++)e.beginPath(),e.arc(n-t*.1+f*t*.15,o-t*1.2,t*.06,0,Math.PI*2),e.fillStyle=u(l,.7),e.fill();e.restore()},Us=(e,n,o,t,l,i)=>{e.save();const a=1+Math.sin(i*.005+n)*.1;e.beginPath(),e.ellipse(n,o,t*.8*a,t*.5*a,0,Math.PI,0),e.fillStyle=u(l,.6),e.fill(),e.beginPath(),e.ellipse(n,o+t*.05,t*.5*a,t*.3*a,0,Math.PI,0),e.fillStyle=u(l,.3),e.fill();const s=6;for(let r=0;r<s;r++){const f=n-t*.6+r/(s-1)*t*1.2;e.beginPath(),e.moveTo(f,o);const c=t*(.8+Math.sin(r*1.5)*.3);for(let h=1;h<=4;h++){const d=h/4,p=f+Math.sin(i*.004+r*.8+h*.7)*(t*.15),v=o+d*c;e.lineTo(p,v)}e.strokeStyle=u(l,.5),e.lineWidth=2,e.lineCap="round",e.stroke()}for(let r=0;r<3;r++){const f=n-t*.3+r*t*.3,c=o-t*.15;e.beginPath(),e.arc(f,c,t*.05,0,Math.PI*2),e.fillStyle=u("#ffffff",.5),e.fill()}e.restore()},Ys=(e,n,o,t,l)=>{e.save();const i=5,a=t*.9,s=a*.4;e.beginPath();for(let r=0;r<i*2;r++){const f=r%2===0?a:s,c=Math.PI*r/i-Math.PI/2,h=n+Math.cos(c)*f,d=o+Math.sin(c)*f;r===0?e.moveTo(h,d):e.lineTo(h,d)}e.closePath(),e.fillStyle=l,e.fill(),e.beginPath(),e.arc(n,o,t*.15,0,Math.PI*2),e.fillStyle=u("#ffffff",.4),e.fill();for(let r=0;r<i;r++){const f=Math.PI*2*r/i-Math.PI/2,c=a*.55,h=n+Math.cos(f)*c,d=o+Math.sin(f)*c;e.beginPath(),e.arc(h,d,t*.06,0,Math.PI*2),e.fillStyle=u("#ffffff",.35),e.fill()}e.restore()},Vs=(e,n,o,t,l,i)=>{e.save(),e.beginPath(),e.arc(n,o-t*.3,t*.6,0,Math.PI*2),e.fillStyle=l,e.fill(),e.beginPath(),e.arc(n-t*.2,o-t*.4,t*.12,0,Math.PI*2),e.fillStyle="#ffffff",e.fill(),e.beginPath(),e.arc(n+t*.2,o-t*.4,t*.12,0,Math.PI*2),e.fillStyle="#ffffff",e.fill(),e.beginPath(),e.arc(n-t*.18,o-t*.38,t*.06,0,Math.PI*2),e.fillStyle="#1a1a2e",e.fill(),e.beginPath(),e.arc(n+t*.22,o-t*.38,t*.06,0,Math.PI*2),e.fillStyle="#1a1a2e",e.fill();const a=4;for(let s=0;s<a;s++){const r=n-t*.45+s/(a-1)*t*.9;e.beginPath(),e.moveTo(r,o+t*.1);for(let f=1;f<=5;f++){const c=f/5,h=r+Math.sin(i*.004+s*1.2+f*.8)*(t*.2),d=o+t*.1+c*t*.9;e.lineTo(h,d)}e.strokeStyle=l,e.lineWidth=3,e.lineCap="round",e.stroke()}e.beginPath(),e.arc(n,o-t*.15,t*.15,.1,Math.PI-.1),e.strokeStyle=u("#1a1a2e",.5),e.lineWidth=1.5,e.stroke(),e.restore()},Xs=(e,n,o,t)=>{switch(e.save(),e.globalAlpha=n.alpha*t,n.kind){case"fish":Gs(e,n.x,n.y,n.size,n.color,n.vx>0,o);break;case"seahorse":js(e,n.x,n.y,n.size,n.color,o);break;case"jellyfish":Us(e,n.x,n.y,n.size,n.color,o);break;case"starfish":Ys(e,n.x,n.y,n.size,n.color);break;case"octopus":Vs(e,n.x,n.y,n.size,n.color,o);break}e.restore()},qs=(e,n,o)=>{const t=Fs[e]??"fish",l=Y[e]??"#6366f1",i=Os[e]??1,a=o*(1-we),s=$(14,22),r=Math.random()>.5?1:-1,f=r>0?-s*2:n+s*2;let c;switch(t){case"starfish":c=a-s*.5;break;case"jellyfish":c=$(o*.15,o*.5);break;case"seahorse":c=$(o*.3,o*.6);break;case"octopus":c=$(o*.5,a-s*1.5);break;default:c=$(o*.15,a-s*2)}return{x:t==="starfish"?$(s*2,n-s*2):f,y:c,vx:t==="starfish"?0:i*r,color:l,kind:t,age:0,alpha:t==="starfish"?0:1,size:s,phaseOffset:$(0,Math.PI*2)}},Ks=(e,n,o)=>{const t=e.age+1,l=e.kind!=="starfish"?Math.sin(n*.003+e.phaseOffset)*.3:0;let i=e.x+e.vx,a=e.vx;e.kind!=="starfish"&&(i<-e.size*3?(i=-e.size*3,a=Math.abs(e.vx)):i>o+e.size*3&&(i=o+e.size*3,a=-Math.abs(e.vx)));let s=e.alpha;return e.kind==="starfish"&&e.alpha<1&&(s=Math.min(1,e.alpha+.02)),{...e,x:i,y:e.y+l,vx:a,age:t,alpha:s}},Zs=(e,n)=>e.kind==="starfish"?!0:e.x>-e.size*4&&e.x<n+e.size*4,Js=(e,n)=>e.length<=n?e:e.map((o,t)=>t<e.length-n?{...o,alpha:o.alpha-Ts}:o).filter(o=>o.alpha>0),Qs=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:vt})},zs=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:"#7dd3fc",cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u("#0a2a3a",.7),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},xs=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u("#7dd3fc",.7),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},er=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",fontSize:"1.1rem",fontWeight:"600",color:"#7dd3fc",margin:"0",padding:"8px 12px",fontFamily:"inherit",borderRadius:"8px",backgroundColor:u("#0a2a3a",.7),backdropFilter:"blur(4px)",pointerEvents:"none"})},nr=()=>{let e=null,n=null,o=0,t=0,l=null,i=null,a=[],s=[],r=[],f=[],c=null,h=0,d=0,p=0,v=0,A=!1;const _=4,k=()=>{if(!e||!n)return;const b=X(e,n);o=b.width,t=b.height,r=zn(o),f=Qn(o,t)},g=()=>{if(n){ee(n,o,t),_s(n,o,t),Ls(n,o,t),Bs(n,f),Ds(n,r,t,p,v);for(const b of s)Xs(n,b,p,v);for(const b of a)$s(n,b,v)}},y=()=>{p=performance.now(),v=A?Math.min(1,v+Cs):Math.max(0,v-Ms),a=a.map(b=>Ns(b,p)).filter(Hs),s=s.map(b=>Ks(b,p,o)).filter(b=>Zs(b,o)),s=Js(s,ms),c&&(c.textContent=`${s.length}`),g(),l=requestAnimationFrame(y)};return{id:"aquarium",name:"Aquarium",description:"Crée ton monde sous-marin avec ta voix",mount:b=>{const P=M("div",{});Qs(P);const S=M("button",{},"← Accueil");zs(S),S.addEventListener("click",()=>{window.location.hash="#menu"});const E=M("p",{},"Aquarium");xs(E),c=M("p",{},"0"),er(c),P.appendChild(S),P.appendChild(E),P.appendChild(c),b.appendChild(P);const R=J(P);e=R.canvas,n=R.ctx,o=R.width,t=R.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),r=zn(o),f=Qn(o,t),i=k,window.addEventListener("resize",i),a=[],s=[],h=0,d=0,p=0,y()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),i&&(window.removeEventListener("resize",i),i=null),e=null,n=null,c=null,o=0,t=0,a=[],s=[],r=[],f=[],h=0,d=0,p=0,v=0,A=!1},update:b=>{A=b.isVoicing;const P=performance.now();b.isVoicing?(d+=1,d>=_&&(d=0,a.push(Ws(o,t,b.volume)))):d=0,b.isVoicing&&b.vowel!==null&&P-h>=bs&&(s.push(qs(b.vowel,o,t)),h=P)}}},Z=.3,tr=.035,qe=.3,Se=.18,or=120,lr=.3,xn=.03,z=40,et=12,Ne={summer:{skyTop:"#1E90FF",skyBottom:"#87CEEB",groundTop:"#4CAF50",groundBottom:"#2E7D32",treeCrown:"#2E8B57",treeHighlight:"#3CB371",label:"Été"},autumn:{skyTop:"#E8843C",skyBottom:"#F4A460",groundTop:"#8B6914",groundBottom:"#6B4E0A",treeCrown:"#D2691E",treeHighlight:"#E25822",label:"Automne"},winter:{skyTop:"#B0B8C8",skyBottom:"#D9DEE8",groundTop:"#E8E8F0",groundBottom:"#CFCFDF",treeCrown:"#8B7355",treeHighlight:"#A08060",label:"Hiver"},spring:{skyTop:"#89CFF0",skyBottom:"#B0E2FF",groundTop:"#5DBB63",groundBottom:"#3E9142",treeCrown:"#FFB7C5",treeHighlight:"#FFC0CB",label:"Printemps"}},ar={a:"summer",o:"autumn",i:"winter",u:"spring"},He=(e,n,o)=>e+(n-e)*o,Ue=(e,n,o)=>Math.min(o,Math.max(n,e)),O=(e,n)=>e+Math.random()*(n-e),nt=e=>({r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16)}),ir=(e,n,o)=>{const t=l=>Ue(Math.round(l),0,255).toString(16).padStart(2,"0");return`#${t(e)}${t(n)}${t(o)}`},he=(e,n,o)=>{const t=nt(e),l=nt(n);return ir(He(t.r,l.r,o),He(t.g,l.g,o),He(t.b,l.b,o))},sr=(e,n,o)=>({skyTop:he(e.skyTop,n.skyTop,o),skyBottom:he(e.skyBottom,n.skyBottom,o),groundTop:he(e.groundTop,n.groundTop,o),groundBottom:he(e.groundBottom,n.groundBottom,o),treeCrown:he(e.treeCrown,n.treeCrown,o),treeHighlight:he(e.treeHighlight,n.treeHighlight,o)}),rr=e=>({skyTop:e.skyTop,skyBottom:e.skyBottom,groundTop:e.groundTop,groundBottom:e.groundBottom,treeCrown:e.treeCrown,treeHighlight:e.treeHighlight}),Ce={skyTop:"#7CA8D0",skyBottom:"#A8C8E8",groundTop:"#6B8E6B",groundBottom:"#4A6B4A",treeCrown:"#5A8A5A",treeHighlight:"#6B9B6B"},dr=(e,n,o)=>{const l=n*(1-Z)-n*qe-n*Se,i=["#D2691E","#CD853F","#B22222","#DAA520","#CC5500"];return{x:e*.5+O(-e*.15,e*.15),y:l+O(0,n*Se),vx:O(-1.5,1.5)*(1+o),vy:O(.3,1.5),size:O(5,10),rotation:O(0,Math.PI*2),rotationSpeed:O(-.05,.05),alpha:1,color:i[Math.floor(Math.random()*i.length)],life:0,maxLife:O(120,250)}},fr=(e,n,o)=>{const t=.3+o*.7;return{x:O(-20,e+20),y:O(-30,-5),vx:O(-.8,.8)*t,vy:O(.5,2.5)*t,size:O(2,6),rotation:0,rotationSpeed:0,alpha:O(.6,1),color:"#FFFFFF",life:0,maxLife:O(200,400)}},cr=(e,n,o)=>{const l=n*(1-Z)-n*qe-n*Se,i=["#FFB7C5","#FF69B4","#FFC0CB","#FFD1DC","#FADADD"];return{x:e*.5+O(-e*.15,e*.15),y:l+O(0,n*Se*.7),vx:O(-1,2)*(.5+o*.5),vy:O(-.5,1.2),size:O(4,8),rotation:O(0,Math.PI*2),rotationSpeed:O(-.04,.04),alpha:1,color:i[Math.floor(Math.random()*i.length)],life:0,maxLife:O(150,300)}},hr=(e,n,o)=>{const t=O(n*.1,n*.6);return{x:O(0,e),y:t,vx:O(-.2,.2),vy:O(-1,-.3)*(.5+o),size:O(2,5),rotation:0,rotationSpeed:0,alpha:O(.15,.4)*o,color:"#FFD700",life:0,maxLife:O(60,120)}},ur=(e,n,o)=>{const t=n*(1-Z),l=["#FF6B9D","#C084FC","#60A5FA","#FBBF24","#FB923C"];return{x:O(e*.1,e*.9),y:t-O(20,120),vx:O(-1,1),vy:O(-1,.5),size:O(6,10),rotation:0,rotationSpeed:.1,alpha:1,color:l[Math.floor(Math.random()*l.length)],life:0,maxLife:O(200,400)}},pr=(e,n)=>{const o=n*(1-Z),t=["#FF6B9D","#FBBF24","#A78BFA","#F87171","#34D399"];return{x:O(e*.05,e*.95),y:o+O(5,n*Z*.5),vx:0,vy:0,size:O(4,8),rotation:O(0,Math.PI*2),rotationSpeed:0,alpha:1,color:t[Math.floor(Math.random()*t.length)],life:0,maxLife:9999}},gr=(e,n)=>{const o=e.life+1,t=o/e.maxLife,l=.7,i=n==="spring"&&e.vy<=.5&&e.size>=6,a=i?e.vx+Math.sin(o*.1)*.15:e.vx+O(-.05,.05),s=i?e.vy+Math.cos(o*.08)*.1:e.vy;return{...e,x:e.x+a,y:e.y+s,vx:a*.99,vy:s,rotation:e.rotation+e.rotationSpeed,alpha:t>l?e.alpha*(1-(t-l)/(1-l)):e.alpha,life:o}},mr=e=>e.life<e.maxLife&&e.alpha>.01,br=(e,n,o,t)=>{const l=e.createLinearGradient(0,0,0,o*(1-Z));l.addColorStop(0,t.skyTop),l.addColorStop(1,t.skyBottom),e.fillStyle=l,e.fillRect(0,0,n,o*(1-Z)+2)},Sr=(e,n,o,t,l)=>{const i=o*(1-Z),a=e.createLinearGradient(0,i,0,o);a.addColorStop(0,t.groundTop),a.addColorStop(1,t.groundBottom),e.fillStyle=a,e.fillRect(0,i,n,o*Z),e.beginPath(),e.moveTo(0,i);for(let s=0;s<=n;s+=15){const r=Math.sin(s*.03+l*5e-4)*3;e.lineTo(s,i+r)}e.lineTo(n,i+8),e.lineTo(0,i+8),e.closePath(),e.fillStyle=t.groundTop,e.fill()},yr=(e,n,o,t,l)=>{const i=n-80,a=70,s=1+Math.sin(o*.001)*.04,r=t==="winter"?.3:t==="autumn"?.7:1,f=t==="autumn"?"#FF8C42":"#FFD700",c=t==="summer"?.5+l*.5:.3;e.save(),e.globalAlpha=r;const h=e.createRadialGradient(i,a,0,i,a,z*2.5);h.addColorStop(0,u(f,.3)),h.addColorStop(1,u(f,0)),e.fillStyle=h,e.fillRect(i-z*3,a-z*3,z*6,z*6),e.save(),e.translate(i,a),e.rotate(o*3e-4);const d=15+l*15;for(let p=0;p<et;p++){const v=p/et*Math.PI*2;e.beginPath(),e.moveTo(Math.cos(v)*z*s,Math.sin(v)*z*s),e.lineTo(Math.cos(v)*(z+d)*s,Math.sin(v)*(z+d)*s),e.strokeStyle=u(f,c),e.lineWidth=3,e.stroke()}e.restore(),e.beginPath(),e.arc(i,a,z*s,0,Math.PI*2),e.fillStyle=f,e.fill(),e.restore()},wr=(e,n,o,t,l,i,a)=>{const s=o*(1-Z),r=n*.5,f=n*tr,c=o*qe,h=s-c,d=o*Se,p=Math.sin(i*.0015)*(2+a*4);e.save(),e.beginPath(),e.moveTo(r-f/2,s),e.lineTo(r-f/3+p*.3,h+d*.3),e.lineTo(r+f/3+p*.3,h+d*.3),e.lineTo(r+f/2,s),e.closePath();const v=e.createLinearGradient(r-f/2,s,r+f/2,s);if(v.addColorStop(0,"#5D4037"),v.addColorStop(.5,"#795548"),v.addColorStop(1,"#5D4037"),e.fillStyle=v,e.fill(),l==="winter"){const A="#6D4C41";e.strokeStyle=A,e.lineWidth=3,e.lineCap="round",e.beginPath(),e.moveTo(r+p*.4,h+d*.5),e.quadraticCurveTo(r-d*.4+p*.5,h+d*.1,r-d*.7+p*.6,h-d*.2),e.stroke(),e.beginPath(),e.moveTo(r+p*.4,h+d*.4),e.quadraticCurveTo(r+d*.3+p*.5,h+d*.05,r+d*.65+p*.6,h-d*.15),e.stroke(),e.beginPath(),e.moveTo(r+p*.5,h+d*.2),e.quadraticCurveTo(r+d*.1+p*.6,h-d*.3,r-d*.1+p*.7,h-d*.6),e.stroke(),e.lineWidth=2,e.beginPath(),e.moveTo(r-d*.5+p*.55,h-d*.05),e.lineTo(r-d*.65+p*.6,h-d*.35),e.stroke(),e.beginPath(),e.moveTo(r+d*.45+p*.55,h),e.lineTo(r+d*.55+p*.6,h-d*.3),e.stroke()}if(l!=="winter"){const A=h-d*.2,_=r+p*.5;e.beginPath(),e.ellipse(_+3,A+5,d*1.05,d*.85,0,0,Math.PI*2),e.fillStyle=u("#000000",.08),e.fill();const k=(g,y,m,T,w)=>{e.beginPath(),e.ellipse(g,y,m,T,0,0,Math.PI*2),e.fillStyle=w,e.fill()};k(_,A,d,d*.8,t.treeCrown),k(_-d*.5,A+d*.1,d*.6,d*.55,t.treeCrown),k(_+d*.5,A+d*.15,d*.55,d*.5,t.treeCrown),k(_+d*.1,A-d*.4,d*.55,d*.5,t.treeHighlight),k(_-d*.2,A-d*.15,d*.45,d*.4,u(t.treeHighlight,.5))}e.restore()},tt=(e,n,o)=>{if(e.save(),e.globalAlpha=Ue(n.alpha,0,1),e.translate(n.x,n.y),e.rotate(n.rotation),o==="autumn")e.beginPath(),e.ellipse(0,0,n.size,n.size*.5,0,0,Math.PI*2),e.fillStyle=n.color,e.fill(),e.beginPath(),e.moveTo(-n.size*.7,0),e.lineTo(n.size*.7,0),e.strokeStyle=u("#000000",.2),e.lineWidth=.5,e.stroke();else if(o==="winter"){const t=e.createRadialGradient(0,0,0,0,0,n.size);t.addColorStop(0,u("#FFFFFF",.9)),t.addColorStop(1,u("#FFFFFF",0)),e.fillStyle=t,e.fillRect(-n.size,-n.size,n.size*2,n.size*2),e.beginPath(),e.arc(0,0,n.size*.5,0,Math.PI*2),e.fillStyle="#FFFFFF",e.fill()}else if(o==="spring"&&n.size>=6&&n.maxLife>=200){const t=Math.sin(n.life*.15)*.4;e.fillStyle=n.color,e.save(),e.scale(1,1+t),e.beginPath(),e.ellipse(-n.size*.4,0,n.size*.5,n.size*.8,-.2,0,Math.PI*2),e.fill(),e.restore(),e.save(),e.scale(1,1-t),e.beginPath(),e.ellipse(n.size*.4,0,n.size*.5,n.size*.8,.2,0,Math.PI*2),e.fill(),e.restore(),e.beginPath(),e.ellipse(0,0,n.size*.12,n.size*.5,0,0,Math.PI*2),e.fillStyle="#333333",e.fill()}else if(o==="spring"&&n.vx===0&&n.vy===0){e.fillStyle=n.color;for(let l=0;l<5;l++){const i=l/5*Math.PI*2;e.beginPath(),e.ellipse(Math.cos(i)*n.size*.4,Math.sin(i)*n.size*.4,n.size*.35,n.size*.2,i,0,Math.PI*2),e.fill()}e.beginPath(),e.arc(0,0,n.size*.2,0,Math.PI*2),e.fillStyle="#FBBF24",e.fill()}else o==="spring"?(e.beginPath(),e.ellipse(0,0,n.size,n.size*.5,0,0,Math.PI*2),e.fillStyle=n.color,e.fill()):o==="summer"&&(e.beginPath(),e.arc(0,0,n.size,0,Math.PI*2),e.fillStyle=u(n.color,Ue(n.alpha,0,.4)),e.fill());e.restore()},vr=(e,n,o,t)=>{e.save(),e.font="bold 20px system-ui, sans-serif",e.textAlign="right",e.textBaseline="bottom",e.fillStyle=u(C.text,.5),e.fillText(n,o-20,t-16),e.restore()},Tr=(e,n,o,t,l)=>{const i=o*(1-Z),a=8+t*6;e.beginPath(),e.moveTo(0,i);for(let s=0;s<=n;s+=20){const r=Math.sin(s*.02+l*3e-4)*3;e.lineTo(s,i-a+r)}e.lineTo(n,i+2),e.lineTo(0,i+2),e.closePath(),e.fillStyle=u("#FFFFFF",.7),e.fill()},Pr=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden"})},Cr=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:C.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u(C.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Mr=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u(C.text,.7),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:u(C.surface,.6),borderRadius:"12px",backdropFilter:"blur(4px)"})},Ar=e=>{Object.assign(e.style,{position:"absolute",bottom:"16px",right:"16px",zIndex:"10",fontSize:"1.3rem",fontWeight:"700",color:u(C.text,.6),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:u(C.surface,.6),borderRadius:"12px",backdropFilter:"blur(4px)"})},Er=()=>{let e=null,n=null,o=0,t=0,l=null,i=null,a=0,s=null,r=null,f={...Ce},c={...Ce},h=1,d=[],p=[],v=0,A=null;const _=(b,P,S)=>{const E=Math.min(S,or-d.length);for(let R=0;R<E;R++)switch(b){case"summer":d.push(hr(o,t,P));break;case"autumn":d.push(dr(o,t,P));break;case"winter":d.push(fr(o,t,P));break;case"spring":d.push(cr(o,t,P)),P>.4&&Math.random()<.15&&d.push(ur(o,t));break}},k=b=>{b==="spring"&&p.length<12?Math.random()<.02&&p.push(pr(o,t)):b!=="spring"&&p.length>0&&(p=p.map(P=>({...P,alpha:P.alpha-.01})).filter(P=>P.alpha>.01))},g=()=>{if(!n)return;const b=performance.now()-a;ee(n,o,t),h<1&&(h=Math.min(1,h+xn),f=sr(f,c,xn));const P=s??"summer";br(n,o,t,f),yr(n,o,b,P,v),Sr(n,o,t,f,b),P==="winter"&&Tr(n,o,t,v,b);for(const S of p)tt(n,S,"spring");if(wr(n,o,t,f,P,b,v),s!==null){const S=lr+v*2;if(Math.random()<S){const E=Math.ceil(1+v*3);_(s,v,E)}}d=d.map(S=>gr(S,P)).filter(mr);for(const S of d)tt(n,S,P);if(k(P),s!==null){const S=Ne[s];vr(n,S.label,o,t)}l=requestAnimationFrame(g)},y=()=>{if(!e||!n)return;const b=X(e,n);o=b.width,t=b.height};return{id:"seasons",name:"Saisons",description:"Change les saisons avec ta voix",mount:b=>{const P=M("div",{});Pr(P);const S=M("button",{},"← Accueil");Cr(S),S.addEventListener("click",()=>{window.location.hash="#menu"});const E=M("p",{},"Saisons");Mr(E),A=M("p",{},""),Ar(A),P.appendChild(S),P.appendChild(E),P.appendChild(A),b.appendChild(P);const R=J(P);e=R.canvas,n=R.ctx,o=R.width,t=R.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),i=y,window.addEventListener("resize",i),s=null,r=null,f={...Ce},c={...Ce},h=1,d=[],p=[],v=0,a=performance.now(),g()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),i&&(window.removeEventListener("resize",i),i=null),e=null,n=null,A=null,o=0,t=0,d=[],p=[],s=null,r=null,h=1,v=0},update:b=>{v=b.volume,b.duration;const P=b.vowel,S=P!==null?ar[P]??null:null;S!==null&&S!==r&&(r=S,c=rr(Ne[S]),h=0,s=S,A&&(A.textContent=Ne[S].label))}}},Ir=Jt("#app"),Tt=qt(),Pt=Kt({volume:0,pitch:null,vowel:null,isVoicing:!1,duration:0,formants:null}),Ct=[rl(),Cl(),aa(),va(),Ua(),hi(),Fi(),ps(),nr(),Er(),No(),wo()],Rr=io(Ct.map(e=>({id:e.id,name:e.name,description:e.description}))),kr=[Rr,...Ct],Fr=Zt(Ir,kr);Pt.subscribe(e=>{const n=Fr.getCurrentGame();n&&n.update(e)});Tt.subscribe(e=>{Pt.set(e)});const ve=document.createElement("div");ve.style.cssText=`
  position: fixed; inset: 0; z-index: 1000;
  display: flex; align-items: center; justify-content: center; flex-direction: column;
  background: rgba(240, 244, 255, 0.95);
`;const ie=document.createElement("button");ie.textContent="🎤 Commencer";ie.style.cssText=`
  font-size: 2rem; padding: 24px 48px;
  border: none; border-radius: 16px;
  background: #6366f1; color: white;
  cursor: pointer; font-family: inherit;
  transition: transform 0.2s;
`;ie.addEventListener("mouseenter",()=>{ie.style.transform="scale(1.05)"});ie.addEventListener("mouseleave",()=>{ie.style.transform="scale(1)"});const ye=document.createElement("p");ye.textContent="Appuie pour activer le micro";ye.style.cssText="margin-top: 16px; color: #64748b; font-size: 1.2rem;";ve.appendChild(ie);ve.appendChild(ye);document.body.appendChild(ve);ie.addEventListener("click",async()=>{try{await Tt.start(),ve.remove()}catch(e){ye.textContent="Erreur : impossible d'accéder au micro",ye.style.color="#ef4444",console.error("Failed to start audio pipeline:",e)}});</script>
    <style rel="stylesheet" crossorigin>*,*:before,*:after{box-sizing:border-box}*{margin:0;padding:0}html{-webkit-text-size-adjust:100%;-moz-text-size-adjust:100%;text-size-adjust:100%}body{line-height:1.5;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}img,picture,video,canvas,svg{display:block;max-width:100%}input,button,textarea,select{font:inherit;color:inherit}p,h1,h2,h3,h4,h5,h6{overflow-wrap:break-word}ol,ul{list-style:none}a{text-decoration:none;color:inherit}table{border-collapse:collapse;border-spacing:0}:root{--color-bg: #f0f4ff;--color-text: #2d3748;--color-primary: #6366f1;--color-secondary: #f472b6;--color-accent: #34d399;--color-surface: #ffffff;--font-family: "Segoe UI", system-ui, sans-serif;--radius: 12px;--transition-speed: .3s}body{width:100%;height:100vh;height:100dvh;font-family:var(--font-family);background-color:var(--color-bg);color:var(--color-text);overflow:hidden}#app{width:100%;height:100%;display:flex;flex-direction:column}.game-container{flex:1;position:relative;overflow:hidden}*,*:before,*:after{transition-timing-function:ease-in-out}@media(prefers-reduced-motion:reduce){*,*:before,*:after{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important;scroll-behavior:auto!important}}</style>
  </head>
  <body>
    <div id="app"></div>
  </body>
</html>
