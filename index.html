<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ortho</title>
    <script type="module" crossorigin>(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))t(l);new MutationObserver(l=>{for(const a of l)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&t(s)}).observe(document,{childList:!0,subtree:!0});function o(l){const a={};return l.integrity&&(a.integrity=l.integrity),l.referrerPolicy&&(a.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?a.credentials="include":l.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function t(l){if(l.ep)return;l.ep=!0;const a=o(l);fetch(l.href,a)}})();const At=e=>{if(e.length===0)return 0;let n=0;for(let t=0;t<e.length;t++)n+=e[t]*e[t];const o=Math.sqrt(n/e.length);return Math.min(1,Math.max(0,o))},Et=.15,Qe=80,ze=600,It=(e,n)=>{const o=Math.min(Math.floor(e.length/2),n),t=new Float32Array(o);for(let l=0;l<o;l++){let a=0;for(let s=0;s<o;s++){const i=e[s]-e[s+l];a+=i*i}t[l]=a}return t},Rt=e=>{const n=new Float32Array(e.length);n[0]=1;let o=0;for(let t=1;t<e.length;t++)o+=e[t],n[t]=o===0?0:e[t]*t/o;return n},kt=(e,n,o)=>{for(let t=n;t<e.length-1;t++)if(e[t]<o){for(;t+1<e.length&&e[t+1]<e[t];)t++;return t}return-1},Ft=(e,n)=>{if(n<=0||n>=e.length-1)return n;const o=e[n-1],t=e[n],l=e[n+1],a=.5*(o-l)/(o-2*t+l);return Number.isFinite(a)?n+a:n},Ot=(e,n)=>{if(e.length<2)return null;const o=Math.floor(n/Qe),t=Math.floor(n/ze);if(e.length<2*o)return null;const l=It(e,o),a=Rt(l),s=kt(a,t,Et);if(s===-1)return null;const i=Ft(a,s);if(i<=0)return null;const r=n/i;return r<Qe||r>ze?null:r},xe=[{vowel:"a",f1:750,f2:1400},{vowel:"e",f1:400,f2:2200},{vowel:"ɛ",f1:550,f2:1900},{vowel:"i",f1:280,f2:2300},{vowel:"o",f1:450,f2:800},{vowel:"u",f1:310,f2:800},{vowel:"y",f1:280,f2:1800}],_t=.01,en=.001,Lt=e=>{const n=e.length,o=new Float32Array(n);for(let t=0;t<n;t++){const l=.54-.46*Math.cos(2*Math.PI*t/(n-1));o[t]=e[t]*l}return o},Bt=e=>{const n=Ht(e.length),o=new Float32Array(n),t=new Float32Array(n);o.set(e.subarray(0,Math.min(e.length,n))),$t(o,t,n);for(let s=2;s<=n;s*=2){const i=s/2,r=-2*Math.PI/s;for(let d=0;d<n;d+=s)for(let c=0;c<i;c++){const h=r*c,f=Math.cos(h),g=Math.sin(h),v=d+c,A=d+c+i,F=f*o[A]-g*t[A],O=f*t[A]+g*o[A];o[A]=o[v]-F,t[A]=t[v]-O,o[v]=o[v]+F,t[v]=t[v]+O}}const l=n/2+1,a=new Float32Array(l);for(let s=0;s<l;s++)a[s]=Math.sqrt(o[s]*o[s]+t[s]*t[s]);return a},nn=(e,n,o,t)=>{const l=(e.length-1)*2,a=n/l,s=Math.max(1,Math.ceil(o/a)),i=Math.min(e.length-1,Math.floor(t/a));let r=s,d=e[s];for(let c=s+1;c<=i;c++)e[c]>d&&(d=e[c],r=c);if(r>s&&r<i){const c=e[r-1],h=e[r],f=e[r+1],g=c-2*h+f;if(g!==0){const v=.5*(c-f)/g;return(r+v)*a}}return r*a},Dt=(e,n)=>{let o=xe[0].vowel,t=1/0;for(const l of xe){const a=e-l.f1,s=n-l.f2,i=a*a+s*s;i<t&&(t=i,o=l.vowel)}return o},Wt=(e,n)=>{if(Nt(e)<_t)return null;const o=Lt(e),t=Bt(o),l=nn(t,n,200,900),a=nn(t,n,700,2500),s=tn(t,n,l),i=tn(t,n,a);return s<en||i<en||a<=l?null:Dt(l,a)},Nt=e=>{let n=0;for(let o=0;o<e.length;o++)n+=e[o]*e[o];return Math.sqrt(n/e.length)},Ht=e=>{let n=1;for(;n<e;)n*=2;return n},$t=(e,n,o)=>{const t=Math.log2(o);for(let l=0;l<o;l++){const a=Gt(l,t);if(a>l){const s=e[l];e[l]=e[a],e[a]=s;const i=n[l];n[l]=n[a],n[a]=i}}},Gt=(e,n)=>{let o=0;for(let t=0;t<n;t++)o=o<<1|e&1,e>>=1;return o},tn=(e,n,o)=>{const t=(e.length-1)*2,l=Math.round(o*t/n),a=Math.max(0,Math.min(e.length-1,l));return e[a]},ke={isVoicing:!1,currentDuration:0},jt=(e,n,o)=>e?{isVoicing:!0,currentDuration:o.currentDuration+n}:{isVoicing:!1,currentDuration:0},Ut=.01,Yt=2048,Xt=()=>{let e=null,n=null,o=null,t=null,l=ke,a=0;const s=new Set,i=f=>{for(const g of s)g(f)},r=f=>{if(n===null||e===null)return;const g=a===0?0:(f-a)/1e3;a=f;const v=new Float32Array(n.fftSize);n.getFloatTimeDomainData(v);const A={buffer:v,sampleRate:e.sampleRate},F=At(A.buffer),O=Ot(A.buffer,A.sampleRate),p=Wt(A.buffer,A.sampleRate),b=F>Ut;l=jt(b,g,l);const w={volume:F,pitch:O,vowel:p,isVoicing:b,duration:l.currentDuration};i(w),t=requestAnimationFrame(r)};return{start:async()=>{const f=await navigator.mediaDevices.getUserMedia({audio:!0});o=f;const g=new AudioContext;e=g;const v=g.createAnalyser();v.fftSize=Yt,n=v,g.createMediaStreamSource(f).connect(v),a=0,l=ke,t=requestAnimationFrame(r)},stop:()=>{if(t!==null&&(cancelAnimationFrame(t),t=null),o!==null){for(const f of o.getTracks())f.stop();o=null}e!==null&&(e.close(),e=null),n=null,l=ke,a=0},subscribe:f=>(s.add(f),()=>{s.delete(f)})}},Vt=e=>{let n=e;const o=new Set;return{get:()=>n,set:s=>{n=s,o.forEach(i=>i(n))},subscribe:s=>(o.add(s),()=>{o.delete(s)})}},on=()=>window.location.hash.replace(/^#/,"")||"menu",qt=(e,n)=>{let o=null;const t=i=>n.find(r=>r.id===i),l=i=>{for(o&&o.unmount();e.firstChild;)e.removeChild(e.firstChild);const r=t(i)??t("menu")??null;o=r,r&&r.mount(e),window.location.hash=`#${(r==null?void 0:r.id)??i}`},a=()=>o,s=()=>{l(on())};return window.addEventListener("hashchange",s),l(on()),{navigate:l,getCurrentGame:a}},C=(e,n,...o)=>{const t=document.createElement(e);if(n)for(const[l,a]of Object.entries(n))t.setAttribute(l,a);for(const l of o)typeof l=="string"?t.appendChild(document.createTextNode(l)):t.appendChild(l);return t},Kt=(e,n=document)=>{const o=n.querySelector(e);if(!o)throw new Error(`Element not found: ${e}`);return o},tt=e=>{for(;e.firstChild;)e.removeChild(e.firstChild)},T={bg:"#f0f4ff",text:"#2d3748",primary:"#6366f1",secondary:"#f472b6",green:"#34d399",surface:"#ffffff",muted:"#94a3b8"},X={a:"#ef4444",e:"#f59e0b",ɛ:"#f97316",i:"#22c55e",o:"#3b82f6",u:"#8b5cf6",y:"#ec4899"},u=(e,n)=>{const o=Math.max(0,Math.min(1,n)),t=parseInt(e.slice(1,3),16),l=parseInt(e.slice(3,5),16),a=parseInt(e.slice(5,7),16);return`rgba(${t}, ${l}, ${a}, ${o})`},ln=["#818cf8","#f472b6","#34d399","#fbbf24","#60a5fa"],Zt=e=>ln[e%ln.length],Jt=e=>{Object.assign(e.style,{display:"flex",flexDirection:"column",alignItems:"center",minHeight:"100%",padding:"32px 16px",backgroundColor:T.bg,fontFamily:"inherit",overflowY:"auto"})},Qt=e=>{Object.assign(e.style,{fontSize:"3rem",fontWeight:"800",color:T.primary,margin:"0 0 8px 0",letterSpacing:"-0.02em"})},zt=e=>{Object.assign(e.style,{fontSize:"1.5rem",fontWeight:"500",color:T.muted,margin:"0 0 40px 0"})},xt=e=>{Object.assign(e.style,{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"24px",width:"100%",maxWidth:"800px"})},eo=(e,n)=>{Object.assign(e.style,{backgroundColor:n,borderRadius:"16px",padding:"32px 24px",cursor:"pointer",border:"none",textAlign:"left",transition:"transform 0.15s ease, box-shadow 0.15s ease",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"}),e.addEventListener("mouseenter",()=>{e.style.transform="scale(1.04)",e.style.boxShadow="0 8px 24px rgba(0, 0, 0, 0.15)"}),e.addEventListener("mouseleave",()=>{e.style.transform="scale(1)",e.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.1)"})},no=e=>{Object.assign(e.style,{fontSize:"1.6rem",fontWeight:"700",color:"#ffffff",margin:"0 0 8px 0"})},to=e=>{Object.assign(e.style,{fontSize:"1.1rem",fontWeight:"400",color:"rgba(255, 255, 255, 0.9)",margin:"0",lineHeight:"1.4"})},oo=(e,n)=>{const o=C("p",{},e.name);no(o);const t=C("p",{},e.description);to(t);const l=C("button",{},o,t);return eo(l,Zt(n)),l.addEventListener("click",()=>{window.location.hash="#"+e.id}),l},lo=e=>({id:"menu",name:"Accueil",description:"Choisis un jeu !",mount:l=>{tt(l);const a=C("div",{});Jt(a);const s=C("h1",{},"Ortho");Qt(s);const i=C("p",{},"Choisis un jeu !");zt(i);const r=C("div",{});xt(r),e.forEach((d,c)=>{r.appendChild(oo(d,c))}),a.appendChild(s),a.appendChild(i),a.appendChild(r),l.appendChild(a)},unmount:()=>{},update:l=>{}}),ce=["background: "+T.surface,"border-radius: 16px","padding: 24px","box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08)","display: flex","flex-direction: column","gap: 12px"].join("; "),he=["font-size: 14px","font-weight: 600","color: "+T.muted,"text-transform: uppercase","letter-spacing: 1px"].join("; "),an=["font-size: 32px","font-weight: 700","color: "+T.text].join("; "),ao=["display: grid","grid-template-columns: 1fr 1fr","gap: 20px","padding: 24px","max-width: 720px","margin: 0 auto","font-family: system-ui, -apple-system, sans-serif"].join("; "),so=["display: flex","align-items: center","justify-content: center","position: relative","padding: 20px 24px 4px","max-width: 720px","margin: 0 auto"].join("; "),io=["position: absolute","left: 24px","top: 20px","background: none","border: none","font-size: 16px","color: "+T.primary,"cursor: pointer","padding: 8px 12px","border-radius: 8px","font-weight: 600","transition: background 0.15s"].join("; "),ro=["font-size: 24px","font-weight: 700","color: "+T.text,"margin: 0"].join("; "),fo=["width: 100%","height: 24px","background: "+T.bg,"border-radius: 12px","overflow: hidden"].join("; "),co=["height: 100%","border-radius: 12px","transition: width 0.05s linear, background 0.15s","width: 0%"].join("; "),ho=["width: 120px","height: 120px","border-radius: 50%","display: flex","align-items: center","justify-content: center","font-size: 48px","font-weight: 700","color: white","margin: 0 auto","transition: background-color 0.15s","background: "+T.bg].join("; "),uo=["display: flex","flex-wrap: wrap","gap: 6px","min-height: 32px","align-items: center"].join("; "),po=["width: 28px","height: 28px","border-radius: 50%","display: flex","align-items: center","justify-content: center","font-size: 13px","font-weight: 700","color: white"].join("; "),go=e=>{const n=Math.round(255*(1-e));return`rgb(${Math.round(255*e)}, ${n}, 80)`},mo=20,bo=()=>{let e=null,n=null,o=null,t=null,l=null,a=null;return{id:"dashboard",name:"Dashboard",description:"Tableau de bord diagnostique — visualise le pipeline audio en temps réel",mount:d=>{const c=C("div",{style:"background: "+T.bg+"; min-height: 100vh;"}),h=C("div",{style:so}),f=C("button",{style:io},"← Accueil");f.addEventListener("click",()=>{window.location.hash="#menu"}),f.addEventListener("mouseenter",()=>{f.style.background=u(T.primary,.1)}),f.addEventListener("mouseleave",()=>{f.style.background="none"});const g=C("h1",{style:ro},"Dashboard");h.appendChild(f),h.appendChild(g),c.appendChild(h);const v=C("div",{style:ao}),A=C("div",{style:ce}),F=C("span",{style:he},"Volume"),O=C("div",{style:fo});e=C("div",{style:co}),O.appendChild(e),A.appendChild(F),A.appendChild(O);const p=C("div",{style:ce}),b=C("span",{style:he},"Pitch");n=C("span",{style:an},"—"),p.appendChild(b),p.appendChild(n);const w=C("div",{style:ce}),y=C("span",{style:he},"Voyelle");o=C("div",{style:ho}),t=C("span",{},"—"),o.appendChild(t),w.appendChild(y),w.appendChild(o);const S=C("div",{style:ce}),P=C("span",{style:he},"Durée");l=C("span",{style:an},"0.0 s"),S.appendChild(P),S.appendChild(l),v.appendChild(A),v.appendChild(p),v.appendChild(w),v.appendChild(S),c.appendChild(v);const M=C("div",{style:"padding: 0 24px 24px; max-width: 720px; margin: 0 auto;"}),m=C("div",{style:ce}),E=C("span",{style:he},"Historique voyelles");a=C("div",{style:uo}),m.appendChild(E),m.appendChild(a),M.appendChild(m),c.appendChild(M),tt(d),d.appendChild(c)},update:d=>{if(e){const c=Math.round(d.volume*100);e.style.width=c+"%",e.style.background=go(d.volume)}if(n&&(n.textContent=d.pitch!==null?Math.round(d.pitch)+" Hz":"—"),o&&t)if(d.vowel!==null){const c=X[d.vowel]??T.muted;o.style.background=c,t.textContent=d.vowel,t.style.color="white"}else o.style.background=T.bg,t.textContent="—",t.style.color=T.muted;if(l&&(l.textContent=d.duration.toFixed(1)+" s"),a&&d.vowel!==null){const c=X[d.vowel]??T.muted,h=C("div",{style:po+"; background: "+c},d.vowel);for(a.insertBefore(h,a.firstChild);a.children.length>mo;)a.removeChild(a.lastChild)}},unmount:()=>{e=null,n=null,o=null,t=null,l=null,a=null}}},Z=e=>{const n=document.createElement("canvas"),o=n.getContext("2d");if(!o)throw new Error("Failed to get 2D rendering context");e.appendChild(n);const{width:t,height:l}=V(n,o);return{canvas:n,ctx:o,width:t,height:l}},x=(e,n,o)=>{e.clearRect(0,0,n,o)},V=(e,n)=>{const o=e.parentElement;if(!o)throw new Error("Canvas must be mounted in a parent element");const t=window.devicePixelRatio||1,l=o.clientWidth,a=o.clientHeight;return e.width=l*t,e.height=a*t,e.style.width=`${l}px`,e.style.height=`${a}px`,n.setTransform(t,0,0,t,0,0),{width:l,height:a}},So=6,yo=.003,wo=.05,vo=10,Po=50,To=-1,Co=-3,sn=.5,Mo=.3,Ao=.7,Eo=.8,rn=(e,n)=>e+Math.random()*(n-e),Io=(e,n,o,t)=>({x:rn(e*Mo,e*Ao),y:n,radius:vo+o*Po,color:t&&X[t]?X[t]:T.primary,alpha:Eo,vy:To+o*Co,vx:rn(-sn,sn)}),Ro=e=>({...e,y:e.y+e.vy,x:e.x+e.vx,alpha:e.alpha-yo,radius:e.radius+wo}),ko=e=>e.alpha>0&&e.y+e.radius>0,Fo=(e,n)=>{e.beginPath(),e.arc(n.x,n.y,n.radius,0,Math.PI*2),e.fillStyle=u(n.color,n.alpha),e.fill()},Oo=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:T.bg})},_o=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:T.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u(T.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Lo=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u(T.primary,.5),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},Bo=()=>{let e=null,n=null,o=0,t=0,l=[],a=null,s=null,i=0,r=null;const d=()=>{if(n){x(n,o,t),l=l.map(Ro).filter(ko);for(const v of l)Fo(n,v);a=requestAnimationFrame(d)}},c=()=>{if(!e||!n)return;const v=V(e,n);o=v.width,t=v.height};return{id:"bubbles",name:"Bulles",description:"Fais monter des bulles avec ta voix !",mount:v=>{const A=C("div",{});Oo(A),s=C("button",{},"← Accueil"),_o(s),s.addEventListener("click",()=>{window.location.hash="#menu"});const F=C("p",{},"Bulles");Lo(F),A.appendChild(s),A.appendChild(F),v.appendChild(A);const O=Z(A);e=O.canvas,n=O.ctx,o=O.width,t=O.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),r=c,window.addEventListener("resize",r),l=[],i=0,d()},unmount:()=>{a!==null&&(cancelAnimationFrame(a),a=null),r&&(window.removeEventListener("resize",r),r=null),e=null,n=null,s=null,l=[],i=0,o=0,t=0},update:v=>{if(!v.isVoicing){i=0;return}i+=1,i>=So&&(i=0,l.push(Io(o,t,v.volume,v.vowel)))}}},dn=120,Do=.08,Me=36,ot=56,Wo=3,No=.03,fn=3,cn=2.5,Ho=3,$o=8,hn=.08,Go=.12,jo=.08,lt="#0f0e2e",Uo="#1a3a2a",Yo="#2d5a3a",un=["#ff6b35","#ffa500","#ffcc00","#ff4444","#ffee88"],Xo=[{x:.78,y:.7,radius:18,color:"#66bb6a",label:"",ringColor:null},{x:.2,y:.5,radius:24,color:"#ffa726",label:"",ringColor:"#ffcc80"},{x:.82,y:.32,radius:20,color:"#ab47bc",label:"",ringColor:null},{x:.35,y:.15,radius:30,color:"#42a5f5",label:"",ringColor:"#90caf9"}],Vo=(e,n,o)=>e+(n-e)*o,ie=(e,n)=>e+Math.random()*(n-e),pn=e=>Array.from({length:e},()=>({x:Math.random(),y:Math.random(),size:ie(.5,2.5),twinkleSpeed:ie(.01,.04),twinkleOffset:Math.random()*Math.PI*2})),qo=(e,n,o)=>({x:e+ie(-Me*.3,Me*.3),y:n+ie(0,4),vx:ie(-fn,fn),vy:ie(cn*.5,cn)*(.5+o*.5),life:1,size:ie(Ho,$o)*(.6+o*.8),color:un[Math.floor(Math.random()*un.length)]}),Ko=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,life:e.life-No,size:e.size*.97}),Zo=e=>e.life>0&&e.size>.5,Jo=(e,n,o,t,l)=>{for(const a of n){const s=.4+.6*Math.abs(Math.sin(l*a.twinkleSpeed+a.twinkleOffset));e.beginPath(),e.arc(a.x*o,a.y*t,a.size,0,Math.PI*2),e.fillStyle=u("#ffffff",s),e.fill()}},Qo=(e,n,o,t)=>{const l=n.x*o,a=n.y*t,s=e.createRadialGradient(l,a,n.radius*.5,l,a,n.radius*2);s.addColorStop(0,u(n.color,.2)),s.addColorStop(1,u(n.color,0)),e.beginPath(),e.arc(l,a,n.radius*2,0,Math.PI*2),e.fillStyle=s,e.fill(),e.beginPath(),e.arc(l,a,n.radius,0,Math.PI*2),e.fillStyle=n.color,e.fill(),n.ringColor&&(e.beginPath(),e.ellipse(l,a,n.radius*1.8,n.radius*.35,-.3,0,Math.PI*2),e.strokeStyle=u(n.ringColor,.6),e.lineWidth=2,e.stroke())},zo=(e,n,o)=>{const t=o*(1-hn);e.fillStyle=Uo,e.fillRect(0,t,n,o*hn),e.fillStyle=Yo,e.fillRect(0,t,n,3)},xo=(e,n,o)=>{const t=Me/2,l=ot;e.save(),e.translate(n,o),e.beginPath(),e.moveTo(0,-l),e.lineTo(-t*.5,-l*.55),e.lineTo(t*.5,-l*.55),e.closePath(),e.fillStyle="#ef4444",e.fill(),e.beginPath(),e.moveTo(-t*.5,-l*.55),e.lineTo(-t*.5,0),e.lineTo(t*.5,0),e.lineTo(t*.5,-l*.55),e.closePath(),e.fillStyle="#e0e0e0",e.fill(),e.fillStyle=T.primary,e.fillRect(-t*.5,-l*.4,Me*.5,l*.12),e.beginPath(),e.arc(0,-l*.42,t*.28,0,Math.PI*2),e.fillStyle="#81d4fa",e.fill(),e.beginPath(),e.arc(0,-l*.42,t*.28,0,Math.PI*2),e.strokeStyle="#4fc3f7",e.lineWidth=1.5,e.stroke(),e.beginPath(),e.moveTo(-t*.5,-l*.08),e.lineTo(-t,l*.08),e.lineTo(-t*.5,0),e.closePath(),e.fillStyle="#ef4444",e.fill(),e.beginPath(),e.moveTo(t*.5,-l*.08),e.lineTo(t,l*.08),e.lineTo(t*.5,0),e.closePath(),e.fillStyle="#ef4444",e.fill(),e.beginPath(),e.moveTo(-t*.3,0),e.lineTo(-t*.2,l*.08),e.lineTo(t*.2,l*.08),e.lineTo(t*.3,0),e.closePath(),e.fillStyle="#78909c",e.fill(),e.restore()},el=(e,n)=>{for(const o of n)e.beginPath(),e.arc(o.x,o.y,o.size,0,Math.PI*2),e.fillStyle=u(o.color,o.life*.8),e.fill()},nl=(e,n,o,t,l,a)=>{const s=1-(t-l)/(a-l),i=n-24,r=o*.08,d=o*.84,c=8;e.fillStyle=u("#ffffff",.1),e.beginPath(),e.roundRect(i-c/2,r,c,d,4),e.fill();const h=d*Math.max(0,Math.min(1,s)),f=e.createLinearGradient(0,r+d,0,r);f.addColorStop(0,"#34d399"),f.addColorStop(.5,"#fbbf24"),f.addColorStop(1,"#ef4444"),e.fillStyle=f,e.beginPath(),e.roundRect(i-c/2,r+d-h,c,h,4),e.fill()},tl=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:lt})},ol=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:"#a5b4fc",cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u("#1e1b4b",.7),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},ll=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u("#a5b4fc",.6),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},al=()=>{let e=null,n=null,o=0,t=0,l=null,a=null,s=[],i=0,r=0,d=[],c=0,h=!1,f=0;const g=()=>t*(1-Go),v=()=>t*jo+ot,A=()=>o/2,F=()=>{if(n){if(f+=1,i=Vo(i,r,Do),d=d.map(Ko).filter(Zo),h&&c>.01){const y=Math.ceil(Wo*(.5+c*1.5));for(let S=0;S<y;S++)d.push(qo(A(),i,c))}x(n,o,t),n.fillStyle=lt,n.fillRect(0,0,o,t),Jo(n,s,o,t,f);for(const y of Xo)Qo(n,y,o,t);zo(n,o,t),el(n,d),xo(n,A(),i),nl(n,o,t,i,v(),g()),l=requestAnimationFrame(F)}},O=()=>{if(!e||!n)return;const y=g(),S=v(),P=y>S?(i-S)/(y-S):1,M=V(e,n);o=M.width,t=M.height;const m=g(),E=v();i=E+P*(m-E),r=i,s=pn(dn)};return{id:"rocket",name:"Fusée",description:"Fais décoller la fusée avec ta voix !",mount:y=>{const S=C("div",{});tl(S);const P=C("button",{},"← Accueil");ol(P),P.addEventListener("click",()=>{window.location.hash="#menu"});const M=C("p",{},"Fusée");ll(M),S.appendChild(P),S.appendChild(M),y.appendChild(S);const m=Z(S);e=m.canvas,n=m.ctx,o=m.width,t=m.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),s=pn(dn),i=g(),r=i,d=[],c=0,h=!1,f=0,a=O,window.addEventListener("resize",a),F()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),a&&(window.removeEventListener("resize",a),a=null),e=null,n=null,s=[],d=[],c=0,h=!1,f=0,o=0,t=0},update:y=>{c=y.volume,h=y.isVoicing;const S=g(),P=v();y.isVoicing&&y.volume>.01?r=S-y.volume*(S-P):r=S}}},gn=["#f9a8d4","#a5b4fc","#86efac","#fcd34d","#fca5a5","#c4b5fd","#67e8f9","#fdba74","#d8b4fe","#6ee7b7"],mn=["star","heart","butterfly","flower"],sl=9,il=15,Fe=20,rl=.45,dl=.06,fl=.25,$e="#0a0e1a",bn=.04,Pe=(e,n)=>e+Math.random()*(n-e),Sn=(e,n,o,t)=>Math.sqrt((o-e)**2+(t-n)**2),yn=(e,n,o)=>Math.max(n,Math.min(o,e)),cl=(e,n)=>{const t=[];for(let l=0;l<sl;l++)t.push({x:Pe(60,e-60),y:Pe(110,n-60),kind:mn[l%mn.length],color:gn[l%gn.length],size:Pe(18,30),discovered:!1,glowPhase:Pe(0,Math.PI*2)});return t},hl=(e,n,o,t,l,a)=>{const i=t,r=t*.45;e.save(),e.globalAlpha=a,e.fillStyle=l,e.beginPath();for(let d=0;d<10;d++){const c=d%2===0?i:r,h=Math.PI*d/5-Math.PI/2,f=n+Math.cos(h)*c,g=o+Math.sin(h)*c;d===0?e.moveTo(f,g):e.lineTo(f,g)}e.closePath(),e.fill(),e.restore()},ul=(e,n,o,t,l,a)=>{const s=t*.6;e.save(),e.globalAlpha=a,e.fillStyle=l,e.beginPath(),e.moveTo(n,o+s*.3),e.bezierCurveTo(n,o-s*.3,n-s,o-s*.3,n-s,o+s*.1),e.bezierCurveTo(n-s,o+s*.6,n,o+s*.9,n,o+s*1.1),e.bezierCurveTo(n,o+s*.9,n+s,o+s*.6,n+s,o+s*.1),e.bezierCurveTo(n+s,o-s*.3,n,o-s*.3,n,o+s*.3),e.closePath(),e.fill(),e.restore()},pl=(e,n,o,t,l,a)=>{const s=t*.7;e.save(),e.globalAlpha=a,e.fillStyle=l,e.beginPath(),e.ellipse(n-s*.45,o-s*.25,s*.5,s*.35,-Math.PI/6,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(n+s*.45,o-s*.25,s*.5,s*.35,Math.PI/6,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(n-s*.35,o+s*.25,s*.35,s*.25,Math.PI/6,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(n+s*.35,o+s*.25,s*.35,s*.25,-Math.PI/6,0,Math.PI*2),e.fill(),e.fillStyle=u(l,a*.8),e.beginPath(),e.ellipse(n,o,s*.08,s*.45,0,0,Math.PI*2),e.fill(),e.restore()},gl=(e,n,o,t,l,a)=>{const i=t*.35,r=t*.2,d=t*.35;e.save(),e.globalAlpha=a,e.fillStyle=l;for(let c=0;c<6;c++){const h=Math.PI*2*c/6,f=n+Math.cos(h)*d,g=o+Math.sin(h)*d;e.beginPath(),e.arc(f,g,i,0,Math.PI*2),e.fill()}e.fillStyle=u("#fef08a",a),e.beginPath(),e.arc(n,o,r,0,Math.PI*2),e.fill(),e.restore()},ml=(e,n,o,t)=>{const l=n.size*t;({star:()=>hl(e,n.x,n.y,l,n.color,o),heart:()=>ul(e,n.x,n.y,l,n.color,o),butterfly:()=>pl(e,n.x,n.y,l,n.color,o),flower:()=>gl(e,n.x,n.y,l,n.color,o)})[n.kind]()},bl=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:$e})},Sl=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:"#a5b4fc",cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u("#1e1b4b",.7),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},yl=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u("#c7d2fe",.6),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},wl=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",fontSize:"1.1rem",fontWeight:"600",color:"#fcd34d",margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:u("#1e1b4b",.7),borderRadius:"8px"})},vl=()=>{let e=null,n=null,o=0,t=0,l=[],a=null,s=null,i=null,r=0,d=0,c=0,h=0;const f=m=>{const E=Math.min(o,t)*rl;return Fe+m*m*E},g=m=>{l=l.map(E=>{if(E.discovered)return E;const _=Sn(c,h,E.x,E.y),k=m-E.size-il;return _<k?{...E,discovered:!0}:E})},v=()=>{if(!i)return;const m=l.filter(E=>E.discovered).length;i.textContent=`${m} / ${l.length}`},A=m=>{m.fillStyle=$e,m.fillRect(0,0,o,t)},F=(m,E)=>{if(E<=Fe)return;const _=m.createRadialGradient(c,h,0,c,h,E);_.addColorStop(0,u("#2a3a6a",.9)),_.addColorStop(.3,u("#1a2550",.7)),_.addColorStop(.7,u("#101830",.4)),_.addColorStop(1,u($e,0)),m.save(),m.globalCompositeOperation="lighter",m.fillStyle=_,m.beginPath(),m.arc(c,h,E,0,Math.PI*2),m.fill(),m.restore()},O=(m,E,_)=>{for(const k of l){const I=Sn(c,h,k.x,k.y);let D;if(k.discovered&&E<=Fe)D=bn*3;else if(I>E+k.size)D=k.discovered?bn*2:0;else if(I>E-k.size){const te=(E+k.size-I)/(k.size*2);D=yn(te,0,1)*.9}else{const te=1-I/E*.3;D=yn(te,.5,.95)}if(D<=0)continue;let U=1;k.discovered&&(U=1+Math.sin(_*dl+k.glowPhase)*fl,D=Math.min(D+.15,1)),ml(m,k,D,U)}},p=(m,E)=>{if(l.filter(I=>I.discovered).length>0)return;const k=.25+Math.sin(E*.03)*.1;m.save(),m.fillStyle=u("#c7d2fe",k),m.font="1.1rem system-ui, sans-serif",m.textAlign="center",m.fillText("Parle pour allumer la lampe !",o/2,t/2+60),m.restore()};let b=0;const w=()=>{n&&(b+=1,x(n,o,t),r+=(d-r)*.12,A(n),F(n,r),O(n,r,b),p(n,b),g(r),v(),a=requestAnimationFrame(w))},y=()=>{if(!e||!n)return;const m=V(e,n);o=m.width,t=m.height,c=o/2,h=t/2};return{id:"lamp",name:"Lampe Magique",description:"Illumine l’obscurité avec ta voix pour découvrir des créatures cachées !",mount:m=>{const E=C("div",{});bl(E);const _=C("button",{},"← Accueil");Sl(_),_.addEventListener("click",()=>{window.location.hash="#menu"});const k=C("p",{},"Lampe Magique");yl(k),i=C("p",{},"0 / 0"),wl(i),E.appendChild(_),E.appendChild(k),E.appendChild(i),m.appendChild(E);const I=Z(E);e=I.canvas,n=I.ctx,o=I.width,t=I.height,c=o/2,h=t/2,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),l=cl(o,t),r=0,d=0,b=0,s=y,window.addEventListener("resize",s),v(),w()},unmount:()=>{a!==null&&(cancelAnimationFrame(a),a=null),s&&(window.removeEventListener("resize",s),s=null),e=null,n=null,i=null,l=[],r=0,d=0,b=0,o=0,t=0},update:m=>{m.isVoicing?d=f(m.volume):d=0}}},wn=7,Pl=.15,Tl=60,Cl=1/Tl,Ml=.03,Al=180,El=80,Il=.08,Rl=.006,kl=.3,Fl=.008,Ol=8,vn=.08,_l=.12,Pn=["#fca5a5","#a5b4fc","#86efac","#fcd34d","#f9a8d4","#67e8f9","#fdba74"],Tn=["#f472b6","#a78bfa","#34d399","#fbbf24","#60a5fa","#f87171","#2dd4bf","#fb923c"],at="#2d1b33",Ll="#4a2c2a",Bl="#5c3a2e",Dl="#7a5040",j=(e,n)=>e+Math.random()*(n-e),Te=(e,n,o)=>Math.max(n,Math.min(o,e)),Wl=e=>Array.from({length:e},(n,o)=>({x:0,bodyColor:Pn[o%Pn.length],flameScale:1,extinguished:!1,blowAccumulator:0})),Cn=(e,n)=>{const o=n*.12,t=(n-o*2)/(e.length-1);return e.map((l,a)=>({...l,x:o+a*t}))},Nl=e=>{const n=e.findIndex(o=>!o.extinguished);return n===-1?null:n},Hl=(e,n)=>({x:e+j(-3,3),y:n-j(2,8),vx:j(-.3,.3),vy:j(-.8,-.3),alpha:j(.3,.6),size:j(3,6)}),$l=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,alpha:e.alpha-Fl,size:e.size+.03}),Gl=e=>e.alpha>0,jl=(e,n)=>Array.from({length:El},()=>({x:j(0,e),y:j(-n*.3,n*.1),vx:j(-2,2),vy:j(1,3),rotation:j(0,Math.PI*2),rotationSpeed:j(-.1,.1),color:Tn[Math.floor(Math.random()*Tn.length)],alpha:1,width:j(6,12),height:j(3,6)})),Ul=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,vy:e.vy+Il,rotation:e.rotation+e.rotationSpeed,alpha:e.alpha-Rl}),Yl=e=>e.alpha>0,Xl=(e,n,o)=>{const t=e.createLinearGradient(0,0,0,o);t.addColorStop(0,at),t.addColorStop(1,Ll),e.fillStyle=t,e.fillRect(0,0,n,o)},Vl=(e,n,o,t)=>{const l=e.createLinearGradient(0,t,0,o);l.addColorStop(0,Dl),l.addColorStop(.15,Bl),l.addColorStop(1,"#3d2518"),e.fillStyle=l,e.beginPath(),e.roundRect(0,t,n,o-t,[8,8,0,0]),e.fill(),e.strokeStyle=u("#a07050",.4),e.lineWidth=1.5,e.beginPath(),e.moveTo(0,t),e.lineTo(n,t),e.stroke()},ql=(e,n,o,t,l,a)=>{const s=n-t/2,i=o-l;e.fillStyle=a,e.beginPath(),e.roundRect(s,i,t,l,[4,4,0,0]),e.fill(),e.fillStyle=u("#ffffff",.15),e.beginPath(),e.roundRect(s+2,i,t*.25,l,[3,0,0,0]),e.fill(),e.strokeStyle="#4a3728",e.lineWidth=2,e.beginPath(),e.moveTo(n,i),e.lineTo(n,i-8),e.stroke()},Kl=(e,n,o,t,l)=>{if(t<=.01)return;const a=22*t,s=9*t,i=o-a,r=l*3*t;e.save();const d=20*t,c=e.createRadialGradient(n+r,o-a*.5,0,n+r,o-a*.5,d);c.addColorStop(0,u("#fef08a",.25*t)),c.addColorStop(1,u("#fef08a",0)),e.fillStyle=c,e.beginPath(),e.arc(n+r,o-a*.5,d,0,Math.PI*2),e.fill(),e.fillStyle=u("#fb923c",.85),e.beginPath(),e.moveTo(n-s*.6+r*.5,o),e.quadraticCurveTo(n-s+r*.8,o-a*.5,n+r,i),e.quadraticCurveTo(n+s+r*.8,o-a*.5,n+s*.6+r*.5,o),e.closePath(),e.fill();const h=.65;e.fillStyle=u("#fef08a",.9),e.beginPath(),e.moveTo(n-s*.35+r*.3,o),e.quadraticCurveTo(n-s*h+r*.5,o-a*.45,n+r*.7,i+a*.2),e.quadraticCurveTo(n+s*h+r*.5,o-a*.45,n+s*.35+r*.3,o),e.closePath(),e.fill();const f=e.createRadialGradient(n+r*.5,o-a*.2,0,n+r*.5,o-a*.2,s*.4);f.addColorStop(0,u("#ffffff",.6*t)),f.addColorStop(1,u("#fef9c3",0)),e.fillStyle=f,e.beginPath(),e.arc(n+r*.5,o-a*.2,s*.4,0,Math.PI*2),e.fill(),e.restore()},Zl=(e,n)=>{for(const o of n)e.beginPath(),e.arc(o.x,o.y,o.size,0,Math.PI*2),e.fillStyle=u("#9ca3af",o.alpha),e.fill()},Jl=(e,n)=>{for(const o of n)e.save(),e.translate(o.x,o.y),e.rotate(o.rotation),e.fillStyle=u(o.color,o.alpha),e.fillRect(-o.width/2,-o.height/2,o.width,o.height),e.restore()},Ql=(e,n,o)=>{if(n<=0)return;const t=n===1?"1 fois":`${n} fois`;e.save(),e.font="600 1rem system-ui, sans-serif",e.textAlign="center";const l=e.measureText(t).width,a=12,s=o/2-l/2-a,i=50;e.fillStyle=u("#1e1b4b",.6),e.beginPath(),e.roundRect(s,i,l+a*2,32,8),e.fill(),e.fillStyle=u("#fcd34d",.85),e.fillText(t,o/2,i+22),e.restore()},zl=(e,n,o,t,l)=>{if(l)return;const a=.3+Math.sin(t*.04)*.1;e.save(),e.fillStyle=u("#fef9c3",a),e.font="1.1rem system-ui, sans-serif",e.textAlign="center",e.fillText("Souffle pour éteindre les bougies !",n/2,o*.15),e.restore()},xl=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:at})},ea=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:"#fcd34d",cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u("#1e1b4b",.7),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},na=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u("#fef9c3",.6),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},ta=()=>{let e=null,n=null,o=0,t=0,l=null,a=null,s=[],i=new Map,r=[],d=0,c=0,h=!1,f=0,g=!1,v=0;const A=()=>t*.7,F=()=>Te(o/(wn*2.5),16,36),O=()=>Te(t*.18,50,120),p=()=>{s=s.map(m=>({...m,flameScale:1,extinguished:!1,blowAccumulator:0})),i=new Map,h=!1,g=!1,f=0},b=()=>{g=!0,h=!0,f=0,d+=1,r=jl(o,t)},w=()=>{if(!n)return;c+=1,x(n,o,t);const m=A(),E=F(),_=O(),k=m-_-8;Xl(n,o,t),Vl(n,o,t,m);for(const[I,D]of i.entries()){const U=D.map($l).filter(Gl);U.length===0?i.delete(I):i.set(I,U)}for(let I=0;I<s.length;I++){const D=s[I];if(D.extinguished&&Math.random()<kl){const U=i.get(I)??[];U.length<Ol&&i.set(I,[...U,Hl(D.x,k)])}}for(let I=0;I<s.length;I++){const D=s[I];if(ql(n,D.x,m,E,_,D.bodyColor),!D.extinguished){const te=Math.sin(c*vn+I*1.7),B=Math.sin(c*vn*1.6+I*2.3)*.5,W=(te+B)*_l;Kl(n,D.x,k,D.flameScale,W)}const U=i.get(I);U&&Zl(n,U)}s=s.map((I,D)=>{if(I.extinguished)return I;if(Nl(s)===D&&v>Pl){const N=I.blowAccumulator+1,Y=Te(1-N*Cl,0,1);return Y<=0?{...I,flameScale:0,extinguished:!0,blowAccumulator:0}:{...I,flameScale:Y,blowAccumulator:N}}const W=Te(I.flameScale+Ml,0,1),G=Math.max(0,I.blowAccumulator-.5);return{...I,flameScale:W,blowAccumulator:G}}),!h&&s.every(I=>I.extinguished)&&b(),g&&(r=r.map(Ul).filter(Yl),Jl(n,r),f+=1,f>=Al&&p()),zl(n,o,t,c,h),Ql(n,d,o),l=requestAnimationFrame(w)},y=()=>{if(!e||!n)return;const m=V(e,n);o=m.width,t=m.height,s=Cn(s,o)};return{id:"candles",name:"Bougies",description:"Souffle pour éteindre les bougies",mount:m=>{const E=C("div",{});xl(E);const _=C("button",{},"← Accueil");ea(_),_.addEventListener("click",()=>{window.location.hash="#menu"});const k=C("p",{},"Bougies");na(k),E.appendChild(_),E.appendChild(k),m.appendChild(E);const I=Z(E);e=I.canvas,n=I.ctx,o=I.width,t=I.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),s=Cn(Wl(wn),o),i=new Map,r=[],d=0,c=0,h=!1,f=0,g=!1,v=0,a=y,window.addEventListener("resize",a),w()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),a&&(window.removeEventListener("resize",a),a=null),e=null,n=null,s=[],i=new Map,r=[],d=0,c=0,h=!1,f=0,g=!1,v=0,o=0,t=0},update:m=>{v=m.volume}}},st=80,oa=600,la=oa-st,aa=1.5,Mn=4,sa=30,ia=1.5,ra=.35,Oe=["#ef4444","#f97316","#eab308","#22c55e","#06b6d4","#3b82f6","#8b5cf6"],it=e=>Math.max(0,Math.min(1,(e-st)/la)),da=(e,n)=>{const t=n-80,l=it(e);return 40+t*(1-l)},fa=e=>{const n=it(e),o=Math.min(Oe.length-1,Math.floor(n*Oe.length));return Oe[o]},ca=e=>Mn+e*(sa-Mn),ha=(e,n,o,t,l)=>{const a=e.createRadialGradient(n,o,0,n,o,t);a.addColorStop(0,u(l,.85)),a.addColorStop(.5,u(l,.5)),a.addColorStop(1,u(l,0)),e.beginPath(),e.arc(n,o,t,0,Math.PI*2),e.fillStyle=a,e.fill()},ua=(e,n,o)=>{e.beginPath(),e.moveTo(n,0),e.lineTo(n,o),e.strokeStyle=u(T.text,ra),e.lineWidth=ia,e.stroke()},pa=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:T.bg})},ga=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:T.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u(T.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},ma=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u(T.primary,.5),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},ba=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1rem",fontWeight:"600",color:T.secondary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u(T.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Sa=()=>{let e=null,n=null,o=0,t=0,l=null,a=null,s=null,i=null,r=0,d=!0;const c=()=>{if(!e||(s||(s=document.createElement("canvas"),i=s.getContext("2d")),!s||!i))return;const p=window.devicePixelRatio||1;if(s.width!==e.width||s.height!==e.height){const b=document.createElement("canvas");b.width=s.width,b.height=s.height;const w=b.getContext("2d");w&&s.width>0&&s.height>0&&w.drawImage(s,0,0),s.width=e.width,s.height=e.height,i.setTransform(p,0,0,p,0,0),b.width>0&&b.height>0&&(i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(b,0,0,s.width,s.height),i.setTransform(p,0,0,p,0,0),i.restore())}},h=()=>{if(!i||!s)return;i.save(),i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,s.width,s.height),i.restore();const p=window.devicePixelRatio||1;i.setTransform(p,0,0,p,0,0),r=0,d=!0},f=()=>{if(!n||!s)return;n.fillStyle=T.bg,n.fillRect(0,0,o,t),n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(s,0,0),n.restore();const p=window.devicePixelRatio||1;n.setTransform(p,0,0,p,0,0),ua(n,r,t)},g=()=>{n&&(d&&(f(),d=!1),l=requestAnimationFrame(g))},v=()=>{if(!e||!n)return;const p=V(e,n);o=p.width,t=p.height,c(),d=!0};return{id:"piano",name:"Piano Visuel",description:"Peins avec ta voix",mount:p=>{const b=C("div",{});pa(b);const w=C("button",{},"← Accueil");ga(w),w.addEventListener("click",()=>{window.location.hash="#menu"});const y=C("p",{},"Piano Visuel");ma(y);const S=C("button",{},"Effacer");ba(S),S.addEventListener("click",h),b.appendChild(w),b.appendChild(y),b.appendChild(S),p.appendChild(b);const P=Z(b);e=P.canvas,n=P.ctx,o=P.width,t=P.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),c(),r=0,d=!0,a=v,window.addEventListener("resize",a),g()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),a&&(window.removeEventListener("resize",a),a=null),e=null,n=null,s=null,i=null,r=0,d=!1,o=0,t=0},update:p=>{if(i){if(r+=aa,r>o&&(r=0),p.isVoicing&&p.pitch!==null){const b=da(p.pitch,t),w=ca(p.volume),y=fa(p.pitch);ha(i,r,b,w,y)}d=!0}}}},ya=1.3,wa=.06,va=.03,Pa=.6,An=6,En=2.5,Ta=.015,Ca=10,rt=50,Ma=4,q=(e,n,o,t,l,a,s,i)=>{e.beginPath(),e.moveTo(n,o),e.lineTo(t,l),e.lineTo(a,s),e.closePath(),e.fillStyle=i,e.fill()},Ae=(e,n,o,t,l,a)=>{e.beginPath(),e.ellipse(n,o,t,l,0,0,Math.PI*2),e.fillStyle=a,e.fill()},L=(e,n,o,t,l)=>{e.beginPath(),e.arc(n,o,t,0,Math.PI*2),e.fillStyle=l,e.fill()},Aa=(e,n,o,t,l)=>{L(e,n,o,t,l),q(e,n-t*.7,o-t*.4,n-t*.35,o-t*1.15,n-t*.05,o-t*.55,l),q(e,n+t*.05,o-t*.55,n+t*.35,o-t*1.15,n+t*.7,o-t*.4,l);const a=u("#fca5a5",.8);q(e,n-t*.58,o-t*.48,n-t*.38,o-t*.95,n-t*.15,o-t*.58,a),q(e,n+t*.15,o-t*.58,n+t*.38,o-t*.95,n+t*.58,o-t*.48,a),L(e,n-t*.3,o-t*.15,t*.13,"#2d3748"),L(e,n+t*.3,o-t*.15,t*.13,"#2d3748"),L(e,n-t*.26,o-t*.2,t*.045,"#ffffff"),L(e,n+t*.34,o-t*.2,t*.045,"#ffffff"),q(e,n,o+t*.05,n-t*.08,o+t*.15,n+t*.08,o+t*.15,"#f472b6"),e.beginPath(),e.moveTo(n,o+t*.15),e.lineTo(n-t*.12,o+t*.3),e.moveTo(n,o+t*.15),e.lineTo(n+t*.12,o+t*.3),e.strokeStyle="#2d3748",e.lineWidth=1.5,e.stroke(),e.beginPath(),e.moveTo(n-t*.3,o+t*.1),e.lineTo(n-t*.85,o+t*0),e.moveTo(n-t*.3,o+t*.2),e.lineTo(n-t*.85,o+t*.25),e.moveTo(n+t*.3,o+t*.1),e.lineTo(n+t*.85,o+t*0),e.moveTo(n+t*.3,o+t*.2),e.lineTo(n+t*.85,o+t*.25),e.strokeStyle="#94a3b8",e.lineWidth=1.2,e.stroke()},Ea=(e,n,o,t,l)=>{L(e,n,o,t,l),L(e,n,o+t*.2,t*.6,u("#fef3c7",.9));const a=t*.3;L(e,n-t*.32,o-t*.15,a,"#ffffff"),L(e,n+t*.32,o-t*.15,a,"#ffffff"),L(e,n-t*.32,o-t*.15,a*.55,"#2d3748"),L(e,n+t*.32,o-t*.15,a*.55,"#2d3748"),L(e,n-t*.26,o-t*.22,a*.2,"#ffffff"),L(e,n+t*.38,o-t*.22,a*.2,"#ffffff"),e.beginPath(),e.arc(n-t*.32,o-t*.15,a,0,Math.PI*2),e.strokeStyle=u("#2d3748",.3),e.lineWidth=1.5,e.stroke(),e.beginPath(),e.arc(n+t*.32,o-t*.15,a,0,Math.PI*2),e.stroke(),q(e,n,o+t*.05,n-t*.1,o+t*.2,n+t*.1,o+t*.2,"#f59e0b"),q(e,n-t*.55,o-t*.65,n-t*.35,o-t*1.1,n-t*.15,o-t*.65,l),q(e,n+t*.15,o-t*.65,n+t*.35,o-t*1.1,n+t*.55,o-t*.65,l)},Ia=(e,n,o,t,l)=>{L(e,n,o,t*.85,l),L(e,n-t*.6,o-t*.7,t*.5,l),L(e,n+t*.6,o-t*.7,t*.5,l),L(e,n-t*.6,o-t*.7,t*.32,u("#fca5a5",.7)),L(e,n+t*.6,o-t*.7,t*.32,u("#fca5a5",.7)),L(e,n-t*.25,o-t*.15,t*.12,"#2d3748"),L(e,n+t*.25,o-t*.15,t*.12,"#2d3748"),L(e,n-t*.21,o-t*.2,t*.04,"#ffffff"),L(e,n+t*.29,o-t*.2,t*.04,"#ffffff"),L(e,n,o+t*.15,t*.1,"#f472b6"),e.beginPath(),e.moveTo(n-t*.2,o+t*.15),e.lineTo(n-t*.75,o+t*.05),e.moveTo(n-t*.2,o+t*.22),e.lineTo(n-t*.75,o+t*.28),e.moveTo(n+t*.2,o+t*.15),e.lineTo(n+t*.75,o+t*.05),e.moveTo(n+t*.2,o+t*.22),e.lineTo(n+t*.75,o+t*.28),e.strokeStyle="#94a3b8",e.lineWidth=1,e.stroke(),e.beginPath(),e.moveTo(n+t*.5,o+t*.6),e.quadraticCurveTo(n+t*1.5,o+t*.2,n+t*1.3,o-t*.3),e.strokeStyle=l,e.lineWidth=2.5,e.lineCap="round",e.stroke()},Ra=(e,n,o,t,l)=>{L(e,n-t*.65,o-t*.65,t*.32,l),L(e,n+t*.65,o-t*.65,t*.32,l),L(e,n-t*.65,o-t*.65,t*.18,u("#d4a574",.8)),L(e,n+t*.65,o-t*.65,t*.18,u("#d4a574",.8)),L(e,n,o,t,l),Ae(e,n,o+t*.15,t*.4,t*.3,u("#d4a574",.7)),L(e,n-t*.3,o-t*.15,t*.11,"#2d3748"),L(e,n+t*.3,o-t*.15,t*.11,"#2d3748"),L(e,n-t*.27,o-t*.2,t*.04,"#ffffff"),L(e,n+t*.33,o-t*.2,t*.04,"#ffffff"),Ae(e,n,o+t*.05,t*.11,t*.08,"#2d3748"),e.beginPath(),e.moveTo(n,o+t*.13),e.lineTo(n-t*.08,o+t*.25),e.moveTo(n,o+t*.13),e.lineTo(n+t*.08,o+t*.25),e.strokeStyle="#2d3748",e.lineWidth=1.2,e.stroke()},ka=(e,n,o,t,l)=>{Ae(e,n,o,t*.9,t,l),Ae(e,n,o+t*.2,t*.55,t*.55,u("#fef3c7",.8)),e.beginPath(),e.ellipse(n-t*.55,o-t*.05,t*.5,t*.28,-.3,0,Math.PI*2),e.fillStyle=u(l,.7),e.fill(),L(e,n+t*.15,o-t*.25,t*.12,"#2d3748"),L(e,n+t*.19,o-t*.3,t*.04,"#ffffff"),q(e,n+t*.55,o-t*.15,n+t*.55,o+t*.05,n+t*.95,o-t*.05,"#f59e0b"),q(e,n-t*.7,o-t*.3,n-t*1.15,o-t*.65,n-t*.5,o-t*.6,l),q(e,n-t*.75,o-t*.15,n-t*1.25,o-t*.35,n-t*.6,o-t*.45,u(l,.8))},ee=[{name:"Chat",vowel:"a",label:"AAA",draw:Aa},{name:"Hibou",vowel:"o",label:"OOO",draw:Ea},{name:"Souris",vowel:"i",label:"III",draw:Ia},{name:"Ours",vowel:"u",label:"UUU",draw:Ra},{name:"Oiseau",vowel:"e",label:"EEE",draw:ka}],Fa=(e,n,o)=>{const t=[];for(let l=0;l<An;l++){const a=Math.PI*2*l/An+(Math.random()-.5)*.5;t.push({x:e,y:n-rt,vx:Math.cos(a)*En*(.7+Math.random()*.6),vy:Math.sin(a)*En*(.7+Math.random()*.6)-1.5,alpha:1,size:Ca*(.7+Math.random()*.6),kind:Math.random()>.5?"heart":"star",color:o})}return t},Oa=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,vy:e.vy+.04,alpha:e.alpha-Ta}),_a=e=>e.alpha>0,La=(e,n,o,t,l,a)=>{e.save(),e.globalAlpha=a,e.fillStyle=l,e.beginPath();const s=t*.5;e.moveTo(n,o+s*.3),e.bezierCurveTo(n,o-s*.2,n-s,o-s*.5,n-s,o+s*.1),e.bezierCurveTo(n-s,o+s*.6,n,o+s*.9,n,o+s*1.1),e.bezierCurveTo(n,o+s*.9,n+s,o+s*.6,n+s,o+s*.1),e.bezierCurveTo(n+s,o-s*.5,n,o-s*.2,n,o+s*.3),e.fill(),e.restore()},Ba=(e,n,o,t,l,a)=>{e.save(),e.globalAlpha=a,e.fillStyle=l,e.beginPath();const s=5,i=t*.5,r=i*.4;for(let d=0;d<s*2;d++){const c=d%2===0?i:r,h=Math.PI*d/s-Math.PI/2,f=n+Math.cos(h)*c,g=o+Math.sin(h)*c;d===0?e.moveTo(f,g):e.lineTo(f,g)}e.closePath(),e.fill(),e.restore()},Da=(e,n)=>{n.kind==="heart"?La(e,n.x,n.y,n.size,n.color,n.alpha):Ba(e,n.x,n.y,n.size,n.color,n.alpha)},Wa=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:T.bg})},Na=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:T.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u(T.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Ha=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:T.text,margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},In=(e,n,o)=>{const t=e/(o+1),l=n*.42,a=[];for(let s=0;s<o;s++)a.push({x:t*(s+1),y:l});return a},$a=()=>{let e=null,n=null,o=0,t=0,l=null,a=null,s=ee.map(()=>({scale:1,targetScale:1,glowAlpha:0,feedCount:0,particles:[]})),i=0,r=null;const d=()=>{s=ee.map(()=>({scale:1,targetScale:1,glowAlpha:0,feedCount:0,particles:[]})),i=0,r=null},c=()=>{const p=o/(ee.length*2.5),b=t*.15;return Math.max(25,Math.min(rt,p,b))},h=()=>{if(!n)return;x(n,o,t),n.fillStyle=T.bg,n.fillRect(0,0,o,t);const p=In(o,t,ee.length),b=c();for(let w=0;w<ee.length;w++){const y=ee[w],S=s[w],P=p[w],M=X[y.vowel]??T.primary;if(n.save(),S.glowAlpha>0){const k=b*1.6*S.scale,I=n.createRadialGradient(P.x,P.y,b*.3,P.x,P.y,k);I.addColorStop(0,u(M,S.glowAlpha*.5)),I.addColorStop(1,u(M,0)),n.fillStyle=I,n.fillRect(P.x-k,P.y-k,k*2,k*2)}n.translate(P.x,P.y),n.scale(S.scale,S.scale),n.translate(-P.x,-P.y),y.draw(n,P.x,P.y,b,M),n.restore();for(const k of S.particles)Da(n,k);const m=P.y+b*1.6;n.font=`bold ${Math.round(b*.55)}px system-ui, -apple-system, sans-serif`,n.textAlign="center",n.textBaseline="top",n.fillStyle=M,n.fillText(y.label,P.x,m);const E=P.y-b*1.5;n.font=`600 ${Math.round(b*.38)}px system-ui, -apple-system, sans-serif`,n.fillStyle=T.text,n.fillText(y.name,P.x,E);const _=P.y+b*1.6+b*.65;n.font=`600 ${Math.round(b*.32)}px system-ui, -apple-system, sans-serif`,n.fillStyle=T.muted,n.fillText(`${S.feedCount}`,P.x,_)}},f=()=>{s=s.map(p=>{const b=p.scale+(p.targetScale-p.scale)*wa*3,w=Math.max(0,p.glowAlpha-va),y=p.particles.map(Oa).filter(_a),S=Math.abs(p.scale-1)<.01&&p.targetScale>1||p.targetScale>1&&b>p.targetScale*.95?1:p.targetScale;return{...p,scale:b,targetScale:S,glowAlpha:w,particles:y}}),h(),l=requestAnimationFrame(f)},g=()=>{if(!e||!n)return;const p=V(e,n);o=p.width,t=p.height},v=p=>{const b=ee[p],w=In(o,t,ee.length)[p],y=X[b.vowel]??T.primary;s=s.map((S,P)=>P!==p?S:{...S,targetScale:ya,glowAlpha:Pa,feedCount:S.feedCount+1,particles:[...S.particles,...Fa(w.x,w.y,y)]})};return{id:"animals",name:"Nourrir les Animaux",description:"Nourris les animaux en prononçant la bonne voyelle !",mount:p=>{const b=C("div",{});Wa(b);const w=C("button",{},"← Accueil");Na(w),w.addEventListener("click",()=>{window.location.hash="#menu"});const y=C("p",{},"Nourrir les Animaux");Ha(y),b.appendChild(w),b.appendChild(y),p.appendChild(b);const S=Z(b);e=S.canvas,n=S.ctx,o=S.width,t=S.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),a=g,window.addEventListener("resize",a),d(),f()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),a&&(window.removeEventListener("resize",a),a=null),e=null,n=null,o=0,t=0,d()},update:p=>{if(!p.isVoicing||p.vowel===null){i=0,r=null;return}if(i+=1,i>=Ma&&p.vowel!==r){const b=ee.findIndex(w=>w.vowel===p.vowel);b!==-1&&(v(b),r=p.vowel)}}}},le=["a","e","i","o","u"],Ee=5,Ga=.04,Rn=.18,dt=.88,Ye=.15,ft=.04,ja=.06,Ua=.03,Ya=2,Xa=Math.round(Ya*60),ct=.35,ht=3,kn=["#ef4444","#f59e0b","#22c55e","#3b82f6","#ec4899","#f97316"],Fn=["#f472b6","#c084fc","#67e8f9","#fbbf24","#a78bfa"],On=["#fbbf24","#fde047","#f59e0b","#fcd34d","#facc15"],_n=["#93c5fd","#a5b4fc","#c4b5fd","#67e8f9","#7dd3fc"],$=(e,n)=>e+Math.random()*(n-e),_e=()=>le.map(e=>({vowel:e,color:X[e]??T.primary,openAmount:0,isOpening:!1,surpriseTime:0,surpriseFrame:0})),Ie=(e,n,o)=>{const t=n*Ga,l=t*(Ee+1),a=(n-l)/Ee,s=t+e*(a+t),i=o*Rn,r=o*(dt-Rn);return{x:s,y:i,w:a,h:r}},Va=(e,n)=>{const o=[];for(let l=0;l<18;l++){const a=Math.PI*2*l/18+$(-.2,.2),s=$(1.5,4);o.push({x:e,y:n,vx:Math.cos(a)*s,vy:Math.sin(a)*s,color:kn[Math.floor(Math.random()*kn.length)],alpha:1,size:$(3,7),life:1})}return o},qa=(e,n,o)=>{const t=[];for(let a=0;a<8;a++)t.push({x:e+$(-20,20),y:n+$(0,o*.5),vx:$(-.8,.8),vy:$(-2,-.8),color:Fn[Math.floor(Math.random()*Fn.length)],alpha:1,size:$(6,12),life:1});return t},Ka=(e,n,o)=>{const t=[];for(let a=0;a<15;a++)t.push({x:e+$(-o*.4,o*.4),y:n-$(10,40),vx:$(-.5,.5),vy:$(1,3),color:On[Math.floor(Math.random()*On.length)],alpha:1,size:$(4,8),life:1});return t},Za=(e,n,o)=>{const t=[];for(let a=0;a<10;a++)t.push({x:e+$(-15,15),y:n+$(0,o*.5),vx:$(-.3,.3),vy:$(-2.5,-1),color:_n[Math.floor(Math.random()*_n.length)],alpha:.85,size:$(5,14),life:1});return t},Ja=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,alpha:Math.max(0,e.alpha-.008),life:Math.max(0,e.life-.008)}),Qa=e=>e.life>0&&e.alpha>0,ut=(e,n,o,t,l,a,s,i)=>{e.beginPath(),e.moveTo(n,o+l),e.lineTo(n,o+a),e.arcTo(n,o,n+t/2,o,a),e.arcTo(n+t,o,n+t,o+a,a),e.lineTo(n+t,o+l),e.closePath(),e.fillStyle=s,e.fill(),e.strokeStyle=i,e.lineWidth=ht,e.stroke()},pt=(e,n,o,t,l,a)=>{const s=n+t*.75,i=o+l*.52;e.beginPath(),e.arc(s,i,a,0,Math.PI*2),e.fillStyle="#d4af37",e.fill(),e.strokeStyle="#b8960c",e.lineWidth=1.5,e.stroke(),e.beginPath(),e.arc(s-a*.25,i-a*.25,a*.35,0,Math.PI*2),e.fillStyle=u("#ffffff",.5),e.fill()},gt=(e,n,o,t,l,a,s)=>{e.font=`bold ${s}px sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillStyle=u("#ffffff",.9),e.fillText(n.toUpperCase(),o+l/2,t+a*.45)},za=(e,n,o,t,l)=>{const{x:a,y:s,w:i,h:r}=Ie(o,t,l),d=r*Ye,c=i*ft;ut(e,a,s,i,r,d,n.color,u(n.color,.7)),pt(e,a,s,i,r,c),gt(e,n.vowel,a,s,i,r,i*ct)},xa=(e,n,o,t,l,a,s)=>{e.beginPath(),e.moveTo(n,o+l),e.lineTo(n,o+a),e.arcTo(n,o,n+t/2,o,a),e.arcTo(n+t,o,n+t,o+a,a),e.lineTo(n+t,o+l),e.closePath(),e.fillStyle=u(s,.12),e.fill(),e.strokeStyle=u(s,.4),e.lineWidth=ht,e.stroke()},es=(e,n,o,t,l)=>{const{x:a,y:s,w:i,h:r}=Ie(o,t,l),d=r*Ye,c=n.openAmount;xa(e,a,s,i,r,d,n.color);const h=i*(1-c*.8),f=a+(i-h),g=h*ft,v=u("#000000",c*.15);e.save(),ut(e,f,s,h,r,d*(1-c*.3),n.color,u(n.color,.7)),e.beginPath(),e.moveTo(f,s+r),e.lineTo(f,s+d),e.arcTo(f,s,f+h/2,s,d*(1-c*.3)),e.arcTo(f+h,s,f+h,s+d,d*(1-c*.3)),e.lineTo(f+h,s+r),e.closePath(),e.fillStyle=v,e.fill(),c<.6&&(pt(e,f,s,h,r,g),gt(e,n.vowel,f,s,h,r,h*ct)),e.restore()},ns=(e,n)=>{e.beginPath(),e.arc(n.x,n.y,n.size,0,Math.PI*2),e.fillStyle=u(n.color,n.alpha),e.fill()},ts=(e,n,o)=>{const t=Math.sin(o*.15+n.x)*4;e.save(),e.translate(n.x,n.y),e.fillStyle=u(n.color,n.alpha),e.beginPath(),e.ellipse(-n.size*.4,0,n.size*.5,n.size*.3+t*.3,-.3,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(n.size*.4,0,n.size*.5,n.size*.3+t*.3,.3,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(0,0,n.size*.12,n.size*.4,0,0,Math.PI*2),e.fillStyle=u("#4a3728",n.alpha),e.fill(),e.restore()},os=(e,n,o)=>{const t=o*.03+n.x*.01,l=5,a=n.size,s=n.size*.45;e.save(),e.translate(n.x,n.y),e.rotate(t),e.beginPath();for(let i=0;i<l*2;i++){const r=Math.PI*i/l-Math.PI/2,d=i%2===0?a:s;i===0?e.moveTo(Math.cos(r)*d,Math.sin(r)*d):e.lineTo(Math.cos(r)*d,Math.sin(r)*d)}e.closePath(),e.fillStyle=u(n.color,n.alpha),e.fill(),e.restore()},ls=(e,n,o,t,l,a)=>{const s=["#ef4444","#f97316","#fbbf24","#22c55e","#3b82f6","#8b5cf6","#a855f7"],i=n+t/2,r=o+l*.8,d=t*.45,c=d/(s.length+2),h=Math.PI*Math.min(a,1);e.save(),e.beginPath(),e.rect(n,o,t,l),e.clip();for(let f=0;f<s.length;f++){const g=d-f*c;e.beginPath(),e.arc(i,r,g,Math.PI,Math.PI+h,!1),e.strokeStyle=u(s[f],.8),e.lineWidth=c*.9,e.lineCap="round",e.stroke()}e.restore()},as=(e,n)=>{e.beginPath(),e.arc(n.x,n.y,n.size,0,Math.PI*2),e.fillStyle=u(n.color,n.alpha*.4),e.fill(),e.strokeStyle=u(n.color,n.alpha*.7),e.lineWidth=1.5,e.stroke(),e.beginPath(),e.arc(n.x-n.size*.25,n.y-n.size*.25,n.size*.25,0,Math.PI*2),e.fillStyle=u("#ffffff",n.alpha*.6),e.fill()},ss=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:T.bg})},is=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:T.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u(T.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},rs=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u(T.primary,.5),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},ds=()=>{let e=null,n=null,o=0,t=0,l=null,a=null,s=[..._e()],i=le.map(()=>[]),r=le.map(()=>!1);const d=p=>{const b=s[p];b.isOpening||(s[p]={...b,isOpening:!0,surpriseTime:Xa,surpriseFrame:0},r[p]=!1)},c=()=>{s=s.map((p,b)=>{if(p.isOpening){const w=Math.min(1,p.openAmount+ja),y=p.surpriseTime-1,S=p.surpriseFrame+1;if(w>.4&&!r[b]){const P=Ie(b,o,t),M=P.x+P.w/2,m=P.y+P.h/2;switch(p.vowel){case"a":i[b]=Va(M,m);break;case"e":i[b]=qa(M,m,P.h);break;case"i":i[b]=Ka(M,P.y,P.w);break;case"o":i[b]=[];break;case"u":i[b]=Za(M,m,P.h);break}r[b]=!0}return y<=0?{...p,openAmount:w,isOpening:!1,surpriseTime:0,surpriseFrame:S}:{...p,openAmount:w,surpriseTime:y,surpriseFrame:S}}if(p.openAmount>0){const w=Math.max(0,p.openAmount-Ua);return w===0&&(i[b]=[],r[b]=!1),{...p,openAmount:w,surpriseFrame:p.surpriseFrame+1}}return p}),i=i.map(p=>p.map(Ja).filter(Qa))},h=()=>{if(n)for(let p=0;p<Ee;p++){const b=s[p];if(b.openAmount<.3)continue;const w=Ie(p,o,t);n.save();const y=w.h*Ye;switch(n.beginPath(),n.moveTo(w.x,w.y+w.h),n.lineTo(w.x,w.y+y),n.arcTo(w.x,w.y,w.x+w.w/2,w.y,y),n.arcTo(w.x+w.w,w.y,w.x+w.w,w.y+y,y),n.lineTo(w.x+w.w,w.y+w.h),n.closePath(),n.clip(),b.vowel){case"a":for(const S of i[p])ns(n,S);break;case"e":for(const S of i[p])ts(n,S,b.surpriseFrame);break;case"i":for(const S of i[p])os(n,S,b.surpriseFrame);break;case"o":{const S=Math.min(1,b.surpriseFrame/40);ls(n,w.x,w.y,w.w,w.h,S);break}case"u":for(const S of i[p])as(n,S);break}n.restore()}},f=()=>{if(!n)return;const p=t*dt;n.fillStyle=u(T.muted,.15),n.fillRect(0,p,o,t-p),n.strokeStyle=u(T.muted,.25),n.lineWidth=1,n.beginPath(),n.moveTo(0,p),n.lineTo(o,p),n.stroke()},g=()=>{if(n){x(n,o,t),f(),c(),h();for(let p=0;p<Ee;p++){const b=s[p];b.openAmount>0?es(n,b,p,o,t):za(n,b,p,o,t)}l=requestAnimationFrame(g)}},v=()=>{if(!e||!n)return;const p=V(e,n);o=p.width,t=p.height};return{id:"doors",name:"Portes Magiques",description:"Ouvre les portes magiques avec ta voix !",mount:p=>{const b=C("div",{});ss(b);const w=C("button",{},"← Accueil");is(w),w.addEventListener("click",()=>{window.location.hash="#menu"});const y=C("p",{},"Portes Magiques");rs(y),b.appendChild(w),b.appendChild(y),p.appendChild(b);const S=Z(b);e=S.canvas,n=S.ctx,o=S.width,t=S.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),a=v,window.addEventListener("resize",a),s=[..._e()],i=le.map(()=>[]),r=le.map(()=>!1),g()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),a&&(window.removeEventListener("resize",a),a=null),e=null,n=null,o=0,t=0,s=[..._e()],i=le.map(()=>[]),r=le.map(()=>!1)},update:p=>{if(!p.isVoicing||p.vowel===null)return;const b=p.vowel,w=le.indexOf(b);w!==-1&&(p.volume<.05||d(w))}}},me=.15,fs=4,Ge=.55,Ln=18,Bn=10,ue=8,cs=14,hs=20,us=.5,Dn=8,ps=60,J=40,Wn=12,Nn=20,Xe=3,Ve=.002,Hn=.3,mt=60,$n=8,Le="#f472b6",pe=(e,n)=>e+Math.random()*(n-e),je=(e,n)=>Math.min(e/2,1)*n,Gn=(e,n,o)=>({x:e,stemHeight:0,maxDuration:n,color:o,petalCount:n>=4?8:5,hasLeaves:n>=1,hasBud:n>=2,isOpen:n>=3,isFullBloom:n>=4,hasSparkles:n>=5}),jn=(e,n)=>({x:e+pe(-30,30),y:n+pe(-30,10),size:pe(2,5),alpha:1,vx:pe(-.5,.5),vy:pe(-1.5,-.3),life:mt}),Un=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,alpha:e.life/mt,life:e.life-1}),Yn=e=>e.life>0,gs=(e,n,o)=>{const t=e.createLinearGradient(0,0,0,o);t.addColorStop(0,"#87CEEB"),t.addColorStop(.6,"#B0E0F0"),t.addColorStop(.85,"#d4f0d4"),e.fillStyle=t,e.fillRect(0,0,n,o)},ms=(e,n,o)=>{const t=o*(1-me),l=e.createLinearGradient(0,t,0,o);l.addColorStop(0,"#5cb85c"),l.addColorStop(1,"#3a8a3a"),e.fillStyle=l,e.fillRect(0,t,n,o*me),e.beginPath(),e.moveTo(0,t);for(let a=0;a<=n;a+=20){const s=t+Math.sin(a*.05)*4;e.lineTo(a,s)}e.lineTo(n,t+10),e.lineTo(0,t+10),e.closePath(),e.fillStyle="#5cb85c",e.fill()},bs=(e,n,o)=>{const t=n-70,l=70,a=1+Math.sin(o*.001)*.05,s=e.createRadialGradient(t,l,0,t,l,J*2);s.addColorStop(0,u("#FFD700",.3)),s.addColorStop(1,u("#FFD700",0)),e.fillStyle=s,e.fillRect(t-J*2,l-J*2,J*4,J*4),e.save(),e.translate(t,l),e.rotate(o*3e-4);for(let i=0;i<Wn;i++){const r=i/Wn*Math.PI*2;e.beginPath(),e.moveTo(Math.cos(r)*J*a,Math.sin(r)*J*a),e.lineTo(Math.cos(r)*(J+Nn)*a,Math.sin(r)*(J+Nn)*a),e.strokeStyle=u("#FFD700",.6),e.lineWidth=3,e.stroke()}e.restore(),e.beginPath(),e.arc(t,l,J*a,0,Math.PI*2),e.fillStyle="#FFD700",e.fill(),e.fillStyle="#E6A800",e.beginPath(),e.arc(t-12,l-8,4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(t+12,l-8,4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(t,l+2,14,.15*Math.PI,.85*Math.PI),e.strokeStyle="#E6A800",e.lineWidth=2.5,e.stroke()},Ss=(e,n,o,t,l,a)=>{const s=o-t,i=Math.sin(l*Ve+a)*Xe,r=n+i,d=o-t*.5;e.beginPath(),e.moveTo(n,o),e.quadraticCurveTo(r,d,n+i,s),e.strokeStyle="#2d8a4e",e.lineWidth=fs,e.lineCap="round",e.stroke()},ys=(e,n,o,t,l,a)=>{const s=Math.sin(l*Ve+a)*Xe,i=o-t*.4,r=n+s*.4-2;e.save(),e.translate(r,i),e.rotate(-.6),e.beginPath(),e.ellipse(0,0,Ln,Bn,0,0,Math.PI*2),e.fillStyle="#34d399",e.fill(),e.restore();const d=o-t*.65,c=n+s*.65+2;e.save(),e.translate(c,d),e.rotate(.6),e.beginPath(),e.ellipse(0,0,Ln,Bn,0,0,Math.PI*2),e.fillStyle="#34d399",e.fill(),e.restore()},ws=(e,n,o,t)=>{e.save(),e.translate(n,o),e.beginPath(),e.ellipse(0,0,ue*.8,ue*1.2,0,0,Math.PI*2),e.fillStyle="#2d8a4e",e.fill(),e.beginPath(),e.ellipse(0,-ue*.3,ue*.5,ue*.5,0,0,Math.PI*2),e.fillStyle=u(t,.6),e.fill(),e.restore()},vs=(e,n,o,t,l,a,s)=>{const i=a?hs:cs,r=i*us,d=1+Math.sin(s*.003)*.03;e.save(),e.translate(n,o);for(let c=0;c<l;c++){const h=c/l*Math.PI*2;e.save(),e.rotate(h),e.beginPath(),e.ellipse(0,-i*.7*d,r*d,i*d,0,0,Math.PI*2),e.fillStyle=u(t,.85),e.fill(),e.beginPath(),e.ellipse(0,-i*.55*d,r*.5*d,i*.5*d,0,0,Math.PI*2),e.fillStyle=u("#ffffff",.25),e.fill(),e.restore()}e.beginPath(),e.arc(0,0,Dn*d,0,Math.PI*2),e.fillStyle="#FFD700",e.fill(),e.beginPath(),e.arc(-2,-2,Dn*.5*d,0,Math.PI*2),e.fillStyle=u("#ffffff",.4),e.fill(),e.restore()},Ps=(e,n)=>{e.save(),e.globalAlpha=n.alpha;const o=n.size;e.fillStyle="#FFD700",e.beginPath(),e.moveTo(n.x,n.y-o),e.lineTo(n.x+o*.3,n.y-o*.3),e.lineTo(n.x+o,n.y),e.lineTo(n.x+o*.3,n.y+o*.3),e.lineTo(n.x,n.y+o),e.lineTo(n.x-o*.3,n.y+o*.3),e.lineTo(n.x-o,n.y),e.lineTo(n.x-o*.3,n.y-o*.3),e.closePath(),e.fill(),e.restore()},Xn=(e,n,o,t,l)=>{const s=o*(1-me)+5,i=o*Ge,r=je(n.maxDuration,i),d=n.x*.1,c=Math.sin(t*Ve+d)*Xe,h=n.x+c,f=s-r;n.maxDuration>0&&Ss(e,n.x,s,r,t,d),n.hasLeaves&&ys(e,n.x,s,r,t,d),n.hasBud&&!n.isOpen&&ws(e,h,f,n.color),n.isOpen&&vs(e,h,f,n.color,n.petalCount,n.isFullBloom,t);for(const g of l)Ps(e,g)},Ts=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden"})},Cs=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:T.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u(T.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Ms=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u(T.text,.7),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:u(T.surface,.6),borderRadius:"12px",backdropFilter:"blur(4px)"})},As=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",fontSize:"1.1rem",fontWeight:"600",color:T.text,margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:u(T.surface,.8),borderRadius:"12px",backdropFilter:"blur(4px)"})},Es=(e,n)=>{if(e.length===0)return n/2;const o=n/2,t=e.length,l=t%2===0?1:-1,a=Math.ceil(t/2)*ps,s=o+l*a,i=40;return Math.max(i,Math.min(n-i,s))},Is=()=>{let e=null,n=null,o=0,t=0,l=null,a=null,s=[],i=0,r=0,d=Le,c=!1,h=!1,f=new Map,g=null,v=0;const A=()=>{if(!g)return;const y=s.length;g.textContent=y===0?"Jardin: 0 fleur":y===1?"Jardin: 1 fleur":`Jardin: ${y} fleurs`},F=()=>{if(!n)return;const y=performance.now()-v;x(n,o,t),gs(n,o,t),bs(n,o,y),ms(n,o,t);for(let S=0;S<s.length;S++){const P=s[S],M=f.get(S)??[];if(P.hasSparkles&&M.length<$n&&Math.random()<Hn){const E=t*(1-me),_=t*Ge,k=je(P.maxDuration,_),I=E+5-k;M.push(jn(P.x,I))}const m=M.map(Un).filter(Yn);f.set(S,m),Xn(n,P,t,y,m)}if(h&&r>0){const S=Gn(i,r,d),P=f.get(-1)??[];if(S.hasSparkles&&P.length<$n&&Math.random()<Hn){const m=t*(1-me),E=t*Ge,_=je(S.maxDuration,E),k=m+5-_;P.push(jn(i,k))}const M=P.map(Un).filter(Yn);f.set(-1,M),Xn(n,S,t,y,M)}l=requestAnimationFrame(F)},O=()=>{if(!e||!n)return;const y=V(e,n);o=y.width,t=y.height};return{id:"flower",name:"Faire Pousser",description:"Fais pousser des fleurs avec ta voix !",mount:y=>{const S=C("div",{});Ts(S);const P=C("button",{},"← Accueil");Cs(P),P.addEventListener("click",()=>{window.location.hash="#menu"});const M=C("p",{},"Faire Pousser");Ms(M),g=C("p",{},"Jardin: 0 fleur"),As(g),S.appendChild(P),S.appendChild(M),S.appendChild(g),y.appendChild(S);const m=Z(S);e=m.canvas,n=m.ctx,o=m.width,t=m.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),a=O,window.addEventListener("resize",a),s=[],f=new Map,r=0,d=Le,c=!1,h=!1,i=o/2,v=performance.now(),A(),F()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),a&&(window.removeEventListener("resize",a),a=null),e=null,n=null,g=null,s=[],f=new Map,r=0,c=!1,h=!1,o=0,t=0},update:y=>{const S=y.isVoicing;if(S)c||(h=!0,i=Es(s,o),r=0,d=Le,f.delete(-1)),r=y.duration,y.vowel!==null&&X[y.vowel]&&(d=X[y.vowel]);else if(c&&h&&r>.1){const P=Gn(i,r,d);s.push(P);const M=f.get(-1)??[];f.set(s.length-1,M),f.delete(-1),h=!1,r=0,A()}else S||(h=!1,r=0,f.delete(-1));c=S}}},Be=20,Rs=130,ks=.72,Fs=100,Os=8,_s=.003,Vn=2,qn=3,ne=3,ge=4,Ls=40,bt=80,Bs=.12,Kn=["#ef4444","#f59e0b","#22c55e","#3b82f6","#8b5cf6","#ec4899","#f97316","#06b6d4","#FFD700","#ff6b6b"],Ds=5,Ws=60,Ns=2e3,Hs=-1.2,Zn=.3,$s="#87CEEB",Gs="#B0E0F0",js="#d4f0d4",Us="#ffffff",z=(e,n)=>e+Math.random()*(n-e),de=(e,n,o)=>Math.max(n,Math.min(o,e)),De=e=>{if(e<=0)return Be;const n=de(e/ge,0,1);return Be+n*(Rs-Be)},Ys=(e,n)=>{if(e<ne)return n;const o=de((e-ne)/(ge-ne),0,1),t=parseInt(n.slice(1,3),16),l=parseInt(n.slice(3,5),16),a=parseInt(n.slice(5,7),16),s=Math.round(t+(240-t)*o),i=Math.round(l+(80-l)*o),r=Math.round(a+(80-a)*o);return`rgb(${s}, ${i}, ${r})`},Xs=(e,n)=>({x:e,y:n,vx:z(-6,6),vy:z(-10,-2),size:z(4,10),color:Kn[Math.floor(Math.random()*Kn.length)],life:bt,gravity:Bs,rotation:z(0,Math.PI*2),rotationSpeed:z(-.15,.15),shape:["circle","rect","star"][Math.floor(Math.random()*3)]}),Vs=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,vy:e.vy+e.gravity,vx:e.vx*.99,life:e.life-1,rotation:e.rotation+e.rotationSpeed}),qs=e=>e.life>0,Ks=(e,n,o)=>{const t=z(0,Math.PI*2),l=z(o*.6,o*1.2);return{x:e+Math.cos(t)*l,y:n+Math.sin(t)*l,size:z(3,7),alpha:1,angle:t,speed:z(.3,.8)}},Zs=e=>({...e,x:e.x+Math.cos(e.angle)*e.speed,y:e.y+Math.sin(e.angle)*e.speed,alpha:e.alpha-1/Ws}),Js=e=>e.alpha>0,Qs=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,alpha:e.alpha-.004,stringAngle:e.stringAngle+.02}),zs=e=>e.alpha>0&&e.y+e.radiusY>-50,xs=(e,n,o)=>{const t=e.createLinearGradient(0,0,0,o);t.addColorStop(0,$s),t.addColorStop(.6,Gs),t.addColorStop(1,js),e.fillStyle=t,e.fillRect(0,0,n,o)},We=(e,n,o,t)=>{e.save(),e.translate(n,o),e.scale(t,t),e.fillStyle=u(Us,.6);const l=[{cx:0,cy:0,r:25},{cx:-22,cy:5,r:20},{cx:22,cy:5,r:20},{cx:-10,cy:-12,r:18},{cx:12,cy:-10,r:16}];for(const a of l)e.beginPath(),e.arc(a.cx,a.cy,a.r,0,Math.PI*2),e.fill();e.restore()},ei=(e,n,o)=>{const t=o*.01;We(e,(n*.15+t)%(n+100)-50,60,1),We(e,(n*.55+t*.7)%(n+100)-50,90,.8),We(e,(n*.85+t*.5)%(n+100)-50,45,1.2)},ni=(e,n,o)=>{const t=o*.88,l=e.createLinearGradient(0,t,0,o);l.addColorStop(0,"#5cb85c"),l.addColorStop(1,"#3a8a3a"),e.fillStyle=l,e.fillRect(0,t,n,o-t),e.beginPath(),e.moveTo(0,t);for(let a=0;a<=n;a+=20){const s=t+Math.sin(a*.05)*4;e.lineTo(a,s)}e.lineTo(n,t+10),e.lineTo(0,t+10),e.closePath(),e.fillStyle="#5cb85c",e.fill()},St=(e,n,o,t,l,a,s)=>{const i=(n+t)/2+Math.sin(a*_s)*Os+s,r=(o+l)/2;e.beginPath(),e.moveTo(n,o),e.quadraticCurveTo(i,r,t,l),e.strokeStyle=u(T.text,.5),e.lineWidth=2,e.lineCap="round",e.stroke()},yt=(e,n,o,t,l,a,s)=>{e.save(),e.translate(n,o),e.rotate(s*.05),e.beginPath(),e.ellipse(0,0,t,l,0,0,Math.PI*2);const i=e.createRadialGradient(-t*.3,-l*.3,t*.1,0,0,l);i.addColorStop(0,u("#ffffff",.6)),i.addColorStop(.3,a),i.addColorStop(1,u(a,.85)),e.fillStyle=i,e.fill(),e.beginPath(),e.ellipse(-t*.3,-l*.35,t*.2,l*.15,-.4,0,Math.PI*2),e.fillStyle=u("#ffffff",.4),e.fill(),e.beginPath(),e.moveTo(-4,l),e.lineTo(0,l+8),e.lineTo(4,l),e.closePath(),e.fillStyle=a,e.fill(),e.restore()},ti=(e,n,o,t,l)=>{const a=1+Math.sin(l*.008)*.15,s=t*1.5*a,i=e.createRadialGradient(n,o,t*.8,n,o,s);i.addColorStop(0,u(T.green,.25)),i.addColorStop(1,u(T.green,0)),e.fillStyle=i,e.beginPath(),e.arc(n,o,s,0,Math.PI*2),e.fill()},oi=(e,n,o,t,l)=>{e.save(),e.globalAlpha=l,e.fillStyle="#FFD700",e.beginPath(),e.moveTo(n,o-t),e.lineTo(n+t*.3,o-t*.3),e.lineTo(n+t,o),e.lineTo(n+t*.3,o+t*.3),e.lineTo(n,o+t),e.lineTo(n-t*.3,o+t*.3),e.lineTo(n-t,o),e.lineTo(n-t*.3,o-t*.3),e.closePath(),e.fill(),e.restore()},li=(e,n)=>{const o=de(n.life/bt,0,1);if(e.save(),e.translate(n.x,n.y),e.rotate(n.rotation),e.globalAlpha=o,n.shape==="circle")e.beginPath(),e.arc(0,0,n.size/2,0,Math.PI*2),e.fillStyle=n.color,e.fill();else if(n.shape==="rect")e.fillStyle=n.color,e.fillRect(-n.size/2,-n.size/4,n.size,n.size/2);else{e.fillStyle=n.color,e.beginPath();for(let t=0;t<5;t++){const l=t*2*Math.PI/5-Math.PI/2,a=l+Math.PI/5,s=n.size/2,i=n.size/4;t===0?e.moveTo(Math.cos(l)*s,Math.sin(l)*s):e.lineTo(Math.cos(l)*s,Math.sin(l)*s),e.lineTo(Math.cos(a)*i,Math.sin(a)*i)}e.closePath(),e.fill()}e.restore()},ai=(e,n,o)=>{e.save(),e.globalAlpha=n.alpha,yt(e,n.x,n.y,n.radiusX,n.radiusY,n.color,0);const t=n.x+Math.sin(n.stringAngle)*15,l=n.y+n.radiusY+8+Fs*.6;St(e,n.x,n.y+n.radiusY+8,t,l,o,Math.sin(n.stringAngle)*5),e.restore()},si=(e,n,o,t)=>{const l=1+t*.02,a=de(1-t/40,0,1);a<=0||(e.save(),e.translate(n,o-20-t*1.5),e.scale(l,l),e.globalAlpha=a,e.font="bold 28px inherit",e.textAlign="center",e.textBaseline="middle",e.fillStyle="#FFD700",e.strokeStyle=u("#ffffff",.8),e.lineWidth=3,e.strokeText("POP!",0,0),e.fillText("POP!",0,0),e.restore())},ii=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden"})},ri=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:T.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u(T.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},di=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u(T.text,.7),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:u(T.surface,.6),borderRadius:"12px",backdropFilter:"blur(4px)"})},fi=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",fontSize:"1.1rem",fontWeight:"600",color:T.text,margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:u(T.surface,.8),borderRadius:"12px",backdropFilter:"blur(4px)"})},ci=()=>{let e=null,n=null,o=0,t=0,l=null,a=null,s="idle",i=0,r=T.secondary,d=!1,c=0,h=null,f=[],g=[],v=[],A=0,F=0,O=0,p=!1,b=null,w=0;const y=()=>o/2,S=()=>t*ks,P=()=>t*.88,M=()=>{h&&(h.textContent=c===0?"Ballons: 0":`Ballons: ${c}`)},m=()=>{b!==null&&clearTimeout(b),b=setTimeout(()=>{s="idle",i=0,p=!1,b=null},Ns)},E=(B,W)=>{s="popped",F=B,O=W,A=0,p=!0;for(let G=0;G<Ls;G++)f.push(Xs(B,W));m()},_=(B,W,G,N)=>{s="floating",c+=1,M(),v.push({x:B,y:W,radiusX:G,radiusY:N,color:r,alpha:1,vx:z(-Zn,Zn),vy:Hs,stringAngle:0}),m()},k=()=>{if(!n)return;w+=1,x(n,o,t),xs(n,o,t),ei(n,o,w),ni(n,o,t);const B=y(),W=S(),G=P();v=v.map(Qs).filter(zs);for(const N of v)ai(n,N,w);if(s==="inflating"||s==="idle"){const N=De(i),Y=N*.85,fe=N,ve=W-fe;let se=0;if(i>=ne){const oe=de((i-ne)/(ge-ne),0,1);se=Math.sin(w*.3)*oe*12}const Ct=Ys(i,r);i>=Vn&&i<qn&&ti(n,B+se*.5,ve,N,w);const Mt=W+8;St(n,B+se*.3,Mt,B,G,w,se*.2),yt(n,B+se*.5,ve,Y,fe,Ct,se),i>=Vn&&i<qn&&g.length<Ds&&Math.random()<.15&&g.push(Ks(B,ve,N)),g=g.map(Zs).filter(Js);for(const oe of g)oi(n,oe.x,oe.y,oe.size,oe.alpha);if(i>=ne){const oe=de((i-ne)/(ge-ne),0,1);n.save(),n.globalAlpha=oe*.4,n.strokeStyle=u("#ffffff",.6),n.lineWidth=1.5;for(let Re=0;Re<3;Re++){const Ke=-.5+Re*.5,Ze=B+se*.5+Math.cos(Ke)*Y*.7,Je=ve+Math.sin(Ke)*fe*.5;n.beginPath(),n.moveTo(Ze-5,Je-3),n.lineTo(Ze+5,Je+3),n.stroke()}n.restore()}}f=f.map(Vs).filter(qs);for(const N of f)li(n,N);p&&(A+=1,si(n,F,O,A),A>50&&(p=!1)),l=requestAnimationFrame(k)},I=()=>{if(!e||!n)return;const B=V(e,n);o=B.width,t=B.height};return{id:"balloon",name:"Ballon",description:"Gonfle le ballon sans le faire éclater",mount:B=>{const W=C("div",{});ii(W);const G=C("button",{},"← Accueil");ri(G),G.addEventListener("click",()=>{window.location.hash="#menu"});const N=C("p",{},"Ballon");di(N),h=C("p",{},"Ballons: 0"),fi(h),W.appendChild(G),W.appendChild(N),W.appendChild(h),B.appendChild(W);const Y=Z(W);e=Y.canvas,n=Y.ctx,o=Y.width,t=Y.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),a=I,window.addEventListener("resize",a),s="idle",i=0,r=T.secondary,d=!1,c=0,f=[],g=[],v=[],p=!1,A=0,w=0,M(),k()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),a&&(window.removeEventListener("resize",a),a=null),b!==null&&(clearTimeout(b),b=null),e=null,n=null,h=null,f=[],g=[],v=[],s="idle",i=0,d=!1,c=0,p=!1,w=0,o=0,t=0},update:B=>{const W=B.isVoicing;if(W){if(d||s==="idle"&&(s="inflating",i=0,g=[],r=T.secondary),s==="inflating"&&(i=B.duration,B.vowel!==null&&X[B.vowel]&&(r=X[B.vowel]),i>=ge)){const G=De(i),N=S()-G;E(y(),N)}}else if(d&&s==="inflating"&&i>.1){const G=De(i),N=G*.85,Y=G,fe=S()-Y;_(y(),fe,N,Y)}else!W&&s==="inflating"&&(s="idle",i=0,g=[]);d=W}}},ye=.1,hi=8,ui=15,pi=500,gi=5,mi=30,bi=-1.5,Si=.004,yi=.02,wi=20,vi="#1a6b8a",wt="#0a2a3a",Pi="#c2a66b",Ti="#a08850",Ci="#2d8a4e",Mi="#1d6a3e",Ai={a:"fish",e:"seahorse",i:"jellyfish",o:"starfish",u:"octopus",ɛ:"fish",y:"jellyfish"},Ei={a:1.8,e:.5,i:.3,o:0,u:.6,ɛ:1.2,y:.4},H=(e,n)=>e+Math.random()*(n-e),Ii=(e,n,o)=>{const t=e.createLinearGradient(0,0,0,o);t.addColorStop(0,vi),t.addColorStop(1,wt),e.fillStyle=t,e.fillRect(0,0,n,o)},Ri=(e,n,o,t)=>{e.save(),e.globalAlpha=.06;const l=80;for(let a=0;a<n+l;a+=l)for(let s=0;s<o*.6;s+=l){const i=Math.sin(t*.001+s*.01)*15,r=Math.cos(t*.0012+a*.01)*10,d=20+Math.sin(t*.002+a*.02+s*.015)*10;e.beginPath(),e.arc(a+i,s+r,d,0,Math.PI*2),e.fillStyle="#7dd3fc",e.fill()}e.restore()},ki=(e,n,o)=>{const t=o*(1-ye),l=e.createLinearGradient(0,t,0,o);l.addColorStop(0,Pi),l.addColorStop(1,Ti),e.beginPath(),e.moveTo(0,o);for(let a=0;a<=n;a+=10){const s=t+Math.sin(a*.03)*3+Math.sin(a*.07)*2;e.lineTo(a,s)}e.lineTo(n,o),e.closePath(),e.fillStyle=l,e.fill()},Jn=(e,n)=>{const o=[],t=n*(1-ye);for(let l=0;l<wi;l++){const a=Math.floor(H(100,170));o.push({x:H(10,e-10),y:H(t+5,n-5),rx:H(3,7),ry:H(2,4),color:`rgb(${a}, ${a-10}, ${a-20})`})}return o},Fi=(e,n)=>{for(const o of n)e.beginPath(),e.ellipse(o.x,o.y,o.rx,o.ry,0,0,Math.PI*2),e.fillStyle=o.color,e.fill()},Qn=(e,n)=>{const o=[];for(let t=0;t<hi;t++)o.push({x:H(30,e-30),height:H(60,150),segments:Math.floor(H(6,12)),phaseOffset:H(0,Math.PI*2)});return o},Oi=(e,n,o,t)=>{const l=o*(1-ye);for(const a of n){const s=a.height/a.segments;e.beginPath(),e.moveTo(a.x,l);for(let i=1;i<=a.segments;i++){const r=i/a.segments,d=Math.sin(t*.002+a.phaseOffset+i*.5)*(8*r),c=a.x+d,h=l-i*s;e.lineTo(c,h)}e.lineWidth=4,e.strokeStyle=Ci,e.lineCap="round",e.lineJoin="round",e.stroke();for(let i=2;i<a.segments;i+=2){const r=i/a.segments,d=Math.sin(t*.002+a.phaseOffset+i*.5)*(8*r),c=a.x+d,h=l-i*s,f=i%4===0?1:-1;e.beginPath(),e.ellipse(c+f*8,h,10,4,f*.4,0,Math.PI*2),e.fillStyle=Mi,e.fill()}}},_i=(e,n,o)=>({x:H(e*.15,e*.85),y:n*(1-ye)-5,radius:gi+o*mi,alpha:.6,vy:bi-o*1.5,wobbleOffset:H(0,Math.PI*2),wobbleSpeed:H(.03,.06)}),Li=(e,n)=>({...e,y:e.y+e.vy,x:e.x+Math.sin(n*e.wobbleSpeed+e.wobbleOffset)*.5,alpha:e.alpha-Si}),Bi=e=>e.alpha>0&&e.y>-e.radius,Di=(e,n)=>{e.save(),e.globalAlpha=n.alpha,e.beginPath(),e.arc(n.x,n.y,n.radius,0,Math.PI*2),e.fillStyle=u("#a5d8ff",.4),e.fill(),e.strokeStyle=u("#74c0fc",.6),e.lineWidth=1,e.stroke(),e.beginPath(),e.arc(n.x-n.radius*.3,n.y-n.radius*.3,n.radius*.25,0,Math.PI*2),e.fillStyle=u("#ffffff",.7),e.fill(),e.restore()},Wi=(e,n,o,t,l,a,s)=>{const i=a?1:-1;e.save(),e.beginPath(),e.ellipse(n,o,t*1.2,t*.7,0,0,Math.PI*2),e.fillStyle=l,e.fill(),e.beginPath();const r=n-i*t*1.2,d=Math.sin(s*.008+n)*3;e.moveTo(r,o),e.lineTo(r-i*t*.7,o-t*.5+d),e.lineTo(r-i*t*.7,o+t*.5+d),e.closePath(),e.fillStyle=l,e.fill();const c=n+i*t*.5,h=o-t*.15;e.beginPath(),e.arc(c,h,t*.18,0,Math.PI*2),e.fillStyle="#ffffff",e.fill(),e.beginPath(),e.arc(c+i*t*.05,h,t*.1,0,Math.PI*2),e.fillStyle="#1a1a2e",e.fill(),e.beginPath(),e.moveTo(n-i*t*.2,o-t*.7),e.lineTo(n+i*t*.3,o-t*.7),e.lineTo(n+i*t*.1,o-t*.35),e.closePath(),e.fillStyle=u(l,.7),e.fill(),e.restore()},Ni=(e,n,o,t,l,a)=>{e.save(),e.beginPath(),e.arc(n,o-t*.8,t*.4,0,Math.PI*2),e.fillStyle=l,e.fill(),e.beginPath(),e.ellipse(n+t*.5,o-t*.8,t*.25,t*.12,0,0,Math.PI*2),e.fillStyle=l,e.fill();const s=Math.sin(a*.003+n*.1)*3;for(let d=0;d<6;d++){const c=d/5,h=n+s*c,f=o-t*.5+d*t*.3,g=t*(.35-c*.08);e.beginPath(),e.arc(h,f,g,0,Math.PI*2),e.fillStyle=u(l,1-c*.2),e.fill()}e.beginPath();const i=n+s*.8,r=o+t*1;e.arc(i+t*.2,r,t*.2,0,Math.PI*1.5),e.strokeStyle=l,e.lineWidth=3,e.lineCap="round",e.stroke(),e.beginPath(),e.arc(n+t*.15,o-t*.9,t*.08,0,Math.PI*2),e.fillStyle="#1a1a2e",e.fill();for(let d=0;d<3;d++)e.beginPath(),e.arc(n-t*.1+d*t*.15,o-t*1.2,t*.06,0,Math.PI*2),e.fillStyle=u(l,.7),e.fill();e.restore()},Hi=(e,n,o,t,l,a)=>{e.save();const s=1+Math.sin(a*.005+n)*.1;e.beginPath(),e.ellipse(n,o,t*.8*s,t*.5*s,0,Math.PI,0),e.fillStyle=u(l,.6),e.fill(),e.beginPath(),e.ellipse(n,o+t*.05,t*.5*s,t*.3*s,0,Math.PI,0),e.fillStyle=u(l,.3),e.fill();const i=6;for(let r=0;r<i;r++){const d=n-t*.6+r/(i-1)*t*1.2;e.beginPath(),e.moveTo(d,o);const c=t*(.8+Math.sin(r*1.5)*.3);for(let h=1;h<=4;h++){const f=h/4,g=d+Math.sin(a*.004+r*.8+h*.7)*(t*.15),v=o+f*c;e.lineTo(g,v)}e.strokeStyle=u(l,.5),e.lineWidth=2,e.lineCap="round",e.stroke()}for(let r=0;r<3;r++){const d=n-t*.3+r*t*.3,c=o-t*.15;e.beginPath(),e.arc(d,c,t*.05,0,Math.PI*2),e.fillStyle=u("#ffffff",.5),e.fill()}e.restore()},$i=(e,n,o,t,l)=>{e.save();const a=5,s=t*.9,i=s*.4;e.beginPath();for(let r=0;r<a*2;r++){const d=r%2===0?s:i,c=Math.PI*r/a-Math.PI/2,h=n+Math.cos(c)*d,f=o+Math.sin(c)*d;r===0?e.moveTo(h,f):e.lineTo(h,f)}e.closePath(),e.fillStyle=l,e.fill(),e.beginPath(),e.arc(n,o,t*.15,0,Math.PI*2),e.fillStyle=u("#ffffff",.4),e.fill();for(let r=0;r<a;r++){const d=Math.PI*2*r/a-Math.PI/2,c=s*.55,h=n+Math.cos(d)*c,f=o+Math.sin(d)*c;e.beginPath(),e.arc(h,f,t*.06,0,Math.PI*2),e.fillStyle=u("#ffffff",.35),e.fill()}e.restore()},Gi=(e,n,o,t,l,a)=>{e.save(),e.beginPath(),e.arc(n,o-t*.3,t*.6,0,Math.PI*2),e.fillStyle=l,e.fill(),e.beginPath(),e.arc(n-t*.2,o-t*.4,t*.12,0,Math.PI*2),e.fillStyle="#ffffff",e.fill(),e.beginPath(),e.arc(n+t*.2,o-t*.4,t*.12,0,Math.PI*2),e.fillStyle="#ffffff",e.fill(),e.beginPath(),e.arc(n-t*.18,o-t*.38,t*.06,0,Math.PI*2),e.fillStyle="#1a1a2e",e.fill(),e.beginPath(),e.arc(n+t*.22,o-t*.38,t*.06,0,Math.PI*2),e.fillStyle="#1a1a2e",e.fill();const s=4;for(let i=0;i<s;i++){const r=n-t*.45+i/(s-1)*t*.9;e.beginPath(),e.moveTo(r,o+t*.1);for(let d=1;d<=5;d++){const c=d/5,h=r+Math.sin(a*.004+i*1.2+d*.8)*(t*.2),f=o+t*.1+c*t*.9;e.lineTo(h,f)}e.strokeStyle=l,e.lineWidth=3,e.lineCap="round",e.stroke()}e.beginPath(),e.arc(n,o-t*.15,t*.15,.1,Math.PI-.1),e.strokeStyle=u("#1a1a2e",.5),e.lineWidth=1.5,e.stroke(),e.restore()},ji=(e,n,o)=>{switch(e.save(),e.globalAlpha=n.alpha,n.kind){case"fish":Wi(e,n.x,n.y,n.size,n.color,n.vx>0,o);break;case"seahorse":Ni(e,n.x,n.y,n.size,n.color,o);break;case"jellyfish":Hi(e,n.x,n.y,n.size,n.color,o);break;case"starfish":$i(e,n.x,n.y,n.size,n.color);break;case"octopus":Gi(e,n.x,n.y,n.size,n.color,o);break}e.restore()},Ui=(e,n,o)=>{const t=Ai[e]??"fish",l=X[e]??"#6366f1",a=Ei[e]??1,s=o*(1-ye),i=H(14,22),r=Math.random()>.5?1:-1,d=r>0?-i*2:n+i*2;let c;switch(t){case"starfish":c=s-i*.5;break;case"jellyfish":c=H(o*.15,o*.5);break;case"seahorse":c=H(o*.3,o*.6);break;case"octopus":c=H(o*.5,s-i*1.5);break;default:c=H(o*.15,s-i*2)}return{x:t==="starfish"?H(i*2,n-i*2):d,y:c,vx:t==="starfish"?0:a*r,color:l,kind:t,age:0,alpha:t==="starfish"?0:1,size:i,phaseOffset:H(0,Math.PI*2)}},Yi=(e,n,o)=>{const t=e.age+1,l=e.kind!=="starfish"?Math.sin(n*.003+e.phaseOffset)*.3:0;let a=e.x+e.vx,s=e.vx;e.kind!=="starfish"&&(a<-e.size*3?(a=-e.size*3,s=Math.abs(e.vx)):a>o+e.size*3&&(a=o+e.size*3,s=-Math.abs(e.vx)));let i=e.alpha;return e.kind==="starfish"&&e.alpha<1&&(i=Math.min(1,e.alpha+.02)),{...e,x:a,y:e.y+l,vx:s,age:t,alpha:i}},Xi=(e,n)=>e.kind==="starfish"?!0:e.x>-e.size*4&&e.x<n+e.size*4,Vi=(e,n)=>e.length<=n?e:e.map((o,t)=>t<e.length-n?{...o,alpha:o.alpha-yi}:o).filter(o=>o.alpha>0),qi=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:wt})},Ki=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:"#7dd3fc",cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u("#0a2a3a",.7),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Zi=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u("#7dd3fc",.7),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},Ji=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",fontSize:"1.1rem",fontWeight:"600",color:"#7dd3fc",margin:"0",padding:"8px 12px",fontFamily:"inherit",borderRadius:"8px",backgroundColor:u("#0a2a3a",.7),backdropFilter:"blur(4px)",pointerEvents:"none"})},Qi=()=>{let e=null,n=null,o=0,t=0,l=null,a=null,s=[],i=[],r=[],d=[],c=null,h=0,f=0,g=0;const v=4,A=()=>{if(!e||!n)return;const y=V(e,n);o=y.width,t=y.height,r=Qn(o),d=Jn(o,t)},F=()=>{if(n){x(n,o,t),Ii(n,o,t),Ri(n,o,t,g),ki(n,o,t),Fi(n,d),Oi(n,r,t,g);for(const y of i)ji(n,y,g);for(const y of s)Di(n,y)}},O=()=>{g=performance.now(),s=s.map(y=>Li(y,g)).filter(Bi),i=i.map(y=>Yi(y,g,o)).filter(y=>Xi(y,o)),i=Vi(i,ui),c&&(c.textContent=`${i.length}`),F(),l=requestAnimationFrame(O)};return{id:"aquarium",name:"Aquarium",description:"Crée ton monde sous-marin avec ta voix",mount:y=>{const S=C("div",{});qi(S);const P=C("button",{},"← Accueil");Ki(P),P.addEventListener("click",()=>{window.location.hash="#menu"});const M=C("p",{},"Aquarium");Zi(M),c=C("p",{},"0"),Ji(c),S.appendChild(P),S.appendChild(M),S.appendChild(c),y.appendChild(S);const m=Z(S);e=m.canvas,n=m.ctx,o=m.width,t=m.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),r=Qn(o),d=Jn(o,t),a=A,window.addEventListener("resize",a),s=[],i=[],h=0,f=0,g=0,O()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),a&&(window.removeEventListener("resize",a),a=null),e=null,n=null,c=null,o=0,t=0,s=[],i=[],r=[],d=[],h=0,f=0,g=0},update:y=>{const S=performance.now();y.isVoicing?(f+=1,f>=v&&(f=0,s.push(_i(o,t,y.volume)))):f=0,y.isVoicing&&y.vowel!==null&&S-h>=pi&&(i.push(Ui(y.vowel,o,t)),h=S)}}},K=.3,zi=.035,qe=.3,be=.18,xi=120,er=.3,zn=.03,Q=40,xn=12,Ne={summer:{skyTop:"#1E90FF",skyBottom:"#87CEEB",groundTop:"#4CAF50",groundBottom:"#2E7D32",treeCrown:"#2E8B57",treeHighlight:"#3CB371",label:"Été"},autumn:{skyTop:"#E8843C",skyBottom:"#F4A460",groundTop:"#8B6914",groundBottom:"#6B4E0A",treeCrown:"#D2691E",treeHighlight:"#E25822",label:"Automne"},winter:{skyTop:"#B0B8C8",skyBottom:"#D9DEE8",groundTop:"#E8E8F0",groundBottom:"#CFCFDF",treeCrown:"#8B7355",treeHighlight:"#A08060",label:"Hiver"},spring:{skyTop:"#89CFF0",skyBottom:"#B0E2FF",groundTop:"#5DBB63",groundBottom:"#3E9142",treeCrown:"#FFB7C5",treeHighlight:"#FFC0CB",label:"Printemps"}},nr={a:"summer",o:"autumn",i:"winter",u:"spring"},He=(e,n,o)=>e+(n-e)*o,Ue=(e,n,o)=>Math.min(o,Math.max(n,e)),R=(e,n)=>e+Math.random()*(n-e),et=e=>({r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16)}),tr=(e,n,o)=>{const t=l=>Ue(Math.round(l),0,255).toString(16).padStart(2,"0");return`#${t(e)}${t(n)}${t(o)}`},re=(e,n,o)=>{const t=et(e),l=et(n);return tr(He(t.r,l.r,o),He(t.g,l.g,o),He(t.b,l.b,o))},or=(e,n,o)=>({skyTop:re(e.skyTop,n.skyTop,o),skyBottom:re(e.skyBottom,n.skyBottom,o),groundTop:re(e.groundTop,n.groundTop,o),groundBottom:re(e.groundBottom,n.groundBottom,o),treeCrown:re(e.treeCrown,n.treeCrown,o),treeHighlight:re(e.treeHighlight,n.treeHighlight,o)}),lr=e=>({skyTop:e.skyTop,skyBottom:e.skyBottom,groundTop:e.groundTop,groundBottom:e.groundBottom,treeCrown:e.treeCrown,treeHighlight:e.treeHighlight}),Ce={skyTop:"#7CA8D0",skyBottom:"#A8C8E8",groundTop:"#6B8E6B",groundBottom:"#4A6B4A",treeCrown:"#5A8A5A",treeHighlight:"#6B9B6B"},ar=(e,n,o)=>{const l=n*(1-K)-n*qe-n*be,a=["#D2691E","#CD853F","#B22222","#DAA520","#CC5500"];return{x:e*.5+R(-e*.15,e*.15),y:l+R(0,n*be),vx:R(-1.5,1.5)*(1+o),vy:R(.3,1.5),size:R(5,10),rotation:R(0,Math.PI*2),rotationSpeed:R(-.05,.05),alpha:1,color:a[Math.floor(Math.random()*a.length)],life:0,maxLife:R(120,250)}},sr=(e,n,o)=>{const t=.3+o*.7;return{x:R(-20,e+20),y:R(-30,-5),vx:R(-.8,.8)*t,vy:R(.5,2.5)*t,size:R(2,6),rotation:0,rotationSpeed:0,alpha:R(.6,1),color:"#FFFFFF",life:0,maxLife:R(200,400)}},ir=(e,n,o)=>{const l=n*(1-K)-n*qe-n*be,a=["#FFB7C5","#FF69B4","#FFC0CB","#FFD1DC","#FADADD"];return{x:e*.5+R(-e*.15,e*.15),y:l+R(0,n*be*.7),vx:R(-1,2)*(.5+o*.5),vy:R(-.5,1.2),size:R(4,8),rotation:R(0,Math.PI*2),rotationSpeed:R(-.04,.04),alpha:1,color:a[Math.floor(Math.random()*a.length)],life:0,maxLife:R(150,300)}},rr=(e,n,o)=>{const t=R(n*.1,n*.6);return{x:R(0,e),y:t,vx:R(-.2,.2),vy:R(-1,-.3)*(.5+o),size:R(2,5),rotation:0,rotationSpeed:0,alpha:R(.15,.4)*o,color:"#FFD700",life:0,maxLife:R(60,120)}},dr=(e,n,o)=>{const t=n*(1-K),l=["#FF6B9D","#C084FC","#60A5FA","#FBBF24","#FB923C"];return{x:R(e*.1,e*.9),y:t-R(20,120),vx:R(-1,1),vy:R(-1,.5),size:R(6,10),rotation:0,rotationSpeed:.1,alpha:1,color:l[Math.floor(Math.random()*l.length)],life:0,maxLife:R(200,400)}},fr=(e,n)=>{const o=n*(1-K),t=["#FF6B9D","#FBBF24","#A78BFA","#F87171","#34D399"];return{x:R(e*.05,e*.95),y:o+R(5,n*K*.5),vx:0,vy:0,size:R(4,8),rotation:R(0,Math.PI*2),rotationSpeed:0,alpha:1,color:t[Math.floor(Math.random()*t.length)],life:0,maxLife:9999}},cr=(e,n)=>{const o=e.life+1,t=o/e.maxLife,l=.7,a=n==="spring"&&e.vy<=.5&&e.size>=6,s=a?e.vx+Math.sin(o*.1)*.15:e.vx+R(-.05,.05),i=a?e.vy+Math.cos(o*.08)*.1:e.vy;return{...e,x:e.x+s,y:e.y+i,vx:s*.99,vy:i,rotation:e.rotation+e.rotationSpeed,alpha:t>l?e.alpha*(1-(t-l)/(1-l)):e.alpha,life:o}},hr=e=>e.life<e.maxLife&&e.alpha>.01,ur=(e,n,o,t)=>{const l=e.createLinearGradient(0,0,0,o*(1-K));l.addColorStop(0,t.skyTop),l.addColorStop(1,t.skyBottom),e.fillStyle=l,e.fillRect(0,0,n,o*(1-K)+2)},pr=(e,n,o,t,l)=>{const a=o*(1-K),s=e.createLinearGradient(0,a,0,o);s.addColorStop(0,t.groundTop),s.addColorStop(1,t.groundBottom),e.fillStyle=s,e.fillRect(0,a,n,o*K),e.beginPath(),e.moveTo(0,a);for(let i=0;i<=n;i+=15){const r=Math.sin(i*.03+l*5e-4)*3;e.lineTo(i,a+r)}e.lineTo(n,a+8),e.lineTo(0,a+8),e.closePath(),e.fillStyle=t.groundTop,e.fill()},gr=(e,n,o,t,l)=>{const a=n-80,s=70,i=1+Math.sin(o*.001)*.04,r=t==="winter"?.3:t==="autumn"?.7:1,d=t==="autumn"?"#FF8C42":"#FFD700",c=t==="summer"?.5+l*.5:.3;e.save(),e.globalAlpha=r;const h=e.createRadialGradient(a,s,0,a,s,Q*2.5);h.addColorStop(0,u(d,.3)),h.addColorStop(1,u(d,0)),e.fillStyle=h,e.fillRect(a-Q*3,s-Q*3,Q*6,Q*6),e.save(),e.translate(a,s),e.rotate(o*3e-4);const f=15+l*15;for(let g=0;g<xn;g++){const v=g/xn*Math.PI*2;e.beginPath(),e.moveTo(Math.cos(v)*Q*i,Math.sin(v)*Q*i),e.lineTo(Math.cos(v)*(Q+f)*i,Math.sin(v)*(Q+f)*i),e.strokeStyle=u(d,c),e.lineWidth=3,e.stroke()}e.restore(),e.beginPath(),e.arc(a,s,Q*i,0,Math.PI*2),e.fillStyle=d,e.fill(),e.restore()},mr=(e,n,o,t,l,a,s)=>{const i=o*(1-K),r=n*.5,d=n*zi,c=o*qe,h=i-c,f=o*be,g=Math.sin(a*.0015)*(2+s*4);e.save(),e.beginPath(),e.moveTo(r-d/2,i),e.lineTo(r-d/3+g*.3,h+f*.3),e.lineTo(r+d/3+g*.3,h+f*.3),e.lineTo(r+d/2,i),e.closePath();const v=e.createLinearGradient(r-d/2,i,r+d/2,i);if(v.addColorStop(0,"#5D4037"),v.addColorStop(.5,"#795548"),v.addColorStop(1,"#5D4037"),e.fillStyle=v,e.fill(),l==="winter"){const A="#6D4C41";e.strokeStyle=A,e.lineWidth=3,e.lineCap="round",e.beginPath(),e.moveTo(r+g*.4,h+f*.5),e.quadraticCurveTo(r-f*.4+g*.5,h+f*.1,r-f*.7+g*.6,h-f*.2),e.stroke(),e.beginPath(),e.moveTo(r+g*.4,h+f*.4),e.quadraticCurveTo(r+f*.3+g*.5,h+f*.05,r+f*.65+g*.6,h-f*.15),e.stroke(),e.beginPath(),e.moveTo(r+g*.5,h+f*.2),e.quadraticCurveTo(r+f*.1+g*.6,h-f*.3,r-f*.1+g*.7,h-f*.6),e.stroke(),e.lineWidth=2,e.beginPath(),e.moveTo(r-f*.5+g*.55,h-f*.05),e.lineTo(r-f*.65+g*.6,h-f*.35),e.stroke(),e.beginPath(),e.moveTo(r+f*.45+g*.55,h),e.lineTo(r+f*.55+g*.6,h-f*.3),e.stroke()}if(l!=="winter"){const A=h-f*.2,F=r+g*.5;e.beginPath(),e.ellipse(F+3,A+5,f*1.05,f*.85,0,0,Math.PI*2),e.fillStyle=u("#000000",.08),e.fill();const O=(p,b,w,y,S)=>{e.beginPath(),e.ellipse(p,b,w,y,0,0,Math.PI*2),e.fillStyle=S,e.fill()};O(F,A,f,f*.8,t.treeCrown),O(F-f*.5,A+f*.1,f*.6,f*.55,t.treeCrown),O(F+f*.5,A+f*.15,f*.55,f*.5,t.treeCrown),O(F+f*.1,A-f*.4,f*.55,f*.5,t.treeHighlight),O(F-f*.2,A-f*.15,f*.45,f*.4,u(t.treeHighlight,.5))}e.restore()},nt=(e,n,o)=>{if(e.save(),e.globalAlpha=Ue(n.alpha,0,1),e.translate(n.x,n.y),e.rotate(n.rotation),o==="autumn")e.beginPath(),e.ellipse(0,0,n.size,n.size*.5,0,0,Math.PI*2),e.fillStyle=n.color,e.fill(),e.beginPath(),e.moveTo(-n.size*.7,0),e.lineTo(n.size*.7,0),e.strokeStyle=u("#000000",.2),e.lineWidth=.5,e.stroke();else if(o==="winter"){const t=e.createRadialGradient(0,0,0,0,0,n.size);t.addColorStop(0,u("#FFFFFF",.9)),t.addColorStop(1,u("#FFFFFF",0)),e.fillStyle=t,e.fillRect(-n.size,-n.size,n.size*2,n.size*2),e.beginPath(),e.arc(0,0,n.size*.5,0,Math.PI*2),e.fillStyle="#FFFFFF",e.fill()}else if(o==="spring"&&n.size>=6&&n.maxLife>=200){const t=Math.sin(n.life*.15)*.4;e.fillStyle=n.color,e.save(),e.scale(1,1+t),e.beginPath(),e.ellipse(-n.size*.4,0,n.size*.5,n.size*.8,-.2,0,Math.PI*2),e.fill(),e.restore(),e.save(),e.scale(1,1-t),e.beginPath(),e.ellipse(n.size*.4,0,n.size*.5,n.size*.8,.2,0,Math.PI*2),e.fill(),e.restore(),e.beginPath(),e.ellipse(0,0,n.size*.12,n.size*.5,0,0,Math.PI*2),e.fillStyle="#333333",e.fill()}else if(o==="spring"&&n.vx===0&&n.vy===0){e.fillStyle=n.color;for(let l=0;l<5;l++){const a=l/5*Math.PI*2;e.beginPath(),e.ellipse(Math.cos(a)*n.size*.4,Math.sin(a)*n.size*.4,n.size*.35,n.size*.2,a,0,Math.PI*2),e.fill()}e.beginPath(),e.arc(0,0,n.size*.2,0,Math.PI*2),e.fillStyle="#FBBF24",e.fill()}else o==="spring"?(e.beginPath(),e.ellipse(0,0,n.size,n.size*.5,0,0,Math.PI*2),e.fillStyle=n.color,e.fill()):o==="summer"&&(e.beginPath(),e.arc(0,0,n.size,0,Math.PI*2),e.fillStyle=u(n.color,Ue(n.alpha,0,.4)),e.fill());e.restore()},br=(e,n,o,t)=>{e.save(),e.font="bold 20px system-ui, sans-serif",e.textAlign="right",e.textBaseline="bottom",e.fillStyle=u(T.text,.5),e.fillText(n,o-20,t-16),e.restore()},Sr=(e,n,o,t,l)=>{const a=o*(1-K),s=8+t*6;e.beginPath(),e.moveTo(0,a);for(let i=0;i<=n;i+=20){const r=Math.sin(i*.02+l*3e-4)*3;e.lineTo(i,a-s+r)}e.lineTo(n,a+2),e.lineTo(0,a+2),e.closePath(),e.fillStyle=u("#FFFFFF",.7),e.fill()},yr=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden"})},wr=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:T.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u(T.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},vr=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u(T.text,.7),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:u(T.surface,.6),borderRadius:"12px",backdropFilter:"blur(4px)"})},Pr=e=>{Object.assign(e.style,{position:"absolute",bottom:"16px",right:"16px",zIndex:"10",fontSize:"1.3rem",fontWeight:"700",color:u(T.text,.6),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:u(T.surface,.6),borderRadius:"12px",backdropFilter:"blur(4px)"})},Tr=()=>{let e=null,n=null,o=0,t=0,l=null,a=null,s=0,i=null,r=null,d={...Ce},c={...Ce},h=1,f=[],g=[],v=0,A=null;const F=(P,M,m)=>{const E=Math.min(m,xi-f.length);for(let _=0;_<E;_++)switch(P){case"summer":f.push(rr(o,t,M));break;case"autumn":f.push(ar(o,t,M));break;case"winter":f.push(sr(o,t,M));break;case"spring":f.push(ir(o,t,M)),M>.4&&Math.random()<.15&&f.push(dr(o,t));break}},O=P=>{P==="spring"&&g.length<12?Math.random()<.02&&g.push(fr(o,t)):P!=="spring"&&g.length>0&&(g=g.map(M=>({...M,alpha:M.alpha-.01})).filter(M=>M.alpha>.01))},p=()=>{if(!n)return;const P=performance.now()-s;x(n,o,t),h<1&&(h=Math.min(1,h+zn),d=or(d,c,zn));const M=i??"summer";ur(n,o,t,d),gr(n,o,P,M,v),pr(n,o,t,d,P),M==="winter"&&Sr(n,o,t,v,P);for(const m of g)nt(n,m,"spring");if(mr(n,o,t,d,M,P,v),i!==null){const m=er+v*2;if(Math.random()<m){const E=Math.ceil(1+v*3);F(i,v,E)}}f=f.map(m=>cr(m,M)).filter(hr);for(const m of f)nt(n,m,M);if(O(M),i!==null){const m=Ne[i];br(n,m.label,o,t)}l=requestAnimationFrame(p)},b=()=>{if(!e||!n)return;const P=V(e,n);o=P.width,t=P.height};return{id:"seasons",name:"Saisons",description:"Change les saisons avec ta voix",mount:P=>{const M=C("div",{});yr(M);const m=C("button",{},"← Accueil");wr(m),m.addEventListener("click",()=>{window.location.hash="#menu"});const E=C("p",{},"Saisons");vr(E),A=C("p",{},""),Pr(A),M.appendChild(m),M.appendChild(E),M.appendChild(A),P.appendChild(M);const _=Z(M);e=_.canvas,n=_.ctx,o=_.width,t=_.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),a=b,window.addEventListener("resize",a),i=null,r=null,d={...Ce},c={...Ce},h=1,f=[],g=[],v=0,s=performance.now(),p()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),a&&(window.removeEventListener("resize",a),a=null),e=null,n=null,A=null,o=0,t=0,f=[],g=[],i=null,r=null,h=1,v=0},update:P=>{v=P.volume,P.duration;const M=P.vowel,m=M!==null?nr[M]??null:null;m!==null&&m!==r&&(r=m,c=lr(Ne[m]),h=0,i=m,A&&(A.textContent=Ne[m].label))}}},Cr=Kt("#app"),vt=Xt(),Pt=Vt({volume:0,pitch:null,vowel:null,isVoicing:!1,duration:0}),Tt=[al(),vl(),ta(),Sa(),$a(),ds(),Is(),ci(),Qi(),Tr(),Bo(),bo()],Mr=lo(Tt.map(e=>({id:e.id,name:e.name,description:e.description}))),Ar=[Mr,...Tt],Er=qt(Cr,Ar);Pt.subscribe(e=>{const n=Er.getCurrentGame();n&&n.update(e)});vt.subscribe(e=>{Pt.set(e)});const we=document.createElement("div");we.style.cssText=`
  position: fixed; inset: 0; z-index: 1000;
  display: flex; align-items: center; justify-content: center; flex-direction: column;
  background: rgba(240, 244, 255, 0.95);
`;const ae=document.createElement("button");ae.textContent="🎤 Commencer";ae.style.cssText=`
  font-size: 2rem; padding: 24px 48px;
  border: none; border-radius: 16px;
  background: #6366f1; color: white;
  cursor: pointer; font-family: inherit;
  transition: transform 0.2s;
`;ae.addEventListener("mouseenter",()=>{ae.style.transform="scale(1.05)"});ae.addEventListener("mouseleave",()=>{ae.style.transform="scale(1)"});const Se=document.createElement("p");Se.textContent="Appuie pour activer le micro";Se.style.cssText="margin-top: 16px; color: #64748b; font-size: 1.2rem;";we.appendChild(ae);we.appendChild(Se);document.body.appendChild(we);ae.addEventListener("click",async()=>{try{await vt.start(),we.remove()}catch(e){Se.textContent="Erreur : impossible d'accéder au micro",Se.style.color="#ef4444",console.error("Failed to start audio pipeline:",e)}});</script>
    <style rel="stylesheet" crossorigin>*,*:before,*:after{box-sizing:border-box}*{margin:0;padding:0}html{-webkit-text-size-adjust:100%;-moz-text-size-adjust:100%;text-size-adjust:100%}body{line-height:1.5;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}img,picture,video,canvas,svg{display:block;max-width:100%}input,button,textarea,select{font:inherit;color:inherit}p,h1,h2,h3,h4,h5,h6{overflow-wrap:break-word}ol,ul{list-style:none}a{text-decoration:none;color:inherit}table{border-collapse:collapse;border-spacing:0}:root{--color-bg: #f0f4ff;--color-text: #2d3748;--color-primary: #6366f1;--color-secondary: #f472b6;--color-accent: #34d399;--color-surface: #ffffff;--font-family: "Segoe UI", system-ui, sans-serif;--radius: 12px;--transition-speed: .3s}body{width:100%;height:100vh;height:100dvh;font-family:var(--font-family);background-color:var(--color-bg);color:var(--color-text);overflow:hidden}#app{width:100%;height:100%;display:flex;flex-direction:column}.game-container{flex:1;position:relative;overflow:hidden}*,*:before,*:after{transition-timing-function:ease-in-out}@media(prefers-reduced-motion:reduce){*,*:before,*:after{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important;scroll-behavior:auto!important}}</style>
  </head>
  <body>
    <div id="app"></div>
  </body>
</html>
