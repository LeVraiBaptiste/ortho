<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ortho</title>
    <script type="module" crossorigin>(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))t(l);new MutationObserver(l=>{for(const s of l)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function o(l){const s={};return l.integrity&&(s.integrity=l.integrity),l.referrerPolicy&&(s.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?s.credentials="include":l.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(l){if(l.ep)return;l.ep=!0;const s=o(l);fetch(l.href,s)}})();const Ft=e=>{if(e.length===0)return 0;let n=0;for(let t=0;t<e.length;t++)n+=e[t]*e[t];const o=Math.sqrt(n/e.length);return Math.min(1,Math.max(0,o))},Ot=.15,on=80,ln=600,_t=(e,n)=>{const o=Math.min(Math.floor(e.length/2),n),t=new Float32Array(o);for(let l=0;l<o;l++){let s=0;for(let a=0;a<o;a++){const i=e[a]-e[a+l];s+=i*i}t[l]=s}return t},Lt=e=>{const n=new Float32Array(e.length);n[0]=1;let o=0;for(let t=1;t<e.length;t++)o+=e[t],n[t]=o===0?0:e[t]*t/o;return n},Bt=(e,n,o)=>{for(let t=n;t<e.length-1;t++)if(e[t]<o){for(;t+1<e.length&&e[t+1]<e[t];)t++;return t}return-1},Dt=(e,n)=>{if(n<=0||n>=e.length-1)return n;const o=e[n-1],t=e[n],l=e[n+1],s=.5*(o-l)/(o-2*t+l);return Number.isFinite(s)?n+s:n},Wt=(e,n)=>{if(e.length<2)return null;const o=Math.floor(n/on),t=Math.floor(n/ln);if(e.length<2*o)return null;const l=_t(e,o),s=Lt(l),a=Bt(s,t,Ot);if(a===-1)return null;const i=Dt(s,a);if(i<=0)return null;const r=n/i;return r<on||r>ln?null:r},an=[{vowel:"a",f1:750,f2:1450,f3:2600},{vowel:"e",f1:400,f2:2050,f3:2650},{vowel:"ɛ",f1:600,f2:1750,f3:2600},{vowel:"i",f1:250,f2:2250,f3:3e3},{vowel:"o",f1:350,f2:750,f3:2550},{vowel:"u",f1:300,f2:750,f3:2300},{vowel:"y",f1:250,f2:1750,f3:2150}],Nt=.01,Fe=.001,sn=12,fe=e=>13*Math.atan(76e-5*e)+3.5*Math.atan((e/7500)**2),Ht=e=>{const n=e.length,o=new Float32Array(n);for(let t=0;t<n;t++){const l=.54-.46*Math.cos(2*Math.PI*t/(n-1));o[t]=e[t]*l}return o},$t=(e,n=.97)=>{const o=new Float32Array(e.length);o[0]=e[0];for(let t=1;t<e.length;t++)o[t]=e[t]-n*e[t-1];return o},Gt=e=>{const n=zt(e.length),o=new Float32Array(n),t=new Float32Array(n);o.set(e.subarray(0,Math.min(e.length,n))),xt(o,t,n);for(let a=2;a<=n;a*=2){const i=a/2,r=-2*Math.PI/a;for(let f=0;f<n;f+=a)for(let c=0;c<i;c++){const h=r*c,d=Math.cos(h),u=Math.sin(h),y=f+c,C=f+c+i,k=d*o[C]-u*t[C],F=d*t[C]+u*o[C];o[C]=o[y]-k,t[C]=t[y]-F,o[y]=o[y]+k,t[y]=t[y]+F}}const l=n/2+1,s=new Float32Array(l);for(let a=0;a<l;a++)s[a]=Math.sqrt(o[a]*o[a]+t[a]*t[a]);return s},Oe=(e,n,o,t)=>{const l=(e.length-1)*2,s=n/l,a=Math.max(1,Math.ceil(o/s)),i=Math.min(e.length-1,Math.floor(t/s));let r=a,f=e[a];for(let c=a+1;c<=i;c++)e[c]>f&&(f=e[c],r=c);if(r>a&&r<i){const c=e[r-1],h=e[r],d=e[r+1],u=c-2*h+d;if(u!==0){const y=.5*(c-d)/u;return(r+y)*s}}return r*s},jt=(e,n,o)=>{const t=fe(e),l=fe(n),s=fe(o);let a=an[0].vowel,i=1/0;for(const r of an){const f=t-fe(r.f1),c=l-fe(r.f2),h=s-fe(r.f3),d=f*f+c*c+.5*h*h;d<i&&(i=d,a=r.vowel)}return a},Ut=(e,n)=>{const o=Math.floor(e.length/n),t=new Float32Array(o);for(let l=0;l<o;l++){let s=0;const a=l*n;for(let i=0;i<n;i++)s+=e[a+i];t[l]=s/n}return t},Yt=(e,n)=>{const o=e.length,t=new Float32Array(n+1);for(let l=0;l<=n;l++){let s=0;for(let a=0;a<o-l;a++)s+=e[a]*e[a+l];t[l]=s}return t},Vt=(e,n)=>{if(e[0]===0)return{coeffs:new Float32Array(n),gain:1};const o=new Float32Array(n);let t=e[0];for(let l=0;l<n;l++){let s=e[l+1];for(let r=0;r<l;r++)s-=o[r]*e[l-r];const a=s/t,i=new Float32Array(l);for(let r=0;r<l;r++)i[r]=o[r];o[l]=a;for(let r=0;r<l;r++)o[r]=i[r]-a*i[l-1-r];t*=1-a*a,t<=0&&(t=1e-10)}return{coeffs:o,gain:Math.sqrt(t)}},qt=(e,n,o,t,l,s)=>{const a=new Float32Array(o),i=t/2,r=e.length;for(let f=0;f<o;f++){const c=f*l/s;if(c>i){a[f]=0;continue}const h=2*Math.PI*c/t;let d=1,u=0;for(let C=0;C<r;C++){const k=(C+1)*h;d-=e[C]*Math.cos(k),u+=e[C]*Math.sin(k)}const y=d*d+u*u;a[f]=n/Math.sqrt(y)}return a},Xt=(e,n,o,t)=>{const l=(e.length-1)*2,s=n/l,a=Math.max(1,Math.ceil(o/s)),i=Math.min(e.length-2,Math.floor(t/s)),r=[];for(let f=a;f<=i;f++)if(e[f]>e[f-1]&&e[f]>e[f+1]){const c=e[f-1],h=e[f],d=e[f+1],u=c-2*h+d;let y=f*s;if(u!==0){const C=.5*(c-d)/u;y=(f+C)*s}r.push({freq:y,mag:h})}return r},Kt=(e,n,o)=>{let t=null;for(const l of e)l.freq>=n&&l.freq<=o&&(t===null||l.mag>t.mag)&&(t=l);return t},Zt=(e,n)=>{const o=new Float32Array(e.length);for(let u=0;u<e.length;u++)o[u]=e[u]*e[u];const l=[...Xt(o,n,100,4e3)].sort((u,y)=>u.freq-y.freq),s=Kt(l,200,1200),a=s?s.freq:Oe(e,n,200,1200),i=a+200,r=l.find(u=>u.freq>=i&&u.freq<=2800)??null,f=r?r.freq:Oe(e,n,i,2800),c=f+200,h=l.find(u=>u.freq>=c&&u.freq<=3800)??null,d=h?h.freq:Oe(e,n,c,3800);return{f1:a,f2:f,f3:d}},Jt=(e,n)=>{if(Qt(e)<Nt)return{vowel:null,formants:null};const o=$t(e),t=Ht(o),l=Gt(t),s=Math.max(1,Math.floor(n/11e3)),a=Ut(t,s),i=n/s,r=Yt(a,sn),{coeffs:f,gain:c}=Vt(r,sn),h=(l.length-1)*2,d=qt(f,c,l.length,i,n,h),{f1:u,f2:y,f3:C}=Zt(d,n),k=_e(d,n,u),F=_e(d,n,y),g=_e(d,n,C),w={magnitudes:l,lpcEnvelope:d,sampleRate:n,fftSize:h,f1:u,f2:y,f3:C};return k<Fe||F<Fe||g<Fe?{vowel:null,formants:w}:{vowel:jt(u,y,C),formants:w}},Qt=e=>{let n=0;for(let o=0;o<e.length;o++)n+=e[o]*e[o];return Math.sqrt(n/e.length)},zt=e=>{let n=1;for(;n<e;)n*=2;return n},xt=(e,n,o)=>{const t=Math.log2(o);for(let l=0;l<o;l++){const s=eo(l,t);if(s>l){const a=e[l];e[l]=e[s],e[s]=a;const i=n[l];n[l]=n[s],n[s]=i}}},eo=(e,n)=>{let o=0;for(let t=0;t<n;t++)o=o<<1|e&1,e>>=1;return o},_e=(e,n,o)=>{const t=(e.length-1)*2,l=Math.round(o*t/n),s=Math.max(0,Math.min(e.length-1,l));return e[s]},Le={isVoicing:!1,currentDuration:0},no=(e,n,o)=>e?{isVoicing:!0,currentDuration:o.currentDuration+n}:{isVoicing:!1,currentDuration:0},to=3,oo=5,Be={isVoicing:!1,framesAbove:0,framesBelow:0},lo=(e,n,o)=>e>o&&n!==null,ao=(e,n)=>{if(n.isVoicing){if(!e){const o=n.framesBelow+1;return o>=oo?{isVoicing:!1,framesAbove:0,framesBelow:0}:{isVoicing:!0,framesAbove:0,framesBelow:o}}return{isVoicing:!0,framesAbove:0,framesBelow:0}}if(e){const o=n.framesAbove+1;return o>=to?{isVoicing:!0,framesAbove:0,framesBelow:0}:{isVoicing:!1,framesAbove:o,framesBelow:0}}return{isVoicing:!1,framesAbove:0,framesBelow:0}},so=7,io=3,De={buffer:[]},ro=(e,n)=>{const o=n.buffer.length>=so?[...n.buffer.slice(1),e]:[...n.buffer,e],t=new Map;for(const a of o)a!==null&&t.set(a,(t.get(a)??0)+1);if(t.size===0)return{vowel:null,state:{buffer:o}};let l=t.keys().next().value,s=0;for(const[a,i]of t)i>s&&(s=i,l=a);return{vowel:s>=io?l:null,state:{buffer:o}}},fo=.01,co=2048,ho=()=>{let e=null,n=null,o=null,t=null,l=Le,s=Be,a=De,i=0;const r=new Set,f=y=>{for(const C of r)C(y)},c=y=>{if(n===null||e===null)return;const C=i===0?0:(y-i)/1e3;i=y;const k=new Float32Array(n.fftSize);n.getFloatTimeDomainData(k);const F={buffer:k,sampleRate:e.sampleRate},g=Ft(F.buffer),w=Wt(F.buffer,F.sampleRate),{vowel:v,formants:P}=Jt(F.buffer,F.sampleRate),m=lo(g,w,fo);s=ao(m,s);const b=s.isVoicing,T=ro(b?v:null,a);a=T.state;const S=b?T.vowel:null;l=no(b,C,l);const A={volume:g,pitch:w,vowel:S,isVoicing:b,duration:l.currentDuration,formants:P};f(A),t=requestAnimationFrame(c)};return{start:async()=>{const y=await navigator.mediaDevices.getUserMedia({audio:!0});o=y;const C=new AudioContext;e=C;const k=C.createAnalyser();k.fftSize=co,n=k,C.createMediaStreamSource(y).connect(k),i=0,l=Le,s=Be,a=De,t=requestAnimationFrame(c)},stop:()=>{if(t!==null&&(cancelAnimationFrame(t),t=null),o!==null){for(const y of o.getTracks())y.stop();o=null}e!==null&&(e.close(),e=null),n=null,l=Le,s=Be,a=De,i=0},subscribe:y=>(r.add(y),()=>{r.delete(y)})}},uo=e=>{let n=e;const o=new Set;return{get:()=>n,set:a=>{n=a,o.forEach(i=>i(n))},subscribe:a=>(o.add(a),()=>{o.delete(a)})}},rn=()=>window.location.hash.replace(/^#/,"")||"menu",po=(e,n)=>{let o=null;const t=i=>n.find(r=>r.id===i),l=i=>{for(o&&o.unmount();e.firstChild;)e.removeChild(e.firstChild);const r=t(i)??t("menu")??null;o=r,r&&r.mount(e),window.location.hash=`#${(r==null?void 0:r.id)??i}`},s=()=>o,a=()=>{l(rn())};return window.addEventListener("hashchange",a),l(rn()),{navigate:l,getCurrentGame:s}},E=(e,n,...o)=>{const t=document.createElement(e);if(n)for(const[l,s]of Object.entries(n))t.setAttribute(l,s);for(const l of o)typeof l=="string"?t.appendChild(document.createTextNode(l)):t.appendChild(l);return t},go=(e,n=document)=>{const o=n.querySelector(e);if(!o)throw new Error(`Element not found: ${e}`);return o},it=e=>{for(;e.firstChild;)e.removeChild(e.firstChild)},M={bg:"#f0f4ff",text:"#2d3748",primary:"#6366f1",secondary:"#f472b6",green:"#34d399",surface:"#ffffff",muted:"#94a3b8"},Y={a:"#ef4444",e:"#f59e0b",ɛ:"#f97316",i:"#22c55e",o:"#3b82f6",u:"#8b5cf6",y:"#ec4899"},p=(e,n)=>{const o=Math.max(0,Math.min(1,n)),t=parseInt(e.slice(1,3),16),l=parseInt(e.slice(3,5),16),s=parseInt(e.slice(5,7),16);return`rgba(${t}, ${l}, ${s}, ${o})`},dn=["#818cf8","#f472b6","#34d399","#fbbf24","#60a5fa"],mo=e=>dn[e%dn.length],bo=e=>{Object.assign(e.style,{display:"flex",flexDirection:"column",alignItems:"center",minHeight:"100%",padding:"32px 16px",backgroundColor:M.bg,fontFamily:"inherit",overflowY:"auto"})},So=e=>{Object.assign(e.style,{fontSize:"3rem",fontWeight:"800",color:M.primary,margin:"0 0 8px 0",letterSpacing:"-0.02em"})},yo=e=>{Object.assign(e.style,{fontSize:"1.5rem",fontWeight:"500",color:M.muted,margin:"0 0 40px 0"})},wo=e=>{Object.assign(e.style,{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"24px",width:"100%",maxWidth:"800px"})},vo=(e,n)=>{Object.assign(e.style,{backgroundColor:n,borderRadius:"16px",padding:"32px 24px",cursor:"pointer",border:"none",textAlign:"left",transition:"transform 0.15s ease, box-shadow 0.15s ease",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"}),e.addEventListener("mouseenter",()=>{e.style.transform="scale(1.04)",e.style.boxShadow="0 8px 24px rgba(0, 0, 0, 0.15)"}),e.addEventListener("mouseleave",()=>{e.style.transform="scale(1)",e.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.1)"})},To=e=>{Object.assign(e.style,{fontSize:"1.6rem",fontWeight:"700",color:"#ffffff",margin:"0 0 8px 0"})},Po=e=>{Object.assign(e.style,{fontSize:"1.1rem",fontWeight:"400",color:"rgba(255, 255, 255, 0.9)",margin:"0",lineHeight:"1.4"})},Co=(e,n)=>{const o=E("p",{},e.name);To(o);const t=E("p",{},e.description);Po(t);const l=E("button",{},o,t);return vo(l,mo(n)),l.addEventListener("click",()=>{window.location.hash="#"+e.id}),l},Mo=e=>({id:"menu",name:"Accueil",description:"Choisis un jeu !",mount:l=>{it(l);const s=E("div",{});bo(s);const a=E("h1",{},"Ortho");So(a);const i=E("p",{},"Choisis un jeu !");yo(i);const r=E("div",{});wo(r),e.forEach((f,c)=>{r.appendChild(Co(f,c))}),s.appendChild(a),s.appendChild(i),s.appendChild(r),l.appendChild(s)},unmount:()=>{},update:l=>{}}),ce=["background: "+M.surface,"border-radius: 16px","padding: 24px","box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08)","display: flex","flex-direction: column","gap: 12px"].join("; "),he=["font-size: 14px","font-weight: 600","color: "+M.muted,"text-transform: uppercase","letter-spacing: 1px"].join("; "),fn=["font-size: 32px","font-weight: 700","color: "+M.text].join("; "),Ao=["display: grid","grid-template-columns: 1fr 1fr","gap: 20px","padding: 24px","max-width: 720px","margin: 0 auto","font-family: system-ui, -apple-system, sans-serif"].join("; "),Eo=["display: flex","align-items: center","justify-content: center","position: relative","padding: 20px 24px 4px","max-width: 720px","margin: 0 auto"].join("; "),Io=["position: absolute","left: 24px","top: 20px","background: none","border: none","font-size: 16px","color: "+M.primary,"cursor: pointer","padding: 8px 12px","border-radius: 8px","font-weight: 600","transition: background 0.15s"].join("; "),Ro=["font-size: 24px","font-weight: 700","color: "+M.text,"margin: 0"].join("; "),ko=["width: 100%","height: 24px","background: "+M.bg,"border-radius: 12px","overflow: hidden"].join("; "),Fo=["height: 100%","border-radius: 12px","transition: width 0.05s linear, background 0.15s","width: 0%"].join("; "),Oo=["width: 120px","height: 120px","border-radius: 50%","display: flex","align-items: center","justify-content: center","font-size: 48px","font-weight: 700","color: white","margin: 0 auto","transition: background-color 0.15s","background: "+M.bg].join("; "),_o=["display: flex","flex-wrap: wrap","gap: 6px","min-height: 32px","align-items: center"].join("; "),Lo=["width: 28px","height: 28px","border-radius: 50%","display: flex","align-items: center","justify-content: center","font-size: 13px","font-weight: 700","color: white"].join("; "),Bo=e=>{const n=Math.round(255*(1-e));return`rgb(${Math.round(255*e)}, ${n}, 80)`},Do=20,cn={a:{f1:750,f2:1450,f3:2600},e:{f1:400,f2:2050,f3:2650},ɛ:{f1:600,f2:1750,f3:2600},i:{f1:250,f2:2250,f3:3e3},o:{f1:350,f2:750,f3:2550},u:{f1:300,f2:750,f3:2300},y:{f1:250,f2:1750,f3:2150}},Wo=(e,n,o,t)=>{const l=window.devicePixelRatio||1,s=n.width/l,a=n.height/l;e.clearRect(0,0,s,a);const{magnitudes:i,sampleRate:r,fftSize:f}=o,c=3500,h=r/f,d=Math.min(i.length-1,Math.ceil(c/h));let u=0;for(let m=0;m<=d;m++){const b=Math.log10(1+i[m]*500);if(b>u&&(u=b),o.lpcEnvelope){const T=Math.log10(1+o.lpcEnvelope[m]*500);T>u&&(u=T)}}u===0&&(u=1);const y=e.createLinearGradient(0,0,0,a);y.addColorStop(0,p(M.primary,.8)),y.addColorStop(1,p(M.primary,.05)),e.beginPath(),e.moveTo(0,a);for(let m=0;m<=d;m++){const T=m*h/c*s,S=Math.log10(1+i[m]*500),A=a-S/u*(a-20);e.lineTo(T,A)}e.lineTo(d*h/c*s,a),e.closePath(),e.fillStyle=y,e.fill(),e.beginPath();for(let m=0;m<=d;m++){const T=m*h/c*s,S=Math.log10(1+i[m]*500),A=a-S/u*(a-20);m===0?e.moveTo(T,A):e.lineTo(T,A)}if(e.strokeStyle=M.primary,e.lineWidth=1.5,e.stroke(),o.lpcEnvelope){e.beginPath();for(let m=0;m<=d;m++){const T=m*h/c*s,S=Math.log10(1+o.lpcEnvelope[m]*500),A=a-S/u*(a-20);m===0?e.moveTo(T,A):e.lineTo(T,A)}e.strokeStyle="#ff6b35",e.lineWidth=2.5,e.stroke()}if(t&&cn[t]){const m=cn[t],b=Y[t]??M.primary,T=100,S=(m.f1-T)/c*s,A=(m.f1+T)/c*s;e.fillStyle=p(b,.18),e.fillRect(S,0,A-S,a);const R=(m.f2-T)/c*s,O=(m.f2+T)/c*s;e.fillStyle=p(b,.18),e.fillRect(R,0,O-R,a);const I=(m.f3-T)/c*s,B=(m.f3+T)/c*s;e.fillStyle=p(b,.18),e.fillRect(I,0,B-I,a),e.fillStyle=p(b,.7),e.font="11px system-ui, sans-serif",e.textAlign="center",e.fillText("F1 cible",(S+A)/2,14),e.fillText("F2 cible",(R+O)/2,14),e.fillText("F3 cible",(I+B)/2,14)}const{f1:C,f2:k,f3:F}=o,g=t&&Y[t]?Y[t]:M.primary,w=C/c*s;e.beginPath(),e.moveTo(w,0),e.lineTo(w,a),e.strokeStyle=g,e.lineWidth=2,e.stroke(),e.fillStyle=g,e.font="bold 11px system-ui, sans-serif",e.textAlign="left",e.fillText("F1: "+Math.round(C)+" Hz",w+4,30);const v=k/c*s;e.beginPath(),e.moveTo(v,0),e.lineTo(v,a),e.strokeStyle=g,e.lineWidth=2,e.stroke(),e.fillStyle=g,e.font="bold 11px system-ui, sans-serif",e.textAlign="right",e.fillText("F2: "+Math.round(k)+" Hz",v-4,30);const P=F/c*s;e.beginPath(),e.moveTo(P,0),e.lineTo(P,a),e.strokeStyle=g,e.lineWidth=2,e.stroke(),e.fillStyle=g,e.font="bold 11px system-ui, sans-serif",e.textAlign="right",e.fillText("F3: "+Math.round(F)+" Hz",P-4,44),e.fillStyle=M.muted,e.font="10px system-ui, sans-serif",e.textAlign="center";for(let m=500;m<=3e3;m+=500){const b=m/c*s;e.fillText(m+"",b,a-4)}},No=()=>{let e=null,n=null,o=null,t=null,l=null,s=null,a=null,i=null,r=null;return{id:"dashboard",name:"Dashboard",description:"Tableau de bord diagnostique — visualise le pipeline audio en temps réel",mount:d=>{const u=E("div",{style:"background: "+M.bg+"; min-height: 100vh;"}),y=E("div",{style:Eo}),C=E("button",{style:Io},"← Accueil");C.addEventListener("click",()=>{window.location.hash="#menu"}),C.addEventListener("mouseenter",()=>{C.style.background=p(M.primary,.1)}),C.addEventListener("mouseleave",()=>{C.style.background="none"});const k=E("h1",{style:Ro},"Dashboard");y.appendChild(C),y.appendChild(k),u.appendChild(y);const F=E("div",{style:Ao}),g=E("div",{style:ce}),w=E("span",{style:he},"Volume"),v=E("div",{style:ko});e=E("div",{style:Fo}),v.appendChild(e),g.appendChild(w),g.appendChild(v);const P=E("div",{style:ce}),m=E("span",{style:he},"Pitch");n=E("span",{style:fn},"—"),P.appendChild(m),P.appendChild(n);const b=E("div",{style:ce}),T=E("span",{style:he},"Voyelle");o=E("div",{style:Oo}),t=E("span",{},"—"),o.appendChild(t),b.appendChild(T),b.appendChild(o);const S=E("div",{style:ce}),A=E("span",{style:he},"Durée");l=E("span",{style:fn},"0.0 s"),S.appendChild(A),S.appendChild(l),F.appendChild(g),F.appendChild(P),F.appendChild(b),F.appendChild(S),u.appendChild(F);const R=E("div",{style:"padding: 0 24px 20px; max-width: 720px; margin: 0 auto;"}),O=E("div",{style:ce}),I=E("span",{style:he},"Spectre");a=document.createElement("canvas"),a.style.cssText="width: 100%; height: 180px; border-radius: 8px; background: "+M.bg;const B=window.devicePixelRatio||1;a.width=672*B,a.height=180*B;const j=a.getContext("2d");j&&j.scale(B,B),i=j,O.appendChild(I),O.appendChild(a),R.appendChild(O),u.appendChild(R);const X=new ResizeObserver(N=>{for(const U of N){const ie=U.contentRect;if(a&&i){const ne=window.devicePixelRatio||1;a.width=ie.width*ne,a.height=180*ne,i.scale(ne,ne)}}});X.observe(O),r=X;const D=E("div",{style:"padding: 0 24px 24px; max-width: 720px; margin: 0 auto;"}),W=E("div",{style:ce}),H=E("span",{style:he},"Historique voyelles");s=E("div",{style:_o}),W.appendChild(H),W.appendChild(s),D.appendChild(W),u.appendChild(D),it(d),d.appendChild(u)},update:d=>{if(e){const u=Math.round(d.volume*100);e.style.width=u+"%",e.style.background=Bo(d.volume)}if(n&&(n.textContent=d.pitch!==null?Math.round(d.pitch)+" Hz":"—"),o&&t)if(d.vowel!==null){const u=Y[d.vowel]??M.muted;o.style.background=u,t.textContent=d.vowel,t.style.color="white"}else o.style.background=M.bg,t.textContent="—",t.style.color=M.muted;if(l&&(l.textContent=d.duration.toFixed(1)+" s"),s&&d.vowel!==null){const u=Y[d.vowel]??M.muted,y=E("div",{style:Lo+"; background: "+u},d.vowel);for(s.insertBefore(y,s.firstChild);s.children.length>Do;)s.removeChild(s.lastChild)}i&&a&&d.formants&&Wo(i,a,d.formants,d.vowel)},unmount:()=>{r&&(r.disconnect(),r=null),e=null,n=null,o=null,t=null,l=null,s=null,a=null,i=null}}},J=e=>{const n=document.createElement("canvas"),o=n.getContext("2d");if(!o)throw new Error("Failed to get 2D rendering context");e.appendChild(n);const{width:t,height:l}=q(n,o);return{canvas:n,ctx:o,width:t,height:l}},ee=(e,n,o)=>{e.clearRect(0,0,n,o)},q=(e,n)=>{const o=e.parentElement;if(!o)throw new Error("Canvas must be mounted in a parent element");const t=window.devicePixelRatio||1,l=o.clientWidth,s=o.clientHeight;return e.width=l*t,e.height=s*t,e.style.width=`${l}px`,e.style.height=`${s}px`,n.setTransform(t,0,0,t,0,0),{width:l,height:s}},Ho=6,$o=.003,Go=.05,jo=10,Uo=50,Yo=-1,Vo=-3,hn=.5,qo=.3,Xo=.7,Ko=.8,un=(e,n)=>e+Math.random()*(n-e),Zo=(e,n,o,t)=>({x:un(e*qo,e*Xo),y:n,radius:jo+o*Uo,color:t&&Y[t]?Y[t]:M.primary,alpha:Ko,vy:Yo+o*Vo,vx:un(-hn,hn)}),Jo=e=>({...e,y:e.y+e.vy,x:e.x+e.vx,alpha:e.alpha-$o,radius:e.radius+Go}),Qo=e=>e.alpha>0&&e.y+e.radius>0,zo=(e,n)=>{e.beginPath(),e.arc(n.x,n.y,n.radius,0,Math.PI*2),e.fillStyle=p(n.color,n.alpha),e.fill()},xo=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:M.bg})},el=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:M.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:p(M.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},nl=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:p(M.primary,.5),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},tl=()=>{let e=null,n=null,o=0,t=0,l=[],s=null,a=null,i=0,r=null;const f=()=>{if(n){ee(n,o,t),l=l.map(Jo).filter(Qo);for(const y of l)zo(n,y);s=requestAnimationFrame(f)}},c=()=>{if(!e||!n)return;const y=q(e,n);o=y.width,t=y.height};return{id:"bubbles",name:"Bulles",description:"Fais monter des bulles avec ta voix !",mount:y=>{const C=E("div",{});xo(C),a=E("button",{},"← Accueil"),el(a),a.addEventListener("click",()=>{window.location.hash="#menu"});const k=E("p",{},"Bulles");nl(k),C.appendChild(a),C.appendChild(k),y.appendChild(C);const F=J(C);e=F.canvas,n=F.ctx,o=F.width,t=F.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),r=c,window.addEventListener("resize",r),l=[],i=0,f()},unmount:()=>{s!==null&&(cancelAnimationFrame(s),s=null),r&&(window.removeEventListener("resize",r),r=null),e=null,n=null,a=null,l=[],i=0,o=0,t=0},update:y=>{if(!y.isVoicing){i=0;return}i+=1,i>=Ho&&(i=0,l.push(Zo(o,t,y.volume,y.vowel)))}}},pn=120,ol=.08,Ae=36,rt=56,ll=3,al=.03,gn=3,mn=2.5,sl=3,il=8,bn=.08,rl=.12,dl=.08,dt="#0f0e2e",fl="#1a3a2a",cl="#2d5a3a",Sn=["#ff6b35","#ffa500","#ffcc00","#ff4444","#ffee88"],hl=[{x:.78,y:.7,radius:18,color:"#66bb6a",label:"",ringColor:null},{x:.2,y:.5,radius:24,color:"#ffa726",label:"",ringColor:"#ffcc80"},{x:.82,y:.32,radius:20,color:"#ab47bc",label:"",ringColor:null},{x:.35,y:.15,radius:30,color:"#42a5f5",label:"",ringColor:"#90caf9"}],ul=(e,n,o)=>e+(n-e)*o,de=(e,n)=>e+Math.random()*(n-e),yn=e=>Array.from({length:e},()=>({x:Math.random(),y:Math.random(),size:de(.5,2.5),twinkleSpeed:de(.01,.04),twinkleOffset:Math.random()*Math.PI*2})),pl=(e,n,o)=>({x:e+de(-Ae*.3,Ae*.3),y:n+de(0,4),vx:de(-gn,gn),vy:de(mn*.5,mn)*(.5+o*.5),life:1,size:de(sl,il)*(.6+o*.8),color:Sn[Math.floor(Math.random()*Sn.length)]}),gl=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,life:e.life-al,size:e.size*.97}),ml=e=>e.life>0&&e.size>.5,bl=(e,n,o,t,l)=>{for(const s of n){const a=.4+.6*Math.abs(Math.sin(l*s.twinkleSpeed+s.twinkleOffset));e.beginPath(),e.arc(s.x*o,s.y*t,s.size,0,Math.PI*2),e.fillStyle=p("#ffffff",a),e.fill()}},Sl=(e,n,o,t)=>{const l=n.x*o,s=n.y*t,a=e.createRadialGradient(l,s,n.radius*.5,l,s,n.radius*2);a.addColorStop(0,p(n.color,.2)),a.addColorStop(1,p(n.color,0)),e.beginPath(),e.arc(l,s,n.radius*2,0,Math.PI*2),e.fillStyle=a,e.fill(),e.beginPath(),e.arc(l,s,n.radius,0,Math.PI*2),e.fillStyle=n.color,e.fill(),n.ringColor&&(e.beginPath(),e.ellipse(l,s,n.radius*1.8,n.radius*.35,-.3,0,Math.PI*2),e.strokeStyle=p(n.ringColor,.6),e.lineWidth=2,e.stroke())},yl=(e,n,o)=>{const t=o*(1-bn);e.fillStyle=fl,e.fillRect(0,t,n,o*bn),e.fillStyle=cl,e.fillRect(0,t,n,3)},wl=(e,n,o)=>{const t=Ae/2,l=rt;e.save(),e.translate(n,o),e.beginPath(),e.moveTo(0,-l),e.lineTo(-t*.5,-l*.55),e.lineTo(t*.5,-l*.55),e.closePath(),e.fillStyle="#ef4444",e.fill(),e.beginPath(),e.moveTo(-t*.5,-l*.55),e.lineTo(-t*.5,0),e.lineTo(t*.5,0),e.lineTo(t*.5,-l*.55),e.closePath(),e.fillStyle="#e0e0e0",e.fill(),e.fillStyle=M.primary,e.fillRect(-t*.5,-l*.4,Ae*.5,l*.12),e.beginPath(),e.arc(0,-l*.42,t*.28,0,Math.PI*2),e.fillStyle="#81d4fa",e.fill(),e.beginPath(),e.arc(0,-l*.42,t*.28,0,Math.PI*2),e.strokeStyle="#4fc3f7",e.lineWidth=1.5,e.stroke(),e.beginPath(),e.moveTo(-t*.5,-l*.08),e.lineTo(-t,l*.08),e.lineTo(-t*.5,0),e.closePath(),e.fillStyle="#ef4444",e.fill(),e.beginPath(),e.moveTo(t*.5,-l*.08),e.lineTo(t,l*.08),e.lineTo(t*.5,0),e.closePath(),e.fillStyle="#ef4444",e.fill(),e.beginPath(),e.moveTo(-t*.3,0),e.lineTo(-t*.2,l*.08),e.lineTo(t*.2,l*.08),e.lineTo(t*.3,0),e.closePath(),e.fillStyle="#78909c",e.fill(),e.restore()},vl=(e,n)=>{for(const o of n)e.beginPath(),e.arc(o.x,o.y,o.size,0,Math.PI*2),e.fillStyle=p(o.color,o.life*.8),e.fill()},Tl=(e,n,o,t,l,s)=>{const a=1-(t-l)/(s-l),i=n-24,r=o*.08,f=o*.84,c=8;e.fillStyle=p("#ffffff",.1),e.beginPath(),e.roundRect(i-c/2,r,c,f,4),e.fill();const h=f*Math.max(0,Math.min(1,a)),d=e.createLinearGradient(0,r+f,0,r);d.addColorStop(0,"#34d399"),d.addColorStop(.5,"#fbbf24"),d.addColorStop(1,"#ef4444"),e.fillStyle=d,e.beginPath(),e.roundRect(i-c/2,r+f-h,c,h,4),e.fill()},Pl=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:dt})},Cl=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:"#a5b4fc",cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:p("#1e1b4b",.7),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Ml=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:p("#a5b4fc",.6),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},Al=()=>{let e=null,n=null,o=0,t=0,l=null,s=null,a=[],i=0,r=0,f=[],c=0,h=!1,d=0;const u=()=>t*(1-rl),y=()=>t*dl+rt,C=()=>o/2,k=()=>{if(n){if(d+=1,i=ul(i,r,ol),f=f.map(gl).filter(ml),h&&c>.01){const P=Math.ceil(ll*(.5+c*1.5));for(let m=0;m<P;m++)f.push(pl(C(),i,c))}ee(n,o,t),n.fillStyle=dt,n.fillRect(0,0,o,t),bl(n,a,o,t,d);for(const P of hl)Sl(n,P,o,t);yl(n,o,t),vl(n,f),wl(n,C(),i),Tl(n,o,t,i,y(),u()),l=requestAnimationFrame(k)}},F=()=>{if(!e||!n)return;const P=u(),m=y(),b=P>m?(i-m)/(P-m):1,T=q(e,n);o=T.width,t=T.height;const S=u(),A=y();i=A+b*(S-A),r=i,a=yn(pn)};return{id:"rocket",name:"Fusée",description:"Fais décoller la fusée avec ta voix !",mount:P=>{const m=E("div",{});Pl(m);const b=E("button",{},"← Accueil");Cl(b),b.addEventListener("click",()=>{window.location.hash="#menu"});const T=E("p",{},"Fusée");Ml(T),m.appendChild(b),m.appendChild(T),P.appendChild(m);const S=J(m);e=S.canvas,n=S.ctx,o=S.width,t=S.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),a=yn(pn),i=u(),r=i,f=[],c=0,h=!1,d=0,s=F,window.addEventListener("resize",s),k()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),s&&(window.removeEventListener("resize",s),s=null),e=null,n=null,a=[],f=[],c=0,h=!1,d=0,o=0,t=0},update:P=>{c=P.volume,h=P.isVoicing;const m=u(),b=y();if(P.isVoicing&&P.volume>.01){const T=Math.pow(P.volume,.3);r=m-T*(m-b)}else r=m}}},wn=["#f9a8d4","#a5b4fc","#86efac","#fcd34d","#fca5a5","#c4b5fd","#67e8f9","#fdba74","#d8b4fe","#6ee7b7"],vn=["star","heart","butterfly","flower"],El=9,Il=15,We=20,Rl=.45,kl=.06,Fl=.25,qe="#0a0e1a",Tn=.04,Pe=(e,n)=>e+Math.random()*(n-e),Pn=(e,n,o,t)=>Math.sqrt((o-e)**2+(t-n)**2),Cn=(e,n,o)=>Math.max(n,Math.min(o,e)),Ol=(e,n)=>{const t=[];for(let l=0;l<El;l++)t.push({x:Pe(60,e-60),y:Pe(110,n-60),kind:vn[l%vn.length],color:wn[l%wn.length],size:Pe(18,30),discovered:!1,glowPhase:Pe(0,Math.PI*2)});return t},_l=(e,n,o,t,l,s)=>{const i=t,r=t*.45;e.save(),e.globalAlpha=s,e.fillStyle=l,e.beginPath();for(let f=0;f<10;f++){const c=f%2===0?i:r,h=Math.PI*f/5-Math.PI/2,d=n+Math.cos(h)*c,u=o+Math.sin(h)*c;f===0?e.moveTo(d,u):e.lineTo(d,u)}e.closePath(),e.fill(),e.restore()},Ll=(e,n,o,t,l,s)=>{const a=t*.6;e.save(),e.globalAlpha=s,e.fillStyle=l,e.beginPath(),e.moveTo(n,o+a*.3),e.bezierCurveTo(n,o-a*.3,n-a,o-a*.3,n-a,o+a*.1),e.bezierCurveTo(n-a,o+a*.6,n,o+a*.9,n,o+a*1.1),e.bezierCurveTo(n,o+a*.9,n+a,o+a*.6,n+a,o+a*.1),e.bezierCurveTo(n+a,o-a*.3,n,o-a*.3,n,o+a*.3),e.closePath(),e.fill(),e.restore()},Bl=(e,n,o,t,l,s)=>{const a=t*.7;e.save(),e.globalAlpha=s,e.fillStyle=l,e.beginPath(),e.ellipse(n-a*.45,o-a*.25,a*.5,a*.35,-Math.PI/6,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(n+a*.45,o-a*.25,a*.5,a*.35,Math.PI/6,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(n-a*.35,o+a*.25,a*.35,a*.25,Math.PI/6,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(n+a*.35,o+a*.25,a*.35,a*.25,-Math.PI/6,0,Math.PI*2),e.fill(),e.fillStyle=p(l,s*.8),e.beginPath(),e.ellipse(n,o,a*.08,a*.45,0,0,Math.PI*2),e.fill(),e.restore()},Dl=(e,n,o,t,l,s)=>{const i=t*.35,r=t*.2,f=t*.35;e.save(),e.globalAlpha=s,e.fillStyle=l;for(let c=0;c<6;c++){const h=Math.PI*2*c/6,d=n+Math.cos(h)*f,u=o+Math.sin(h)*f;e.beginPath(),e.arc(d,u,i,0,Math.PI*2),e.fill()}e.fillStyle=p("#fef08a",s),e.beginPath(),e.arc(n,o,r,0,Math.PI*2),e.fill(),e.restore()},Wl=(e,n,o,t)=>{const l=n.size*t;({star:()=>_l(e,n.x,n.y,l,n.color,o),heart:()=>Ll(e,n.x,n.y,l,n.color,o),butterfly:()=>Bl(e,n.x,n.y,l,n.color,o),flower:()=>Dl(e,n.x,n.y,l,n.color,o)})[n.kind]()},Nl=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:qe})},Hl=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:"#a5b4fc",cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:p("#1e1b4b",.7),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},$l=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:p("#c7d2fe",.6),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},Gl=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",fontSize:"1.1rem",fontWeight:"600",color:"#fcd34d",margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:p("#1e1b4b",.7),borderRadius:"8px"})},jl=()=>{let e=null,n=null,o=0,t=0,l=[],s=null,a=null,i=null,r=0,f=0,c=0,h=0;const d=S=>{const A=Math.min(o,t)*Rl,R=Math.pow(S,.3);return We+R*A},u=S=>{l=l.map(A=>{if(A.discovered)return A;const R=Pn(c,h,A.x,A.y),O=S-A.size-Il;return R<O?{...A,discovered:!0}:A})},y=()=>{if(!i)return;const S=l.filter(A=>A.discovered).length;i.textContent=`${S} / ${l.length}`},C=S=>{S.fillStyle=qe,S.fillRect(0,0,o,t)},k=(S,A)=>{if(A<=We)return;const R=S.createRadialGradient(c,h,0,c,h,A);R.addColorStop(0,p("#2a3a6a",.9)),R.addColorStop(.3,p("#1a2550",.7)),R.addColorStop(.7,p("#101830",.4)),R.addColorStop(1,p(qe,0)),S.save(),S.globalCompositeOperation="lighter",S.fillStyle=R,S.beginPath(),S.arc(c,h,A,0,Math.PI*2),S.fill(),S.restore()},F=(S,A,R)=>{for(const O of l){const I=Pn(c,h,O.x,O.y);let B;if(O.discovered&&A<=We)B=Tn*3;else if(I>A+O.size)B=O.discovered?Tn*2:0;else if(I>A-O.size){const X=(A+O.size-I)/(O.size*2);B=Cn(X,0,1)*.9}else{const X=1-I/A*.3;B=Cn(X,.5,.95)}if(B<=0)continue;let j=1;O.discovered&&(j=1+Math.sin(R*kl+O.glowPhase)*Fl,B=Math.min(B+.15,1)),Wl(S,O,B,j)}},g=(S,A)=>{if(l.filter(I=>I.discovered).length>0)return;const O=.25+Math.sin(A*.03)*.1;S.save(),S.fillStyle=p("#c7d2fe",O),S.font="1.1rem system-ui, sans-serif",S.textAlign="center",S.fillText("Parle pour allumer la lampe !",o/2,t/2+60),S.restore()};let w=0;const v=()=>{n&&(w+=1,ee(n,o,t),r+=(f-r)*.12,C(n),k(n,r),F(n,r,w),g(n,w),u(r),y(),s=requestAnimationFrame(v))},P=()=>{if(!e||!n)return;const S=q(e,n);o=S.width,t=S.height,c=o/2,h=t/2};return{id:"lamp",name:"Lampe Magique",description:"Illumine l’obscurité avec ta voix pour découvrir des créatures cachées !",mount:S=>{const A=E("div",{});Nl(A);const R=E("button",{},"← Accueil");Hl(R),R.addEventListener("click",()=>{window.location.hash="#menu"});const O=E("p",{},"Lampe Magique");$l(O),i=E("p",{},"0 / 0"),Gl(i),A.appendChild(R),A.appendChild(O),A.appendChild(i),S.appendChild(A);const I=J(A);e=I.canvas,n=I.ctx,o=I.width,t=I.height,c=o/2,h=t/2,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),l=Ol(o,t),r=0,f=0,w=0,a=P,window.addEventListener("resize",a),y(),v()},unmount:()=>{s!==null&&(cancelAnimationFrame(s),s=null),a&&(window.removeEventListener("resize",a),a=null),e=null,n=null,i=null,l=[],r=0,f=0,w=0,o=0,t=0},update:S=>{S.isVoicing?f=d(S.volume):f=0}}},Mn=7,Ul=.15,Yl=60,Vl=1/Yl,ql=.03,Xl=180,Kl=80,Zl=.08,Jl=.006,Ql=.3,zl=.008,xl=8,An=.08,ea=.12,En=["#fca5a5","#a5b4fc","#86efac","#fcd34d","#f9a8d4","#67e8f9","#fdba74"],In=["#f472b6","#a78bfa","#34d399","#fbbf24","#60a5fa","#f87171","#2dd4bf","#fb923c"],ft="#2d1b33",na="#4a2c2a",ta="#5c3a2e",oa="#7a5040",V=(e,n)=>e+Math.random()*(n-e),Ce=(e,n,o)=>Math.max(n,Math.min(o,e)),la=e=>Array.from({length:e},(n,o)=>({x:0,bodyColor:En[o%En.length],flameScale:1,extinguished:!1,blowAccumulator:0})),Rn=(e,n)=>{const o=n*.12,t=(n-o*2)/(e.length-1);return e.map((l,s)=>({...l,x:o+s*t}))},aa=e=>{const n=e.findIndex(o=>!o.extinguished);return n===-1?null:n},sa=(e,n)=>({x:e+V(-3,3),y:n-V(2,8),vx:V(-.3,.3),vy:V(-.8,-.3),alpha:V(.3,.6),size:V(3,6)}),ia=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,alpha:e.alpha-zl,size:e.size+.03}),ra=e=>e.alpha>0,da=(e,n)=>Array.from({length:Kl},()=>({x:V(0,e),y:V(-n*.3,n*.1),vx:V(-2,2),vy:V(1,3),rotation:V(0,Math.PI*2),rotationSpeed:V(-.1,.1),color:In[Math.floor(Math.random()*In.length)],alpha:1,width:V(6,12),height:V(3,6)})),fa=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,vy:e.vy+Zl,rotation:e.rotation+e.rotationSpeed,alpha:e.alpha-Jl}),ca=e=>e.alpha>0,ha=(e,n,o)=>{const t=e.createLinearGradient(0,0,0,o);t.addColorStop(0,ft),t.addColorStop(1,na),e.fillStyle=t,e.fillRect(0,0,n,o)},ua=(e,n,o,t)=>{const l=e.createLinearGradient(0,t,0,o);l.addColorStop(0,oa),l.addColorStop(.15,ta),l.addColorStop(1,"#3d2518"),e.fillStyle=l,e.beginPath(),e.roundRect(0,t,n,o-t,[8,8,0,0]),e.fill(),e.strokeStyle=p("#a07050",.4),e.lineWidth=1.5,e.beginPath(),e.moveTo(0,t),e.lineTo(n,t),e.stroke()},pa=(e,n,o,t,l,s)=>{const a=n-t/2,i=o-l;e.fillStyle=s,e.beginPath(),e.roundRect(a,i,t,l,[4,4,0,0]),e.fill(),e.fillStyle=p("#ffffff",.15),e.beginPath(),e.roundRect(a+2,i,t*.25,l,[3,0,0,0]),e.fill(),e.strokeStyle="#4a3728",e.lineWidth=2,e.beginPath(),e.moveTo(n,i),e.lineTo(n,i-8),e.stroke()},ga=(e,n,o,t,l)=>{if(t<=.01)return;const s=22*t,a=9*t,i=o-s,r=l*3*t;e.save();const f=20*t,c=e.createRadialGradient(n+r,o-s*.5,0,n+r,o-s*.5,f);c.addColorStop(0,p("#fef08a",.25*t)),c.addColorStop(1,p("#fef08a",0)),e.fillStyle=c,e.beginPath(),e.arc(n+r,o-s*.5,f,0,Math.PI*2),e.fill(),e.fillStyle=p("#fb923c",.85),e.beginPath(),e.moveTo(n-a*.6+r*.5,o),e.quadraticCurveTo(n-a+r*.8,o-s*.5,n+r,i),e.quadraticCurveTo(n+a+r*.8,o-s*.5,n+a*.6+r*.5,o),e.closePath(),e.fill();const h=.65;e.fillStyle=p("#fef08a",.9),e.beginPath(),e.moveTo(n-a*.35+r*.3,o),e.quadraticCurveTo(n-a*h+r*.5,o-s*.45,n+r*.7,i+s*.2),e.quadraticCurveTo(n+a*h+r*.5,o-s*.45,n+a*.35+r*.3,o),e.closePath(),e.fill();const d=e.createRadialGradient(n+r*.5,o-s*.2,0,n+r*.5,o-s*.2,a*.4);d.addColorStop(0,p("#ffffff",.6*t)),d.addColorStop(1,p("#fef9c3",0)),e.fillStyle=d,e.beginPath(),e.arc(n+r*.5,o-s*.2,a*.4,0,Math.PI*2),e.fill(),e.restore()},ma=(e,n)=>{for(const o of n)e.beginPath(),e.arc(o.x,o.y,o.size,0,Math.PI*2),e.fillStyle=p("#9ca3af",o.alpha),e.fill()},ba=(e,n)=>{for(const o of n)e.save(),e.translate(o.x,o.y),e.rotate(o.rotation),e.fillStyle=p(o.color,o.alpha),e.fillRect(-o.width/2,-o.height/2,o.width,o.height),e.restore()},Sa=(e,n,o)=>{if(n<=0)return;const t=n===1?"1 fois":`${n} fois`;e.save(),e.font="600 1rem system-ui, sans-serif",e.textAlign="center";const l=e.measureText(t).width,s=12,a=o/2-l/2-s,i=50;e.fillStyle=p("#1e1b4b",.6),e.beginPath(),e.roundRect(a,i,l+s*2,32,8),e.fill(),e.fillStyle=p("#fcd34d",.85),e.fillText(t,o/2,i+22),e.restore()},ya=(e,n,o,t,l)=>{if(l)return;const s=.3+Math.sin(t*.04)*.1;e.save(),e.fillStyle=p("#fef9c3",s),e.font="1.1rem system-ui, sans-serif",e.textAlign="center",e.fillText("Souffle pour éteindre les bougies !",n/2,o*.15),e.restore()},wa=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:ft})},va=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:"#fcd34d",cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:p("#1e1b4b",.7),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Ta=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:p("#fef9c3",.6),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},Pa=()=>{let e=null,n=null,o=0,t=0,l=null,s=null,a=[],i=new Map,r=[],f=0,c=0,h=!1,d=0,u=!1,y=0;const C=()=>t*.7,k=()=>Ce(o/(Mn*2.5),16,36),F=()=>Ce(t*.18,50,120),g=()=>{a=a.map(S=>({...S,flameScale:1,extinguished:!1,blowAccumulator:0})),i=new Map,h=!1,u=!1,d=0},w=()=>{u=!0,h=!0,d=0,f+=1,r=da(o,t)},v=()=>{if(!n)return;c+=1,ee(n,o,t);const S=C(),A=k(),R=F(),O=S-R-8;ha(n,o,t),ua(n,o,t,S);for(const[I,B]of i.entries()){const j=B.map(ia).filter(ra);j.length===0?i.delete(I):i.set(I,j)}for(let I=0;I<a.length;I++){const B=a[I];if(B.extinguished&&Math.random()<Ql){const j=i.get(I)??[];j.length<xl&&i.set(I,[...j,sa(B.x,O)])}}for(let I=0;I<a.length;I++){const B=a[I];if(pa(n,B.x,S,A,R,B.bodyColor),!B.extinguished){const X=Math.sin(c*An+I*1.7),D=Math.sin(c*An*1.6+I*2.3)*.5,W=(X+D)*ea;ga(n,B.x,O,B.flameScale,W)}const j=i.get(I);j&&ma(n,j)}a=a.map((I,B)=>{if(I.extinguished)return I;if(aa(a)===B&&y>Ul){const N=I.blowAccumulator+1,U=Ce(1-N*Vl,0,1);return U<=0?{...I,flameScale:0,extinguished:!0,blowAccumulator:0}:{...I,flameScale:U,blowAccumulator:N}}const W=Ce(I.flameScale+ql,0,1),H=Math.max(0,I.blowAccumulator-.5);return{...I,flameScale:W,blowAccumulator:H}}),!h&&a.every(I=>I.extinguished)&&w(),u&&(r=r.map(fa).filter(ca),ba(n,r),d+=1,d>=Xl&&g()),ya(n,o,t,c,h),Sa(n,f,o),l=requestAnimationFrame(v)},P=()=>{if(!e||!n)return;const S=q(e,n);o=S.width,t=S.height,a=Rn(a,o)};return{id:"candles",name:"Bougies",description:"Souffle pour éteindre les bougies",mount:S=>{const A=E("div",{});wa(A);const R=E("button",{},"← Accueil");va(R),R.addEventListener("click",()=>{window.location.hash="#menu"});const O=E("p",{},"Bougies");Ta(O),A.appendChild(R),A.appendChild(O),S.appendChild(A);const I=J(A);e=I.canvas,n=I.ctx,o=I.width,t=I.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),a=Rn(la(Mn),o),i=new Map,r=[],f=0,c=0,h=!1,d=0,u=!1,y=0,s=P,window.addEventListener("resize",s),v()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),s&&(window.removeEventListener("resize",s),s=null),e=null,n=null,a=[],i=new Map,r=[],f=0,c=0,h=!1,d=0,u=!1,y=0,o=0,t=0},update:S=>{y=S.volume}}},ct=80,Ca=600,Ma=Ca-ct,Aa=1.5,kn=4,Ea=30,Ia=1.5,Ra=.35,Ne=["#ef4444","#f97316","#eab308","#22c55e","#06b6d4","#3b82f6","#8b5cf6"],ht=e=>Math.max(0,Math.min(1,(e-ct)/Ma)),ka=(e,n)=>{const t=n-80,l=ht(e);return 40+t*(1-l)},Fa=e=>{const n=ht(e),o=Math.min(Ne.length-1,Math.floor(n*Ne.length));return Ne[o]},Oa=e=>kn+e*(Ea-kn),_a=(e,n,o,t,l)=>{const s=e.createRadialGradient(n,o,0,n,o,t);s.addColorStop(0,p(l,.85)),s.addColorStop(.5,p(l,.5)),s.addColorStop(1,p(l,0)),e.beginPath(),e.arc(n,o,t,0,Math.PI*2),e.fillStyle=s,e.fill()},La=(e,n,o)=>{e.beginPath(),e.moveTo(n,0),e.lineTo(n,o),e.strokeStyle=p(M.text,Ra),e.lineWidth=Ia,e.stroke()},Ba=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:M.bg})},Da=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:M.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:p(M.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Wa=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:p(M.primary,.5),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},Na=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1rem",fontWeight:"600",color:M.secondary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:p(M.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Ha=()=>{let e=null,n=null,o=0,t=0,l=null,s=null,a=null,i=null,r=0,f=!0;const c=()=>{if(!e||(a||(a=document.createElement("canvas"),i=a.getContext("2d")),!a||!i))return;const g=window.devicePixelRatio||1;if(a.width!==e.width||a.height!==e.height){const w=document.createElement("canvas");w.width=a.width,w.height=a.height;const v=w.getContext("2d");v&&a.width>0&&a.height>0&&v.drawImage(a,0,0),a.width=e.width,a.height=e.height,i.setTransform(g,0,0,g,0,0),w.width>0&&w.height>0&&(i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(w,0,0,a.width,a.height),i.setTransform(g,0,0,g,0,0),i.restore())}},h=()=>{if(!i||!a)return;i.save(),i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,a.width,a.height),i.restore();const g=window.devicePixelRatio||1;i.setTransform(g,0,0,g,0,0),r=0,f=!0},d=()=>{if(!n||!a)return;n.fillStyle=M.bg,n.fillRect(0,0,o,t),n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(a,0,0),n.restore();const g=window.devicePixelRatio||1;n.setTransform(g,0,0,g,0,0),La(n,r,t)},u=()=>{n&&(f&&(d(),f=!1),l=requestAnimationFrame(u))},y=()=>{if(!e||!n)return;const g=q(e,n);o=g.width,t=g.height,c(),f=!0};return{id:"piano",name:"Piano Visuel",description:"Peins avec ta voix",mount:g=>{const w=E("div",{});Ba(w);const v=E("button",{},"← Accueil");Da(v),v.addEventListener("click",()=>{window.location.hash="#menu"});const P=E("p",{},"Piano Visuel");Wa(P);const m=E("button",{},"Effacer");Na(m),m.addEventListener("click",h),w.appendChild(v),w.appendChild(P),w.appendChild(m),g.appendChild(w);const b=J(w);e=b.canvas,n=b.ctx,o=b.width,t=b.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),c(),r=0,f=!0,s=y,window.addEventListener("resize",s),u()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),s&&(window.removeEventListener("resize",s),s=null),e=null,n=null,a=null,i=null,r=0,f=!1,o=0,t=0},update:g=>{if(i){if(r+=Aa,r>o&&(r=0),g.isVoicing&&g.pitch!==null){const w=ka(g.pitch,t),v=Oa(g.volume),P=Fa(g.pitch);_a(i,r,w,v,P)}f=!0}}}},$a=1.3,Ga=.06,ja=.03,Ua=.6,Fn=6,On=2.5,Ya=.015,Va=10,ut=50,qa=4,K=(e,n,o,t,l,s,a,i)=>{e.beginPath(),e.moveTo(n,o),e.lineTo(t,l),e.lineTo(s,a),e.closePath(),e.fillStyle=i,e.fill()},Ee=(e,n,o,t,l,s)=>{e.beginPath(),e.ellipse(n,o,t,l,0,0,Math.PI*2),e.fillStyle=s,e.fill()},L=(e,n,o,t,l)=>{e.beginPath(),e.arc(n,o,t,0,Math.PI*2),e.fillStyle=l,e.fill()},Xa=(e,n,o,t,l)=>{L(e,n,o,t,l),K(e,n-t*.7,o-t*.4,n-t*.35,o-t*1.15,n-t*.05,o-t*.55,l),K(e,n+t*.05,o-t*.55,n+t*.35,o-t*1.15,n+t*.7,o-t*.4,l);const s=p("#fca5a5",.8);K(e,n-t*.58,o-t*.48,n-t*.38,o-t*.95,n-t*.15,o-t*.58,s),K(e,n+t*.15,o-t*.58,n+t*.38,o-t*.95,n+t*.58,o-t*.48,s),L(e,n-t*.3,o-t*.15,t*.13,"#2d3748"),L(e,n+t*.3,o-t*.15,t*.13,"#2d3748"),L(e,n-t*.26,o-t*.2,t*.045,"#ffffff"),L(e,n+t*.34,o-t*.2,t*.045,"#ffffff"),K(e,n,o+t*.05,n-t*.08,o+t*.15,n+t*.08,o+t*.15,"#f472b6"),e.beginPath(),e.moveTo(n,o+t*.15),e.lineTo(n-t*.12,o+t*.3),e.moveTo(n,o+t*.15),e.lineTo(n+t*.12,o+t*.3),e.strokeStyle="#2d3748",e.lineWidth=1.5,e.stroke(),e.beginPath(),e.moveTo(n-t*.3,o+t*.1),e.lineTo(n-t*.85,o+t*0),e.moveTo(n-t*.3,o+t*.2),e.lineTo(n-t*.85,o+t*.25),e.moveTo(n+t*.3,o+t*.1),e.lineTo(n+t*.85,o+t*0),e.moveTo(n+t*.3,o+t*.2),e.lineTo(n+t*.85,o+t*.25),e.strokeStyle="#94a3b8",e.lineWidth=1.2,e.stroke()},Ka=(e,n,o,t,l)=>{L(e,n,o,t,l),L(e,n,o+t*.2,t*.6,p("#fef3c7",.9));const s=t*.3;L(e,n-t*.32,o-t*.15,s,"#ffffff"),L(e,n+t*.32,o-t*.15,s,"#ffffff"),L(e,n-t*.32,o-t*.15,s*.55,"#2d3748"),L(e,n+t*.32,o-t*.15,s*.55,"#2d3748"),L(e,n-t*.26,o-t*.22,s*.2,"#ffffff"),L(e,n+t*.38,o-t*.22,s*.2,"#ffffff"),e.beginPath(),e.arc(n-t*.32,o-t*.15,s,0,Math.PI*2),e.strokeStyle=p("#2d3748",.3),e.lineWidth=1.5,e.stroke(),e.beginPath(),e.arc(n+t*.32,o-t*.15,s,0,Math.PI*2),e.stroke(),K(e,n,o+t*.05,n-t*.1,o+t*.2,n+t*.1,o+t*.2,"#f59e0b"),K(e,n-t*.55,o-t*.65,n-t*.35,o-t*1.1,n-t*.15,o-t*.65,l),K(e,n+t*.15,o-t*.65,n+t*.35,o-t*1.1,n+t*.55,o-t*.65,l)},Za=(e,n,o,t,l)=>{L(e,n,o,t*.85,l),L(e,n-t*.6,o-t*.7,t*.5,l),L(e,n+t*.6,o-t*.7,t*.5,l),L(e,n-t*.6,o-t*.7,t*.32,p("#fca5a5",.7)),L(e,n+t*.6,o-t*.7,t*.32,p("#fca5a5",.7)),L(e,n-t*.25,o-t*.15,t*.12,"#2d3748"),L(e,n+t*.25,o-t*.15,t*.12,"#2d3748"),L(e,n-t*.21,o-t*.2,t*.04,"#ffffff"),L(e,n+t*.29,o-t*.2,t*.04,"#ffffff"),L(e,n,o+t*.15,t*.1,"#f472b6"),e.beginPath(),e.moveTo(n-t*.2,o+t*.15),e.lineTo(n-t*.75,o+t*.05),e.moveTo(n-t*.2,o+t*.22),e.lineTo(n-t*.75,o+t*.28),e.moveTo(n+t*.2,o+t*.15),e.lineTo(n+t*.75,o+t*.05),e.moveTo(n+t*.2,o+t*.22),e.lineTo(n+t*.75,o+t*.28),e.strokeStyle="#94a3b8",e.lineWidth=1,e.stroke(),e.beginPath(),e.moveTo(n+t*.5,o+t*.6),e.quadraticCurveTo(n+t*1.5,o+t*.2,n+t*1.3,o-t*.3),e.strokeStyle=l,e.lineWidth=2.5,e.lineCap="round",e.stroke()},Ja=(e,n,o,t,l)=>{L(e,n-t*.65,o-t*.65,t*.32,l),L(e,n+t*.65,o-t*.65,t*.32,l),L(e,n-t*.65,o-t*.65,t*.18,p("#d4a574",.8)),L(e,n+t*.65,o-t*.65,t*.18,p("#d4a574",.8)),L(e,n,o,t,l),Ee(e,n,o+t*.15,t*.4,t*.3,p("#d4a574",.7)),L(e,n-t*.3,o-t*.15,t*.11,"#2d3748"),L(e,n+t*.3,o-t*.15,t*.11,"#2d3748"),L(e,n-t*.27,o-t*.2,t*.04,"#ffffff"),L(e,n+t*.33,o-t*.2,t*.04,"#ffffff"),Ee(e,n,o+t*.05,t*.11,t*.08,"#2d3748"),e.beginPath(),e.moveTo(n,o+t*.13),e.lineTo(n-t*.08,o+t*.25),e.moveTo(n,o+t*.13),e.lineTo(n+t*.08,o+t*.25),e.strokeStyle="#2d3748",e.lineWidth=1.2,e.stroke()},Qa=(e,n,o,t,l)=>{Ee(e,n,o,t*.9,t,l),Ee(e,n,o+t*.2,t*.55,t*.55,p("#fef3c7",.8)),e.beginPath(),e.ellipse(n-t*.55,o-t*.05,t*.5,t*.28,-.3,0,Math.PI*2),e.fillStyle=p(l,.7),e.fill(),L(e,n+t*.15,o-t*.25,t*.12,"#2d3748"),L(e,n+t*.19,o-t*.3,t*.04,"#ffffff"),K(e,n+t*.55,o-t*.15,n+t*.55,o+t*.05,n+t*.95,o-t*.05,"#f59e0b"),K(e,n-t*.7,o-t*.3,n-t*1.15,o-t*.65,n-t*.5,o-t*.6,l),K(e,n-t*.75,o-t*.15,n-t*1.25,o-t*.35,n-t*.6,o-t*.45,p(l,.8))},te=[{name:"Chat",vowel:"a",label:"AAA",draw:Xa},{name:"Hibou",vowel:"o",label:"OOO",draw:Ka},{name:"Souris",vowel:"i",label:"III",draw:Za},{name:"Ours",vowel:"u",label:"UUU",draw:Ja},{name:"Oiseau",vowel:"e",label:"EEE",draw:Qa}],za=(e,n,o)=>{const t=[];for(let l=0;l<Fn;l++){const s=Math.PI*2*l/Fn+(Math.random()-.5)*.5;t.push({x:e,y:n-ut,vx:Math.cos(s)*On*(.7+Math.random()*.6),vy:Math.sin(s)*On*(.7+Math.random()*.6)-1.5,alpha:1,size:Va*(.7+Math.random()*.6),kind:Math.random()>.5?"heart":"star",color:o})}return t},xa=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,vy:e.vy+.04,alpha:e.alpha-Ya}),es=e=>e.alpha>0,ns=(e,n,o,t,l,s)=>{e.save(),e.globalAlpha=s,e.fillStyle=l,e.beginPath();const a=t*.5;e.moveTo(n,o+a*.3),e.bezierCurveTo(n,o-a*.2,n-a,o-a*.5,n-a,o+a*.1),e.bezierCurveTo(n-a,o+a*.6,n,o+a*.9,n,o+a*1.1),e.bezierCurveTo(n,o+a*.9,n+a,o+a*.6,n+a,o+a*.1),e.bezierCurveTo(n+a,o-a*.5,n,o-a*.2,n,o+a*.3),e.fill(),e.restore()},ts=(e,n,o,t,l,s)=>{e.save(),e.globalAlpha=s,e.fillStyle=l,e.beginPath();const a=5,i=t*.5,r=i*.4;for(let f=0;f<a*2;f++){const c=f%2===0?i:r,h=Math.PI*f/a-Math.PI/2,d=n+Math.cos(h)*c,u=o+Math.sin(h)*c;f===0?e.moveTo(d,u):e.lineTo(d,u)}e.closePath(),e.fill(),e.restore()},os=(e,n)=>{n.kind==="heart"?ns(e,n.x,n.y,n.size,n.color,n.alpha):ts(e,n.x,n.y,n.size,n.color,n.alpha)},ls=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:M.bg})},as=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:M.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:p(M.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},ss=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:M.text,margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},_n=(e,n,o)=>{const t=e/(o+1),l=n*.42,s=[];for(let a=0;a<o;a++)s.push({x:t*(a+1),y:l});return s},is=()=>{let e=null,n=null,o=0,t=0,l=null,s=null,a=te.map(()=>({scale:1,targetScale:1,glowAlpha:0,feedCount:0,particles:[]})),i=0,r=null;const f=()=>{a=te.map(()=>({scale:1,targetScale:1,glowAlpha:0,feedCount:0,particles:[]})),i=0,r=null},c=()=>{const g=o/(te.length*2.5),w=t*.15;return Math.max(25,Math.min(ut,g,w))},h=()=>{if(!n)return;ee(n,o,t),n.fillStyle=M.bg,n.fillRect(0,0,o,t);const g=_n(o,t,te.length),w=c();for(let v=0;v<te.length;v++){const P=te[v],m=a[v],b=g[v],T=Y[P.vowel]??M.primary;if(n.save(),m.glowAlpha>0){const O=w*1.6*m.scale,I=n.createRadialGradient(b.x,b.y,w*.3,b.x,b.y,O);I.addColorStop(0,p(T,m.glowAlpha*.5)),I.addColorStop(1,p(T,0)),n.fillStyle=I,n.fillRect(b.x-O,b.y-O,O*2,O*2)}n.translate(b.x,b.y),n.scale(m.scale,m.scale),n.translate(-b.x,-b.y),P.draw(n,b.x,b.y,w,T),n.restore();for(const O of m.particles)os(n,O);const S=b.y+w*1.6;n.font=`bold ${Math.round(w*.55)}px system-ui, -apple-system, sans-serif`,n.textAlign="center",n.textBaseline="top",n.fillStyle=T,n.fillText(P.label,b.x,S);const A=b.y-w*1.5;n.font=`600 ${Math.round(w*.38)}px system-ui, -apple-system, sans-serif`,n.fillStyle=M.text,n.fillText(P.name,b.x,A);const R=b.y+w*1.6+w*.65;n.font=`600 ${Math.round(w*.32)}px system-ui, -apple-system, sans-serif`,n.fillStyle=M.muted,n.fillText(`${m.feedCount}`,b.x,R)}},d=()=>{a=a.map(g=>{const w=g.scale+(g.targetScale-g.scale)*Ga*3,v=Math.max(0,g.glowAlpha-ja),P=g.particles.map(xa).filter(es),m=Math.abs(g.scale-1)<.01&&g.targetScale>1||g.targetScale>1&&w>g.targetScale*.95?1:g.targetScale;return{...g,scale:w,targetScale:m,glowAlpha:v,particles:P}}),h(),l=requestAnimationFrame(d)},u=()=>{if(!e||!n)return;const g=q(e,n);o=g.width,t=g.height},y=g=>{const w=te[g],v=_n(o,t,te.length)[g],P=Y[w.vowel]??M.primary;a=a.map((m,b)=>b!==g?m:{...m,targetScale:$a,glowAlpha:Ua,feedCount:m.feedCount+1,particles:[...m.particles,...za(v.x,v.y,P)]})};return{id:"animals",name:"Nourrir les Animaux",description:"Nourris les animaux en prononçant la bonne voyelle !",mount:g=>{const w=E("div",{});ls(w);const v=E("button",{},"← Accueil");as(v),v.addEventListener("click",()=>{window.location.hash="#menu"});const P=E("p",{},"Nourrir les Animaux");ss(P),w.appendChild(v),w.appendChild(P),g.appendChild(w);const m=J(w);e=m.canvas,n=m.ctx,o=m.width,t=m.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),s=u,window.addEventListener("resize",s),f(),d()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),s&&(window.removeEventListener("resize",s),s=null),e=null,n=null,o=0,t=0,f()},update:g=>{if(!g.isVoicing||g.vowel===null){i=0,r=null;return}if(i+=1,i>=qa&&g.vowel!==r){const w=te.findIndex(v=>v.vowel===g.vowel);w!==-1&&(y(w),r=g.vowel)}}}},ae=["a","e","i","o","u"],Ie=5,rs=.04,Ln=.18,pt=.88,Je=.15,gt=.04,ds=.06,fs=.03,cs=2,hs=Math.round(cs*60),mt=.35,bt=3,Bn=["#ef4444","#f59e0b","#22c55e","#3b82f6","#ec4899","#f97316"],Dn=["#f472b6","#c084fc","#67e8f9","#fbbf24","#a78bfa"],Wn=["#fbbf24","#fde047","#f59e0b","#fcd34d","#facc15"],Nn=["#93c5fd","#a5b4fc","#c4b5fd","#67e8f9","#7dd3fc"],G=(e,n)=>e+Math.random()*(n-e),He=()=>ae.map(e=>({vowel:e,color:Y[e]??M.primary,openAmount:0,isOpening:!1,surpriseTime:0,surpriseFrame:0})),Re=(e,n,o)=>{const t=n*rs,l=t*(Ie+1),s=(n-l)/Ie,a=t+e*(s+t),i=o*Ln,r=o*(pt-Ln);return{x:a,y:i,w:s,h:r}},us=(e,n)=>{const o=[];for(let l=0;l<18;l++){const s=Math.PI*2*l/18+G(-.2,.2),a=G(1.5,4);o.push({x:e,y:n,vx:Math.cos(s)*a,vy:Math.sin(s)*a,color:Bn[Math.floor(Math.random()*Bn.length)],alpha:1,size:G(3,7),life:1})}return o},ps=(e,n,o)=>{const t=[];for(let s=0;s<8;s++)t.push({x:e+G(-20,20),y:n+G(0,o*.5),vx:G(-.8,.8),vy:G(-2,-.8),color:Dn[Math.floor(Math.random()*Dn.length)],alpha:1,size:G(6,12),life:1});return t},gs=(e,n,o)=>{const t=[];for(let s=0;s<15;s++)t.push({x:e+G(-o*.4,o*.4),y:n-G(10,40),vx:G(-.5,.5),vy:G(1,3),color:Wn[Math.floor(Math.random()*Wn.length)],alpha:1,size:G(4,8),life:1});return t},ms=(e,n,o)=>{const t=[];for(let s=0;s<10;s++)t.push({x:e+G(-15,15),y:n+G(0,o*.5),vx:G(-.3,.3),vy:G(-2.5,-1),color:Nn[Math.floor(Math.random()*Nn.length)],alpha:.85,size:G(5,14),life:1});return t},bs=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,alpha:Math.max(0,e.alpha-.008),life:Math.max(0,e.life-.008)}),Ss=e=>e.life>0&&e.alpha>0,St=(e,n,o,t,l,s,a,i)=>{e.beginPath(),e.moveTo(n,o+l),e.lineTo(n,o+s),e.arcTo(n,o,n+t/2,o,s),e.arcTo(n+t,o,n+t,o+s,s),e.lineTo(n+t,o+l),e.closePath(),e.fillStyle=a,e.fill(),e.strokeStyle=i,e.lineWidth=bt,e.stroke()},yt=(e,n,o,t,l,s)=>{const a=n+t*.75,i=o+l*.52;e.beginPath(),e.arc(a,i,s,0,Math.PI*2),e.fillStyle="#d4af37",e.fill(),e.strokeStyle="#b8960c",e.lineWidth=1.5,e.stroke(),e.beginPath(),e.arc(a-s*.25,i-s*.25,s*.35,0,Math.PI*2),e.fillStyle=p("#ffffff",.5),e.fill()},wt=(e,n,o,t,l,s,a)=>{e.font=`bold ${a}px sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillStyle=p("#ffffff",.9),e.fillText(n.toUpperCase(),o+l/2,t+s*.45)},ys=(e,n,o,t,l)=>{const{x:s,y:a,w:i,h:r}=Re(o,t,l),f=r*Je,c=i*gt;St(e,s,a,i,r,f,n.color,p(n.color,.7)),yt(e,s,a,i,r,c),wt(e,n.vowel,s,a,i,r,i*mt)},ws=(e,n,o,t,l,s,a)=>{e.beginPath(),e.moveTo(n,o+l),e.lineTo(n,o+s),e.arcTo(n,o,n+t/2,o,s),e.arcTo(n+t,o,n+t,o+s,s),e.lineTo(n+t,o+l),e.closePath(),e.fillStyle=p(a,.12),e.fill(),e.strokeStyle=p(a,.4),e.lineWidth=bt,e.stroke()},vs=(e,n,o,t,l)=>{const{x:s,y:a,w:i,h:r}=Re(o,t,l),f=r*Je,c=n.openAmount;ws(e,s,a,i,r,f,n.color);const h=i*(1-c*.8),d=s+(i-h),u=h*gt,y=p("#000000",c*.15);e.save(),St(e,d,a,h,r,f*(1-c*.3),n.color,p(n.color,.7)),e.beginPath(),e.moveTo(d,a+r),e.lineTo(d,a+f),e.arcTo(d,a,d+h/2,a,f*(1-c*.3)),e.arcTo(d+h,a,d+h,a+f,f*(1-c*.3)),e.lineTo(d+h,a+r),e.closePath(),e.fillStyle=y,e.fill(),c<.6&&(yt(e,d,a,h,r,u),wt(e,n.vowel,d,a,h,r,h*mt)),e.restore()},Ts=(e,n)=>{e.beginPath(),e.arc(n.x,n.y,n.size,0,Math.PI*2),e.fillStyle=p(n.color,n.alpha),e.fill()},Ps=(e,n,o)=>{const t=Math.sin(o*.15+n.x)*4;e.save(),e.translate(n.x,n.y),e.fillStyle=p(n.color,n.alpha),e.beginPath(),e.ellipse(-n.size*.4,0,n.size*.5,n.size*.3+t*.3,-.3,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(n.size*.4,0,n.size*.5,n.size*.3+t*.3,.3,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(0,0,n.size*.12,n.size*.4,0,0,Math.PI*2),e.fillStyle=p("#4a3728",n.alpha),e.fill(),e.restore()},Cs=(e,n,o)=>{const t=o*.03+n.x*.01,l=5,s=n.size,a=n.size*.45;e.save(),e.translate(n.x,n.y),e.rotate(t),e.beginPath();for(let i=0;i<l*2;i++){const r=Math.PI*i/l-Math.PI/2,f=i%2===0?s:a;i===0?e.moveTo(Math.cos(r)*f,Math.sin(r)*f):e.lineTo(Math.cos(r)*f,Math.sin(r)*f)}e.closePath(),e.fillStyle=p(n.color,n.alpha),e.fill(),e.restore()},Ms=(e,n,o,t,l,s)=>{const a=["#ef4444","#f97316","#fbbf24","#22c55e","#3b82f6","#8b5cf6","#a855f7"],i=n+t/2,r=o+l*.8,f=t*.45,c=f/(a.length+2),h=Math.PI*Math.min(s,1);e.save(),e.beginPath(),e.rect(n,o,t,l),e.clip();for(let d=0;d<a.length;d++){const u=f-d*c;e.beginPath(),e.arc(i,r,u,Math.PI,Math.PI+h,!1),e.strokeStyle=p(a[d],.8),e.lineWidth=c*.9,e.lineCap="round",e.stroke()}e.restore()},As=(e,n)=>{e.beginPath(),e.arc(n.x,n.y,n.size,0,Math.PI*2),e.fillStyle=p(n.color,n.alpha*.4),e.fill(),e.strokeStyle=p(n.color,n.alpha*.7),e.lineWidth=1.5,e.stroke(),e.beginPath(),e.arc(n.x-n.size*.25,n.y-n.size*.25,n.size*.25,0,Math.PI*2),e.fillStyle=p("#ffffff",n.alpha*.6),e.fill()},Es=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:M.bg})},Is=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:M.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:p(M.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Rs=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:p(M.primary,.5),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},ks=()=>{let e=null,n=null,o=0,t=0,l=null,s=null,a=[...He()],i=ae.map(()=>[]),r=ae.map(()=>!1);const f=g=>{const w=a[g];w.isOpening||(a[g]={...w,isOpening:!0,surpriseTime:hs,surpriseFrame:0},r[g]=!1)},c=()=>{a=a.map((g,w)=>{if(g.isOpening){const v=Math.min(1,g.openAmount+ds),P=g.surpriseTime-1,m=g.surpriseFrame+1;if(v>.4&&!r[w]){const b=Re(w,o,t),T=b.x+b.w/2,S=b.y+b.h/2;switch(g.vowel){case"a":i[w]=us(T,S);break;case"e":i[w]=ps(T,S,b.h);break;case"i":i[w]=gs(T,b.y,b.w);break;case"o":i[w]=[];break;case"u":i[w]=ms(T,S,b.h);break}r[w]=!0}return P<=0?{...g,openAmount:v,isOpening:!1,surpriseTime:0,surpriseFrame:m}:{...g,openAmount:v,surpriseTime:P,surpriseFrame:m}}if(g.openAmount>0){const v=Math.max(0,g.openAmount-fs);return v===0&&(i[w]=[],r[w]=!1),{...g,openAmount:v,surpriseFrame:g.surpriseFrame+1}}return g}),i=i.map(g=>g.map(bs).filter(Ss))},h=()=>{if(n)for(let g=0;g<Ie;g++){const w=a[g];if(w.openAmount<.3)continue;const v=Re(g,o,t);n.save();const P=v.h*Je;switch(n.beginPath(),n.moveTo(v.x,v.y+v.h),n.lineTo(v.x,v.y+P),n.arcTo(v.x,v.y,v.x+v.w/2,v.y,P),n.arcTo(v.x+v.w,v.y,v.x+v.w,v.y+P,P),n.lineTo(v.x+v.w,v.y+v.h),n.closePath(),n.clip(),w.vowel){case"a":for(const m of i[g])Ts(n,m);break;case"e":for(const m of i[g])Ps(n,m,w.surpriseFrame);break;case"i":for(const m of i[g])Cs(n,m,w.surpriseFrame);break;case"o":{const m=Math.min(1,w.surpriseFrame/40);Ms(n,v.x,v.y,v.w,v.h,m);break}case"u":for(const m of i[g])As(n,m);break}n.restore()}},d=()=>{if(!n)return;const g=t*pt;n.fillStyle=p(M.muted,.15),n.fillRect(0,g,o,t-g),n.strokeStyle=p(M.muted,.25),n.lineWidth=1,n.beginPath(),n.moveTo(0,g),n.lineTo(o,g),n.stroke()},u=()=>{if(n){ee(n,o,t),d(),c(),h();for(let g=0;g<Ie;g++){const w=a[g];w.openAmount>0?vs(n,w,g,o,t):ys(n,w,g,o,t)}l=requestAnimationFrame(u)}},y=()=>{if(!e||!n)return;const g=q(e,n);o=g.width,t=g.height};return{id:"doors",name:"Portes Magiques",description:"Ouvre les portes magiques avec ta voix !",mount:g=>{const w=E("div",{});Es(w);const v=E("button",{},"← Accueil");Is(v),v.addEventListener("click",()=>{window.location.hash="#menu"});const P=E("p",{},"Portes Magiques");Rs(P),w.appendChild(v),w.appendChild(P),g.appendChild(w);const m=J(w);e=m.canvas,n=m.ctx,o=m.width,t=m.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),s=y,window.addEventListener("resize",s),a=[...He()],i=ae.map(()=>[]),r=ae.map(()=>!1),u()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),s&&(window.removeEventListener("resize",s),s=null),e=null,n=null,o=0,t=0,a=[...He()],i=ae.map(()=>[]),r=ae.map(()=>!1)},update:g=>{if(!g.isVoicing||g.vowel===null)return;const w=g.vowel,v=ae.indexOf(w);v!==-1&&(g.volume<.05||f(v))}}},Se=.15,Fs=4,Xe=.55,Hn=18,$n=10,ge=8,Os=14,_s=20,Ls=.5,Gn=8,Bs=60,Q=40,jn=12,Un=20,Qe=3,ze=.002,Yn=.3,vt=60,Vn=8,$e="#f472b6",me=(e,n)=>e+Math.random()*(n-e),Ke=(e,n)=>Math.min(e/2,1)*n,qn=(e,n,o)=>({x:e,stemHeight:0,maxDuration:n,color:o,petalCount:n>=4?8:5,hasLeaves:n>=1,hasBud:n>=2,isOpen:n>=3,isFullBloom:n>=4,hasSparkles:n>=5}),Xn=(e,n)=>({x:e+me(-30,30),y:n+me(-30,10),size:me(2,5),alpha:1,vx:me(-.5,.5),vy:me(-1.5,-.3),life:vt}),Kn=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,alpha:e.life/vt,life:e.life-1}),Zn=e=>e.life>0,Ds=(e,n,o)=>{const t=e.createLinearGradient(0,0,0,o);t.addColorStop(0,"#87CEEB"),t.addColorStop(.6,"#B0E0F0"),t.addColorStop(.85,"#d4f0d4"),e.fillStyle=t,e.fillRect(0,0,n,o)},Ws=(e,n,o)=>{const t=o*(1-Se),l=e.createLinearGradient(0,t,0,o);l.addColorStop(0,"#5cb85c"),l.addColorStop(1,"#3a8a3a"),e.fillStyle=l,e.fillRect(0,t,n,o*Se),e.beginPath(),e.moveTo(0,t);for(let s=0;s<=n;s+=20){const a=t+Math.sin(s*.05)*4;e.lineTo(s,a)}e.lineTo(n,t+10),e.lineTo(0,t+10),e.closePath(),e.fillStyle="#5cb85c",e.fill()},Ns=(e,n,o)=>{const t=n-70,l=70,s=1+Math.sin(o*.001)*.05,a=e.createRadialGradient(t,l,0,t,l,Q*2);a.addColorStop(0,p("#FFD700",.3)),a.addColorStop(1,p("#FFD700",0)),e.fillStyle=a,e.fillRect(t-Q*2,l-Q*2,Q*4,Q*4),e.save(),e.translate(t,l),e.rotate(o*3e-4);for(let i=0;i<jn;i++){const r=i/jn*Math.PI*2;e.beginPath(),e.moveTo(Math.cos(r)*Q*s,Math.sin(r)*Q*s),e.lineTo(Math.cos(r)*(Q+Un)*s,Math.sin(r)*(Q+Un)*s),e.strokeStyle=p("#FFD700",.6),e.lineWidth=3,e.stroke()}e.restore(),e.beginPath(),e.arc(t,l,Q*s,0,Math.PI*2),e.fillStyle="#FFD700",e.fill(),e.fillStyle="#E6A800",e.beginPath(),e.arc(t-12,l-8,4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(t+12,l-8,4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(t,l+2,14,.15*Math.PI,.85*Math.PI),e.strokeStyle="#E6A800",e.lineWidth=2.5,e.stroke()},Hs=(e,n,o,t,l,s)=>{const a=o-t,i=Math.sin(l*ze+s)*Qe,r=n+i,f=o-t*.5;e.beginPath(),e.moveTo(n,o),e.quadraticCurveTo(r,f,n+i,a),e.strokeStyle="#2d8a4e",e.lineWidth=Fs,e.lineCap="round",e.stroke()},$s=(e,n,o,t,l,s)=>{const a=Math.sin(l*ze+s)*Qe,i=o-t*.4,r=n+a*.4-2;e.save(),e.translate(r,i),e.rotate(-.6),e.beginPath(),e.ellipse(0,0,Hn,$n,0,0,Math.PI*2),e.fillStyle="#34d399",e.fill(),e.restore();const f=o-t*.65,c=n+a*.65+2;e.save(),e.translate(c,f),e.rotate(.6),e.beginPath(),e.ellipse(0,0,Hn,$n,0,0,Math.PI*2),e.fillStyle="#34d399",e.fill(),e.restore()},Gs=(e,n,o,t)=>{e.save(),e.translate(n,o),e.beginPath(),e.ellipse(0,0,ge*.8,ge*1.2,0,0,Math.PI*2),e.fillStyle="#2d8a4e",e.fill(),e.beginPath(),e.ellipse(0,-ge*.3,ge*.5,ge*.5,0,0,Math.PI*2),e.fillStyle=p(t,.6),e.fill(),e.restore()},js=(e,n,o,t,l,s,a)=>{const i=s?_s:Os,r=i*Ls,f=1+Math.sin(a*.003)*.03;e.save(),e.translate(n,o);for(let c=0;c<l;c++){const h=c/l*Math.PI*2;e.save(),e.rotate(h),e.beginPath(),e.ellipse(0,-i*.7*f,r*f,i*f,0,0,Math.PI*2),e.fillStyle=p(t,.85),e.fill(),e.beginPath(),e.ellipse(0,-i*.55*f,r*.5*f,i*.5*f,0,0,Math.PI*2),e.fillStyle=p("#ffffff",.25),e.fill(),e.restore()}e.beginPath(),e.arc(0,0,Gn*f,0,Math.PI*2),e.fillStyle="#FFD700",e.fill(),e.beginPath(),e.arc(-2,-2,Gn*.5*f,0,Math.PI*2),e.fillStyle=p("#ffffff",.4),e.fill(),e.restore()},Us=(e,n)=>{e.save(),e.globalAlpha=n.alpha;const o=n.size;e.fillStyle="#FFD700",e.beginPath(),e.moveTo(n.x,n.y-o),e.lineTo(n.x+o*.3,n.y-o*.3),e.lineTo(n.x+o,n.y),e.lineTo(n.x+o*.3,n.y+o*.3),e.lineTo(n.x,n.y+o),e.lineTo(n.x-o*.3,n.y+o*.3),e.lineTo(n.x-o,n.y),e.lineTo(n.x-o*.3,n.y-o*.3),e.closePath(),e.fill(),e.restore()},Jn=(e,n,o,t,l)=>{const a=o*(1-Se)+5,i=o*Xe,r=Ke(n.maxDuration,i),f=n.x*.1,c=Math.sin(t*ze+f)*Qe,h=n.x+c,d=a-r;n.maxDuration>0&&Hs(e,n.x,a,r,t,f),n.hasLeaves&&$s(e,n.x,a,r,t,f),n.hasBud&&!n.isOpen&&Gs(e,h,d,n.color),n.isOpen&&js(e,h,d,n.color,n.petalCount,n.isFullBloom,t);for(const u of l)Us(e,u)},Ys=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden"})},Vs=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:M.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:p(M.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},qs=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:p(M.text,.7),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:p(M.surface,.6),borderRadius:"12px",backdropFilter:"blur(4px)"})},Xs=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",fontSize:"1.1rem",fontWeight:"600",color:M.text,margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:p(M.surface,.8),borderRadius:"12px",backdropFilter:"blur(4px)"})},Ks=(e,n)=>{if(e.length===0)return n/2;const o=n/2,t=e.length,l=t%2===0?1:-1,s=Math.ceil(t/2)*Bs,a=o+l*s,i=40;return Math.max(i,Math.min(n-i,a))},Zs=()=>{let e=null,n=null,o=0,t=0,l=null,s=null,a=[],i=0,r=0,f=$e,c=!1,h=!1,d=new Map,u=null,y=0;const C=()=>{if(!u)return;const P=a.length;u.textContent=P===0?"Jardin: 0 fleur":P===1?"Jardin: 1 fleur":`Jardin: ${P} fleurs`},k=()=>{if(!n)return;const P=performance.now()-y;ee(n,o,t),Ds(n,o,t),Ns(n,o,P),Ws(n,o,t);for(let m=0;m<a.length;m++){const b=a[m],T=d.get(m)??[];if(b.hasSparkles&&T.length<Vn&&Math.random()<Yn){const A=t*(1-Se),R=t*Xe,O=Ke(b.maxDuration,R),I=A+5-O;T.push(Xn(b.x,I))}const S=T.map(Kn).filter(Zn);d.set(m,S),Jn(n,b,t,P,S)}if(h&&r>0){const m=qn(i,r,f),b=d.get(-1)??[];if(m.hasSparkles&&b.length<Vn&&Math.random()<Yn){const S=t*(1-Se),A=t*Xe,R=Ke(m.maxDuration,A),O=S+5-R;b.push(Xn(i,O))}const T=b.map(Kn).filter(Zn);d.set(-1,T),Jn(n,m,t,P,T)}l=requestAnimationFrame(k)},F=()=>{if(!e||!n)return;const P=q(e,n);o=P.width,t=P.height};return{id:"flower",name:"Faire Pousser",description:"Fais pousser des fleurs avec ta voix !",mount:P=>{const m=E("div",{});Ys(m);const b=E("button",{},"← Accueil");Vs(b),b.addEventListener("click",()=>{window.location.hash="#menu"});const T=E("p",{},"Faire Pousser");qs(T),u=E("p",{},"Jardin: 0 fleur"),Xs(u),m.appendChild(b),m.appendChild(T),m.appendChild(u),P.appendChild(m);const S=J(m);e=S.canvas,n=S.ctx,o=S.width,t=S.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),s=F,window.addEventListener("resize",s),a=[],d=new Map,r=0,f=$e,c=!1,h=!1,i=o/2,y=performance.now(),C(),k()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),s&&(window.removeEventListener("resize",s),s=null),e=null,n=null,u=null,a=[],d=new Map,r=0,c=!1,h=!1,o=0,t=0},update:P=>{const m=P.isVoicing;if(m)c||(h=!0,i=Ks(a,o),r=0,f=$e,d.delete(-1)),r=P.duration,P.vowel!==null&&Y[P.vowel]&&(f=Y[P.vowel]);else if(c&&h&&r>.1){const b=qn(i,r,f);a.push(b);const T=d.get(-1)??[];d.set(a.length-1,T),d.delete(-1),h=!1,r=0,C()}else m||(h=!1,r=0,d.delete(-1));c=m}}},Ge=20,Js=130,Qs=.72,zs=100,xs=8,ei=.003,Qn=2,zn=3,oe=3,be=4,ni=40,Tt=80,ti=.12,xn=["#ef4444","#f59e0b","#22c55e","#3b82f6","#8b5cf6","#ec4899","#f97316","#06b6d4","#FFD700","#ff6b6b"],oi=5,li=60,ai=2e3,si=-1.2,et=.3,ii="#87CEEB",ri="#B0E0F0",di="#d4f0d4",fi="#ffffff",x=(e,n)=>e+Math.random()*(n-e),pe=(e,n,o)=>Math.max(n,Math.min(o,e)),je=e=>{if(e<=0)return Ge;const n=pe(e/be,0,1);return Ge+n*(Js-Ge)},ci=(e,n)=>{if(e<oe)return n;const o=pe((e-oe)/(be-oe),0,1),t=parseInt(n.slice(1,3),16),l=parseInt(n.slice(3,5),16),s=parseInt(n.slice(5,7),16),a=Math.round(t+(240-t)*o),i=Math.round(l+(80-l)*o),r=Math.round(s+(80-s)*o);return`rgb(${a}, ${i}, ${r})`},hi=(e,n)=>({x:e,y:n,vx:x(-6,6),vy:x(-10,-2),size:x(4,10),color:xn[Math.floor(Math.random()*xn.length)],life:Tt,gravity:ti,rotation:x(0,Math.PI*2),rotationSpeed:x(-.15,.15),shape:["circle","rect","star"][Math.floor(Math.random()*3)]}),ui=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,vy:e.vy+e.gravity,vx:e.vx*.99,life:e.life-1,rotation:e.rotation+e.rotationSpeed}),pi=e=>e.life>0,gi=(e,n,o)=>{const t=x(0,Math.PI*2),l=x(o*.6,o*1.2);return{x:e+Math.cos(t)*l,y:n+Math.sin(t)*l,size:x(3,7),alpha:1,angle:t,speed:x(.3,.8)}},mi=e=>({...e,x:e.x+Math.cos(e.angle)*e.speed,y:e.y+Math.sin(e.angle)*e.speed,alpha:e.alpha-1/li}),bi=e=>e.alpha>0,Si=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,alpha:e.alpha-.004,stringAngle:e.stringAngle+.02}),yi=e=>e.alpha>0&&e.y+e.radiusY>-50,wi=(e,n,o)=>{const t=e.createLinearGradient(0,0,0,o);t.addColorStop(0,ii),t.addColorStop(.6,ri),t.addColorStop(1,di),e.fillStyle=t,e.fillRect(0,0,n,o)},Ue=(e,n,o,t)=>{e.save(),e.translate(n,o),e.scale(t,t),e.fillStyle=p(fi,.6);const l=[{cx:0,cy:0,r:25},{cx:-22,cy:5,r:20},{cx:22,cy:5,r:20},{cx:-10,cy:-12,r:18},{cx:12,cy:-10,r:16}];for(const s of l)e.beginPath(),e.arc(s.cx,s.cy,s.r,0,Math.PI*2),e.fill();e.restore()},vi=(e,n,o)=>{const t=o*.01;Ue(e,(n*.15+t)%(n+100)-50,60,1),Ue(e,(n*.55+t*.7)%(n+100)-50,90,.8),Ue(e,(n*.85+t*.5)%(n+100)-50,45,1.2)},Ti=(e,n,o)=>{const t=o*.88,l=e.createLinearGradient(0,t,0,o);l.addColorStop(0,"#5cb85c"),l.addColorStop(1,"#3a8a3a"),e.fillStyle=l,e.fillRect(0,t,n,o-t),e.beginPath(),e.moveTo(0,t);for(let s=0;s<=n;s+=20){const a=t+Math.sin(s*.05)*4;e.lineTo(s,a)}e.lineTo(n,t+10),e.lineTo(0,t+10),e.closePath(),e.fillStyle="#5cb85c",e.fill()},Pt=(e,n,o,t,l,s,a)=>{const i=(n+t)/2+Math.sin(s*ei)*xs+a,r=(o+l)/2;e.beginPath(),e.moveTo(n,o),e.quadraticCurveTo(i,r,t,l),e.strokeStyle=p(M.text,.5),e.lineWidth=2,e.lineCap="round",e.stroke()},Ct=(e,n,o,t,l,s,a)=>{e.save(),e.translate(n,o),e.rotate(a*.05),e.beginPath(),e.ellipse(0,0,t,l,0,0,Math.PI*2);const i=e.createRadialGradient(-t*.3,-l*.3,t*.1,0,0,l);i.addColorStop(0,p("#ffffff",.6)),i.addColorStop(.3,s),i.addColorStop(1,p(s,.85)),e.fillStyle=i,e.fill(),e.beginPath(),e.ellipse(-t*.3,-l*.35,t*.2,l*.15,-.4,0,Math.PI*2),e.fillStyle=p("#ffffff",.4),e.fill(),e.beginPath(),e.moveTo(-4,l),e.lineTo(0,l+8),e.lineTo(4,l),e.closePath(),e.fillStyle=s,e.fill(),e.restore()},Pi=(e,n,o,t,l)=>{const s=1+Math.sin(l*.008)*.15,a=t*1.5*s,i=e.createRadialGradient(n,o,t*.8,n,o,a);i.addColorStop(0,p(M.green,.25)),i.addColorStop(1,p(M.green,0)),e.fillStyle=i,e.beginPath(),e.arc(n,o,a,0,Math.PI*2),e.fill()},Ci=(e,n,o,t,l)=>{e.save(),e.globalAlpha=l,e.fillStyle="#FFD700",e.beginPath(),e.moveTo(n,o-t),e.lineTo(n+t*.3,o-t*.3),e.lineTo(n+t,o),e.lineTo(n+t*.3,o+t*.3),e.lineTo(n,o+t),e.lineTo(n-t*.3,o+t*.3),e.lineTo(n-t,o),e.lineTo(n-t*.3,o-t*.3),e.closePath(),e.fill(),e.restore()},Mi=(e,n)=>{const o=pe(n.life/Tt,0,1);if(e.save(),e.translate(n.x,n.y),e.rotate(n.rotation),e.globalAlpha=o,n.shape==="circle")e.beginPath(),e.arc(0,0,n.size/2,0,Math.PI*2),e.fillStyle=n.color,e.fill();else if(n.shape==="rect")e.fillStyle=n.color,e.fillRect(-n.size/2,-n.size/4,n.size,n.size/2);else{e.fillStyle=n.color,e.beginPath();for(let t=0;t<5;t++){const l=t*2*Math.PI/5-Math.PI/2,s=l+Math.PI/5,a=n.size/2,i=n.size/4;t===0?e.moveTo(Math.cos(l)*a,Math.sin(l)*a):e.lineTo(Math.cos(l)*a,Math.sin(l)*a),e.lineTo(Math.cos(s)*i,Math.sin(s)*i)}e.closePath(),e.fill()}e.restore()},Ai=(e,n,o)=>{e.save(),e.globalAlpha=n.alpha,Ct(e,n.x,n.y,n.radiusX,n.radiusY,n.color,0);const t=n.x+Math.sin(n.stringAngle)*15,l=n.y+n.radiusY+8+zs*.6;Pt(e,n.x,n.y+n.radiusY+8,t,l,o,Math.sin(n.stringAngle)*5),e.restore()},Ei=(e,n,o,t)=>{const l=1+t*.02,s=pe(1-t/40,0,1);s<=0||(e.save(),e.translate(n,o-20-t*1.5),e.scale(l,l),e.globalAlpha=s,e.font="bold 28px inherit",e.textAlign="center",e.textBaseline="middle",e.fillStyle="#FFD700",e.strokeStyle=p("#ffffff",.8),e.lineWidth=3,e.strokeText("POP!",0,0),e.fillText("POP!",0,0),e.restore())},Ii=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden"})},Ri=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:M.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:p(M.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},ki=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:p(M.text,.7),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:p(M.surface,.6),borderRadius:"12px",backdropFilter:"blur(4px)"})},Fi=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",fontSize:"1.1rem",fontWeight:"600",color:M.text,margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:p(M.surface,.8),borderRadius:"12px",backdropFilter:"blur(4px)"})},Oi=()=>{let e=null,n=null,o=0,t=0,l=null,s=null,a="idle",i=0,r=M.secondary,f=!1,c=0,h=null,d=[],u=[],y=[],C=0,k=0,F=0,g=!1,w=null,v=0;const P=()=>o/2,m=()=>t*Qs,b=()=>t*.88,T=()=>{h&&(h.textContent=c===0?"Ballons: 0":`Ballons: ${c}`)},S=()=>{w!==null&&clearTimeout(w),w=setTimeout(()=>{a="idle",i=0,g=!1,w=null},ai)},A=(D,W)=>{a="popped",k=D,F=W,C=0,g=!0;for(let H=0;H<ni;H++)d.push(hi(D,W));S()},R=(D,W,H,N)=>{a="floating",c+=1,T(),y.push({x:D,y:W,radiusX:H,radiusY:N,color:r,alpha:1,vx:x(-et,et),vy:si,stringAngle:0}),S()},O=()=>{if(!n)return;v+=1,ee(n,o,t),wi(n,o,t),vi(n,o,v),Ti(n,o,t);const D=P(),W=m(),H=b();y=y.map(Si).filter(yi);for(const N of y)Ai(n,N,v);if(a==="inflating"||a==="idle"){const N=je(i),U=N*.85,ie=N,ne=W-ie;let re=0;if(i>=oe){const le=pe((i-oe)/(be-oe),0,1);re=Math.sin(v*.3)*le*12}const Rt=ci(i,r);i>=Qn&&i<zn&&Pi(n,D+re*.5,ne,N,v);const kt=W+8;Pt(n,D+re*.3,kt,D,H,v,re*.2),Ct(n,D+re*.5,ne,U,ie,Rt,re),i>=Qn&&i<zn&&u.length<oi&&Math.random()<.15&&u.push(gi(D,ne,N)),u=u.map(mi).filter(bi);for(const le of u)Ci(n,le.x,le.y,le.size,le.alpha);if(i>=oe){const le=pe((i-oe)/(be-oe),0,1);n.save(),n.globalAlpha=le*.4,n.strokeStyle=p("#ffffff",.6),n.lineWidth=1.5;for(let ke=0;ke<3;ke++){const en=-.5+ke*.5,nn=D+re*.5+Math.cos(en)*U*.7,tn=ne+Math.sin(en)*ie*.5;n.beginPath(),n.moveTo(nn-5,tn-3),n.lineTo(nn+5,tn+3),n.stroke()}n.restore()}}d=d.map(ui).filter(pi);for(const N of d)Mi(n,N);g&&(C+=1,Ei(n,k,F,C),C>50&&(g=!1)),l=requestAnimationFrame(O)},I=()=>{if(!e||!n)return;const D=q(e,n);o=D.width,t=D.height};return{id:"balloon",name:"Ballon",description:"Gonfle le ballon sans le faire éclater",mount:D=>{const W=E("div",{});Ii(W);const H=E("button",{},"← Accueil");Ri(H),H.addEventListener("click",()=>{window.location.hash="#menu"});const N=E("p",{},"Ballon");ki(N),h=E("p",{},"Ballons: 0"),Fi(h),W.appendChild(H),W.appendChild(N),W.appendChild(h),D.appendChild(W);const U=J(W);e=U.canvas,n=U.ctx,o=U.width,t=U.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),s=I,window.addEventListener("resize",s),a="idle",i=0,r=M.secondary,f=!1,c=0,d=[],u=[],y=[],g=!1,C=0,v=0,T(),O()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),s&&(window.removeEventListener("resize",s),s=null),w!==null&&(clearTimeout(w),w=null),e=null,n=null,h=null,d=[],u=[],y=[],a="idle",i=0,f=!1,c=0,g=!1,v=0,o=0,t=0},update:D=>{const W=D.isVoicing;if(W){if(f||a==="idle"&&(a="inflating",i=0,u=[],r=M.secondary),a==="inflating"&&(i=D.duration,D.vowel!==null&&Y[D.vowel]&&(r=Y[D.vowel]),i>=be)){const H=je(i),N=m()-H;A(P(),N)}}else if(f&&a==="inflating"&&i>.1){const H=je(i),N=H*.85,U=H,ie=m()-U;R(P(),ie,N,U)}else!W&&a==="inflating"&&(a="idle",i=0,u=[]);f=W}}},ve=.1,_i=8,Li=20,Bi=500,Di=8,Wi=35,Ni=-2.2,Hi=.008,$i=.06,Gi=20,ji=.08,Ui=.06,Yi="#1a6b8a",Mt="#0a2a3a",Vi="#c2a66b",qi="#a08850",Xi="#2d8a4e",Ki="#1d6a3e",Zi={a:"fish",e:"seahorse",i:"jellyfish",o:"starfish",u:"octopus",ɛ:"fish",y:"jellyfish"},Ji={a:1.8,e:.5,i:.3,o:0,u:.6,ɛ:1.2,y:.4},$=(e,n)=>e+Math.random()*(n-e),Qi=(e,n,o)=>{const t=e.createLinearGradient(0,0,0,o);t.addColorStop(0,Yi),t.addColorStop(1,Mt),e.fillStyle=t,e.fillRect(0,0,n,o)},zi=(e,n,o)=>{const t=o*(1-ve),l=e.createLinearGradient(0,t,0,o);l.addColorStop(0,Vi),l.addColorStop(1,qi),e.beginPath(),e.moveTo(0,o);for(let s=0;s<=n;s+=10){const a=t+Math.sin(s*.03)*3+Math.sin(s*.07)*2;e.lineTo(s,a)}e.lineTo(n,o),e.closePath(),e.fillStyle=l,e.fill()},nt=(e,n)=>{const o=[],t=n*(1-ve);for(let l=0;l<Gi;l++){const s=Math.floor($(100,170));o.push({x:$(10,e-10),y:$(t+5,n-5),rx:$(3,7),ry:$(2,4),color:`rgb(${s}, ${s-10}, ${s-20})`})}return o},xi=(e,n)=>{for(const o of n)e.beginPath(),e.ellipse(o.x,o.y,o.rx,o.ry,0,0,Math.PI*2),e.fillStyle=o.color,e.fill()},tt=(e,n)=>{const o=[];for(let t=0;t<_i;t++)o.push({x:$(30,e-30),height:$(80,400),segments:Math.floor($(6,12)),phaseOffset:$(0,Math.PI*2)});return o},er=(e,n,o,t,l)=>{const s=o*(1-ve);for(const a of n){const i=a.height/a.segments;e.beginPath(),e.moveTo(a.x,s);for(let r=1;r<=a.segments;r++){const f=r/a.segments,c=Math.sin(t*.002+a.phaseOffset+r*.5)*(20*f)*l,h=a.x+c,d=s-r*i;e.lineTo(h,d)}e.lineWidth=4,e.strokeStyle=Xi,e.lineCap="round",e.lineJoin="round",e.stroke();for(let r=2;r<a.segments;r+=2){const f=r/a.segments,c=Math.sin(t*.002+a.phaseOffset+r*.5)*(20*f)*l,h=a.x+c,d=s-r*i,u=r%4===0?1:-1;e.beginPath(),e.ellipse(h+u*8,d,10,4,u*.4,0,Math.PI*2),e.fillStyle=Ki,e.fill()}}},nr=(e,n,o)=>({x:$(e*.15,e*.85),y:n*(1-ve)-5,radius:Di+o*Wi,alpha:.6,vy:Ni-o*1.5,wobbleOffset:$(0,Math.PI*2),wobbleSpeed:$(.03,.06)}),tr=(e,n)=>({...e,y:e.y+e.vy,x:e.x+Math.sin(n*e.wobbleSpeed+e.wobbleOffset)*.5,alpha:e.alpha-Hi}),or=e=>e.alpha>0&&e.y>-e.radius,lr=(e,n,o)=>{e.save(),e.globalAlpha=n.alpha*o,e.beginPath(),e.arc(n.x,n.y,n.radius,0,Math.PI*2),e.fillStyle=p("#a5d8ff",.4),e.fill(),e.strokeStyle=p("#74c0fc",.6),e.lineWidth=1,e.stroke(),e.beginPath(),e.arc(n.x-n.radius*.3,n.y-n.radius*.3,n.radius*.25,0,Math.PI*2),e.fillStyle=p("#ffffff",.7),e.fill(),e.restore()},ar=(e,n,o,t,l,s,a)=>{const i=s?1:-1;e.save(),e.beginPath(),e.ellipse(n,o,t*1.2,t*.7,0,0,Math.PI*2),e.fillStyle=l,e.fill(),e.beginPath();const r=n-i*t*1.2,f=Math.sin(a*.008+n)*3;e.moveTo(r,o),e.lineTo(r-i*t*.7,o-t*.5+f),e.lineTo(r-i*t*.7,o+t*.5+f),e.closePath(),e.fillStyle=l,e.fill();const c=n+i*t*.5,h=o-t*.15;e.beginPath(),e.arc(c,h,t*.18,0,Math.PI*2),e.fillStyle="#ffffff",e.fill(),e.beginPath(),e.arc(c+i*t*.05,h,t*.1,0,Math.PI*2),e.fillStyle="#1a1a2e",e.fill(),e.beginPath(),e.moveTo(n-i*t*.2,o-t*.7),e.lineTo(n+i*t*.3,o-t*.7),e.lineTo(n+i*t*.1,o-t*.35),e.closePath(),e.fillStyle=p(l,.7),e.fill(),e.restore()},sr=(e,n,o,t,l,s)=>{e.save(),e.beginPath(),e.arc(n,o-t*.8,t*.4,0,Math.PI*2),e.fillStyle=l,e.fill(),e.beginPath(),e.ellipse(n+t*.5,o-t*.8,t*.25,t*.12,0,0,Math.PI*2),e.fillStyle=l,e.fill();const a=Math.sin(s*.003+n*.1)*3;for(let f=0;f<6;f++){const c=f/5,h=n+a*c,d=o-t*.5+f*t*.3,u=t*(.35-c*.08);e.beginPath(),e.arc(h,d,u,0,Math.PI*2),e.fillStyle=p(l,1-c*.2),e.fill()}e.beginPath();const i=n+a*.8,r=o+t*1;e.arc(i+t*.2,r,t*.2,0,Math.PI*1.5),e.strokeStyle=l,e.lineWidth=3,e.lineCap="round",e.stroke(),e.beginPath(),e.arc(n+t*.15,o-t*.9,t*.08,0,Math.PI*2),e.fillStyle="#1a1a2e",e.fill();for(let f=0;f<3;f++)e.beginPath(),e.arc(n-t*.1+f*t*.15,o-t*1.2,t*.06,0,Math.PI*2),e.fillStyle=p(l,.7),e.fill();e.restore()},ir=(e,n,o,t,l,s)=>{e.save();const a=1+Math.sin(s*.005+n)*.1;e.beginPath(),e.ellipse(n,o,t*.8*a,t*.5*a,0,Math.PI,0),e.fillStyle=p(l,.6),e.fill(),e.beginPath(),e.ellipse(n,o+t*.05,t*.5*a,t*.3*a,0,Math.PI,0),e.fillStyle=p(l,.3),e.fill();const i=6;for(let r=0;r<i;r++){const f=n-t*.6+r/(i-1)*t*1.2;e.beginPath(),e.moveTo(f,o);const c=t*(.8+Math.sin(r*1.5)*.3);for(let h=1;h<=4;h++){const d=h/4,u=f+Math.sin(s*.004+r*.8+h*.7)*(t*.15),y=o+d*c;e.lineTo(u,y)}e.strokeStyle=p(l,.5),e.lineWidth=2,e.lineCap="round",e.stroke()}for(let r=0;r<3;r++){const f=n-t*.3+r*t*.3,c=o-t*.15;e.beginPath(),e.arc(f,c,t*.05,0,Math.PI*2),e.fillStyle=p("#ffffff",.5),e.fill()}e.restore()},rr=(e,n,o,t,l)=>{e.save();const s=5,a=t*.9,i=a*.4;e.beginPath();for(let r=0;r<s*2;r++){const f=r%2===0?a:i,c=Math.PI*r/s-Math.PI/2,h=n+Math.cos(c)*f,d=o+Math.sin(c)*f;r===0?e.moveTo(h,d):e.lineTo(h,d)}e.closePath(),e.fillStyle=l,e.fill(),e.beginPath(),e.arc(n,o,t*.15,0,Math.PI*2),e.fillStyle=p("#ffffff",.4),e.fill();for(let r=0;r<s;r++){const f=Math.PI*2*r/s-Math.PI/2,c=a*.55,h=n+Math.cos(f)*c,d=o+Math.sin(f)*c;e.beginPath(),e.arc(h,d,t*.06,0,Math.PI*2),e.fillStyle=p("#ffffff",.35),e.fill()}e.restore()},dr=(e,n,o,t,l,s)=>{e.save(),e.beginPath(),e.arc(n,o-t*.3,t*.6,0,Math.PI*2),e.fillStyle=l,e.fill(),e.beginPath(),e.arc(n-t*.2,o-t*.4,t*.12,0,Math.PI*2),e.fillStyle="#ffffff",e.fill(),e.beginPath(),e.arc(n+t*.2,o-t*.4,t*.12,0,Math.PI*2),e.fillStyle="#ffffff",e.fill(),e.beginPath(),e.arc(n-t*.18,o-t*.38,t*.06,0,Math.PI*2),e.fillStyle="#1a1a2e",e.fill(),e.beginPath(),e.arc(n+t*.22,o-t*.38,t*.06,0,Math.PI*2),e.fillStyle="#1a1a2e",e.fill();const a=4;for(let i=0;i<a;i++){const r=n-t*.45+i/(a-1)*t*.9;e.beginPath(),e.moveTo(r,o+t*.1);for(let f=1;f<=5;f++){const c=f/5,h=r+Math.sin(s*.004+i*1.2+f*.8)*(t*.2),d=o+t*.1+c*t*.9;e.lineTo(h,d)}e.strokeStyle=l,e.lineWidth=3,e.lineCap="round",e.stroke()}e.beginPath(),e.arc(n,o-t*.15,t*.15,.1,Math.PI-.1),e.strokeStyle=p("#1a1a2e",.5),e.lineWidth=1.5,e.stroke(),e.restore()},fr=(e,n,o,t)=>{switch(e.save(),e.globalAlpha=n.alpha*t,n.kind){case"fish":ar(e,n.x,n.y,n.size,n.color,n.vx>0,o);break;case"seahorse":sr(e,n.x,n.y,n.size,n.color,o);break;case"jellyfish":ir(e,n.x,n.y,n.size,n.color,o);break;case"starfish":rr(e,n.x,n.y,n.size,n.color);break;case"octopus":dr(e,n.x,n.y,n.size,n.color,o);break}e.restore()},cr=(e,n,o)=>{const t=Zi[e]??"fish",l=Y[e]??"#6366f1",s=Ji[e]??1,a=o*(1-ve),i=$(14,22),r=Math.random()>.5?1:-1,f=r>0?-i*2:n+i*2;let c;switch(t){case"starfish":c=a-i*.5;break;case"jellyfish":c=$(o*.15,o*.5);break;case"seahorse":c=$(o*.3,o*.6);break;case"octopus":c=$(o*.5,a-i*1.5);break;default:c=$(o*.15,a-i*2)}return{x:t==="starfish"?$(i*2,n-i*2):f,y:c,vx:t==="starfish"?0:s*r,color:l,kind:t,age:0,alpha:t==="starfish"?0:1,size:i,phaseOffset:$(0,Math.PI*2)}},hr=(e,n,o)=>{const t=e.age+1,l=e.kind!=="starfish"?Math.sin(n*.003+e.phaseOffset)*.3:0;let s=e.x+e.vx,a=e.vx;e.kind!=="starfish"&&(s<-e.size*3?(s=-e.size*3,a=Math.abs(e.vx)):s>o+e.size*3&&(s=o+e.size*3,a=-Math.abs(e.vx)));let i=e.alpha;return e.kind==="starfish"&&e.alpha<1&&(i=Math.min(1,e.alpha+.02)),{...e,x:s,y:e.y+l,vx:a,age:t,alpha:i}},ur=(e,n)=>e.kind==="starfish"?!0:e.x>-e.size*4&&e.x<n+e.size*4,pr=(e,n)=>e.length<=n?e:e.map((o,t)=>t<e.length-n?{...o,alpha:o.alpha-$i}:o).filter(o=>o.alpha>0),gr=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:Mt})},mr=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:"#7dd3fc",cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:p("#0a2a3a",.7),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},br=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:p("#7dd3fc",.7),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},Sr=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",fontSize:"1.1rem",fontWeight:"600",color:"#7dd3fc",margin:"0",padding:"8px 12px",fontFamily:"inherit",borderRadius:"8px",backgroundColor:p("#0a2a3a",.7),backdropFilter:"blur(4px)",pointerEvents:"none"})},yr=()=>{let e=null,n=null,o=0,t=0,l=null,s=null,a=[],i=[],r=[],f=[],c=null,h=0,d=0,u=0,y=0,C=!1;const k=4,F=()=>{if(!e||!n)return;const b=q(e,n);o=b.width,t=b.height,r=tt(o),f=nt(o,t)},g=()=>{if(n){ee(n,o,t),Qi(n,o,t),zi(n,o,t),xi(n,f),er(n,r,t,u,y);for(const b of i)fr(n,b,u,y);for(const b of a)lr(n,b,y)}},w=()=>{u=performance.now(),y=C?Math.min(1,y+ji):Math.max(0,y-Ui),a=a.map(b=>tr(b,u)).filter(or),i=i.map(b=>hr(b,u,o)).filter(b=>ur(b,o)),i=pr(i,Li),c&&(c.textContent=`${i.length}`),g(),l=requestAnimationFrame(w)};return{id:"aquarium",name:"Aquarium",description:"Crée ton monde sous-marin avec ta voix",mount:b=>{const T=E("div",{});gr(T);const S=E("button",{},"← Accueil");mr(S),S.addEventListener("click",()=>{window.location.hash="#menu"});const A=E("p",{},"Aquarium");br(A),c=E("p",{},"0"),Sr(c),T.appendChild(S),T.appendChild(A),T.appendChild(c),b.appendChild(T);const R=J(T);e=R.canvas,n=R.ctx,o=R.width,t=R.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),r=tt(o),f=nt(o,t),s=F,window.addEventListener("resize",s),a=[],i=[],h=0,d=0,u=0,w()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),s&&(window.removeEventListener("resize",s),s=null),e=null,n=null,c=null,o=0,t=0,a=[],i=[],r=[],f=[],h=0,d=0,u=0,y=0,C=!1},update:b=>{C=b.isVoicing;const T=performance.now();b.isVoicing?(d+=1,d>=k&&(d=0,a.push(nr(o,t,b.volume)))):d=0,b.isVoicing&&b.vowel!==null&&T-h>=Bi&&(i.push(cr(b.vowel,o,t)),h=T)}}},Z=.3,wr=.035,xe=.3,ye=.18,vr=120,Tr=.3,ot=.03,z=40,lt=12,Ye={summer:{skyTop:"#1E90FF",skyBottom:"#87CEEB",groundTop:"#4CAF50",groundBottom:"#2E7D32",treeCrown:"#2E8B57",treeHighlight:"#3CB371",label:"Été"},autumn:{skyTop:"#E8843C",skyBottom:"#F4A460",groundTop:"#8B6914",groundBottom:"#6B4E0A",treeCrown:"#D2691E",treeHighlight:"#E25822",label:"Automne"},winter:{skyTop:"#B0B8C8",skyBottom:"#D9DEE8",groundTop:"#E8E8F0",groundBottom:"#CFCFDF",treeCrown:"#8B7355",treeHighlight:"#A08060",label:"Hiver"},spring:{skyTop:"#89CFF0",skyBottom:"#B0E2FF",groundTop:"#5DBB63",groundBottom:"#3E9142",treeCrown:"#FFB7C5",treeHighlight:"#FFC0CB",label:"Printemps"}},Pr={a:"summer",o:"autumn",i:"winter",u:"spring"},Ve=(e,n,o)=>e+(n-e)*o,Ze=(e,n,o)=>Math.min(o,Math.max(n,e)),_=(e,n)=>e+Math.random()*(n-e),at=e=>({r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16)}),Cr=(e,n,o)=>{const t=l=>Ze(Math.round(l),0,255).toString(16).padStart(2,"0");return`#${t(e)}${t(n)}${t(o)}`},ue=(e,n,o)=>{const t=at(e),l=at(n);return Cr(Ve(t.r,l.r,o),Ve(t.g,l.g,o),Ve(t.b,l.b,o))},Mr=(e,n,o)=>({skyTop:ue(e.skyTop,n.skyTop,o),skyBottom:ue(e.skyBottom,n.skyBottom,o),groundTop:ue(e.groundTop,n.groundTop,o),groundBottom:ue(e.groundBottom,n.groundBottom,o),treeCrown:ue(e.treeCrown,n.treeCrown,o),treeHighlight:ue(e.treeHighlight,n.treeHighlight,o)}),Ar=e=>({skyTop:e.skyTop,skyBottom:e.skyBottom,groundTop:e.groundTop,groundBottom:e.groundBottom,treeCrown:e.treeCrown,treeHighlight:e.treeHighlight}),Me={skyTop:"#7CA8D0",skyBottom:"#A8C8E8",groundTop:"#6B8E6B",groundBottom:"#4A6B4A",treeCrown:"#5A8A5A",treeHighlight:"#6B9B6B"},Er=(e,n,o)=>{const l=n*(1-Z)-n*xe-n*ye,s=["#D2691E","#CD853F","#B22222","#DAA520","#CC5500"];return{x:e*.5+_(-e*.15,e*.15),y:l+_(0,n*ye),vx:_(-1.5,1.5)*(1+o),vy:_(.3,1.5),size:_(5,10),rotation:_(0,Math.PI*2),rotationSpeed:_(-.05,.05),alpha:1,color:s[Math.floor(Math.random()*s.length)],life:0,maxLife:_(120,250)}},Ir=(e,n,o)=>{const t=.3+o*.7;return{x:_(-20,e+20),y:_(-30,-5),vx:_(-.8,.8)*t,vy:_(.5,2.5)*t,size:_(2,6),rotation:0,rotationSpeed:0,alpha:_(.6,1),color:"#FFFFFF",life:0,maxLife:_(200,400)}},Rr=(e,n,o)=>{const l=n*(1-Z)-n*xe-n*ye,s=["#FFB7C5","#FF69B4","#FFC0CB","#FFD1DC","#FADADD"];return{x:e*.5+_(-e*.15,e*.15),y:l+_(0,n*ye*.7),vx:_(-1,2)*(.5+o*.5),vy:_(-.5,1.2),size:_(4,8),rotation:_(0,Math.PI*2),rotationSpeed:_(-.04,.04),alpha:1,color:s[Math.floor(Math.random()*s.length)],life:0,maxLife:_(150,300)}},kr=(e,n,o)=>{const t=_(n*.1,n*.6);return{x:_(0,e),y:t,vx:_(-.2,.2),vy:_(-1,-.3)*(.5+o),size:_(2,5),rotation:0,rotationSpeed:0,alpha:_(.15,.4)*o,color:"#FFD700",life:0,maxLife:_(60,120)}},Fr=(e,n,o)=>{const t=n*(1-Z),l=["#FF6B9D","#C084FC","#60A5FA","#FBBF24","#FB923C"];return{x:_(e*.1,e*.9),y:t-_(20,120),vx:_(-1,1),vy:_(-1,.5),size:_(6,10),rotation:0,rotationSpeed:.1,alpha:1,color:l[Math.floor(Math.random()*l.length)],life:0,maxLife:_(200,400)}},Or=(e,n)=>{const o=n*(1-Z),t=["#FF6B9D","#FBBF24","#A78BFA","#F87171","#34D399"];return{x:_(e*.05,e*.95),y:o+_(5,n*Z*.5),vx:0,vy:0,size:_(4,8),rotation:_(0,Math.PI*2),rotationSpeed:0,alpha:1,color:t[Math.floor(Math.random()*t.length)],life:0,maxLife:9999}},_r=(e,n)=>{const o=e.life+1,t=o/e.maxLife,l=.7,s=n==="spring"&&e.vy<=.5&&e.size>=6,a=s?e.vx+Math.sin(o*.1)*.15:e.vx+_(-.05,.05),i=s?e.vy+Math.cos(o*.08)*.1:e.vy;return{...e,x:e.x+a,y:e.y+i,vx:a*.99,vy:i,rotation:e.rotation+e.rotationSpeed,alpha:t>l?e.alpha*(1-(t-l)/(1-l)):e.alpha,life:o}},Lr=e=>e.life<e.maxLife&&e.alpha>.01,Br=(e,n,o,t)=>{const l=e.createLinearGradient(0,0,0,o*(1-Z));l.addColorStop(0,t.skyTop),l.addColorStop(1,t.skyBottom),e.fillStyle=l,e.fillRect(0,0,n,o*(1-Z)+2)},Dr=(e,n,o,t,l)=>{const s=o*(1-Z),a=e.createLinearGradient(0,s,0,o);a.addColorStop(0,t.groundTop),a.addColorStop(1,t.groundBottom),e.fillStyle=a,e.fillRect(0,s,n,o*Z),e.beginPath(),e.moveTo(0,s);for(let i=0;i<=n;i+=15){const r=Math.sin(i*.03+l*5e-4)*3;e.lineTo(i,s+r)}e.lineTo(n,s+8),e.lineTo(0,s+8),e.closePath(),e.fillStyle=t.groundTop,e.fill()},Wr=(e,n,o,t,l)=>{const s=n-80,a=70,i=1+Math.sin(o*.001)*.04,r=t==="winter"?.3:t==="autumn"?.7:1,f=t==="autumn"?"#FF8C42":"#FFD700",c=t==="summer"?.5+l*.5:.3;e.save(),e.globalAlpha=r;const h=e.createRadialGradient(s,a,0,s,a,z*2.5);h.addColorStop(0,p(f,.3)),h.addColorStop(1,p(f,0)),e.fillStyle=h,e.fillRect(s-z*3,a-z*3,z*6,z*6),e.save(),e.translate(s,a),e.rotate(o*3e-4);const d=15+l*15;for(let u=0;u<lt;u++){const y=u/lt*Math.PI*2;e.beginPath(),e.moveTo(Math.cos(y)*z*i,Math.sin(y)*z*i),e.lineTo(Math.cos(y)*(z+d)*i,Math.sin(y)*(z+d)*i),e.strokeStyle=p(f,c),e.lineWidth=3,e.stroke()}e.restore(),e.beginPath(),e.arc(s,a,z*i,0,Math.PI*2),e.fillStyle=f,e.fill(),e.restore()},Nr=(e,n,o,t,l,s,a)=>{const i=o*(1-Z),r=n*.5,f=n*wr,c=o*xe,h=i-c,d=o*ye,u=Math.sin(s*.0015)*(2+a*4);e.save(),e.beginPath(),e.moveTo(r-f/2,i),e.lineTo(r-f/3+u*.3,h+d*.3),e.lineTo(r+f/3+u*.3,h+d*.3),e.lineTo(r+f/2,i),e.closePath();const y=e.createLinearGradient(r-f/2,i,r+f/2,i);if(y.addColorStop(0,"#5D4037"),y.addColorStop(.5,"#795548"),y.addColorStop(1,"#5D4037"),e.fillStyle=y,e.fill(),l==="winter"){const C="#6D4C41";e.strokeStyle=C,e.lineWidth=3,e.lineCap="round",e.beginPath(),e.moveTo(r+u*.4,h+d*.5),e.quadraticCurveTo(r-d*.4+u*.5,h+d*.1,r-d*.7+u*.6,h-d*.2),e.stroke(),e.beginPath(),e.moveTo(r+u*.4,h+d*.4),e.quadraticCurveTo(r+d*.3+u*.5,h+d*.05,r+d*.65+u*.6,h-d*.15),e.stroke(),e.beginPath(),e.moveTo(r+u*.5,h+d*.2),e.quadraticCurveTo(r+d*.1+u*.6,h-d*.3,r-d*.1+u*.7,h-d*.6),e.stroke(),e.lineWidth=2,e.beginPath(),e.moveTo(r-d*.5+u*.55,h-d*.05),e.lineTo(r-d*.65+u*.6,h-d*.35),e.stroke(),e.beginPath(),e.moveTo(r+d*.45+u*.55,h),e.lineTo(r+d*.55+u*.6,h-d*.3),e.stroke()}if(l!=="winter"){const C=h-d*.2,k=r+u*.5;e.beginPath(),e.ellipse(k+3,C+5,d*1.05,d*.85,0,0,Math.PI*2),e.fillStyle=p("#000000",.08),e.fill();const F=(g,w,v,P,m)=>{e.beginPath(),e.ellipse(g,w,v,P,0,0,Math.PI*2),e.fillStyle=m,e.fill()};F(k,C,d,d*.8,t.treeCrown),F(k-d*.5,C+d*.1,d*.6,d*.55,t.treeCrown),F(k+d*.5,C+d*.15,d*.55,d*.5,t.treeCrown),F(k+d*.1,C-d*.4,d*.55,d*.5,t.treeHighlight),F(k-d*.2,C-d*.15,d*.45,d*.4,p(t.treeHighlight,.5))}e.restore()},st=(e,n,o)=>{if(e.save(),e.globalAlpha=Ze(n.alpha,0,1),e.translate(n.x,n.y),e.rotate(n.rotation),o==="autumn")e.beginPath(),e.ellipse(0,0,n.size,n.size*.5,0,0,Math.PI*2),e.fillStyle=n.color,e.fill(),e.beginPath(),e.moveTo(-n.size*.7,0),e.lineTo(n.size*.7,0),e.strokeStyle=p("#000000",.2),e.lineWidth=.5,e.stroke();else if(o==="winter"){const t=e.createRadialGradient(0,0,0,0,0,n.size);t.addColorStop(0,p("#FFFFFF",.9)),t.addColorStop(1,p("#FFFFFF",0)),e.fillStyle=t,e.fillRect(-n.size,-n.size,n.size*2,n.size*2),e.beginPath(),e.arc(0,0,n.size*.5,0,Math.PI*2),e.fillStyle="#FFFFFF",e.fill()}else if(o==="spring"&&n.size>=6&&n.maxLife>=200){const t=Math.sin(n.life*.15)*.4;e.fillStyle=n.color,e.save(),e.scale(1,1+t),e.beginPath(),e.ellipse(-n.size*.4,0,n.size*.5,n.size*.8,-.2,0,Math.PI*2),e.fill(),e.restore(),e.save(),e.scale(1,1-t),e.beginPath(),e.ellipse(n.size*.4,0,n.size*.5,n.size*.8,.2,0,Math.PI*2),e.fill(),e.restore(),e.beginPath(),e.ellipse(0,0,n.size*.12,n.size*.5,0,0,Math.PI*2),e.fillStyle="#333333",e.fill()}else if(o==="spring"&&n.vx===0&&n.vy===0){e.fillStyle=n.color;for(let l=0;l<5;l++){const s=l/5*Math.PI*2;e.beginPath(),e.ellipse(Math.cos(s)*n.size*.4,Math.sin(s)*n.size*.4,n.size*.35,n.size*.2,s,0,Math.PI*2),e.fill()}e.beginPath(),e.arc(0,0,n.size*.2,0,Math.PI*2),e.fillStyle="#FBBF24",e.fill()}else o==="spring"?(e.beginPath(),e.ellipse(0,0,n.size,n.size*.5,0,0,Math.PI*2),e.fillStyle=n.color,e.fill()):o==="summer"&&(e.beginPath(),e.arc(0,0,n.size,0,Math.PI*2),e.fillStyle=p(n.color,Ze(n.alpha,0,.4)),e.fill());e.restore()},Hr=(e,n,o,t)=>{e.save(),e.font="bold 20px system-ui, sans-serif",e.textAlign="right",e.textBaseline="bottom",e.fillStyle=p(M.text,.5),e.fillText(n,o-20,t-16),e.restore()},$r=(e,n,o,t,l)=>{const s=o*(1-Z),a=8+t*6;e.beginPath(),e.moveTo(0,s);for(let i=0;i<=n;i+=20){const r=Math.sin(i*.02+l*3e-4)*3;e.lineTo(i,s-a+r)}e.lineTo(n,s+2),e.lineTo(0,s+2),e.closePath(),e.fillStyle=p("#FFFFFF",.7),e.fill()},Gr=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden"})},jr=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:M.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:p(M.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Ur=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:p(M.text,.7),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:p(M.surface,.6),borderRadius:"12px",backdropFilter:"blur(4px)"})},Yr=e=>{Object.assign(e.style,{position:"absolute",bottom:"16px",right:"16px",zIndex:"10",fontSize:"1.3rem",fontWeight:"700",color:p(M.text,.6),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:p(M.surface,.6),borderRadius:"12px",backdropFilter:"blur(4px)"})},Vr=()=>{let e=null,n=null,o=0,t=0,l=null,s=null,a=0,i=null,r=null,f={...Me},c={...Me},h=1,d=[],u=[],y=0,C=null;const k=(b,T,S)=>{const A=Math.min(S,vr-d.length);for(let R=0;R<A;R++)switch(b){case"summer":d.push(kr(o,t,T));break;case"autumn":d.push(Er(o,t,T));break;case"winter":d.push(Ir(o,t,T));break;case"spring":d.push(Rr(o,t,T)),T>.4&&Math.random()<.15&&d.push(Fr(o,t));break}},F=b=>{b==="spring"&&u.length<12?Math.random()<.02&&u.push(Or(o,t)):b!=="spring"&&u.length>0&&(u=u.map(T=>({...T,alpha:T.alpha-.01})).filter(T=>T.alpha>.01))},g=()=>{if(!n)return;const b=performance.now()-a;ee(n,o,t),h<1&&(h=Math.min(1,h+ot),f=Mr(f,c,ot));const T=i??"summer";Br(n,o,t,f),Wr(n,o,b,T,y),Dr(n,o,t,f,b),T==="winter"&&$r(n,o,t,y,b);for(const S of u)st(n,S,"spring");if(Nr(n,o,t,f,T,b,y),i!==null){const S=Tr+y*2;if(Math.random()<S){const A=Math.ceil(1+y*3);k(i,y,A)}}d=d.map(S=>_r(S,T)).filter(Lr);for(const S of d)st(n,S,T);if(F(T),i!==null){const S=Ye[i];Hr(n,S.label,o,t)}l=requestAnimationFrame(g)},w=()=>{if(!e||!n)return;const b=q(e,n);o=b.width,t=b.height};return{id:"seasons",name:"Saisons",description:"Change les saisons avec ta voix",mount:b=>{const T=E("div",{});Gr(T);const S=E("button",{},"← Accueil");jr(S),S.addEventListener("click",()=>{window.location.hash="#menu"});const A=E("p",{},"Saisons");Ur(A),C=E("p",{},""),Yr(C),T.appendChild(S),T.appendChild(A),T.appendChild(C),b.appendChild(T);const R=J(T);e=R.canvas,n=R.ctx,o=R.width,t=R.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),s=w,window.addEventListener("resize",s),i=null,r=null,f={...Me},c={...Me},h=1,d=[],u=[],y=0,a=performance.now(),g()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),s&&(window.removeEventListener("resize",s),s=null),e=null,n=null,C=null,o=0,t=0,d=[],u=[],i=null,r=null,h=1,y=0},update:b=>{y=b.volume,b.duration;const T=b.vowel,S=T!==null?Pr[T]??null:null;S!==null&&S!==r&&(r=S,c=Ar(Ye[S]),h=0,i=S,C&&(C.textContent=Ye[S].label))}}},qr=go("#app"),At=ho(),Et=uo({volume:0,pitch:null,vowel:null,isVoicing:!1,duration:0,formants:null}),It=[Al(),jl(),Pa(),Ha(),is(),ks(),Zs(),Oi(),yr(),Vr(),tl(),No()],Xr=Mo(It.map(e=>({id:e.id,name:e.name,description:e.description}))),Kr=[Xr,...It],Zr=po(qr,Kr);Et.subscribe(e=>{const n=Zr.getCurrentGame();n&&n.update(e)});At.subscribe(e=>{Et.set(e)});const Te=document.createElement("div");Te.style.cssText=`
  position: fixed; inset: 0; z-index: 1000;
  display: flex; align-items: center; justify-content: center; flex-direction: column;
  background: rgba(240, 244, 255, 0.95);
`;const se=document.createElement("button");se.textContent="🎤 Commencer";se.style.cssText=`
  font-size: 2rem; padding: 24px 48px;
  border: none; border-radius: 16px;
  background: #6366f1; color: white;
  cursor: pointer; font-family: inherit;
  transition: transform 0.2s;
`;se.addEventListener("mouseenter",()=>{se.style.transform="scale(1.05)"});se.addEventListener("mouseleave",()=>{se.style.transform="scale(1)"});const we=document.createElement("p");we.textContent="Appuie pour activer le micro";we.style.cssText="margin-top: 16px; color: #64748b; font-size: 1.2rem;";Te.appendChild(se);Te.appendChild(we);document.body.appendChild(Te);se.addEventListener("click",async()=>{try{await At.start(),Te.remove()}catch(e){we.textContent="Erreur : impossible d'accéder au micro",we.style.color="#ef4444",console.error("Failed to start audio pipeline:",e)}});</script>
    <style rel="stylesheet" crossorigin>*,*:before,*:after{box-sizing:border-box}*{margin:0;padding:0}html{-webkit-text-size-adjust:100%;-moz-text-size-adjust:100%;text-size-adjust:100%}body{line-height:1.5;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}img,picture,video,canvas,svg{display:block;max-width:100%}input,button,textarea,select{font:inherit;color:inherit}p,h1,h2,h3,h4,h5,h6{overflow-wrap:break-word}ol,ul{list-style:none}a{text-decoration:none;color:inherit}table{border-collapse:collapse;border-spacing:0}:root{--color-bg: #f0f4ff;--color-text: #2d3748;--color-primary: #6366f1;--color-secondary: #f472b6;--color-accent: #34d399;--color-surface: #ffffff;--font-family: "Segoe UI", system-ui, sans-serif;--radius: 12px;--transition-speed: .3s}body{width:100%;height:100vh;height:100dvh;font-family:var(--font-family);background-color:var(--color-bg);color:var(--color-text);overflow:hidden}#app{width:100%;height:100%;display:flex;flex-direction:column}.game-container{flex:1;position:relative;overflow:hidden}*,*:before,*:after{transition-timing-function:ease-in-out}@media(prefers-reduced-motion:reduce){*,*:before,*:after{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important;scroll-behavior:auto!important}}</style>
  </head>
  <body>
    <div id="app"></div>
  </body>
</html>
