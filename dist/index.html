<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ortho</title>
    <script type="module" crossorigin>(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))t(l);new MutationObserver(l=>{for(const i of l)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function o(l){const i={};return l.integrity&&(i.integrity=l.integrity),l.referrerPolicy&&(i.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?i.credentials="include":l.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(l){if(l.ep)return;l.ep=!0;const i=o(l);fetch(l.href,i)}})();const Rt=e=>{if(e.length===0)return 0;let n=0;for(let t=0;t<e.length;t++)n+=e[t]*e[t];const o=Math.sqrt(n/e.length);return Math.min(1,Math.max(0,o))},kt=.15,xe=80,en=600,Ft=(e,n)=>{const o=Math.min(Math.floor(e.length/2),n),t=new Float32Array(o);for(let l=0;l<o;l++){let i=0;for(let a=0;a<o;a++){const s=e[a]-e[a+l];i+=s*s}t[l]=i}return t},Ot=e=>{const n=new Float32Array(e.length);n[0]=1;let o=0;for(let t=1;t<e.length;t++)o+=e[t],n[t]=o===0?0:e[t]*t/o;return n},_t=(e,n,o)=>{for(let t=n;t<e.length-1;t++)if(e[t]<o){for(;t+1<e.length&&e[t+1]<e[t];)t++;return t}return-1},Lt=(e,n)=>{if(n<=0||n>=e.length-1)return n;const o=e[n-1],t=e[n],l=e[n+1],i=.5*(o-l)/(o-2*t+l);return Number.isFinite(i)?n+i:n},Bt=(e,n)=>{if(e.length<2)return null;const o=Math.floor(n/xe),t=Math.floor(n/en);if(e.length<2*o)return null;const l=Ft(e,o),i=Ot(l),a=_t(i,t,kt);if(a===-1)return null;const s=Lt(i,a);if(s<=0)return null;const r=n/s;return r<xe||r>en?null:r},nn=[{vowel:"a",f1:750,f2:1450},{vowel:"e",f1:400,f2:2050},{vowel:"ɛ",f1:600,f2:1750},{vowel:"i",f1:250,f2:2250},{vowel:"o",f1:350,f2:750},{vowel:"u",f1:300,f2:750},{vowel:"y",f1:250,f2:1750}],Dt=.01,tn=.001,Wt=e=>{const n=e.length,o=new Float32Array(n);for(let t=0;t<n;t++){const l=.54-.46*Math.cos(2*Math.PI*t/(n-1));o[t]=e[t]*l}return o},Nt=(e,n=.97)=>{const o=new Float32Array(e.length);o[0]=e[0];for(let t=1;t<e.length;t++)o[t]=e[t]-n*e[t-1];return o},Ht=e=>{const n=Ut(e.length),o=new Float32Array(n),t=new Float32Array(n);o.set(e.subarray(0,Math.min(e.length,n))),Yt(o,t,n);for(let a=2;a<=n;a*=2){const s=a/2,r=-2*Math.PI/a;for(let f=0;f<n;f+=a)for(let c=0;c<s;c++){const h=r*c,d=Math.cos(h),g=Math.sin(h),w=f+c,A=f+c+s,F=d*o[A]-g*t[A],R=d*t[A]+g*o[A];o[A]=o[w]-F,t[A]=t[w]-R,o[w]=o[w]+F,t[w]=t[w]+R}}const l=n/2+1,i=new Float32Array(l);for(let a=0;a<l;a++)i[a]=Math.sqrt(o[a]*o[a]+t[a]*t[a]);return i},on=(e,n,o,t)=>{const l=(e.length-1)*2,i=n/l,a=Math.max(1,Math.ceil(o/i)),s=Math.min(e.length-1,Math.floor(t/i));let r=a,f=e[a];for(let c=a+1;c<=s;c++)e[c]>f&&(f=e[c],r=c);if(r>a&&r<s){const c=e[r-1],h=e[r],d=e[r+1],g=c-2*h+d;if(g!==0){const w=.5*(c-d)/g;return(r+w)*i}}return r*i},$t=(e,n)=>{let o=nn[0].vowel,t=1/0;for(const l of nn){const i=e-l.f1,a=n-l.f2,s=i*i+a*a;s<t&&(t=s,o=l.vowel)}return o},Gt=(e,n)=>{if(jt(e)<Dt)return{vowel:null,formants:null};const o=Nt(e),t=Wt(o),l=Ht(t),i=on(l,n,200,1200),a=i+200,s=on(l,n,a,2800),r=ln(l,n,i),f=ln(l,n,s),c=(l.length-1)*2,h={magnitudes:l,sampleRate:n,fftSize:c,f1:i,f2:s};return r<tn||f<tn?{vowel:null,formants:h}:{vowel:$t(i,s),formants:h}},jt=e=>{let n=0;for(let o=0;o<e.length;o++)n+=e[o]*e[o];return Math.sqrt(n/e.length)},Ut=e=>{let n=1;for(;n<e;)n*=2;return n},Yt=(e,n,o)=>{const t=Math.log2(o);for(let l=0;l<o;l++){const i=Vt(l,t);if(i>l){const a=e[l];e[l]=e[i],e[i]=a;const s=n[l];n[l]=n[i],n[i]=s}}},Vt=(e,n)=>{let o=0;for(let t=0;t<n;t++)o=o<<1|e&1,e>>=1;return o},ln=(e,n,o)=>{const t=(e.length-1)*2,l=Math.round(o*t/n),i=Math.max(0,Math.min(e.length-1,l));return e[i]},ke={isVoicing:!1,currentDuration:0},Xt=(e,n,o)=>e?{isVoicing:!0,currentDuration:o.currentDuration+n}:{isVoicing:!1,currentDuration:0},qt=3,Kt=5,Fe={isVoicing:!1,framesAbove:0,framesBelow:0},Zt=(e,n,o)=>e>o&&n!==null,Jt=(e,n)=>{if(n.isVoicing){if(!e){const o=n.framesBelow+1;return o>=Kt?{isVoicing:!1,framesAbove:0,framesBelow:0}:{isVoicing:!0,framesAbove:0,framesBelow:o}}return{isVoicing:!0,framesAbove:0,framesBelow:0}}if(e){const o=n.framesAbove+1;return o>=qt?{isVoicing:!0,framesAbove:0,framesBelow:0}:{isVoicing:!1,framesAbove:o,framesBelow:0}}return{isVoicing:!1,framesAbove:0,framesBelow:0}},Qt=7,zt=3,Oe={buffer:[]},xt=(e,n)=>{const o=n.buffer.length>=Qt?[...n.buffer.slice(1),e]:[...n.buffer,e],t=new Map;for(const a of o)a!==null&&t.set(a,(t.get(a)??0)+1);if(t.size===0)return{vowel:null,state:{buffer:o}};let l=t.keys().next().value,i=0;for(const[a,s]of t)s>i&&(i=s,l=a);return{vowel:i>=zt?l:null,state:{buffer:o}}},eo=.01,no=2048,to=()=>{let e=null,n=null,o=null,t=null,l=ke,i=Fe,a=Oe,s=0;const r=new Set,f=w=>{for(const A of r)A(w)},c=w=>{if(n===null||e===null)return;const A=s===0?0:(w-s)/1e3;s=w;const F=new Float32Array(n.fftSize);n.getFloatTimeDomainData(F);const R={buffer:F,sampleRate:e.sampleRate},p=Rt(R.buffer),y=Bt(R.buffer,R.sampleRate),{vowel:b,formants:T}=Gt(R.buffer,R.sampleRate),v=Zt(p,y,eo);i=Jt(v,i);const m=i.isVoicing,P=xt(m?b:null,a);a=P.state;const S=m?P.vowel:null;l=Xt(m,A,l);const E={volume:p,pitch:y,vowel:S,isVoicing:m,duration:l.currentDuration,formants:T};f(E),t=requestAnimationFrame(c)};return{start:async()=>{const w=await navigator.mediaDevices.getUserMedia({audio:!0});o=w;const A=new AudioContext;e=A;const F=A.createAnalyser();F.fftSize=no,n=F,A.createMediaStreamSource(w).connect(F),s=0,l=ke,i=Fe,a=Oe,t=requestAnimationFrame(c)},stop:()=>{if(t!==null&&(cancelAnimationFrame(t),t=null),o!==null){for(const w of o.getTracks())w.stop();o=null}e!==null&&(e.close(),e=null),n=null,l=ke,i=Fe,a=Oe,s=0},subscribe:w=>(r.add(w),()=>{r.delete(w)})}},oo=e=>{let n=e;const o=new Set;return{get:()=>n,set:a=>{n=a,o.forEach(s=>s(n))},subscribe:a=>(o.add(a),()=>{o.delete(a)})}},an=()=>window.location.hash.replace(/^#/,"")||"menu",lo=(e,n)=>{let o=null;const t=s=>n.find(r=>r.id===s),l=s=>{for(o&&o.unmount();e.firstChild;)e.removeChild(e.firstChild);const r=t(s)??t("menu")??null;o=r,r&&r.mount(e),window.location.hash=`#${(r==null?void 0:r.id)??s}`},i=()=>o,a=()=>{l(an())};return window.addEventListener("hashchange",a),l(an()),{navigate:l,getCurrentGame:i}},M=(e,n,...o)=>{const t=document.createElement(e);if(n)for(const[l,i]of Object.entries(n))t.setAttribute(l,i);for(const l of o)typeof l=="string"?t.appendChild(document.createTextNode(l)):t.appendChild(l);return t},ao=(e,n=document)=>{const o=n.querySelector(e);if(!o)throw new Error(`Element not found: ${e}`);return o},at=e=>{for(;e.firstChild;)e.removeChild(e.firstChild)},C={bg:"#f0f4ff",text:"#2d3748",primary:"#6366f1",secondary:"#f472b6",green:"#34d399",surface:"#ffffff",muted:"#94a3b8"},Y={a:"#ef4444",e:"#f59e0b",ɛ:"#f97316",i:"#22c55e",o:"#3b82f6",u:"#8b5cf6",y:"#ec4899"},u=(e,n)=>{const o=Math.max(0,Math.min(1,n)),t=parseInt(e.slice(1,3),16),l=parseInt(e.slice(3,5),16),i=parseInt(e.slice(5,7),16);return`rgba(${t}, ${l}, ${i}, ${o})`},sn=["#818cf8","#f472b6","#34d399","#fbbf24","#60a5fa"],io=e=>sn[e%sn.length],so=e=>{Object.assign(e.style,{display:"flex",flexDirection:"column",alignItems:"center",minHeight:"100%",padding:"32px 16px",backgroundColor:C.bg,fontFamily:"inherit",overflowY:"auto"})},ro=e=>{Object.assign(e.style,{fontSize:"3rem",fontWeight:"800",color:C.primary,margin:"0 0 8px 0",letterSpacing:"-0.02em"})},fo=e=>{Object.assign(e.style,{fontSize:"1.5rem",fontWeight:"500",color:C.muted,margin:"0 0 40px 0"})},co=e=>{Object.assign(e.style,{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"24px",width:"100%",maxWidth:"800px"})},ho=(e,n)=>{Object.assign(e.style,{backgroundColor:n,borderRadius:"16px",padding:"32px 24px",cursor:"pointer",border:"none",textAlign:"left",transition:"transform 0.15s ease, box-shadow 0.15s ease",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"}),e.addEventListener("mouseenter",()=>{e.style.transform="scale(1.04)",e.style.boxShadow="0 8px 24px rgba(0, 0, 0, 0.15)"}),e.addEventListener("mouseleave",()=>{e.style.transform="scale(1)",e.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.1)"})},uo=e=>{Object.assign(e.style,{fontSize:"1.6rem",fontWeight:"700",color:"#ffffff",margin:"0 0 8px 0"})},po=e=>{Object.assign(e.style,{fontSize:"1.1rem",fontWeight:"400",color:"rgba(255, 255, 255, 0.9)",margin:"0",lineHeight:"1.4"})},go=(e,n)=>{const o=M("p",{},e.name);uo(o);const t=M("p",{},e.description);po(t);const l=M("button",{},o,t);return ho(l,io(n)),l.addEventListener("click",()=>{window.location.hash="#"+e.id}),l},mo=e=>({id:"menu",name:"Accueil",description:"Choisis un jeu !",mount:l=>{at(l);const i=M("div",{});so(i);const a=M("h1",{},"Ortho");ro(a);const s=M("p",{},"Choisis un jeu !");fo(s);const r=M("div",{});co(r),e.forEach((f,c)=>{r.appendChild(go(f,c))}),i.appendChild(a),i.appendChild(s),i.appendChild(r),l.appendChild(i)},unmount:()=>{},update:l=>{}}),fe=["background: "+C.surface,"border-radius: 16px","padding: 24px","box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08)","display: flex","flex-direction: column","gap: 12px"].join("; "),ce=["font-size: 14px","font-weight: 600","color: "+C.muted,"text-transform: uppercase","letter-spacing: 1px"].join("; "),rn=["font-size: 32px","font-weight: 700","color: "+C.text].join("; "),bo=["display: grid","grid-template-columns: 1fr 1fr","gap: 20px","padding: 24px","max-width: 720px","margin: 0 auto","font-family: system-ui, -apple-system, sans-serif"].join("; "),So=["display: flex","align-items: center","justify-content: center","position: relative","padding: 20px 24px 4px","max-width: 720px","margin: 0 auto"].join("; "),yo=["position: absolute","left: 24px","top: 20px","background: none","border: none","font-size: 16px","color: "+C.primary,"cursor: pointer","padding: 8px 12px","border-radius: 8px","font-weight: 600","transition: background 0.15s"].join("; "),wo=["font-size: 24px","font-weight: 700","color: "+C.text,"margin: 0"].join("; "),vo=["width: 100%","height: 24px","background: "+C.bg,"border-radius: 12px","overflow: hidden"].join("; "),To=["height: 100%","border-radius: 12px","transition: width 0.05s linear, background 0.15s","width: 0%"].join("; "),Po=["width: 120px","height: 120px","border-radius: 50%","display: flex","align-items: center","justify-content: center","font-size: 48px","font-weight: 700","color: white","margin: 0 auto","transition: background-color 0.15s","background: "+C.bg].join("; "),Co=["display: flex","flex-wrap: wrap","gap: 6px","min-height: 32px","align-items: center"].join("; "),Mo=["width: 28px","height: 28px","border-radius: 50%","display: flex","align-items: center","justify-content: center","font-size: 13px","font-weight: 700","color: white"].join("; "),Ao=e=>{const n=Math.round(255*(1-e));return`rgb(${Math.round(255*e)}, ${n}, 80)`},Eo=20,dn={a:{f1:1e3,f2:1600},e:{f1:500,f2:2600},ɛ:{f1:700,f2:2300},i:{f1:350,f2:2800},o:{f1:600,f2:1100},u:{f1:400,f2:1100},y:{f1:350,f2:2200}},Io=(e,n,o,t)=>{const l=window.devicePixelRatio||1,i=n.width/l,a=n.height/l;e.clearRect(0,0,i,a);const{magnitudes:s,sampleRate:r,fftSize:f}=o,c=3500,h=r/f,d=Math.min(s.length-1,Math.ceil(c/h));let g=0;for(let b=0;b<=d;b++){const T=Math.log10(1+s[b]*500);T>g&&(g=T)}g===0&&(g=1);const w=e.createLinearGradient(0,0,0,a);w.addColorStop(0,u(C.primary,.8)),w.addColorStop(1,u(C.primary,.05)),e.beginPath(),e.moveTo(0,a);for(let b=0;b<=d;b++){const v=b*h/c*i,m=Math.log10(1+s[b]*500),P=a-m/g*(a-20);e.lineTo(v,P)}e.lineTo(d*h/c*i,a),e.closePath(),e.fillStyle=w,e.fill(),e.beginPath();for(let b=0;b<=d;b++){const v=b*h/c*i,m=Math.log10(1+s[b]*500),P=a-m/g*(a-20);b===0?e.moveTo(v,P):e.lineTo(v,P)}if(e.strokeStyle=C.primary,e.lineWidth=1.5,e.stroke(),t&&dn[t]){const b=dn[t],T=Y[t]??C.primary,v=100,m=(b.f1-v)/c*i,P=(b.f1+v)/c*i;e.fillStyle=u(T,.18),e.fillRect(m,0,P-m,a);const S=(b.f2-v)/c*i,E=(b.f2+v)/c*i;e.fillStyle=u(T,.18),e.fillRect(S,0,E-S,a),e.fillStyle=u(T,.7),e.font="11px system-ui, sans-serif",e.textAlign="center",e.fillText("F1 cible",(m+P)/2,14),e.fillText("F2 cible",(S+E)/2,14)}const{f1:A,f2:F}=o,R=t&&Y[t]?Y[t]:C.primary,p=A/c*i;e.beginPath(),e.moveTo(p,0),e.lineTo(p,a),e.strokeStyle=R,e.lineWidth=2,e.stroke(),e.fillStyle=R,e.font="bold 11px system-ui, sans-serif",e.textAlign="left",e.fillText("F1: "+Math.round(A)+" Hz",p+4,30);const y=F/c*i;e.beginPath(),e.moveTo(y,0),e.lineTo(y,a),e.strokeStyle=R,e.lineWidth=2,e.stroke(),e.fillStyle=R,e.font="bold 11px system-ui, sans-serif",e.textAlign="right",e.fillText("F2: "+Math.round(F)+" Hz",y-4,30),e.fillStyle=C.muted,e.font="10px system-ui, sans-serif",e.textAlign="center";for(let b=500;b<=3e3;b+=500){const T=b/c*i;e.fillText(b+"",T,a-4)}},Ro=()=>{let e=null,n=null,o=null,t=null,l=null,i=null,a=null,s=null,r=null;return{id:"dashboard",name:"Dashboard",description:"Tableau de bord diagnostique — visualise le pipeline audio en temps réel",mount:d=>{const g=M("div",{style:"background: "+C.bg+"; min-height: 100vh;"}),w=M("div",{style:So}),A=M("button",{style:yo},"← Accueil");A.addEventListener("click",()=>{window.location.hash="#menu"}),A.addEventListener("mouseenter",()=>{A.style.background=u(C.primary,.1)}),A.addEventListener("mouseleave",()=>{A.style.background="none"});const F=M("h1",{style:wo},"Dashboard");w.appendChild(A),w.appendChild(F),g.appendChild(w);const R=M("div",{style:bo}),p=M("div",{style:fe}),y=M("span",{style:ce},"Volume"),b=M("div",{style:vo});e=M("div",{style:To}),b.appendChild(e),p.appendChild(y),p.appendChild(b);const T=M("div",{style:fe}),v=M("span",{style:ce},"Pitch");n=M("span",{style:rn},"—"),T.appendChild(v),T.appendChild(n);const m=M("div",{style:fe}),P=M("span",{style:ce},"Voyelle");o=M("div",{style:Po}),t=M("span",{},"—"),o.appendChild(t),m.appendChild(P),m.appendChild(o);const S=M("div",{style:fe}),E=M("span",{style:ce},"Durée");l=M("span",{style:rn},"0.0 s"),S.appendChild(E),S.appendChild(l),R.appendChild(p),R.appendChild(T),R.appendChild(m),R.appendChild(S),g.appendChild(R);const k=M("div",{style:"padding: 0 24px 20px; max-width: 720px; margin: 0 auto;"}),O=M("div",{style:fe}),I=M("span",{style:ce},"Spectre");a=document.createElement("canvas"),a.style.cssText="width: 100%; height: 180px; border-radius: 8px; background: "+C.bg;const D=window.devicePixelRatio||1;a.width=672*D,a.height=180*D;const j=a.getContext("2d");j&&j.scale(D,D),s=j,O.appendChild(I),O.appendChild(a),k.appendChild(O),g.appendChild(k);const q=new ResizeObserver(N=>{for(const U of N){const se=U.contentRect;if(a&&s){const ne=window.devicePixelRatio||1;a.width=se.width*ne,a.height=180*ne,s.scale(ne,ne)}}});q.observe(O),r=q;const B=M("div",{style:"padding: 0 24px 24px; max-width: 720px; margin: 0 auto;"}),W=M("div",{style:fe}),H=M("span",{style:ce},"Historique voyelles");i=M("div",{style:Co}),W.appendChild(H),W.appendChild(i),B.appendChild(W),g.appendChild(B),at(d),d.appendChild(g)},update:d=>{if(e){const g=Math.round(d.volume*100);e.style.width=g+"%",e.style.background=Ao(d.volume)}if(n&&(n.textContent=d.pitch!==null?Math.round(d.pitch)+" Hz":"—"),o&&t)if(d.vowel!==null){const g=Y[d.vowel]??C.muted;o.style.background=g,t.textContent=d.vowel,t.style.color="white"}else o.style.background=C.bg,t.textContent="—",t.style.color=C.muted;if(l&&(l.textContent=d.duration.toFixed(1)+" s"),i&&d.vowel!==null){const g=Y[d.vowel]??C.muted,w=M("div",{style:Mo+"; background: "+g},d.vowel);for(i.insertBefore(w,i.firstChild);i.children.length>Eo;)i.removeChild(i.lastChild)}s&&a&&d.formants&&Io(s,a,d.formants,d.vowel)},unmount:()=>{r&&(r.disconnect(),r=null),e=null,n=null,o=null,t=null,l=null,i=null,a=null,s=null}}},J=e=>{const n=document.createElement("canvas"),o=n.getContext("2d");if(!o)throw new Error("Failed to get 2D rendering context");e.appendChild(n);const{width:t,height:l}=X(n,o);return{canvas:n,ctx:o,width:t,height:l}},ee=(e,n,o)=>{e.clearRect(0,0,n,o)},X=(e,n)=>{const o=e.parentElement;if(!o)throw new Error("Canvas must be mounted in a parent element");const t=window.devicePixelRatio||1,l=o.clientWidth,i=o.clientHeight;return e.width=l*t,e.height=i*t,e.style.width=`${l}px`,e.style.height=`${i}px`,n.setTransform(t,0,0,t,0,0),{width:l,height:i}},ko=6,Fo=.003,Oo=.05,_o=10,Lo=50,Bo=-1,Do=-3,fn=.5,Wo=.3,No=.7,Ho=.8,cn=(e,n)=>e+Math.random()*(n-e),$o=(e,n,o,t)=>({x:cn(e*Wo,e*No),y:n,radius:_o+o*Lo,color:t&&Y[t]?Y[t]:C.primary,alpha:Ho,vy:Bo+o*Do,vx:cn(-fn,fn)}),Go=e=>({...e,y:e.y+e.vy,x:e.x+e.vx,alpha:e.alpha-Fo,radius:e.radius+Oo}),jo=e=>e.alpha>0&&e.y+e.radius>0,Uo=(e,n)=>{e.beginPath(),e.arc(n.x,n.y,n.radius,0,Math.PI*2),e.fillStyle=u(n.color,n.alpha),e.fill()},Yo=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:C.bg})},Vo=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:C.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u(C.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Xo=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u(C.primary,.5),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},qo=()=>{let e=null,n=null,o=0,t=0,l=[],i=null,a=null,s=0,r=null;const f=()=>{if(n){ee(n,o,t),l=l.map(Go).filter(jo);for(const w of l)Uo(n,w);i=requestAnimationFrame(f)}},c=()=>{if(!e||!n)return;const w=X(e,n);o=w.width,t=w.height};return{id:"bubbles",name:"Bulles",description:"Fais monter des bulles avec ta voix !",mount:w=>{const A=M("div",{});Yo(A),a=M("button",{},"← Accueil"),Vo(a),a.addEventListener("click",()=>{window.location.hash="#menu"});const F=M("p",{},"Bulles");Xo(F),A.appendChild(a),A.appendChild(F),w.appendChild(A);const R=J(A);e=R.canvas,n=R.ctx,o=R.width,t=R.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),r=c,window.addEventListener("resize",r),l=[],s=0,f()},unmount:()=>{i!==null&&(cancelAnimationFrame(i),i=null),r&&(window.removeEventListener("resize",r),r=null),e=null,n=null,a=null,l=[],s=0,o=0,t=0},update:w=>{if(!w.isVoicing){s=0;return}s+=1,s>=ko&&(s=0,l.push($o(o,t,w.volume,w.vowel)))}}},hn=120,Ko=.08,Me=36,it=56,Zo=3,Jo=.03,un=3,pn=2.5,Qo=3,zo=8,gn=.08,xo=.12,el=.08,st="#0f0e2e",nl="#1a3a2a",tl="#2d5a3a",mn=["#ff6b35","#ffa500","#ffcc00","#ff4444","#ffee88"],ol=[{x:.78,y:.7,radius:18,color:"#66bb6a",label:"",ringColor:null},{x:.2,y:.5,radius:24,color:"#ffa726",label:"",ringColor:"#ffcc80"},{x:.82,y:.32,radius:20,color:"#ab47bc",label:"",ringColor:null},{x:.35,y:.15,radius:30,color:"#42a5f5",label:"",ringColor:"#90caf9"}],ll=(e,n,o)=>e+(n-e)*o,de=(e,n)=>e+Math.random()*(n-e),bn=e=>Array.from({length:e},()=>({x:Math.random(),y:Math.random(),size:de(.5,2.5),twinkleSpeed:de(.01,.04),twinkleOffset:Math.random()*Math.PI*2})),al=(e,n,o)=>({x:e+de(-Me*.3,Me*.3),y:n+de(0,4),vx:de(-un,un),vy:de(pn*.5,pn)*(.5+o*.5),life:1,size:de(Qo,zo)*(.6+o*.8),color:mn[Math.floor(Math.random()*mn.length)]}),il=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,life:e.life-Jo,size:e.size*.97}),sl=e=>e.life>0&&e.size>.5,rl=(e,n,o,t,l)=>{for(const i of n){const a=.4+.6*Math.abs(Math.sin(l*i.twinkleSpeed+i.twinkleOffset));e.beginPath(),e.arc(i.x*o,i.y*t,i.size,0,Math.PI*2),e.fillStyle=u("#ffffff",a),e.fill()}},dl=(e,n,o,t)=>{const l=n.x*o,i=n.y*t,a=e.createRadialGradient(l,i,n.radius*.5,l,i,n.radius*2);a.addColorStop(0,u(n.color,.2)),a.addColorStop(1,u(n.color,0)),e.beginPath(),e.arc(l,i,n.radius*2,0,Math.PI*2),e.fillStyle=a,e.fill(),e.beginPath(),e.arc(l,i,n.radius,0,Math.PI*2),e.fillStyle=n.color,e.fill(),n.ringColor&&(e.beginPath(),e.ellipse(l,i,n.radius*1.8,n.radius*.35,-.3,0,Math.PI*2),e.strokeStyle=u(n.ringColor,.6),e.lineWidth=2,e.stroke())},fl=(e,n,o)=>{const t=o*(1-gn);e.fillStyle=nl,e.fillRect(0,t,n,o*gn),e.fillStyle=tl,e.fillRect(0,t,n,3)},cl=(e,n,o)=>{const t=Me/2,l=it;e.save(),e.translate(n,o),e.beginPath(),e.moveTo(0,-l),e.lineTo(-t*.5,-l*.55),e.lineTo(t*.5,-l*.55),e.closePath(),e.fillStyle="#ef4444",e.fill(),e.beginPath(),e.moveTo(-t*.5,-l*.55),e.lineTo(-t*.5,0),e.lineTo(t*.5,0),e.lineTo(t*.5,-l*.55),e.closePath(),e.fillStyle="#e0e0e0",e.fill(),e.fillStyle=C.primary,e.fillRect(-t*.5,-l*.4,Me*.5,l*.12),e.beginPath(),e.arc(0,-l*.42,t*.28,0,Math.PI*2),e.fillStyle="#81d4fa",e.fill(),e.beginPath(),e.arc(0,-l*.42,t*.28,0,Math.PI*2),e.strokeStyle="#4fc3f7",e.lineWidth=1.5,e.stroke(),e.beginPath(),e.moveTo(-t*.5,-l*.08),e.lineTo(-t,l*.08),e.lineTo(-t*.5,0),e.closePath(),e.fillStyle="#ef4444",e.fill(),e.beginPath(),e.moveTo(t*.5,-l*.08),e.lineTo(t,l*.08),e.lineTo(t*.5,0),e.closePath(),e.fillStyle="#ef4444",e.fill(),e.beginPath(),e.moveTo(-t*.3,0),e.lineTo(-t*.2,l*.08),e.lineTo(t*.2,l*.08),e.lineTo(t*.3,0),e.closePath(),e.fillStyle="#78909c",e.fill(),e.restore()},hl=(e,n)=>{for(const o of n)e.beginPath(),e.arc(o.x,o.y,o.size,0,Math.PI*2),e.fillStyle=u(o.color,o.life*.8),e.fill()},ul=(e,n,o,t,l,i)=>{const a=1-(t-l)/(i-l),s=n-24,r=o*.08,f=o*.84,c=8;e.fillStyle=u("#ffffff",.1),e.beginPath(),e.roundRect(s-c/2,r,c,f,4),e.fill();const h=f*Math.max(0,Math.min(1,a)),d=e.createLinearGradient(0,r+f,0,r);d.addColorStop(0,"#34d399"),d.addColorStop(.5,"#fbbf24"),d.addColorStop(1,"#ef4444"),e.fillStyle=d,e.beginPath(),e.roundRect(s-c/2,r+f-h,c,h,4),e.fill()},pl=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:st})},gl=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:"#a5b4fc",cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u("#1e1b4b",.7),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},ml=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u("#a5b4fc",.6),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},bl=()=>{let e=null,n=null,o=0,t=0,l=null,i=null,a=[],s=0,r=0,f=[],c=0,h=!1,d=0;const g=()=>t*(1-xo),w=()=>t*el+it,A=()=>o/2,F=()=>{if(n){if(d+=1,s=ll(s,r,Ko),f=f.map(il).filter(sl),h&&c>.01){const T=Math.ceil(Zo*(.5+c*1.5));for(let v=0;v<T;v++)f.push(al(A(),s,c))}ee(n,o,t),n.fillStyle=st,n.fillRect(0,0,o,t),rl(n,a,o,t,d);for(const T of ol)dl(n,T,o,t);fl(n,o,t),hl(n,f),cl(n,A(),s),ul(n,o,t,s,w(),g()),l=requestAnimationFrame(F)}},R=()=>{if(!e||!n)return;const T=g(),v=w(),m=T>v?(s-v)/(T-v):1,P=X(e,n);o=P.width,t=P.height;const S=g(),E=w();s=E+m*(S-E),r=s,a=bn(hn)};return{id:"rocket",name:"Fusée",description:"Fais décoller la fusée avec ta voix !",mount:T=>{const v=M("div",{});pl(v);const m=M("button",{},"← Accueil");gl(m),m.addEventListener("click",()=>{window.location.hash="#menu"});const P=M("p",{},"Fusée");ml(P),v.appendChild(m),v.appendChild(P),T.appendChild(v);const S=J(v);e=S.canvas,n=S.ctx,o=S.width,t=S.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),a=bn(hn),s=g(),r=s,f=[],c=0,h=!1,d=0,i=R,window.addEventListener("resize",i),F()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),i&&(window.removeEventListener("resize",i),i=null),e=null,n=null,a=[],f=[],c=0,h=!1,d=0,o=0,t=0},update:T=>{c=T.volume,h=T.isVoicing;const v=g(),m=w();T.isVoicing&&T.volume>.01?r=v-T.volume*(v-m):r=v}}},Sn=["#f9a8d4","#a5b4fc","#86efac","#fcd34d","#fca5a5","#c4b5fd","#67e8f9","#fdba74","#d8b4fe","#6ee7b7"],yn=["star","heart","butterfly","flower"],Sl=9,yl=15,_e=20,wl=.45,vl=.06,Tl=.25,je="#0a0e1a",wn=.04,Te=(e,n)=>e+Math.random()*(n-e),vn=(e,n,o,t)=>Math.sqrt((o-e)**2+(t-n)**2),Tn=(e,n,o)=>Math.max(n,Math.min(o,e)),Pl=(e,n)=>{const t=[];for(let l=0;l<Sl;l++)t.push({x:Te(60,e-60),y:Te(110,n-60),kind:yn[l%yn.length],color:Sn[l%Sn.length],size:Te(18,30),discovered:!1,glowPhase:Te(0,Math.PI*2)});return t},Cl=(e,n,o,t,l,i)=>{const s=t,r=t*.45;e.save(),e.globalAlpha=i,e.fillStyle=l,e.beginPath();for(let f=0;f<10;f++){const c=f%2===0?s:r,h=Math.PI*f/5-Math.PI/2,d=n+Math.cos(h)*c,g=o+Math.sin(h)*c;f===0?e.moveTo(d,g):e.lineTo(d,g)}e.closePath(),e.fill(),e.restore()},Ml=(e,n,o,t,l,i)=>{const a=t*.6;e.save(),e.globalAlpha=i,e.fillStyle=l,e.beginPath(),e.moveTo(n,o+a*.3),e.bezierCurveTo(n,o-a*.3,n-a,o-a*.3,n-a,o+a*.1),e.bezierCurveTo(n-a,o+a*.6,n,o+a*.9,n,o+a*1.1),e.bezierCurveTo(n,o+a*.9,n+a,o+a*.6,n+a,o+a*.1),e.bezierCurveTo(n+a,o-a*.3,n,o-a*.3,n,o+a*.3),e.closePath(),e.fill(),e.restore()},Al=(e,n,o,t,l,i)=>{const a=t*.7;e.save(),e.globalAlpha=i,e.fillStyle=l,e.beginPath(),e.ellipse(n-a*.45,o-a*.25,a*.5,a*.35,-Math.PI/6,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(n+a*.45,o-a*.25,a*.5,a*.35,Math.PI/6,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(n-a*.35,o+a*.25,a*.35,a*.25,Math.PI/6,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(n+a*.35,o+a*.25,a*.35,a*.25,-Math.PI/6,0,Math.PI*2),e.fill(),e.fillStyle=u(l,i*.8),e.beginPath(),e.ellipse(n,o,a*.08,a*.45,0,0,Math.PI*2),e.fill(),e.restore()},El=(e,n,o,t,l,i)=>{const s=t*.35,r=t*.2,f=t*.35;e.save(),e.globalAlpha=i,e.fillStyle=l;for(let c=0;c<6;c++){const h=Math.PI*2*c/6,d=n+Math.cos(h)*f,g=o+Math.sin(h)*f;e.beginPath(),e.arc(d,g,s,0,Math.PI*2),e.fill()}e.fillStyle=u("#fef08a",i),e.beginPath(),e.arc(n,o,r,0,Math.PI*2),e.fill(),e.restore()},Il=(e,n,o,t)=>{const l=n.size*t;({star:()=>Cl(e,n.x,n.y,l,n.color,o),heart:()=>Ml(e,n.x,n.y,l,n.color,o),butterfly:()=>Al(e,n.x,n.y,l,n.color,o),flower:()=>El(e,n.x,n.y,l,n.color,o)})[n.kind]()},Rl=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:je})},kl=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:"#a5b4fc",cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u("#1e1b4b",.7),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Fl=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u("#c7d2fe",.6),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},Ol=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",fontSize:"1.1rem",fontWeight:"600",color:"#fcd34d",margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:u("#1e1b4b",.7),borderRadius:"8px"})},_l=()=>{let e=null,n=null,o=0,t=0,l=[],i=null,a=null,s=null,r=0,f=0,c=0,h=0;const d=S=>{const E=Math.min(o,t)*wl;return _e+S*S*E},g=S=>{l=l.map(E=>{if(E.discovered)return E;const k=vn(c,h,E.x,E.y),O=S-E.size-yl;return k<O?{...E,discovered:!0}:E})},w=()=>{if(!s)return;const S=l.filter(E=>E.discovered).length;s.textContent=`${S} / ${l.length}`},A=S=>{S.fillStyle=je,S.fillRect(0,0,o,t)},F=(S,E)=>{if(E<=_e)return;const k=S.createRadialGradient(c,h,0,c,h,E);k.addColorStop(0,u("#2a3a6a",.9)),k.addColorStop(.3,u("#1a2550",.7)),k.addColorStop(.7,u("#101830",.4)),k.addColorStop(1,u(je,0)),S.save(),S.globalCompositeOperation="lighter",S.fillStyle=k,S.beginPath(),S.arc(c,h,E,0,Math.PI*2),S.fill(),S.restore()},R=(S,E,k)=>{for(const O of l){const I=vn(c,h,O.x,O.y);let D;if(O.discovered&&E<=_e)D=wn*3;else if(I>E+O.size)D=O.discovered?wn*2:0;else if(I>E-O.size){const q=(E+O.size-I)/(O.size*2);D=Tn(q,0,1)*.9}else{const q=1-I/E*.3;D=Tn(q,.5,.95)}if(D<=0)continue;let j=1;O.discovered&&(j=1+Math.sin(k*vl+O.glowPhase)*Tl,D=Math.min(D+.15,1)),Il(S,O,D,j)}},p=(S,E)=>{if(l.filter(I=>I.discovered).length>0)return;const O=.25+Math.sin(E*.03)*.1;S.save(),S.fillStyle=u("#c7d2fe",O),S.font="1.1rem system-ui, sans-serif",S.textAlign="center",S.fillText("Parle pour allumer la lampe !",o/2,t/2+60),S.restore()};let y=0;const b=()=>{n&&(y+=1,ee(n,o,t),r+=(f-r)*.12,A(n),F(n,r),R(n,r,y),p(n,y),g(r),w(),i=requestAnimationFrame(b))},T=()=>{if(!e||!n)return;const S=X(e,n);o=S.width,t=S.height,c=o/2,h=t/2};return{id:"lamp",name:"Lampe Magique",description:"Illumine l’obscurité avec ta voix pour découvrir des créatures cachées !",mount:S=>{const E=M("div",{});Rl(E);const k=M("button",{},"← Accueil");kl(k),k.addEventListener("click",()=>{window.location.hash="#menu"});const O=M("p",{},"Lampe Magique");Fl(O),s=M("p",{},"0 / 0"),Ol(s),E.appendChild(k),E.appendChild(O),E.appendChild(s),S.appendChild(E);const I=J(E);e=I.canvas,n=I.ctx,o=I.width,t=I.height,c=o/2,h=t/2,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),l=Pl(o,t),r=0,f=0,y=0,a=T,window.addEventListener("resize",a),w(),b()},unmount:()=>{i!==null&&(cancelAnimationFrame(i),i=null),a&&(window.removeEventListener("resize",a),a=null),e=null,n=null,s=null,l=[],r=0,f=0,y=0,o=0,t=0},update:S=>{S.isVoicing?f=d(S.volume):f=0}}},Pn=7,Ll=.15,Bl=60,Dl=1/Bl,Wl=.03,Nl=180,Hl=80,$l=.08,Gl=.006,jl=.3,Ul=.008,Yl=8,Cn=.08,Vl=.12,Mn=["#fca5a5","#a5b4fc","#86efac","#fcd34d","#f9a8d4","#67e8f9","#fdba74"],An=["#f472b6","#a78bfa","#34d399","#fbbf24","#60a5fa","#f87171","#2dd4bf","#fb923c"],rt="#2d1b33",Xl="#4a2c2a",ql="#5c3a2e",Kl="#7a5040",V=(e,n)=>e+Math.random()*(n-e),Pe=(e,n,o)=>Math.max(n,Math.min(o,e)),Zl=e=>Array.from({length:e},(n,o)=>({x:0,bodyColor:Mn[o%Mn.length],flameScale:1,extinguished:!1,blowAccumulator:0})),En=(e,n)=>{const o=n*.12,t=(n-o*2)/(e.length-1);return e.map((l,i)=>({...l,x:o+i*t}))},Jl=e=>{const n=e.findIndex(o=>!o.extinguished);return n===-1?null:n},Ql=(e,n)=>({x:e+V(-3,3),y:n-V(2,8),vx:V(-.3,.3),vy:V(-.8,-.3),alpha:V(.3,.6),size:V(3,6)}),zl=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,alpha:e.alpha-Ul,size:e.size+.03}),xl=e=>e.alpha>0,ea=(e,n)=>Array.from({length:Hl},()=>({x:V(0,e),y:V(-n*.3,n*.1),vx:V(-2,2),vy:V(1,3),rotation:V(0,Math.PI*2),rotationSpeed:V(-.1,.1),color:An[Math.floor(Math.random()*An.length)],alpha:1,width:V(6,12),height:V(3,6)})),na=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,vy:e.vy+$l,rotation:e.rotation+e.rotationSpeed,alpha:e.alpha-Gl}),ta=e=>e.alpha>0,oa=(e,n,o)=>{const t=e.createLinearGradient(0,0,0,o);t.addColorStop(0,rt),t.addColorStop(1,Xl),e.fillStyle=t,e.fillRect(0,0,n,o)},la=(e,n,o,t)=>{const l=e.createLinearGradient(0,t,0,o);l.addColorStop(0,Kl),l.addColorStop(.15,ql),l.addColorStop(1,"#3d2518"),e.fillStyle=l,e.beginPath(),e.roundRect(0,t,n,o-t,[8,8,0,0]),e.fill(),e.strokeStyle=u("#a07050",.4),e.lineWidth=1.5,e.beginPath(),e.moveTo(0,t),e.lineTo(n,t),e.stroke()},aa=(e,n,o,t,l,i)=>{const a=n-t/2,s=o-l;e.fillStyle=i,e.beginPath(),e.roundRect(a,s,t,l,[4,4,0,0]),e.fill(),e.fillStyle=u("#ffffff",.15),e.beginPath(),e.roundRect(a+2,s,t*.25,l,[3,0,0,0]),e.fill(),e.strokeStyle="#4a3728",e.lineWidth=2,e.beginPath(),e.moveTo(n,s),e.lineTo(n,s-8),e.stroke()},ia=(e,n,o,t,l)=>{if(t<=.01)return;const i=22*t,a=9*t,s=o-i,r=l*3*t;e.save();const f=20*t,c=e.createRadialGradient(n+r,o-i*.5,0,n+r,o-i*.5,f);c.addColorStop(0,u("#fef08a",.25*t)),c.addColorStop(1,u("#fef08a",0)),e.fillStyle=c,e.beginPath(),e.arc(n+r,o-i*.5,f,0,Math.PI*2),e.fill(),e.fillStyle=u("#fb923c",.85),e.beginPath(),e.moveTo(n-a*.6+r*.5,o),e.quadraticCurveTo(n-a+r*.8,o-i*.5,n+r,s),e.quadraticCurveTo(n+a+r*.8,o-i*.5,n+a*.6+r*.5,o),e.closePath(),e.fill();const h=.65;e.fillStyle=u("#fef08a",.9),e.beginPath(),e.moveTo(n-a*.35+r*.3,o),e.quadraticCurveTo(n-a*h+r*.5,o-i*.45,n+r*.7,s+i*.2),e.quadraticCurveTo(n+a*h+r*.5,o-i*.45,n+a*.35+r*.3,o),e.closePath(),e.fill();const d=e.createRadialGradient(n+r*.5,o-i*.2,0,n+r*.5,o-i*.2,a*.4);d.addColorStop(0,u("#ffffff",.6*t)),d.addColorStop(1,u("#fef9c3",0)),e.fillStyle=d,e.beginPath(),e.arc(n+r*.5,o-i*.2,a*.4,0,Math.PI*2),e.fill(),e.restore()},sa=(e,n)=>{for(const o of n)e.beginPath(),e.arc(o.x,o.y,o.size,0,Math.PI*2),e.fillStyle=u("#9ca3af",o.alpha),e.fill()},ra=(e,n)=>{for(const o of n)e.save(),e.translate(o.x,o.y),e.rotate(o.rotation),e.fillStyle=u(o.color,o.alpha),e.fillRect(-o.width/2,-o.height/2,o.width,o.height),e.restore()},da=(e,n,o)=>{if(n<=0)return;const t=n===1?"1 fois":`${n} fois`;e.save(),e.font="600 1rem system-ui, sans-serif",e.textAlign="center";const l=e.measureText(t).width,i=12,a=o/2-l/2-i,s=50;e.fillStyle=u("#1e1b4b",.6),e.beginPath(),e.roundRect(a,s,l+i*2,32,8),e.fill(),e.fillStyle=u("#fcd34d",.85),e.fillText(t,o/2,s+22),e.restore()},fa=(e,n,o,t,l)=>{if(l)return;const i=.3+Math.sin(t*.04)*.1;e.save(),e.fillStyle=u("#fef9c3",i),e.font="1.1rem system-ui, sans-serif",e.textAlign="center",e.fillText("Souffle pour éteindre les bougies !",n/2,o*.15),e.restore()},ca=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:rt})},ha=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:"#fcd34d",cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u("#1e1b4b",.7),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},ua=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u("#fef9c3",.6),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},pa=()=>{let e=null,n=null,o=0,t=0,l=null,i=null,a=[],s=new Map,r=[],f=0,c=0,h=!1,d=0,g=!1,w=0;const A=()=>t*.7,F=()=>Pe(o/(Pn*2.5),16,36),R=()=>Pe(t*.18,50,120),p=()=>{a=a.map(S=>({...S,flameScale:1,extinguished:!1,blowAccumulator:0})),s=new Map,h=!1,g=!1,d=0},y=()=>{g=!0,h=!0,d=0,f+=1,r=ea(o,t)},b=()=>{if(!n)return;c+=1,ee(n,o,t);const S=A(),E=F(),k=R(),O=S-k-8;oa(n,o,t),la(n,o,t,S);for(const[I,D]of s.entries()){const j=D.map(zl).filter(xl);j.length===0?s.delete(I):s.set(I,j)}for(let I=0;I<a.length;I++){const D=a[I];if(D.extinguished&&Math.random()<jl){const j=s.get(I)??[];j.length<Yl&&s.set(I,[...j,Ql(D.x,O)])}}for(let I=0;I<a.length;I++){const D=a[I];if(aa(n,D.x,S,E,k,D.bodyColor),!D.extinguished){const q=Math.sin(c*Cn+I*1.7),B=Math.sin(c*Cn*1.6+I*2.3)*.5,W=(q+B)*Vl;ia(n,D.x,O,D.flameScale,W)}const j=s.get(I);j&&sa(n,j)}a=a.map((I,D)=>{if(I.extinguished)return I;if(Jl(a)===D&&w>Ll){const N=I.blowAccumulator+1,U=Pe(1-N*Dl,0,1);return U<=0?{...I,flameScale:0,extinguished:!0,blowAccumulator:0}:{...I,flameScale:U,blowAccumulator:N}}const W=Pe(I.flameScale+Wl,0,1),H=Math.max(0,I.blowAccumulator-.5);return{...I,flameScale:W,blowAccumulator:H}}),!h&&a.every(I=>I.extinguished)&&y(),g&&(r=r.map(na).filter(ta),ra(n,r),d+=1,d>=Nl&&p()),fa(n,o,t,c,h),da(n,f,o),l=requestAnimationFrame(b)},T=()=>{if(!e||!n)return;const S=X(e,n);o=S.width,t=S.height,a=En(a,o)};return{id:"candles",name:"Bougies",description:"Souffle pour éteindre les bougies",mount:S=>{const E=M("div",{});ca(E);const k=M("button",{},"← Accueil");ha(k),k.addEventListener("click",()=>{window.location.hash="#menu"});const O=M("p",{},"Bougies");ua(O),E.appendChild(k),E.appendChild(O),S.appendChild(E);const I=J(E);e=I.canvas,n=I.ctx,o=I.width,t=I.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),a=En(Zl(Pn),o),s=new Map,r=[],f=0,c=0,h=!1,d=0,g=!1,w=0,i=T,window.addEventListener("resize",i),b()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),i&&(window.removeEventListener("resize",i),i=null),e=null,n=null,a=[],s=new Map,r=[],f=0,c=0,h=!1,d=0,g=!1,w=0,o=0,t=0},update:S=>{w=S.volume}}},dt=80,ga=600,ma=ga-dt,ba=1.5,In=4,Sa=30,ya=1.5,wa=.35,Le=["#ef4444","#f97316","#eab308","#22c55e","#06b6d4","#3b82f6","#8b5cf6"],ft=e=>Math.max(0,Math.min(1,(e-dt)/ma)),va=(e,n)=>{const t=n-80,l=ft(e);return 40+t*(1-l)},Ta=e=>{const n=ft(e),o=Math.min(Le.length-1,Math.floor(n*Le.length));return Le[o]},Pa=e=>In+e*(Sa-In),Ca=(e,n,o,t,l)=>{const i=e.createRadialGradient(n,o,0,n,o,t);i.addColorStop(0,u(l,.85)),i.addColorStop(.5,u(l,.5)),i.addColorStop(1,u(l,0)),e.beginPath(),e.arc(n,o,t,0,Math.PI*2),e.fillStyle=i,e.fill()},Ma=(e,n,o)=>{e.beginPath(),e.moveTo(n,0),e.lineTo(n,o),e.strokeStyle=u(C.text,wa),e.lineWidth=ya,e.stroke()},Aa=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:C.bg})},Ea=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:C.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u(C.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Ia=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u(C.primary,.5),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},Ra=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1rem",fontWeight:"600",color:C.secondary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u(C.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},ka=()=>{let e=null,n=null,o=0,t=0,l=null,i=null,a=null,s=null,r=0,f=!0;const c=()=>{if(!e||(a||(a=document.createElement("canvas"),s=a.getContext("2d")),!a||!s))return;const p=window.devicePixelRatio||1;if(a.width!==e.width||a.height!==e.height){const y=document.createElement("canvas");y.width=a.width,y.height=a.height;const b=y.getContext("2d");b&&a.width>0&&a.height>0&&b.drawImage(a,0,0),a.width=e.width,a.height=e.height,s.setTransform(p,0,0,p,0,0),y.width>0&&y.height>0&&(s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(y,0,0,a.width,a.height),s.setTransform(p,0,0,p,0,0),s.restore())}},h=()=>{if(!s||!a)return;s.save(),s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,a.width,a.height),s.restore();const p=window.devicePixelRatio||1;s.setTransform(p,0,0,p,0,0),r=0,f=!0},d=()=>{if(!n||!a)return;n.fillStyle=C.bg,n.fillRect(0,0,o,t),n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(a,0,0),n.restore();const p=window.devicePixelRatio||1;n.setTransform(p,0,0,p,0,0),Ma(n,r,t)},g=()=>{n&&(f&&(d(),f=!1),l=requestAnimationFrame(g))},w=()=>{if(!e||!n)return;const p=X(e,n);o=p.width,t=p.height,c(),f=!0};return{id:"piano",name:"Piano Visuel",description:"Peins avec ta voix",mount:p=>{const y=M("div",{});Aa(y);const b=M("button",{},"← Accueil");Ea(b),b.addEventListener("click",()=>{window.location.hash="#menu"});const T=M("p",{},"Piano Visuel");Ia(T);const v=M("button",{},"Effacer");Ra(v),v.addEventListener("click",h),y.appendChild(b),y.appendChild(T),y.appendChild(v),p.appendChild(y);const m=J(y);e=m.canvas,n=m.ctx,o=m.width,t=m.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),c(),r=0,f=!0,i=w,window.addEventListener("resize",i),g()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),i&&(window.removeEventListener("resize",i),i=null),e=null,n=null,a=null,s=null,r=0,f=!1,o=0,t=0},update:p=>{if(s){if(r+=ba,r>o&&(r=0),p.isVoicing&&p.pitch!==null){const y=va(p.pitch,t),b=Pa(p.volume),T=Ta(p.pitch);Ca(s,r,y,b,T)}f=!0}}}},Fa=1.3,Oa=.06,_a=.03,La=.6,Rn=6,kn=2.5,Ba=.015,Da=10,ct=50,Wa=4,K=(e,n,o,t,l,i,a,s)=>{e.beginPath(),e.moveTo(n,o),e.lineTo(t,l),e.lineTo(i,a),e.closePath(),e.fillStyle=s,e.fill()},Ae=(e,n,o,t,l,i)=>{e.beginPath(),e.ellipse(n,o,t,l,0,0,Math.PI*2),e.fillStyle=i,e.fill()},L=(e,n,o,t,l)=>{e.beginPath(),e.arc(n,o,t,0,Math.PI*2),e.fillStyle=l,e.fill()},Na=(e,n,o,t,l)=>{L(e,n,o,t,l),K(e,n-t*.7,o-t*.4,n-t*.35,o-t*1.15,n-t*.05,o-t*.55,l),K(e,n+t*.05,o-t*.55,n+t*.35,o-t*1.15,n+t*.7,o-t*.4,l);const i=u("#fca5a5",.8);K(e,n-t*.58,o-t*.48,n-t*.38,o-t*.95,n-t*.15,o-t*.58,i),K(e,n+t*.15,o-t*.58,n+t*.38,o-t*.95,n+t*.58,o-t*.48,i),L(e,n-t*.3,o-t*.15,t*.13,"#2d3748"),L(e,n+t*.3,o-t*.15,t*.13,"#2d3748"),L(e,n-t*.26,o-t*.2,t*.045,"#ffffff"),L(e,n+t*.34,o-t*.2,t*.045,"#ffffff"),K(e,n,o+t*.05,n-t*.08,o+t*.15,n+t*.08,o+t*.15,"#f472b6"),e.beginPath(),e.moveTo(n,o+t*.15),e.lineTo(n-t*.12,o+t*.3),e.moveTo(n,o+t*.15),e.lineTo(n+t*.12,o+t*.3),e.strokeStyle="#2d3748",e.lineWidth=1.5,e.stroke(),e.beginPath(),e.moveTo(n-t*.3,o+t*.1),e.lineTo(n-t*.85,o+t*0),e.moveTo(n-t*.3,o+t*.2),e.lineTo(n-t*.85,o+t*.25),e.moveTo(n+t*.3,o+t*.1),e.lineTo(n+t*.85,o+t*0),e.moveTo(n+t*.3,o+t*.2),e.lineTo(n+t*.85,o+t*.25),e.strokeStyle="#94a3b8",e.lineWidth=1.2,e.stroke()},Ha=(e,n,o,t,l)=>{L(e,n,o,t,l),L(e,n,o+t*.2,t*.6,u("#fef3c7",.9));const i=t*.3;L(e,n-t*.32,o-t*.15,i,"#ffffff"),L(e,n+t*.32,o-t*.15,i,"#ffffff"),L(e,n-t*.32,o-t*.15,i*.55,"#2d3748"),L(e,n+t*.32,o-t*.15,i*.55,"#2d3748"),L(e,n-t*.26,o-t*.22,i*.2,"#ffffff"),L(e,n+t*.38,o-t*.22,i*.2,"#ffffff"),e.beginPath(),e.arc(n-t*.32,o-t*.15,i,0,Math.PI*2),e.strokeStyle=u("#2d3748",.3),e.lineWidth=1.5,e.stroke(),e.beginPath(),e.arc(n+t*.32,o-t*.15,i,0,Math.PI*2),e.stroke(),K(e,n,o+t*.05,n-t*.1,o+t*.2,n+t*.1,o+t*.2,"#f59e0b"),K(e,n-t*.55,o-t*.65,n-t*.35,o-t*1.1,n-t*.15,o-t*.65,l),K(e,n+t*.15,o-t*.65,n+t*.35,o-t*1.1,n+t*.55,o-t*.65,l)},$a=(e,n,o,t,l)=>{L(e,n,o,t*.85,l),L(e,n-t*.6,o-t*.7,t*.5,l),L(e,n+t*.6,o-t*.7,t*.5,l),L(e,n-t*.6,o-t*.7,t*.32,u("#fca5a5",.7)),L(e,n+t*.6,o-t*.7,t*.32,u("#fca5a5",.7)),L(e,n-t*.25,o-t*.15,t*.12,"#2d3748"),L(e,n+t*.25,o-t*.15,t*.12,"#2d3748"),L(e,n-t*.21,o-t*.2,t*.04,"#ffffff"),L(e,n+t*.29,o-t*.2,t*.04,"#ffffff"),L(e,n,o+t*.15,t*.1,"#f472b6"),e.beginPath(),e.moveTo(n-t*.2,o+t*.15),e.lineTo(n-t*.75,o+t*.05),e.moveTo(n-t*.2,o+t*.22),e.lineTo(n-t*.75,o+t*.28),e.moveTo(n+t*.2,o+t*.15),e.lineTo(n+t*.75,o+t*.05),e.moveTo(n+t*.2,o+t*.22),e.lineTo(n+t*.75,o+t*.28),e.strokeStyle="#94a3b8",e.lineWidth=1,e.stroke(),e.beginPath(),e.moveTo(n+t*.5,o+t*.6),e.quadraticCurveTo(n+t*1.5,o+t*.2,n+t*1.3,o-t*.3),e.strokeStyle=l,e.lineWidth=2.5,e.lineCap="round",e.stroke()},Ga=(e,n,o,t,l)=>{L(e,n-t*.65,o-t*.65,t*.32,l),L(e,n+t*.65,o-t*.65,t*.32,l),L(e,n-t*.65,o-t*.65,t*.18,u("#d4a574",.8)),L(e,n+t*.65,o-t*.65,t*.18,u("#d4a574",.8)),L(e,n,o,t,l),Ae(e,n,o+t*.15,t*.4,t*.3,u("#d4a574",.7)),L(e,n-t*.3,o-t*.15,t*.11,"#2d3748"),L(e,n+t*.3,o-t*.15,t*.11,"#2d3748"),L(e,n-t*.27,o-t*.2,t*.04,"#ffffff"),L(e,n+t*.33,o-t*.2,t*.04,"#ffffff"),Ae(e,n,o+t*.05,t*.11,t*.08,"#2d3748"),e.beginPath(),e.moveTo(n,o+t*.13),e.lineTo(n-t*.08,o+t*.25),e.moveTo(n,o+t*.13),e.lineTo(n+t*.08,o+t*.25),e.strokeStyle="#2d3748",e.lineWidth=1.2,e.stroke()},ja=(e,n,o,t,l)=>{Ae(e,n,o,t*.9,t,l),Ae(e,n,o+t*.2,t*.55,t*.55,u("#fef3c7",.8)),e.beginPath(),e.ellipse(n-t*.55,o-t*.05,t*.5,t*.28,-.3,0,Math.PI*2),e.fillStyle=u(l,.7),e.fill(),L(e,n+t*.15,o-t*.25,t*.12,"#2d3748"),L(e,n+t*.19,o-t*.3,t*.04,"#ffffff"),K(e,n+t*.55,o-t*.15,n+t*.55,o+t*.05,n+t*.95,o-t*.05,"#f59e0b"),K(e,n-t*.7,o-t*.3,n-t*1.15,o-t*.65,n-t*.5,o-t*.6,l),K(e,n-t*.75,o-t*.15,n-t*1.25,o-t*.35,n-t*.6,o-t*.45,u(l,.8))},te=[{name:"Chat",vowel:"a",label:"AAA",draw:Na},{name:"Hibou",vowel:"o",label:"OOO",draw:Ha},{name:"Souris",vowel:"i",label:"III",draw:$a},{name:"Ours",vowel:"u",label:"UUU",draw:Ga},{name:"Oiseau",vowel:"e",label:"EEE",draw:ja}],Ua=(e,n,o)=>{const t=[];for(let l=0;l<Rn;l++){const i=Math.PI*2*l/Rn+(Math.random()-.5)*.5;t.push({x:e,y:n-ct,vx:Math.cos(i)*kn*(.7+Math.random()*.6),vy:Math.sin(i)*kn*(.7+Math.random()*.6)-1.5,alpha:1,size:Da*(.7+Math.random()*.6),kind:Math.random()>.5?"heart":"star",color:o})}return t},Ya=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,vy:e.vy+.04,alpha:e.alpha-Ba}),Va=e=>e.alpha>0,Xa=(e,n,o,t,l,i)=>{e.save(),e.globalAlpha=i,e.fillStyle=l,e.beginPath();const a=t*.5;e.moveTo(n,o+a*.3),e.bezierCurveTo(n,o-a*.2,n-a,o-a*.5,n-a,o+a*.1),e.bezierCurveTo(n-a,o+a*.6,n,o+a*.9,n,o+a*1.1),e.bezierCurveTo(n,o+a*.9,n+a,o+a*.6,n+a,o+a*.1),e.bezierCurveTo(n+a,o-a*.5,n,o-a*.2,n,o+a*.3),e.fill(),e.restore()},qa=(e,n,o,t,l,i)=>{e.save(),e.globalAlpha=i,e.fillStyle=l,e.beginPath();const a=5,s=t*.5,r=s*.4;for(let f=0;f<a*2;f++){const c=f%2===0?s:r,h=Math.PI*f/a-Math.PI/2,d=n+Math.cos(h)*c,g=o+Math.sin(h)*c;f===0?e.moveTo(d,g):e.lineTo(d,g)}e.closePath(),e.fill(),e.restore()},Ka=(e,n)=>{n.kind==="heart"?Xa(e,n.x,n.y,n.size,n.color,n.alpha):qa(e,n.x,n.y,n.size,n.color,n.alpha)},Za=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:C.bg})},Ja=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:C.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u(C.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Qa=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:C.text,margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},Fn=(e,n,o)=>{const t=e/(o+1),l=n*.42,i=[];for(let a=0;a<o;a++)i.push({x:t*(a+1),y:l});return i},za=()=>{let e=null,n=null,o=0,t=0,l=null,i=null,a=te.map(()=>({scale:1,targetScale:1,glowAlpha:0,feedCount:0,particles:[]})),s=0,r=null;const f=()=>{a=te.map(()=>({scale:1,targetScale:1,glowAlpha:0,feedCount:0,particles:[]})),s=0,r=null},c=()=>{const p=o/(te.length*2.5),y=t*.15;return Math.max(25,Math.min(ct,p,y))},h=()=>{if(!n)return;ee(n,o,t),n.fillStyle=C.bg,n.fillRect(0,0,o,t);const p=Fn(o,t,te.length),y=c();for(let b=0;b<te.length;b++){const T=te[b],v=a[b],m=p[b],P=Y[T.vowel]??C.primary;if(n.save(),v.glowAlpha>0){const O=y*1.6*v.scale,I=n.createRadialGradient(m.x,m.y,y*.3,m.x,m.y,O);I.addColorStop(0,u(P,v.glowAlpha*.5)),I.addColorStop(1,u(P,0)),n.fillStyle=I,n.fillRect(m.x-O,m.y-O,O*2,O*2)}n.translate(m.x,m.y),n.scale(v.scale,v.scale),n.translate(-m.x,-m.y),T.draw(n,m.x,m.y,y,P),n.restore();for(const O of v.particles)Ka(n,O);const S=m.y+y*1.6;n.font=`bold ${Math.round(y*.55)}px system-ui, -apple-system, sans-serif`,n.textAlign="center",n.textBaseline="top",n.fillStyle=P,n.fillText(T.label,m.x,S);const E=m.y-y*1.5;n.font=`600 ${Math.round(y*.38)}px system-ui, -apple-system, sans-serif`,n.fillStyle=C.text,n.fillText(T.name,m.x,E);const k=m.y+y*1.6+y*.65;n.font=`600 ${Math.round(y*.32)}px system-ui, -apple-system, sans-serif`,n.fillStyle=C.muted,n.fillText(`${v.feedCount}`,m.x,k)}},d=()=>{a=a.map(p=>{const y=p.scale+(p.targetScale-p.scale)*Oa*3,b=Math.max(0,p.glowAlpha-_a),T=p.particles.map(Ya).filter(Va),v=Math.abs(p.scale-1)<.01&&p.targetScale>1||p.targetScale>1&&y>p.targetScale*.95?1:p.targetScale;return{...p,scale:y,targetScale:v,glowAlpha:b,particles:T}}),h(),l=requestAnimationFrame(d)},g=()=>{if(!e||!n)return;const p=X(e,n);o=p.width,t=p.height},w=p=>{const y=te[p],b=Fn(o,t,te.length)[p],T=Y[y.vowel]??C.primary;a=a.map((v,m)=>m!==p?v:{...v,targetScale:Fa,glowAlpha:La,feedCount:v.feedCount+1,particles:[...v.particles,...Ua(b.x,b.y,T)]})};return{id:"animals",name:"Nourrir les Animaux",description:"Nourris les animaux en prononçant la bonne voyelle !",mount:p=>{const y=M("div",{});Za(y);const b=M("button",{},"← Accueil");Ja(b),b.addEventListener("click",()=>{window.location.hash="#menu"});const T=M("p",{},"Nourrir les Animaux");Qa(T),y.appendChild(b),y.appendChild(T),p.appendChild(y);const v=J(y);e=v.canvas,n=v.ctx,o=v.width,t=v.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),i=g,window.addEventListener("resize",i),f(),d()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),i&&(window.removeEventListener("resize",i),i=null),e=null,n=null,o=0,t=0,f()},update:p=>{if(!p.isVoicing||p.vowel===null){s=0,r=null;return}if(s+=1,s>=Wa&&p.vowel!==r){const y=te.findIndex(b=>b.vowel===p.vowel);y!==-1&&(w(y),r=p.vowel)}}}},ae=["a","e","i","o","u"],Ee=5,xa=.04,On=.18,ht=.88,Xe=.15,ut=.04,ei=.06,ni=.03,ti=2,oi=Math.round(ti*60),pt=.35,gt=3,_n=["#ef4444","#f59e0b","#22c55e","#3b82f6","#ec4899","#f97316"],Ln=["#f472b6","#c084fc","#67e8f9","#fbbf24","#a78bfa"],Bn=["#fbbf24","#fde047","#f59e0b","#fcd34d","#facc15"],Dn=["#93c5fd","#a5b4fc","#c4b5fd","#67e8f9","#7dd3fc"],G=(e,n)=>e+Math.random()*(n-e),Be=()=>ae.map(e=>({vowel:e,color:Y[e]??C.primary,openAmount:0,isOpening:!1,surpriseTime:0,surpriseFrame:0})),Ie=(e,n,o)=>{const t=n*xa,l=t*(Ee+1),i=(n-l)/Ee,a=t+e*(i+t),s=o*On,r=o*(ht-On);return{x:a,y:s,w:i,h:r}},li=(e,n)=>{const o=[];for(let l=0;l<18;l++){const i=Math.PI*2*l/18+G(-.2,.2),a=G(1.5,4);o.push({x:e,y:n,vx:Math.cos(i)*a,vy:Math.sin(i)*a,color:_n[Math.floor(Math.random()*_n.length)],alpha:1,size:G(3,7),life:1})}return o},ai=(e,n,o)=>{const t=[];for(let i=0;i<8;i++)t.push({x:e+G(-20,20),y:n+G(0,o*.5),vx:G(-.8,.8),vy:G(-2,-.8),color:Ln[Math.floor(Math.random()*Ln.length)],alpha:1,size:G(6,12),life:1});return t},ii=(e,n,o)=>{const t=[];for(let i=0;i<15;i++)t.push({x:e+G(-o*.4,o*.4),y:n-G(10,40),vx:G(-.5,.5),vy:G(1,3),color:Bn[Math.floor(Math.random()*Bn.length)],alpha:1,size:G(4,8),life:1});return t},si=(e,n,o)=>{const t=[];for(let i=0;i<10;i++)t.push({x:e+G(-15,15),y:n+G(0,o*.5),vx:G(-.3,.3),vy:G(-2.5,-1),color:Dn[Math.floor(Math.random()*Dn.length)],alpha:.85,size:G(5,14),life:1});return t},ri=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,alpha:Math.max(0,e.alpha-.008),life:Math.max(0,e.life-.008)}),di=e=>e.life>0&&e.alpha>0,mt=(e,n,o,t,l,i,a,s)=>{e.beginPath(),e.moveTo(n,o+l),e.lineTo(n,o+i),e.arcTo(n,o,n+t/2,o,i),e.arcTo(n+t,o,n+t,o+i,i),e.lineTo(n+t,o+l),e.closePath(),e.fillStyle=a,e.fill(),e.strokeStyle=s,e.lineWidth=gt,e.stroke()},bt=(e,n,o,t,l,i)=>{const a=n+t*.75,s=o+l*.52;e.beginPath(),e.arc(a,s,i,0,Math.PI*2),e.fillStyle="#d4af37",e.fill(),e.strokeStyle="#b8960c",e.lineWidth=1.5,e.stroke(),e.beginPath(),e.arc(a-i*.25,s-i*.25,i*.35,0,Math.PI*2),e.fillStyle=u("#ffffff",.5),e.fill()},St=(e,n,o,t,l,i,a)=>{e.font=`bold ${a}px sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillStyle=u("#ffffff",.9),e.fillText(n.toUpperCase(),o+l/2,t+i*.45)},fi=(e,n,o,t,l)=>{const{x:i,y:a,w:s,h:r}=Ie(o,t,l),f=r*Xe,c=s*ut;mt(e,i,a,s,r,f,n.color,u(n.color,.7)),bt(e,i,a,s,r,c),St(e,n.vowel,i,a,s,r,s*pt)},ci=(e,n,o,t,l,i,a)=>{e.beginPath(),e.moveTo(n,o+l),e.lineTo(n,o+i),e.arcTo(n,o,n+t/2,o,i),e.arcTo(n+t,o,n+t,o+i,i),e.lineTo(n+t,o+l),e.closePath(),e.fillStyle=u(a,.12),e.fill(),e.strokeStyle=u(a,.4),e.lineWidth=gt,e.stroke()},hi=(e,n,o,t,l)=>{const{x:i,y:a,w:s,h:r}=Ie(o,t,l),f=r*Xe,c=n.openAmount;ci(e,i,a,s,r,f,n.color);const h=s*(1-c*.8),d=i+(s-h),g=h*ut,w=u("#000000",c*.15);e.save(),mt(e,d,a,h,r,f*(1-c*.3),n.color,u(n.color,.7)),e.beginPath(),e.moveTo(d,a+r),e.lineTo(d,a+f),e.arcTo(d,a,d+h/2,a,f*(1-c*.3)),e.arcTo(d+h,a,d+h,a+f,f*(1-c*.3)),e.lineTo(d+h,a+r),e.closePath(),e.fillStyle=w,e.fill(),c<.6&&(bt(e,d,a,h,r,g),St(e,n.vowel,d,a,h,r,h*pt)),e.restore()},ui=(e,n)=>{e.beginPath(),e.arc(n.x,n.y,n.size,0,Math.PI*2),e.fillStyle=u(n.color,n.alpha),e.fill()},pi=(e,n,o)=>{const t=Math.sin(o*.15+n.x)*4;e.save(),e.translate(n.x,n.y),e.fillStyle=u(n.color,n.alpha),e.beginPath(),e.ellipse(-n.size*.4,0,n.size*.5,n.size*.3+t*.3,-.3,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(n.size*.4,0,n.size*.5,n.size*.3+t*.3,.3,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(0,0,n.size*.12,n.size*.4,0,0,Math.PI*2),e.fillStyle=u("#4a3728",n.alpha),e.fill(),e.restore()},gi=(e,n,o)=>{const t=o*.03+n.x*.01,l=5,i=n.size,a=n.size*.45;e.save(),e.translate(n.x,n.y),e.rotate(t),e.beginPath();for(let s=0;s<l*2;s++){const r=Math.PI*s/l-Math.PI/2,f=s%2===0?i:a;s===0?e.moveTo(Math.cos(r)*f,Math.sin(r)*f):e.lineTo(Math.cos(r)*f,Math.sin(r)*f)}e.closePath(),e.fillStyle=u(n.color,n.alpha),e.fill(),e.restore()},mi=(e,n,o,t,l,i)=>{const a=["#ef4444","#f97316","#fbbf24","#22c55e","#3b82f6","#8b5cf6","#a855f7"],s=n+t/2,r=o+l*.8,f=t*.45,c=f/(a.length+2),h=Math.PI*Math.min(i,1);e.save(),e.beginPath(),e.rect(n,o,t,l),e.clip();for(let d=0;d<a.length;d++){const g=f-d*c;e.beginPath(),e.arc(s,r,g,Math.PI,Math.PI+h,!1),e.strokeStyle=u(a[d],.8),e.lineWidth=c*.9,e.lineCap="round",e.stroke()}e.restore()},bi=(e,n)=>{e.beginPath(),e.arc(n.x,n.y,n.size,0,Math.PI*2),e.fillStyle=u(n.color,n.alpha*.4),e.fill(),e.strokeStyle=u(n.color,n.alpha*.7),e.lineWidth=1.5,e.stroke(),e.beginPath(),e.arc(n.x-n.size*.25,n.y-n.size*.25,n.size*.25,0,Math.PI*2),e.fillStyle=u("#ffffff",n.alpha*.6),e.fill()},Si=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:C.bg})},yi=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:C.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u(C.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},wi=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u(C.primary,.5),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},vi=()=>{let e=null,n=null,o=0,t=0,l=null,i=null,a=[...Be()],s=ae.map(()=>[]),r=ae.map(()=>!1);const f=p=>{const y=a[p];y.isOpening||(a[p]={...y,isOpening:!0,surpriseTime:oi,surpriseFrame:0},r[p]=!1)},c=()=>{a=a.map((p,y)=>{if(p.isOpening){const b=Math.min(1,p.openAmount+ei),T=p.surpriseTime-1,v=p.surpriseFrame+1;if(b>.4&&!r[y]){const m=Ie(y,o,t),P=m.x+m.w/2,S=m.y+m.h/2;switch(p.vowel){case"a":s[y]=li(P,S);break;case"e":s[y]=ai(P,S,m.h);break;case"i":s[y]=ii(P,m.y,m.w);break;case"o":s[y]=[];break;case"u":s[y]=si(P,S,m.h);break}r[y]=!0}return T<=0?{...p,openAmount:b,isOpening:!1,surpriseTime:0,surpriseFrame:v}:{...p,openAmount:b,surpriseTime:T,surpriseFrame:v}}if(p.openAmount>0){const b=Math.max(0,p.openAmount-ni);return b===0&&(s[y]=[],r[y]=!1),{...p,openAmount:b,surpriseFrame:p.surpriseFrame+1}}return p}),s=s.map(p=>p.map(ri).filter(di))},h=()=>{if(n)for(let p=0;p<Ee;p++){const y=a[p];if(y.openAmount<.3)continue;const b=Ie(p,o,t);n.save();const T=b.h*Xe;switch(n.beginPath(),n.moveTo(b.x,b.y+b.h),n.lineTo(b.x,b.y+T),n.arcTo(b.x,b.y,b.x+b.w/2,b.y,T),n.arcTo(b.x+b.w,b.y,b.x+b.w,b.y+T,T),n.lineTo(b.x+b.w,b.y+b.h),n.closePath(),n.clip(),y.vowel){case"a":for(const v of s[p])ui(n,v);break;case"e":for(const v of s[p])pi(n,v,y.surpriseFrame);break;case"i":for(const v of s[p])gi(n,v,y.surpriseFrame);break;case"o":{const v=Math.min(1,y.surpriseFrame/40);mi(n,b.x,b.y,b.w,b.h,v);break}case"u":for(const v of s[p])bi(n,v);break}n.restore()}},d=()=>{if(!n)return;const p=t*ht;n.fillStyle=u(C.muted,.15),n.fillRect(0,p,o,t-p),n.strokeStyle=u(C.muted,.25),n.lineWidth=1,n.beginPath(),n.moveTo(0,p),n.lineTo(o,p),n.stroke()},g=()=>{if(n){ee(n,o,t),d(),c(),h();for(let p=0;p<Ee;p++){const y=a[p];y.openAmount>0?hi(n,y,p,o,t):fi(n,y,p,o,t)}l=requestAnimationFrame(g)}},w=()=>{if(!e||!n)return;const p=X(e,n);o=p.width,t=p.height};return{id:"doors",name:"Portes Magiques",description:"Ouvre les portes magiques avec ta voix !",mount:p=>{const y=M("div",{});Si(y);const b=M("button",{},"← Accueil");yi(b),b.addEventListener("click",()=>{window.location.hash="#menu"});const T=M("p",{},"Portes Magiques");wi(T),y.appendChild(b),y.appendChild(T),p.appendChild(y);const v=J(y);e=v.canvas,n=v.ctx,o=v.width,t=v.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),i=w,window.addEventListener("resize",i),a=[...Be()],s=ae.map(()=>[]),r=ae.map(()=>!1),g()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),i&&(window.removeEventListener("resize",i),i=null),e=null,n=null,o=0,t=0,a=[...Be()],s=ae.map(()=>[]),r=ae.map(()=>!1)},update:p=>{if(!p.isVoicing||p.vowel===null)return;const y=p.vowel,b=ae.indexOf(y);b!==-1&&(p.volume<.05||f(b))}}},be=.15,Ti=4,Ue=.55,Wn=18,Nn=10,pe=8,Pi=14,Ci=20,Mi=.5,Hn=8,Ai=60,Q=40,$n=12,Gn=20,qe=3,Ke=.002,jn=.3,yt=60,Un=8,De="#f472b6",ge=(e,n)=>e+Math.random()*(n-e),Ye=(e,n)=>Math.min(e/2,1)*n,Yn=(e,n,o)=>({x:e,stemHeight:0,maxDuration:n,color:o,petalCount:n>=4?8:5,hasLeaves:n>=1,hasBud:n>=2,isOpen:n>=3,isFullBloom:n>=4,hasSparkles:n>=5}),Vn=(e,n)=>({x:e+ge(-30,30),y:n+ge(-30,10),size:ge(2,5),alpha:1,vx:ge(-.5,.5),vy:ge(-1.5,-.3),life:yt}),Xn=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,alpha:e.life/yt,life:e.life-1}),qn=e=>e.life>0,Ei=(e,n,o)=>{const t=e.createLinearGradient(0,0,0,o);t.addColorStop(0,"#87CEEB"),t.addColorStop(.6,"#B0E0F0"),t.addColorStop(.85,"#d4f0d4"),e.fillStyle=t,e.fillRect(0,0,n,o)},Ii=(e,n,o)=>{const t=o*(1-be),l=e.createLinearGradient(0,t,0,o);l.addColorStop(0,"#5cb85c"),l.addColorStop(1,"#3a8a3a"),e.fillStyle=l,e.fillRect(0,t,n,o*be),e.beginPath(),e.moveTo(0,t);for(let i=0;i<=n;i+=20){const a=t+Math.sin(i*.05)*4;e.lineTo(i,a)}e.lineTo(n,t+10),e.lineTo(0,t+10),e.closePath(),e.fillStyle="#5cb85c",e.fill()},Ri=(e,n,o)=>{const t=n-70,l=70,i=1+Math.sin(o*.001)*.05,a=e.createRadialGradient(t,l,0,t,l,Q*2);a.addColorStop(0,u("#FFD700",.3)),a.addColorStop(1,u("#FFD700",0)),e.fillStyle=a,e.fillRect(t-Q*2,l-Q*2,Q*4,Q*4),e.save(),e.translate(t,l),e.rotate(o*3e-4);for(let s=0;s<$n;s++){const r=s/$n*Math.PI*2;e.beginPath(),e.moveTo(Math.cos(r)*Q*i,Math.sin(r)*Q*i),e.lineTo(Math.cos(r)*(Q+Gn)*i,Math.sin(r)*(Q+Gn)*i),e.strokeStyle=u("#FFD700",.6),e.lineWidth=3,e.stroke()}e.restore(),e.beginPath(),e.arc(t,l,Q*i,0,Math.PI*2),e.fillStyle="#FFD700",e.fill(),e.fillStyle="#E6A800",e.beginPath(),e.arc(t-12,l-8,4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(t+12,l-8,4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(t,l+2,14,.15*Math.PI,.85*Math.PI),e.strokeStyle="#E6A800",e.lineWidth=2.5,e.stroke()},ki=(e,n,o,t,l,i)=>{const a=o-t,s=Math.sin(l*Ke+i)*qe,r=n+s,f=o-t*.5;e.beginPath(),e.moveTo(n,o),e.quadraticCurveTo(r,f,n+s,a),e.strokeStyle="#2d8a4e",e.lineWidth=Ti,e.lineCap="round",e.stroke()},Fi=(e,n,o,t,l,i)=>{const a=Math.sin(l*Ke+i)*qe,s=o-t*.4,r=n+a*.4-2;e.save(),e.translate(r,s),e.rotate(-.6),e.beginPath(),e.ellipse(0,0,Wn,Nn,0,0,Math.PI*2),e.fillStyle="#34d399",e.fill(),e.restore();const f=o-t*.65,c=n+a*.65+2;e.save(),e.translate(c,f),e.rotate(.6),e.beginPath(),e.ellipse(0,0,Wn,Nn,0,0,Math.PI*2),e.fillStyle="#34d399",e.fill(),e.restore()},Oi=(e,n,o,t)=>{e.save(),e.translate(n,o),e.beginPath(),e.ellipse(0,0,pe*.8,pe*1.2,0,0,Math.PI*2),e.fillStyle="#2d8a4e",e.fill(),e.beginPath(),e.ellipse(0,-pe*.3,pe*.5,pe*.5,0,0,Math.PI*2),e.fillStyle=u(t,.6),e.fill(),e.restore()},_i=(e,n,o,t,l,i,a)=>{const s=i?Ci:Pi,r=s*Mi,f=1+Math.sin(a*.003)*.03;e.save(),e.translate(n,o);for(let c=0;c<l;c++){const h=c/l*Math.PI*2;e.save(),e.rotate(h),e.beginPath(),e.ellipse(0,-s*.7*f,r*f,s*f,0,0,Math.PI*2),e.fillStyle=u(t,.85),e.fill(),e.beginPath(),e.ellipse(0,-s*.55*f,r*.5*f,s*.5*f,0,0,Math.PI*2),e.fillStyle=u("#ffffff",.25),e.fill(),e.restore()}e.beginPath(),e.arc(0,0,Hn*f,0,Math.PI*2),e.fillStyle="#FFD700",e.fill(),e.beginPath(),e.arc(-2,-2,Hn*.5*f,0,Math.PI*2),e.fillStyle=u("#ffffff",.4),e.fill(),e.restore()},Li=(e,n)=>{e.save(),e.globalAlpha=n.alpha;const o=n.size;e.fillStyle="#FFD700",e.beginPath(),e.moveTo(n.x,n.y-o),e.lineTo(n.x+o*.3,n.y-o*.3),e.lineTo(n.x+o,n.y),e.lineTo(n.x+o*.3,n.y+o*.3),e.lineTo(n.x,n.y+o),e.lineTo(n.x-o*.3,n.y+o*.3),e.lineTo(n.x-o,n.y),e.lineTo(n.x-o*.3,n.y-o*.3),e.closePath(),e.fill(),e.restore()},Kn=(e,n,o,t,l)=>{const a=o*(1-be)+5,s=o*Ue,r=Ye(n.maxDuration,s),f=n.x*.1,c=Math.sin(t*Ke+f)*qe,h=n.x+c,d=a-r;n.maxDuration>0&&ki(e,n.x,a,r,t,f),n.hasLeaves&&Fi(e,n.x,a,r,t,f),n.hasBud&&!n.isOpen&&Oi(e,h,d,n.color),n.isOpen&&_i(e,h,d,n.color,n.petalCount,n.isFullBloom,t);for(const g of l)Li(e,g)},Bi=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden"})},Di=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:C.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u(C.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Wi=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u(C.text,.7),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:u(C.surface,.6),borderRadius:"12px",backdropFilter:"blur(4px)"})},Ni=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",fontSize:"1.1rem",fontWeight:"600",color:C.text,margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:u(C.surface,.8),borderRadius:"12px",backdropFilter:"blur(4px)"})},Hi=(e,n)=>{if(e.length===0)return n/2;const o=n/2,t=e.length,l=t%2===0?1:-1,i=Math.ceil(t/2)*Ai,a=o+l*i,s=40;return Math.max(s,Math.min(n-s,a))},$i=()=>{let e=null,n=null,o=0,t=0,l=null,i=null,a=[],s=0,r=0,f=De,c=!1,h=!1,d=new Map,g=null,w=0;const A=()=>{if(!g)return;const T=a.length;g.textContent=T===0?"Jardin: 0 fleur":T===1?"Jardin: 1 fleur":`Jardin: ${T} fleurs`},F=()=>{if(!n)return;const T=performance.now()-w;ee(n,o,t),Ei(n,o,t),Ri(n,o,T),Ii(n,o,t);for(let v=0;v<a.length;v++){const m=a[v],P=d.get(v)??[];if(m.hasSparkles&&P.length<Un&&Math.random()<jn){const E=t*(1-be),k=t*Ue,O=Ye(m.maxDuration,k),I=E+5-O;P.push(Vn(m.x,I))}const S=P.map(Xn).filter(qn);d.set(v,S),Kn(n,m,t,T,S)}if(h&&r>0){const v=Yn(s,r,f),m=d.get(-1)??[];if(v.hasSparkles&&m.length<Un&&Math.random()<jn){const S=t*(1-be),E=t*Ue,k=Ye(v.maxDuration,E),O=S+5-k;m.push(Vn(s,O))}const P=m.map(Xn).filter(qn);d.set(-1,P),Kn(n,v,t,T,P)}l=requestAnimationFrame(F)},R=()=>{if(!e||!n)return;const T=X(e,n);o=T.width,t=T.height};return{id:"flower",name:"Faire Pousser",description:"Fais pousser des fleurs avec ta voix !",mount:T=>{const v=M("div",{});Bi(v);const m=M("button",{},"← Accueil");Di(m),m.addEventListener("click",()=>{window.location.hash="#menu"});const P=M("p",{},"Faire Pousser");Wi(P),g=M("p",{},"Jardin: 0 fleur"),Ni(g),v.appendChild(m),v.appendChild(P),v.appendChild(g),T.appendChild(v);const S=J(v);e=S.canvas,n=S.ctx,o=S.width,t=S.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),i=R,window.addEventListener("resize",i),a=[],d=new Map,r=0,f=De,c=!1,h=!1,s=o/2,w=performance.now(),A(),F()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),i&&(window.removeEventListener("resize",i),i=null),e=null,n=null,g=null,a=[],d=new Map,r=0,c=!1,h=!1,o=0,t=0},update:T=>{const v=T.isVoicing;if(v)c||(h=!0,s=Hi(a,o),r=0,f=De,d.delete(-1)),r=T.duration,T.vowel!==null&&Y[T.vowel]&&(f=Y[T.vowel]);else if(c&&h&&r>.1){const m=Yn(s,r,f);a.push(m);const P=d.get(-1)??[];d.set(a.length-1,P),d.delete(-1),h=!1,r=0,A()}else v||(h=!1,r=0,d.delete(-1));c=v}}},We=20,Gi=130,ji=.72,Ui=100,Yi=8,Vi=.003,Zn=2,Jn=3,oe=3,me=4,Xi=40,wt=80,qi=.12,Qn=["#ef4444","#f59e0b","#22c55e","#3b82f6","#8b5cf6","#ec4899","#f97316","#06b6d4","#FFD700","#ff6b6b"],Ki=5,Zi=60,Ji=2e3,Qi=-1.2,zn=.3,zi="#87CEEB",xi="#B0E0F0",es="#d4f0d4",ns="#ffffff",x=(e,n)=>e+Math.random()*(n-e),ue=(e,n,o)=>Math.max(n,Math.min(o,e)),Ne=e=>{if(e<=0)return We;const n=ue(e/me,0,1);return We+n*(Gi-We)},ts=(e,n)=>{if(e<oe)return n;const o=ue((e-oe)/(me-oe),0,1),t=parseInt(n.slice(1,3),16),l=parseInt(n.slice(3,5),16),i=parseInt(n.slice(5,7),16),a=Math.round(t+(240-t)*o),s=Math.round(l+(80-l)*o),r=Math.round(i+(80-i)*o);return`rgb(${a}, ${s}, ${r})`},os=(e,n)=>({x:e,y:n,vx:x(-6,6),vy:x(-10,-2),size:x(4,10),color:Qn[Math.floor(Math.random()*Qn.length)],life:wt,gravity:qi,rotation:x(0,Math.PI*2),rotationSpeed:x(-.15,.15),shape:["circle","rect","star"][Math.floor(Math.random()*3)]}),ls=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,vy:e.vy+e.gravity,vx:e.vx*.99,life:e.life-1,rotation:e.rotation+e.rotationSpeed}),as=e=>e.life>0,is=(e,n,o)=>{const t=x(0,Math.PI*2),l=x(o*.6,o*1.2);return{x:e+Math.cos(t)*l,y:n+Math.sin(t)*l,size:x(3,7),alpha:1,angle:t,speed:x(.3,.8)}},ss=e=>({...e,x:e.x+Math.cos(e.angle)*e.speed,y:e.y+Math.sin(e.angle)*e.speed,alpha:e.alpha-1/Zi}),rs=e=>e.alpha>0,ds=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,alpha:e.alpha-.004,stringAngle:e.stringAngle+.02}),fs=e=>e.alpha>0&&e.y+e.radiusY>-50,cs=(e,n,o)=>{const t=e.createLinearGradient(0,0,0,o);t.addColorStop(0,zi),t.addColorStop(.6,xi),t.addColorStop(1,es),e.fillStyle=t,e.fillRect(0,0,n,o)},He=(e,n,o,t)=>{e.save(),e.translate(n,o),e.scale(t,t),e.fillStyle=u(ns,.6);const l=[{cx:0,cy:0,r:25},{cx:-22,cy:5,r:20},{cx:22,cy:5,r:20},{cx:-10,cy:-12,r:18},{cx:12,cy:-10,r:16}];for(const i of l)e.beginPath(),e.arc(i.cx,i.cy,i.r,0,Math.PI*2),e.fill();e.restore()},hs=(e,n,o)=>{const t=o*.01;He(e,(n*.15+t)%(n+100)-50,60,1),He(e,(n*.55+t*.7)%(n+100)-50,90,.8),He(e,(n*.85+t*.5)%(n+100)-50,45,1.2)},us=(e,n,o)=>{const t=o*.88,l=e.createLinearGradient(0,t,0,o);l.addColorStop(0,"#5cb85c"),l.addColorStop(1,"#3a8a3a"),e.fillStyle=l,e.fillRect(0,t,n,o-t),e.beginPath(),e.moveTo(0,t);for(let i=0;i<=n;i+=20){const a=t+Math.sin(i*.05)*4;e.lineTo(i,a)}e.lineTo(n,t+10),e.lineTo(0,t+10),e.closePath(),e.fillStyle="#5cb85c",e.fill()},vt=(e,n,o,t,l,i,a)=>{const s=(n+t)/2+Math.sin(i*Vi)*Yi+a,r=(o+l)/2;e.beginPath(),e.moveTo(n,o),e.quadraticCurveTo(s,r,t,l),e.strokeStyle=u(C.text,.5),e.lineWidth=2,e.lineCap="round",e.stroke()},Tt=(e,n,o,t,l,i,a)=>{e.save(),e.translate(n,o),e.rotate(a*.05),e.beginPath(),e.ellipse(0,0,t,l,0,0,Math.PI*2);const s=e.createRadialGradient(-t*.3,-l*.3,t*.1,0,0,l);s.addColorStop(0,u("#ffffff",.6)),s.addColorStop(.3,i),s.addColorStop(1,u(i,.85)),e.fillStyle=s,e.fill(),e.beginPath(),e.ellipse(-t*.3,-l*.35,t*.2,l*.15,-.4,0,Math.PI*2),e.fillStyle=u("#ffffff",.4),e.fill(),e.beginPath(),e.moveTo(-4,l),e.lineTo(0,l+8),e.lineTo(4,l),e.closePath(),e.fillStyle=i,e.fill(),e.restore()},ps=(e,n,o,t,l)=>{const i=1+Math.sin(l*.008)*.15,a=t*1.5*i,s=e.createRadialGradient(n,o,t*.8,n,o,a);s.addColorStop(0,u(C.green,.25)),s.addColorStop(1,u(C.green,0)),e.fillStyle=s,e.beginPath(),e.arc(n,o,a,0,Math.PI*2),e.fill()},gs=(e,n,o,t,l)=>{e.save(),e.globalAlpha=l,e.fillStyle="#FFD700",e.beginPath(),e.moveTo(n,o-t),e.lineTo(n+t*.3,o-t*.3),e.lineTo(n+t,o),e.lineTo(n+t*.3,o+t*.3),e.lineTo(n,o+t),e.lineTo(n-t*.3,o+t*.3),e.lineTo(n-t,o),e.lineTo(n-t*.3,o-t*.3),e.closePath(),e.fill(),e.restore()},ms=(e,n)=>{const o=ue(n.life/wt,0,1);if(e.save(),e.translate(n.x,n.y),e.rotate(n.rotation),e.globalAlpha=o,n.shape==="circle")e.beginPath(),e.arc(0,0,n.size/2,0,Math.PI*2),e.fillStyle=n.color,e.fill();else if(n.shape==="rect")e.fillStyle=n.color,e.fillRect(-n.size/2,-n.size/4,n.size,n.size/2);else{e.fillStyle=n.color,e.beginPath();for(let t=0;t<5;t++){const l=t*2*Math.PI/5-Math.PI/2,i=l+Math.PI/5,a=n.size/2,s=n.size/4;t===0?e.moveTo(Math.cos(l)*a,Math.sin(l)*a):e.lineTo(Math.cos(l)*a,Math.sin(l)*a),e.lineTo(Math.cos(i)*s,Math.sin(i)*s)}e.closePath(),e.fill()}e.restore()},bs=(e,n,o)=>{e.save(),e.globalAlpha=n.alpha,Tt(e,n.x,n.y,n.radiusX,n.radiusY,n.color,0);const t=n.x+Math.sin(n.stringAngle)*15,l=n.y+n.radiusY+8+Ui*.6;vt(e,n.x,n.y+n.radiusY+8,t,l,o,Math.sin(n.stringAngle)*5),e.restore()},Ss=(e,n,o,t)=>{const l=1+t*.02,i=ue(1-t/40,0,1);i<=0||(e.save(),e.translate(n,o-20-t*1.5),e.scale(l,l),e.globalAlpha=i,e.font="bold 28px inherit",e.textAlign="center",e.textBaseline="middle",e.fillStyle="#FFD700",e.strokeStyle=u("#ffffff",.8),e.lineWidth=3,e.strokeText("POP!",0,0),e.fillText("POP!",0,0),e.restore())},ys=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden"})},ws=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:C.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u(C.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},vs=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u(C.text,.7),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:u(C.surface,.6),borderRadius:"12px",backdropFilter:"blur(4px)"})},Ts=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",fontSize:"1.1rem",fontWeight:"600",color:C.text,margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:u(C.surface,.8),borderRadius:"12px",backdropFilter:"blur(4px)"})},Ps=()=>{let e=null,n=null,o=0,t=0,l=null,i=null,a="idle",s=0,r=C.secondary,f=!1,c=0,h=null,d=[],g=[],w=[],A=0,F=0,R=0,p=!1,y=null,b=0;const T=()=>o/2,v=()=>t*ji,m=()=>t*.88,P=()=>{h&&(h.textContent=c===0?"Ballons: 0":`Ballons: ${c}`)},S=()=>{y!==null&&clearTimeout(y),y=setTimeout(()=>{a="idle",s=0,p=!1,y=null},Ji)},E=(B,W)=>{a="popped",F=B,R=W,A=0,p=!0;for(let H=0;H<Xi;H++)d.push(os(B,W));S()},k=(B,W,H,N)=>{a="floating",c+=1,P(),w.push({x:B,y:W,radiusX:H,radiusY:N,color:r,alpha:1,vx:x(-zn,zn),vy:Qi,stringAngle:0}),S()},O=()=>{if(!n)return;b+=1,ee(n,o,t),cs(n,o,t),hs(n,o,b),us(n,o,t);const B=T(),W=v(),H=m();w=w.map(ds).filter(fs);for(const N of w)bs(n,N,b);if(a==="inflating"||a==="idle"){const N=Ne(s),U=N*.85,se=N,ne=W-se;let re=0;if(s>=oe){const le=ue((s-oe)/(me-oe),0,1);re=Math.sin(b*.3)*le*12}const Et=ts(s,r);s>=Zn&&s<Jn&&ps(n,B+re*.5,ne,N,b);const It=W+8;vt(n,B+re*.3,It,B,H,b,re*.2),Tt(n,B+re*.5,ne,U,se,Et,re),s>=Zn&&s<Jn&&g.length<Ki&&Math.random()<.15&&g.push(is(B,ne,N)),g=g.map(ss).filter(rs);for(const le of g)gs(n,le.x,le.y,le.size,le.alpha);if(s>=oe){const le=ue((s-oe)/(me-oe),0,1);n.save(),n.globalAlpha=le*.4,n.strokeStyle=u("#ffffff",.6),n.lineWidth=1.5;for(let Re=0;Re<3;Re++){const Je=-.5+Re*.5,Qe=B+re*.5+Math.cos(Je)*U*.7,ze=ne+Math.sin(Je)*se*.5;n.beginPath(),n.moveTo(Qe-5,ze-3),n.lineTo(Qe+5,ze+3),n.stroke()}n.restore()}}d=d.map(ls).filter(as);for(const N of d)ms(n,N);p&&(A+=1,Ss(n,F,R,A),A>50&&(p=!1)),l=requestAnimationFrame(O)},I=()=>{if(!e||!n)return;const B=X(e,n);o=B.width,t=B.height};return{id:"balloon",name:"Ballon",description:"Gonfle le ballon sans le faire éclater",mount:B=>{const W=M("div",{});ys(W);const H=M("button",{},"← Accueil");ws(H),H.addEventListener("click",()=>{window.location.hash="#menu"});const N=M("p",{},"Ballon");vs(N),h=M("p",{},"Ballons: 0"),Ts(h),W.appendChild(H),W.appendChild(N),W.appendChild(h),B.appendChild(W);const U=J(W);e=U.canvas,n=U.ctx,o=U.width,t=U.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),i=I,window.addEventListener("resize",i),a="idle",s=0,r=C.secondary,f=!1,c=0,d=[],g=[],w=[],p=!1,A=0,b=0,P(),O()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),i&&(window.removeEventListener("resize",i),i=null),y!==null&&(clearTimeout(y),y=null),e=null,n=null,h=null,d=[],g=[],w=[],a="idle",s=0,f=!1,c=0,p=!1,b=0,o=0,t=0},update:B=>{const W=B.isVoicing;if(W){if(f||a==="idle"&&(a="inflating",s=0,g=[],r=C.secondary),a==="inflating"&&(s=B.duration,B.vowel!==null&&Y[B.vowel]&&(r=Y[B.vowel]),s>=me)){const H=Ne(s),N=v()-H;E(T(),N)}}else if(f&&a==="inflating"&&s>.1){const H=Ne(s),N=H*.85,U=H,se=v()-U;k(T(),se,N,U)}else!W&&a==="inflating"&&(a="idle",s=0,g=[]);f=W}}},we=.1,Cs=8,Ms=20,As=500,Es=5,Is=30,Rs=-1.5,ks=.004,Fs=.02,Os=20,_s=.08,Ls=.02,Bs="#1a6b8a",Pt="#0a2a3a",Ds="#c2a66b",Ws="#a08850",Ns="#2d8a4e",Hs="#1d6a3e",$s={a:"fish",e:"seahorse",i:"jellyfish",o:"starfish",u:"octopus",ɛ:"fish",y:"jellyfish"},Gs={a:1.8,e:.5,i:.3,o:0,u:.6,ɛ:1.2,y:.4},$=(e,n)=>e+Math.random()*(n-e),js=(e,n,o)=>{const t=e.createLinearGradient(0,0,0,o);t.addColorStop(0,Bs),t.addColorStop(1,Pt),e.fillStyle=t,e.fillRect(0,0,n,o)},Us=(e,n,o)=>{const t=o*(1-we),l=e.createLinearGradient(0,t,0,o);l.addColorStop(0,Ds),l.addColorStop(1,Ws),e.beginPath(),e.moveTo(0,o);for(let i=0;i<=n;i+=10){const a=t+Math.sin(i*.03)*3+Math.sin(i*.07)*2;e.lineTo(i,a)}e.lineTo(n,o),e.closePath(),e.fillStyle=l,e.fill()},xn=(e,n)=>{const o=[],t=n*(1-we);for(let l=0;l<Os;l++){const i=Math.floor($(100,170));o.push({x:$(10,e-10),y:$(t+5,n-5),rx:$(3,7),ry:$(2,4),color:`rgb(${i}, ${i-10}, ${i-20})`})}return o},Ys=(e,n)=>{for(const o of n)e.beginPath(),e.ellipse(o.x,o.y,o.rx,o.ry,0,0,Math.PI*2),e.fillStyle=o.color,e.fill()},et=(e,n)=>{const o=[];for(let t=0;t<Cs;t++)o.push({x:$(30,e-30),height:$(80,400),segments:Math.floor($(6,12)),phaseOffset:$(0,Math.PI*2)});return o},Vs=(e,n,o,t,l)=>{const i=o*(1-we);for(const a of n){const s=a.height/a.segments;e.beginPath(),e.moveTo(a.x,i);for(let r=1;r<=a.segments;r++){const f=r/a.segments,c=Math.sin(t*.002+a.phaseOffset+r*.5)*(20*f)*l,h=a.x+c,d=i-r*s;e.lineTo(h,d)}e.lineWidth=4,e.strokeStyle=Ns,e.lineCap="round",e.lineJoin="round",e.stroke();for(let r=2;r<a.segments;r+=2){const f=r/a.segments,c=Math.sin(t*.002+a.phaseOffset+r*.5)*(20*f)*l,h=a.x+c,d=i-r*s,g=r%4===0?1:-1;e.beginPath(),e.ellipse(h+g*8,d,10,4,g*.4,0,Math.PI*2),e.fillStyle=Hs,e.fill()}}},Xs=(e,n,o)=>({x:$(e*.15,e*.85),y:n*(1-we)-5,radius:Es+o*Is,alpha:.6,vy:Rs-o*1.5,wobbleOffset:$(0,Math.PI*2),wobbleSpeed:$(.03,.06)}),qs=(e,n)=>({...e,y:e.y+e.vy,x:e.x+Math.sin(n*e.wobbleSpeed+e.wobbleOffset)*.5,alpha:e.alpha-ks}),Ks=e=>e.alpha>0&&e.y>-e.radius,Zs=(e,n,o)=>{e.save(),e.globalAlpha=n.alpha*o,e.beginPath(),e.arc(n.x,n.y,n.radius,0,Math.PI*2),e.fillStyle=u("#a5d8ff",.4),e.fill(),e.strokeStyle=u("#74c0fc",.6),e.lineWidth=1,e.stroke(),e.beginPath(),e.arc(n.x-n.radius*.3,n.y-n.radius*.3,n.radius*.25,0,Math.PI*2),e.fillStyle=u("#ffffff",.7),e.fill(),e.restore()},Js=(e,n,o,t,l,i,a)=>{const s=i?1:-1;e.save(),e.beginPath(),e.ellipse(n,o,t*1.2,t*.7,0,0,Math.PI*2),e.fillStyle=l,e.fill(),e.beginPath();const r=n-s*t*1.2,f=Math.sin(a*.008+n)*3;e.moveTo(r,o),e.lineTo(r-s*t*.7,o-t*.5+f),e.lineTo(r-s*t*.7,o+t*.5+f),e.closePath(),e.fillStyle=l,e.fill();const c=n+s*t*.5,h=o-t*.15;e.beginPath(),e.arc(c,h,t*.18,0,Math.PI*2),e.fillStyle="#ffffff",e.fill(),e.beginPath(),e.arc(c+s*t*.05,h,t*.1,0,Math.PI*2),e.fillStyle="#1a1a2e",e.fill(),e.beginPath(),e.moveTo(n-s*t*.2,o-t*.7),e.lineTo(n+s*t*.3,o-t*.7),e.lineTo(n+s*t*.1,o-t*.35),e.closePath(),e.fillStyle=u(l,.7),e.fill(),e.restore()},Qs=(e,n,o,t,l,i)=>{e.save(),e.beginPath(),e.arc(n,o-t*.8,t*.4,0,Math.PI*2),e.fillStyle=l,e.fill(),e.beginPath(),e.ellipse(n+t*.5,o-t*.8,t*.25,t*.12,0,0,Math.PI*2),e.fillStyle=l,e.fill();const a=Math.sin(i*.003+n*.1)*3;for(let f=0;f<6;f++){const c=f/5,h=n+a*c,d=o-t*.5+f*t*.3,g=t*(.35-c*.08);e.beginPath(),e.arc(h,d,g,0,Math.PI*2),e.fillStyle=u(l,1-c*.2),e.fill()}e.beginPath();const s=n+a*.8,r=o+t*1;e.arc(s+t*.2,r,t*.2,0,Math.PI*1.5),e.strokeStyle=l,e.lineWidth=3,e.lineCap="round",e.stroke(),e.beginPath(),e.arc(n+t*.15,o-t*.9,t*.08,0,Math.PI*2),e.fillStyle="#1a1a2e",e.fill();for(let f=0;f<3;f++)e.beginPath(),e.arc(n-t*.1+f*t*.15,o-t*1.2,t*.06,0,Math.PI*2),e.fillStyle=u(l,.7),e.fill();e.restore()},zs=(e,n,o,t,l,i)=>{e.save();const a=1+Math.sin(i*.005+n)*.1;e.beginPath(),e.ellipse(n,o,t*.8*a,t*.5*a,0,Math.PI,0),e.fillStyle=u(l,.6),e.fill(),e.beginPath(),e.ellipse(n,o+t*.05,t*.5*a,t*.3*a,0,Math.PI,0),e.fillStyle=u(l,.3),e.fill();const s=6;for(let r=0;r<s;r++){const f=n-t*.6+r/(s-1)*t*1.2;e.beginPath(),e.moveTo(f,o);const c=t*(.8+Math.sin(r*1.5)*.3);for(let h=1;h<=4;h++){const d=h/4,g=f+Math.sin(i*.004+r*.8+h*.7)*(t*.15),w=o+d*c;e.lineTo(g,w)}e.strokeStyle=u(l,.5),e.lineWidth=2,e.lineCap="round",e.stroke()}for(let r=0;r<3;r++){const f=n-t*.3+r*t*.3,c=o-t*.15;e.beginPath(),e.arc(f,c,t*.05,0,Math.PI*2),e.fillStyle=u("#ffffff",.5),e.fill()}e.restore()},xs=(e,n,o,t,l)=>{e.save();const i=5,a=t*.9,s=a*.4;e.beginPath();for(let r=0;r<i*2;r++){const f=r%2===0?a:s,c=Math.PI*r/i-Math.PI/2,h=n+Math.cos(c)*f,d=o+Math.sin(c)*f;r===0?e.moveTo(h,d):e.lineTo(h,d)}e.closePath(),e.fillStyle=l,e.fill(),e.beginPath(),e.arc(n,o,t*.15,0,Math.PI*2),e.fillStyle=u("#ffffff",.4),e.fill();for(let r=0;r<i;r++){const f=Math.PI*2*r/i-Math.PI/2,c=a*.55,h=n+Math.cos(f)*c,d=o+Math.sin(f)*c;e.beginPath(),e.arc(h,d,t*.06,0,Math.PI*2),e.fillStyle=u("#ffffff",.35),e.fill()}e.restore()},er=(e,n,o,t,l,i)=>{e.save(),e.beginPath(),e.arc(n,o-t*.3,t*.6,0,Math.PI*2),e.fillStyle=l,e.fill(),e.beginPath(),e.arc(n-t*.2,o-t*.4,t*.12,0,Math.PI*2),e.fillStyle="#ffffff",e.fill(),e.beginPath(),e.arc(n+t*.2,o-t*.4,t*.12,0,Math.PI*2),e.fillStyle="#ffffff",e.fill(),e.beginPath(),e.arc(n-t*.18,o-t*.38,t*.06,0,Math.PI*2),e.fillStyle="#1a1a2e",e.fill(),e.beginPath(),e.arc(n+t*.22,o-t*.38,t*.06,0,Math.PI*2),e.fillStyle="#1a1a2e",e.fill();const a=4;for(let s=0;s<a;s++){const r=n-t*.45+s/(a-1)*t*.9;e.beginPath(),e.moveTo(r,o+t*.1);for(let f=1;f<=5;f++){const c=f/5,h=r+Math.sin(i*.004+s*1.2+f*.8)*(t*.2),d=o+t*.1+c*t*.9;e.lineTo(h,d)}e.strokeStyle=l,e.lineWidth=3,e.lineCap="round",e.stroke()}e.beginPath(),e.arc(n,o-t*.15,t*.15,.1,Math.PI-.1),e.strokeStyle=u("#1a1a2e",.5),e.lineWidth=1.5,e.stroke(),e.restore()},nr=(e,n,o,t)=>{switch(e.save(),e.globalAlpha=n.alpha*t,n.kind){case"fish":Js(e,n.x,n.y,n.size,n.color,n.vx>0,o);break;case"seahorse":Qs(e,n.x,n.y,n.size,n.color,o);break;case"jellyfish":zs(e,n.x,n.y,n.size,n.color,o);break;case"starfish":xs(e,n.x,n.y,n.size,n.color);break;case"octopus":er(e,n.x,n.y,n.size,n.color,o);break}e.restore()},tr=(e,n,o)=>{const t=$s[e]??"fish",l=Y[e]??"#6366f1",i=Gs[e]??1,a=o*(1-we),s=$(14,22),r=Math.random()>.5?1:-1,f=r>0?-s*2:n+s*2;let c;switch(t){case"starfish":c=a-s*.5;break;case"jellyfish":c=$(o*.15,o*.5);break;case"seahorse":c=$(o*.3,o*.6);break;case"octopus":c=$(o*.5,a-s*1.5);break;default:c=$(o*.15,a-s*2)}return{x:t==="starfish"?$(s*2,n-s*2):f,y:c,vx:t==="starfish"?0:i*r,color:l,kind:t,age:0,alpha:t==="starfish"?0:1,size:s,phaseOffset:$(0,Math.PI*2)}},or=(e,n,o)=>{const t=e.age+1,l=e.kind!=="starfish"?Math.sin(n*.003+e.phaseOffset)*.3:0;let i=e.x+e.vx,a=e.vx;e.kind!=="starfish"&&(i<-e.size*3?(i=-e.size*3,a=Math.abs(e.vx)):i>o+e.size*3&&(i=o+e.size*3,a=-Math.abs(e.vx)));let s=e.alpha;return e.kind==="starfish"&&e.alpha<1&&(s=Math.min(1,e.alpha+.02)),{...e,x:i,y:e.y+l,vx:a,age:t,alpha:s}},lr=(e,n)=>e.kind==="starfish"?!0:e.x>-e.size*4&&e.x<n+e.size*4,ar=(e,n)=>e.length<=n?e:e.map((o,t)=>t<e.length-n?{...o,alpha:o.alpha-Fs}:o).filter(o=>o.alpha>0),ir=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:Pt})},sr=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:"#7dd3fc",cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u("#0a2a3a",.7),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},rr=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u("#7dd3fc",.7),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},dr=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",fontSize:"1.1rem",fontWeight:"600",color:"#7dd3fc",margin:"0",padding:"8px 12px",fontFamily:"inherit",borderRadius:"8px",backgroundColor:u("#0a2a3a",.7),backdropFilter:"blur(4px)",pointerEvents:"none"})},fr=()=>{let e=null,n=null,o=0,t=0,l=null,i=null,a=[],s=[],r=[],f=[],c=null,h=0,d=0,g=0,w=0,A=!1;const F=4,R=()=>{if(!e||!n)return;const m=X(e,n);o=m.width,t=m.height,r=et(o),f=xn(o,t)},p=()=>{if(n){ee(n,o,t),js(n,o,t),Us(n,o,t),Ys(n,f),Vs(n,r,t,g,w);for(const m of s)nr(n,m,g,w);for(const m of a)Zs(n,m,w)}},y=()=>{g=performance.now(),w=A?Math.min(1,w+_s):Math.max(0,w-Ls),a=a.map(m=>qs(m,g)).filter(Ks),s=s.map(m=>or(m,g,o)).filter(m=>lr(m,o)),s=ar(s,Ms),c&&(c.textContent=`${s.length}`),p(),l=requestAnimationFrame(y)};return{id:"aquarium",name:"Aquarium",description:"Crée ton monde sous-marin avec ta voix",mount:m=>{const P=M("div",{});ir(P);const S=M("button",{},"← Accueil");sr(S),S.addEventListener("click",()=>{window.location.hash="#menu"});const E=M("p",{},"Aquarium");rr(E),c=M("p",{},"0"),dr(c),P.appendChild(S),P.appendChild(E),P.appendChild(c),m.appendChild(P);const k=J(P);e=k.canvas,n=k.ctx,o=k.width,t=k.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),r=et(o),f=xn(o,t),i=R,window.addEventListener("resize",i),a=[],s=[],h=0,d=0,g=0,y()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),i&&(window.removeEventListener("resize",i),i=null),e=null,n=null,c=null,o=0,t=0,a=[],s=[],r=[],f=[],h=0,d=0,g=0,w=0,A=!1},update:m=>{A=m.isVoicing;const P=performance.now();m.isVoicing?(d+=1,d>=F&&(d=0,a.push(Xs(o,t,m.volume)))):d=0,m.isVoicing&&m.vowel!==null&&P-h>=As&&(s.push(tr(m.vowel,o,t)),h=P)}}},Z=.3,cr=.035,Ze=.3,Se=.18,hr=120,ur=.3,nt=.03,z=40,tt=12,$e={summer:{skyTop:"#1E90FF",skyBottom:"#87CEEB",groundTop:"#4CAF50",groundBottom:"#2E7D32",treeCrown:"#2E8B57",treeHighlight:"#3CB371",label:"Été"},autumn:{skyTop:"#E8843C",skyBottom:"#F4A460",groundTop:"#8B6914",groundBottom:"#6B4E0A",treeCrown:"#D2691E",treeHighlight:"#E25822",label:"Automne"},winter:{skyTop:"#B0B8C8",skyBottom:"#D9DEE8",groundTop:"#E8E8F0",groundBottom:"#CFCFDF",treeCrown:"#8B7355",treeHighlight:"#A08060",label:"Hiver"},spring:{skyTop:"#89CFF0",skyBottom:"#B0E2FF",groundTop:"#5DBB63",groundBottom:"#3E9142",treeCrown:"#FFB7C5",treeHighlight:"#FFC0CB",label:"Printemps"}},pr={a:"summer",o:"autumn",i:"winter",u:"spring"},Ge=(e,n,o)=>e+(n-e)*o,Ve=(e,n,o)=>Math.min(o,Math.max(n,e)),_=(e,n)=>e+Math.random()*(n-e),ot=e=>({r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16)}),gr=(e,n,o)=>{const t=l=>Ve(Math.round(l),0,255).toString(16).padStart(2,"0");return`#${t(e)}${t(n)}${t(o)}`},he=(e,n,o)=>{const t=ot(e),l=ot(n);return gr(Ge(t.r,l.r,o),Ge(t.g,l.g,o),Ge(t.b,l.b,o))},mr=(e,n,o)=>({skyTop:he(e.skyTop,n.skyTop,o),skyBottom:he(e.skyBottom,n.skyBottom,o),groundTop:he(e.groundTop,n.groundTop,o),groundBottom:he(e.groundBottom,n.groundBottom,o),treeCrown:he(e.treeCrown,n.treeCrown,o),treeHighlight:he(e.treeHighlight,n.treeHighlight,o)}),br=e=>({skyTop:e.skyTop,skyBottom:e.skyBottom,groundTop:e.groundTop,groundBottom:e.groundBottom,treeCrown:e.treeCrown,treeHighlight:e.treeHighlight}),Ce={skyTop:"#7CA8D0",skyBottom:"#A8C8E8",groundTop:"#6B8E6B",groundBottom:"#4A6B4A",treeCrown:"#5A8A5A",treeHighlight:"#6B9B6B"},Sr=(e,n,o)=>{const l=n*(1-Z)-n*Ze-n*Se,i=["#D2691E","#CD853F","#B22222","#DAA520","#CC5500"];return{x:e*.5+_(-e*.15,e*.15),y:l+_(0,n*Se),vx:_(-1.5,1.5)*(1+o),vy:_(.3,1.5),size:_(5,10),rotation:_(0,Math.PI*2),rotationSpeed:_(-.05,.05),alpha:1,color:i[Math.floor(Math.random()*i.length)],life:0,maxLife:_(120,250)}},yr=(e,n,o)=>{const t=.3+o*.7;return{x:_(-20,e+20),y:_(-30,-5),vx:_(-.8,.8)*t,vy:_(.5,2.5)*t,size:_(2,6),rotation:0,rotationSpeed:0,alpha:_(.6,1),color:"#FFFFFF",life:0,maxLife:_(200,400)}},wr=(e,n,o)=>{const l=n*(1-Z)-n*Ze-n*Se,i=["#FFB7C5","#FF69B4","#FFC0CB","#FFD1DC","#FADADD"];return{x:e*.5+_(-e*.15,e*.15),y:l+_(0,n*Se*.7),vx:_(-1,2)*(.5+o*.5),vy:_(-.5,1.2),size:_(4,8),rotation:_(0,Math.PI*2),rotationSpeed:_(-.04,.04),alpha:1,color:i[Math.floor(Math.random()*i.length)],life:0,maxLife:_(150,300)}},vr=(e,n,o)=>{const t=_(n*.1,n*.6);return{x:_(0,e),y:t,vx:_(-.2,.2),vy:_(-1,-.3)*(.5+o),size:_(2,5),rotation:0,rotationSpeed:0,alpha:_(.15,.4)*o,color:"#FFD700",life:0,maxLife:_(60,120)}},Tr=(e,n,o)=>{const t=n*(1-Z),l=["#FF6B9D","#C084FC","#60A5FA","#FBBF24","#FB923C"];return{x:_(e*.1,e*.9),y:t-_(20,120),vx:_(-1,1),vy:_(-1,.5),size:_(6,10),rotation:0,rotationSpeed:.1,alpha:1,color:l[Math.floor(Math.random()*l.length)],life:0,maxLife:_(200,400)}},Pr=(e,n)=>{const o=n*(1-Z),t=["#FF6B9D","#FBBF24","#A78BFA","#F87171","#34D399"];return{x:_(e*.05,e*.95),y:o+_(5,n*Z*.5),vx:0,vy:0,size:_(4,8),rotation:_(0,Math.PI*2),rotationSpeed:0,alpha:1,color:t[Math.floor(Math.random()*t.length)],life:0,maxLife:9999}},Cr=(e,n)=>{const o=e.life+1,t=o/e.maxLife,l=.7,i=n==="spring"&&e.vy<=.5&&e.size>=6,a=i?e.vx+Math.sin(o*.1)*.15:e.vx+_(-.05,.05),s=i?e.vy+Math.cos(o*.08)*.1:e.vy;return{...e,x:e.x+a,y:e.y+s,vx:a*.99,vy:s,rotation:e.rotation+e.rotationSpeed,alpha:t>l?e.alpha*(1-(t-l)/(1-l)):e.alpha,life:o}},Mr=e=>e.life<e.maxLife&&e.alpha>.01,Ar=(e,n,o,t)=>{const l=e.createLinearGradient(0,0,0,o*(1-Z));l.addColorStop(0,t.skyTop),l.addColorStop(1,t.skyBottom),e.fillStyle=l,e.fillRect(0,0,n,o*(1-Z)+2)},Er=(e,n,o,t,l)=>{const i=o*(1-Z),a=e.createLinearGradient(0,i,0,o);a.addColorStop(0,t.groundTop),a.addColorStop(1,t.groundBottom),e.fillStyle=a,e.fillRect(0,i,n,o*Z),e.beginPath(),e.moveTo(0,i);for(let s=0;s<=n;s+=15){const r=Math.sin(s*.03+l*5e-4)*3;e.lineTo(s,i+r)}e.lineTo(n,i+8),e.lineTo(0,i+8),e.closePath(),e.fillStyle=t.groundTop,e.fill()},Ir=(e,n,o,t,l)=>{const i=n-80,a=70,s=1+Math.sin(o*.001)*.04,r=t==="winter"?.3:t==="autumn"?.7:1,f=t==="autumn"?"#FF8C42":"#FFD700",c=t==="summer"?.5+l*.5:.3;e.save(),e.globalAlpha=r;const h=e.createRadialGradient(i,a,0,i,a,z*2.5);h.addColorStop(0,u(f,.3)),h.addColorStop(1,u(f,0)),e.fillStyle=h,e.fillRect(i-z*3,a-z*3,z*6,z*6),e.save(),e.translate(i,a),e.rotate(o*3e-4);const d=15+l*15;for(let g=0;g<tt;g++){const w=g/tt*Math.PI*2;e.beginPath(),e.moveTo(Math.cos(w)*z*s,Math.sin(w)*z*s),e.lineTo(Math.cos(w)*(z+d)*s,Math.sin(w)*(z+d)*s),e.strokeStyle=u(f,c),e.lineWidth=3,e.stroke()}e.restore(),e.beginPath(),e.arc(i,a,z*s,0,Math.PI*2),e.fillStyle=f,e.fill(),e.restore()},Rr=(e,n,o,t,l,i,a)=>{const s=o*(1-Z),r=n*.5,f=n*cr,c=o*Ze,h=s-c,d=o*Se,g=Math.sin(i*.0015)*(2+a*4);e.save(),e.beginPath(),e.moveTo(r-f/2,s),e.lineTo(r-f/3+g*.3,h+d*.3),e.lineTo(r+f/3+g*.3,h+d*.3),e.lineTo(r+f/2,s),e.closePath();const w=e.createLinearGradient(r-f/2,s,r+f/2,s);if(w.addColorStop(0,"#5D4037"),w.addColorStop(.5,"#795548"),w.addColorStop(1,"#5D4037"),e.fillStyle=w,e.fill(),l==="winter"){const A="#6D4C41";e.strokeStyle=A,e.lineWidth=3,e.lineCap="round",e.beginPath(),e.moveTo(r+g*.4,h+d*.5),e.quadraticCurveTo(r-d*.4+g*.5,h+d*.1,r-d*.7+g*.6,h-d*.2),e.stroke(),e.beginPath(),e.moveTo(r+g*.4,h+d*.4),e.quadraticCurveTo(r+d*.3+g*.5,h+d*.05,r+d*.65+g*.6,h-d*.15),e.stroke(),e.beginPath(),e.moveTo(r+g*.5,h+d*.2),e.quadraticCurveTo(r+d*.1+g*.6,h-d*.3,r-d*.1+g*.7,h-d*.6),e.stroke(),e.lineWidth=2,e.beginPath(),e.moveTo(r-d*.5+g*.55,h-d*.05),e.lineTo(r-d*.65+g*.6,h-d*.35),e.stroke(),e.beginPath(),e.moveTo(r+d*.45+g*.55,h),e.lineTo(r+d*.55+g*.6,h-d*.3),e.stroke()}if(l!=="winter"){const A=h-d*.2,F=r+g*.5;e.beginPath(),e.ellipse(F+3,A+5,d*1.05,d*.85,0,0,Math.PI*2),e.fillStyle=u("#000000",.08),e.fill();const R=(p,y,b,T,v)=>{e.beginPath(),e.ellipse(p,y,b,T,0,0,Math.PI*2),e.fillStyle=v,e.fill()};R(F,A,d,d*.8,t.treeCrown),R(F-d*.5,A+d*.1,d*.6,d*.55,t.treeCrown),R(F+d*.5,A+d*.15,d*.55,d*.5,t.treeCrown),R(F+d*.1,A-d*.4,d*.55,d*.5,t.treeHighlight),R(F-d*.2,A-d*.15,d*.45,d*.4,u(t.treeHighlight,.5))}e.restore()},lt=(e,n,o)=>{if(e.save(),e.globalAlpha=Ve(n.alpha,0,1),e.translate(n.x,n.y),e.rotate(n.rotation),o==="autumn")e.beginPath(),e.ellipse(0,0,n.size,n.size*.5,0,0,Math.PI*2),e.fillStyle=n.color,e.fill(),e.beginPath(),e.moveTo(-n.size*.7,0),e.lineTo(n.size*.7,0),e.strokeStyle=u("#000000",.2),e.lineWidth=.5,e.stroke();else if(o==="winter"){const t=e.createRadialGradient(0,0,0,0,0,n.size);t.addColorStop(0,u("#FFFFFF",.9)),t.addColorStop(1,u("#FFFFFF",0)),e.fillStyle=t,e.fillRect(-n.size,-n.size,n.size*2,n.size*2),e.beginPath(),e.arc(0,0,n.size*.5,0,Math.PI*2),e.fillStyle="#FFFFFF",e.fill()}else if(o==="spring"&&n.size>=6&&n.maxLife>=200){const t=Math.sin(n.life*.15)*.4;e.fillStyle=n.color,e.save(),e.scale(1,1+t),e.beginPath(),e.ellipse(-n.size*.4,0,n.size*.5,n.size*.8,-.2,0,Math.PI*2),e.fill(),e.restore(),e.save(),e.scale(1,1-t),e.beginPath(),e.ellipse(n.size*.4,0,n.size*.5,n.size*.8,.2,0,Math.PI*2),e.fill(),e.restore(),e.beginPath(),e.ellipse(0,0,n.size*.12,n.size*.5,0,0,Math.PI*2),e.fillStyle="#333333",e.fill()}else if(o==="spring"&&n.vx===0&&n.vy===0){e.fillStyle=n.color;for(let l=0;l<5;l++){const i=l/5*Math.PI*2;e.beginPath(),e.ellipse(Math.cos(i)*n.size*.4,Math.sin(i)*n.size*.4,n.size*.35,n.size*.2,i,0,Math.PI*2),e.fill()}e.beginPath(),e.arc(0,0,n.size*.2,0,Math.PI*2),e.fillStyle="#FBBF24",e.fill()}else o==="spring"?(e.beginPath(),e.ellipse(0,0,n.size,n.size*.5,0,0,Math.PI*2),e.fillStyle=n.color,e.fill()):o==="summer"&&(e.beginPath(),e.arc(0,0,n.size,0,Math.PI*2),e.fillStyle=u(n.color,Ve(n.alpha,0,.4)),e.fill());e.restore()},kr=(e,n,o,t)=>{e.save(),e.font="bold 20px system-ui, sans-serif",e.textAlign="right",e.textBaseline="bottom",e.fillStyle=u(C.text,.5),e.fillText(n,o-20,t-16),e.restore()},Fr=(e,n,o,t,l)=>{const i=o*(1-Z),a=8+t*6;e.beginPath(),e.moveTo(0,i);for(let s=0;s<=n;s+=20){const r=Math.sin(s*.02+l*3e-4)*3;e.lineTo(s,i-a+r)}e.lineTo(n,i+2),e.lineTo(0,i+2),e.closePath(),e.fillStyle=u("#FFFFFF",.7),e.fill()},Or=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden"})},_r=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:C.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:u(C.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Lr=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:u(C.text,.7),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:u(C.surface,.6),borderRadius:"12px",backdropFilter:"blur(4px)"})},Br=e=>{Object.assign(e.style,{position:"absolute",bottom:"16px",right:"16px",zIndex:"10",fontSize:"1.3rem",fontWeight:"700",color:u(C.text,.6),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:u(C.surface,.6),borderRadius:"12px",backdropFilter:"blur(4px)"})},Dr=()=>{let e=null,n=null,o=0,t=0,l=null,i=null,a=0,s=null,r=null,f={...Ce},c={...Ce},h=1,d=[],g=[],w=0,A=null;const F=(m,P,S)=>{const E=Math.min(S,hr-d.length);for(let k=0;k<E;k++)switch(m){case"summer":d.push(vr(o,t,P));break;case"autumn":d.push(Sr(o,t,P));break;case"winter":d.push(yr(o,t,P));break;case"spring":d.push(wr(o,t,P)),P>.4&&Math.random()<.15&&d.push(Tr(o,t));break}},R=m=>{m==="spring"&&g.length<12?Math.random()<.02&&g.push(Pr(o,t)):m!=="spring"&&g.length>0&&(g=g.map(P=>({...P,alpha:P.alpha-.01})).filter(P=>P.alpha>.01))},p=()=>{if(!n)return;const m=performance.now()-a;ee(n,o,t),h<1&&(h=Math.min(1,h+nt),f=mr(f,c,nt));const P=s??"summer";Ar(n,o,t,f),Ir(n,o,m,P,w),Er(n,o,t,f,m),P==="winter"&&Fr(n,o,t,w,m);for(const S of g)lt(n,S,"spring");if(Rr(n,o,t,f,P,m,w),s!==null){const S=ur+w*2;if(Math.random()<S){const E=Math.ceil(1+w*3);F(s,w,E)}}d=d.map(S=>Cr(S,P)).filter(Mr);for(const S of d)lt(n,S,P);if(R(P),s!==null){const S=$e[s];kr(n,S.label,o,t)}l=requestAnimationFrame(p)},y=()=>{if(!e||!n)return;const m=X(e,n);o=m.width,t=m.height};return{id:"seasons",name:"Saisons",description:"Change les saisons avec ta voix",mount:m=>{const P=M("div",{});Or(P);const S=M("button",{},"← Accueil");_r(S),S.addEventListener("click",()=>{window.location.hash="#menu"});const E=M("p",{},"Saisons");Lr(E),A=M("p",{},""),Br(A),P.appendChild(S),P.appendChild(E),P.appendChild(A),m.appendChild(P);const k=J(P);e=k.canvas,n=k.ctx,o=k.width,t=k.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),i=y,window.addEventListener("resize",i),s=null,r=null,f={...Ce},c={...Ce},h=1,d=[],g=[],w=0,a=performance.now(),p()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),i&&(window.removeEventListener("resize",i),i=null),e=null,n=null,A=null,o=0,t=0,d=[],g=[],s=null,r=null,h=1,w=0},update:m=>{w=m.volume,m.duration;const P=m.vowel,S=P!==null?pr[P]??null:null;S!==null&&S!==r&&(r=S,c=br($e[S]),h=0,s=S,A&&(A.textContent=$e[S].label))}}},Wr=ao("#app"),Ct=to(),Mt=oo({volume:0,pitch:null,vowel:null,isVoicing:!1,duration:0,formants:null}),At=[bl(),_l(),pa(),ka(),za(),vi(),$i(),Ps(),fr(),Dr(),qo(),Ro()],Nr=mo(At.map(e=>({id:e.id,name:e.name,description:e.description}))),Hr=[Nr,...At],$r=lo(Wr,Hr);Mt.subscribe(e=>{const n=$r.getCurrentGame();n&&n.update(e)});Ct.subscribe(e=>{Mt.set(e)});const ve=document.createElement("div");ve.style.cssText=`
  position: fixed; inset: 0; z-index: 1000;
  display: flex; align-items: center; justify-content: center; flex-direction: column;
  background: rgba(240, 244, 255, 0.95);
`;const ie=document.createElement("button");ie.textContent="🎤 Commencer";ie.style.cssText=`
  font-size: 2rem; padding: 24px 48px;
  border: none; border-radius: 16px;
  background: #6366f1; color: white;
  cursor: pointer; font-family: inherit;
  transition: transform 0.2s;
`;ie.addEventListener("mouseenter",()=>{ie.style.transform="scale(1.05)"});ie.addEventListener("mouseleave",()=>{ie.style.transform="scale(1)"});const ye=document.createElement("p");ye.textContent="Appuie pour activer le micro";ye.style.cssText="margin-top: 16px; color: #64748b; font-size: 1.2rem;";ve.appendChild(ie);ve.appendChild(ye);document.body.appendChild(ve);ie.addEventListener("click",async()=>{try{await Ct.start(),ve.remove()}catch(e){ye.textContent="Erreur : impossible d'accéder au micro",ye.style.color="#ef4444",console.error("Failed to start audio pipeline:",e)}});</script>
    <style rel="stylesheet" crossorigin>*,*:before,*:after{box-sizing:border-box}*{margin:0;padding:0}html{-webkit-text-size-adjust:100%;-moz-text-size-adjust:100%;text-size-adjust:100%}body{line-height:1.5;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}img,picture,video,canvas,svg{display:block;max-width:100%}input,button,textarea,select{font:inherit;color:inherit}p,h1,h2,h3,h4,h5,h6{overflow-wrap:break-word}ol,ul{list-style:none}a{text-decoration:none;color:inherit}table{border-collapse:collapse;border-spacing:0}:root{--color-bg: #f0f4ff;--color-text: #2d3748;--color-primary: #6366f1;--color-secondary: #f472b6;--color-accent: #34d399;--color-surface: #ffffff;--font-family: "Segoe UI", system-ui, sans-serif;--radius: 12px;--transition-speed: .3s}body{width:100%;height:100vh;height:100dvh;font-family:var(--font-family);background-color:var(--color-bg);color:var(--color-text);overflow:hidden}#app{width:100%;height:100%;display:flex;flex-direction:column}.game-container{flex:1;position:relative;overflow:hidden}*,*:before,*:after{transition-timing-function:ease-in-out}@media(prefers-reduced-motion:reduce){*,*:before,*:after{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important;scroll-behavior:auto!important}}</style>
  </head>
  <body>
    <div id="app"></div>
  </body>
</html>
