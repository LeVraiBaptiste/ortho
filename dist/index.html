<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ortho</title>
    <script type="module" crossorigin>(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))n(l);new MutationObserver(l=>{for(const s of l)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function o(l){const s={};return l.integrity&&(s.integrity=l.integrity),l.referrerPolicy&&(s.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?s.credentials="include":l.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(l){if(l.ep)return;l.ep=!0;const s=o(l);fetch(l.href,s)}})();const Jn=(...e)=>(t,o)=>e.reduce((n,l)=>({...n,...l(t,n)}),o),Qn=e=>{if(e.length===0)return 0;let t=0;for(let n=0;n<e.length;n++)t+=e[n]*e[n];const o=Math.sqrt(t/e.length);return Math.min(1,Math.max(0,o))},zn=.15,ft=80,ht=600,xn=(e,t)=>{const o=Math.min(Math.floor(e.length/2),t),n=new Float32Array(o);for(let l=0;l<o;l++){let s=0;for(let a=0;a<o;a++){const i=e[a]-e[a+l];s+=i*i}n[l]=s}return n},eo=e=>{const t=new Float32Array(e.length);t[0]=1;let o=0;for(let n=1;n<e.length;n++)o+=e[n],t[n]=o===0?0:e[n]*n/o;return t},to=(e,t,o)=>{for(let n=t;n<e.length-1;n++)if(e[n]<o){for(;n+1<e.length&&e[n+1]<e[n];)n++;return n}return-1},no=(e,t)=>{if(t<=0||t>=e.length-1)return t;const o=e[t-1],n=e[t],l=e[t+1],s=.5*(o-l)/(o-2*n+l);return Number.isFinite(s)?t+s:t},oo=(e,t)=>{if(e.length<2)return null;const o=Math.floor(t/ft),n=Math.floor(t/ht);if(e.length<2*o)return null;const l=xn(e,o),s=eo(l),a=to(s,n,zn);if(a===-1)return null;const i=no(s,a);if(i<=0)return null;const r=t/i;return r<ft||r>ht?null:r},vn=.01,He=.001,et=e=>{const t=e.length,o=new Float32Array(t);for(let n=0;n<t;n++){const l=.54-.46*Math.cos(2*Math.PI*n/(t-1));o[n]=e[n]*l}return o},tt=(e,t=.97)=>{const o=new Float32Array(e.length);o[0]=e[0];for(let n=1;n<e.length;n++)o[n]=e[n]-t*e[n-1];return o},lo=e=>{let t=1;for(;t<e;)t*=2;return t},ao=(e,t)=>{let o=0;for(let n=0;n<t;n++)o=o<<1|e&1,e>>=1;return o},so=(e,t,o)=>{const n=Math.log2(o);for(let l=0;l<o;l++){const s=ao(l,n);if(s>l){const a=e[l];e[l]=e[s],e[s]=a;const i=t[l];t[l]=t[s],t[s]=i}}},nt=e=>{const t=lo(e.length),o=new Float32Array(t),n=new Float32Array(t);o.set(e.subarray(0,Math.min(e.length,t))),so(o,n,t);for(let a=2;a<=t;a*=2){const i=a/2,r=-2*Math.PI/a;for(let d=0;d<t;d+=a)for(let f=0;f<i;f++){const h=r*f,c=Math.cos(h),u=Math.sin(h),b=d+f,v=d+f+i,R=c*o[v]-u*n[v],I=c*n[v]+u*o[v];o[v]=o[b]-R,n[v]=n[b]-I,o[b]=o[b]+R,n[b]=n[b]+I}}const l=t/2+1,s=new Float32Array(l);for(let a=0;a<l;a++)s[a]=Math.sqrt(o[a]*o[a]+n[a]*n[a]);return s},Mn=e=>{let t=0;for(let o=0;o<e.length;o++)t+=e[o]*e[o];return Math.sqrt(t/e.length)},he=(e,t,o)=>{const n=(e.length-1)*2,l=Math.round(o*n/t),s=Math.max(0,Math.min(e.length-1,l));return e[s]},_e=12,Tn=(e,t)=>{const o=Math.floor(e.length/t),n=new Float32Array(o);for(let l=0;l<o;l++){let s=0;const a=l*t;for(let i=0;i<t;i++)s+=e[a+i];n[l]=s/t}return n},Pn=(e,t)=>{const o=e.length,n=new Float32Array(t+1);for(let l=0;l<=t;l++){let s=0;for(let a=0;a<o-l;a++)s+=e[a]*e[a+l];n[l]=s}return n},Cn=(e,t)=>{if(e[0]===0)return{coeffs:new Float32Array(t),gain:1};const o=new Float32Array(t);let n=e[0];for(let l=0;l<t;l++){let s=e[l+1];for(let r=0;r<l;r++)s-=o[r]*e[l-r];const a=s/n,i=new Float32Array(l);for(let r=0;r<l;r++)i[r]=o[r];o[l]=a;for(let r=0;r<l;r++)o[r]=i[r]-a*i[l-1-r];n*=1-a*a,n<=0&&(n=1e-10)}return{coeffs:o,gain:Math.sqrt(n)}},An=(e,t,o,n,l,s)=>{const a=new Float32Array(o),i=n/2,r=e.length;for(let d=0;d<o;d++){const f=d*l/s;if(f>i){a[d]=0;continue}const h=2*Math.PI*f/n;let c=1,u=0;for(let v=0;v<r;v++){const R=(v+1)*h;c-=e[v]*Math.cos(R),u+=e[v]*Math.sin(R)}const b=c*c+u*u;a[d]=t/Math.sqrt(b)}return a},io=(e,t=2)=>{const o=new Float32Array(e.length),n=1e-10;let l=1/0;for(let s=0;s<e.length;s++)e[s]>n&&e[s]<l&&(l=e[s]);l===1/0&&(l=1);for(let s=0;s<e.length;s++){const a=e[s]/l;o[s]=Math.pow(a,t)}return o},fe=(e,t,o,n)=>{const l=(e.length-1)*2,s=t/l,a=Math.max(1,Math.ceil(o/s)),i=Math.min(e.length-1,Math.floor(n/s));let r=a,d=e[a];for(let f=a+1;f<=i;f++)e[f]>d&&(d=e[f],r=f);if(r>a&&r<i){const f=e[r-1],h=e[r],c=e[r+1],u=f-2*h+c;if(u!==0){const b=.5*(f-c)/u;return(r+b)*s}}return r*s},ot=(e,t,o,n)=>{const l=(e.length-1)*2,s=t/l,a=Math.max(1,Math.ceil(o/s)),i=Math.min(e.length-3,Math.floor(n/s)),r=[];for(let d=a;d<=i;d++){const f=e[d]-e[d-1],h=e[d+1]-e[d];if(f>0&&h<=0){const c=e[d-1],u=e[d],b=e[d+1],v=c-2*u+b;let R=d*s;if(v!==0){const I=.5*(c-b)/v;R=(d+I)*s}r.push({freq:R,mag:u})}}return r},ro=(e,t,o)=>{let n=null;for(const l of e)l.freq>=t&&l.freq<=o&&(n===null||l.mag>n.mag)&&(n=l);return n},ue=[{vowel:"a",f1:700,f2:1300,f3:2550},{vowel:"e",f1:380,f2:2100,f3:2700},{vowel:"ɛ",f1:550,f2:1800,f3:2600},{vowel:"i",f1:270,f2:2300,f3:3100},{vowel:"o",f1:380,f2:700,f3:2500},{vowel:"u",f1:310,f2:700,f3:2200}],j=e=>13*Math.atan(76e-5*e)+3.5*Math.atan((e/7500)**2),co=(e,t,o)=>{const n=j(e),l=j(t),s=j(o);let a=ue[0].vowel,i=1/0;for(const r of ue){const d=n-j(r.f1),f=l-j(r.f2),h=s-j(r.f3),c=d*d+f*f+.8*h*h;c<i&&(i=c,a=r.vowel)}return a},fo=(e,t)=>{const o=(e.length-1)*2,n=t/o,s=Math.ceil(100/(2*n));let a=0;for(let r=0;r<e.length;r++)a+=e[r];a===0&&(a=1);const i=[];for(const r of ue){const d=(h,c)=>{const u=Math.round(h/n),b=Math.max(0,u-s),v=Math.min(e.length-1,u+s);let R=0;for(let I=b;I<=v;I++)R+=e[I];return R*c/a},f=d(r.f1,2)+d(r.f2,1)+d(r.f3,.5);i.push({vowel:r.vowel,score:f})}return i.sort((r,d)=>d.score-r.score)},ho=(e,t)=>{const o=ot(e,t,100,4e3);if(o.length<2)return ue.map(a=>({vowel:a.vowel,score:0}));const n=1.5,l=2,s=[];for(const a of ue){const i=j(a.f1),r=j(a.f2),d=j(a.f3);let f=1/0,h=1/0,c=1/0;for(const b of o){const v=j(b.freq),R=Math.abs(v-i),I=Math.abs(v-r),p=Math.abs(v-d);R<f&&(f=R),I<h&&(h=I),p<c&&(c=p)}if(f>n||h>l){s.push({vowel:a.vowel,score:0});continue}const u=2*f*f+h*h+.5*c*c;s.push({vowel:a.vowel,score:1/(1+u)})}return s.sort((a,i)=>i.score-a.score)},uo=(e,t)=>{const n=[...ot(e,t,100,4e3)].sort((c,u)=>c.freq-u.freq),l=ro(n,200,1200),s=l?l.freq:fe(e,t,200,1200),a=s+200,i=n.find(c=>c.freq>=a&&c.freq<=2800)??null;let r;if(i)r=i.freq;else{const c=fe(e,t,s+100,1500),u=fe(e,t,1500,2800),b=he(e,t,s);r=he(e,t,c)>=.15*b?c:u}const d=r+200,f=n.find(c=>c.freq>=d&&c.freq<=3800)??null,h=f?f.freq:fe(e,t,d,3800);return{f1:s,f2:r,f3:h}},po=(e,t)=>{if(Mn(e)<vn)return null;const o=tt(e),n=et(o),l=Math.max(1,Math.floor(t/8500)),s=Tn(n,l),a=t/l,i=Pn(s,_e),{coeffs:r,gain:d}=Cn(i,_e),f=nt(n),h=(f.length-1)*2,c=An(r,d,f.length,a,t,h),u=ot(c,t,100,4e3),b=1.5,v=2,R=new Set,I=(c.length-1)*2,p=t/I,M=Math.ceil(200/(2*p));let P=0;for(let k=0;k<c.length;k++)P+=c[k];P===0&&(P=1);const m=k=>{const D=Math.round(k/p),U=Math.max(0,D-M),L=Math.min(c.length-1,D+M);let W=0;for(let G=U;G<=L;G++)W+=c[G];return W/P};for(const k of ue){const D=j(k.f1),U=j(k.f2);let L=1/0,W=1/0;for(const X of u){const K=j(X.freq),pe=Math.abs(K-D),Ee=Math.abs(K-U);pe<L&&(L=pe),Ee<W&&(W=Ee)}const G=L<=b&&W<=v,H=m(k.f1),$=m(k.f2),q=H>.08&&$>.04;(G||q)&&R.add(k.vowel)}if(R.size===0)return null;const y=fo(c,t),T=ho(c,t),S=[];for(const k of ue){const D=fe(c,t,Math.max(100,k.f1-200),k.f1+200),U=fe(c,t,Math.max(k.f1+100,k.f2-300),k.f2+300),L=fe(c,t,Math.max(k.f2+100,k.f3-400),k.f3+400),W=he(c,t,D),G=he(c,t,U),H=j(D)-j(k.f1),$=j(U)-j(k.f2),q=j(L)-j(k.f3),X=2*H*H+$*$+.5*q*q,pe=(W+G)/(1+X);S.push({vowel:k.vowel,score:pe})}S.sort((k,D)=>D.score-k.score);const E=10,O=new Map;for(const k of[y,S,T])for(let D=0;D<k.length;D++){const U=k[D].vowel;R.has(U)&&O.set(U,(O.get(U)??0)+1/(E+D))}let _=null,F=-1/0;for(const[k,D]of O)D>F&&(F=D,_=k);return _},go=(e,t)=>{if(Mn(e)<vn)return{vowel:null,formants:null};const o=tt(e),n=et(o),l=nt(n),s=Math.max(1,Math.floor(t/11e3)),a=Tn(n,s),i=t/s,r=Pn(a,_e),{coeffs:d,gain:f}=Cn(r,_e),h=(l.length-1)*2,c=An(d,f,l.length,i,t,h),u=io(c,2),{f1:b,f2:v,f3:R}=uo(u,t),I=he(u,t,b),p=he(u,t,v),w=he(u,t,R),M={magnitudes:l,lpcEnvelope:u,sampleRate:t,fftSize:h,f1:b,f2:v,f3:R};return I<He||p<He||w<He?{vowel:null,formants:M}:{vowel:co(b,v,R),formants:M}},ut=e=>2595*Math.log10(1+e/700),mo=e=>700*(10**(e/2595)-1),bo=(e,t,o,n=0,l)=>{const s=l,a=t/2+1,i=ut(n),r=ut(s),d=[];for(let c=0;c<=e+1;c++)d.push(mo(i+c*(r-i)/(e+1)));const f=d.map(c=>Math.round(c*t/o)),h=[];for(let c=0;c<e;c++){const u=new Float32Array(a),b=f[c],v=f[c+1],R=f[c+2];for(let I=b;I<v;I++)I>=0&&I<a&&v!==b&&(u[I]=(I-b)/(v-b));for(let I=v;I<=R;I++)I>=0&&I<a&&R!==v&&(u[I]=(R-I)/(R-v));h.push(u)}return h},yo=(e,t)=>{const o=e.length,n=new Float32Array(t);for(let l=0;l<t;l++){let s=0;for(let a=0;a<o;a++)s+=e[a]*Math.cos(Math.PI*l*(2*a+1)/(2*o));n[l]=s}return n},Ze=26,En=13,So=.01;let Ie=null,pt=0,gt=0;const wo=(e,t)=>(Ie&&pt===e&&gt===t||(Ie=bo(Ze,e,t,100,4e3),pt=e,gt=t),Ie),vo=(e,t)=>{let o=0;for(let d=0;d<e.length;d++)o+=e[d]*e[d];if(o=Math.sqrt(o/e.length),o<So)return null;const n=tt(e),l=et(n),s=nt(l),a=(s.length-1)*2,i=wo(a,t),r=new Float32Array(Ze);for(let d=0;d<Ze;d++){let f=0;const h=i[d];for(let c=0;c<s.length&&c<h.length;c++)f+=s[c]*s[c]*h[c];r[d]=Math.log(Math.max(f,1e-10))}return yo(r,En)};let mt=[];const Mo=(e,t)=>{const o=vo(e,t);return o?To(o):null},To=e=>{if(mt.length===0)return null;let t=null,o=1/0;for(const n of mt){let l=0;for(let s=1;s<En&&s<n.mfcc.length;s++){const a=e[s]-n.mfcc[s],i=s<=4?1:.5;l+=i*a*a}l<o&&(o=l,t=n.vowel)}return t},Po=(e,t)=>{const o=po(e,t),n=Mo(e,t);return o===null&&n===null?null:o===null?n:n===null||o===n?o:n},Co=3,Ao=5,Eo={isVoicing:!1,framesAbove:0,framesBelow:0},Io=(e,t,o)=>e>o&&t!==null,Ro=(e,t)=>{if(t.isVoicing){if(!e){const o=t.framesBelow+1;return o>=Ao?{isVoicing:!1,framesAbove:0,framesBelow:0}:{isVoicing:!0,framesAbove:0,framesBelow:o}}return{isVoicing:!0,framesAbove:0,framesBelow:0}}if(e){const o=t.framesAbove+1;return o>=Co?{isVoicing:!0,framesAbove:0,framesBelow:0}:{isVoicing:!1,framesAbove:o,framesBelow:0}}return{isVoicing:!1,framesAbove:0,framesBelow:0}},ko=.01,Fo=()=>{let e=Eo;return(t,o)=>{const n=Io(o.volume??0,o.pitch??null,ko);return e=Ro(n,e),{isVoicing:e.isVoicing}}},bt=7,Oo=[.37,.44,.52,.61,.72,.85,1],_o=1.5,Bo={buffer:[]},Lo=(e,t)=>{const o=t.buffer.length>=bt?[...t.buffer.slice(1),e]:[...t.buffer,e],n=new Map,l=bt-o.length;for(let i=0;i<o.length;i++){const r=o[i];if(r!==null){const d=Oo[i+l];n.set(r,(n.get(r)??0)+d)}}if(n.size===0)return{vowel:null,state:{buffer:o}};let s=n.keys().next().value,a=0;for(const[i,r]of n)r>a&&(a=r,s=i);return{vowel:a>=_o?s:null,state:{buffer:o}}},Do=()=>{let e=Bo;return(t,o)=>{const n=o.isVoicing?o.vowel??null:null,l=Lo(n,e);return e=l.state,{vowel:o.isVoicing?l.vowel:null}}},Wo={currentDuration:0},No=(e,t,o)=>e?{isVoicing:!0,currentDuration:o.currentDuration+t}:{isVoicing:!1,currentDuration:0},Ho=()=>{let e=Wo;return(t,o)=>(e=No(o.isVoicing??!1,t.dt,e),{duration:e.currentDuration})},Go=2048,$o=()=>{let e=null,t=null,o=null,n=null,l=0;const s=new Set;let a=yt();const i=c=>{for(const u of s)u(c)},r=c=>{if(t===null||e===null)return;const u=l===0?0:(c-l)/1e3;l=c;const b=new Float32Array(t.fftSize);t.getFloatTimeDomainData(b);const v={buffer:b,sampleRate:e.sampleRate,timestamp:c,dt:u},R=a(v,{});i(R),n=requestAnimationFrame(r)};return{start:async()=>{const c=await navigator.mediaDevices.getUserMedia({audio:!0});o=c;const u=new AudioContext;e=u;const b=u.createAnalyser();b.fftSize=Go,t=b,u.createMediaStreamSource(c).connect(b),l=0,a=yt(),n=requestAnimationFrame(r)},stop:()=>{if(n!==null&&(cancelAnimationFrame(n),n=null),o!==null){for(const c of o.getTracks())c.stop();o=null}e!==null&&(e.close(),e=null),t=null,l=0},subscribe:c=>(s.add(c),()=>{s.delete(c)})}},yt=()=>Jn(e=>({volume:Qn(e.buffer)}),e=>({pitch:oo(e.buffer,e.sampleRate)}),e=>{const t=Po(e.buffer,e.sampleRate),{formants:o}=go(e.buffer,e.sampleRate);return{vowel:t,formants:o}},Fo(),Do(),Ho()),Uo=e=>{let t=e;const o=new Set;return{get:()=>t,set:a=>{t=a,o.forEach(i=>i(t))},subscribe:a=>(o.add(a),()=>{o.delete(a)})}},St=()=>window.location.hash.replace(/^#/,"")||"menu",jo=(e,t)=>{let o=null;const n=i=>t.find(r=>r.id===i),l=i=>{for(o&&o.unmount();e.firstChild;)e.removeChild(e.firstChild);const r=n(i)??n("menu")??null;o=r,r&&r.mount(e),window.location.hash=`#${(r==null?void 0:r.id)??i}`},s=()=>o,a=()=>{l(St())};return window.addEventListener("hashchange",a),l(St()),{navigate:l,getCurrentGame:s}},A=(e,t,...o)=>{const n=document.createElement(e);if(t)for(const[l,s]of Object.entries(t))n.setAttribute(l,s);for(const l of o)typeof l=="string"?n.appendChild(document.createTextNode(l)):n.appendChild(l);return n},Vo=(e,t=document)=>{const o=t.querySelector(e);if(!o)throw new Error(`Element not found: ${e}`);return o},In=e=>{for(;e.firstChild;)e.removeChild(e.firstChild)},C={bg:"#f0f4ff",text:"#2d3748",primary:"#6366f1",secondary:"#f472b6",green:"#34d399",surface:"#ffffff",muted:"#94a3b8"},Z={a:"#ef4444",e:"#f59e0b",ɛ:"#f97316",i:"#22c55e",o:"#3b82f6",u:"#8b5cf6",y:"#ec4899"},g=(e,t)=>{const o=Math.max(0,Math.min(1,t)),n=parseInt(e.slice(1,3),16),l=parseInt(e.slice(3,5),16),s=parseInt(e.slice(5,7),16);return`rgba(${n}, ${l}, ${s}, ${o})`},wt=["#818cf8","#f472b6","#34d399","#fbbf24","#60a5fa"],Yo=e=>wt[e%wt.length],qo=e=>{Object.assign(e.style,{display:"flex",flexDirection:"column",alignItems:"center",minHeight:"100%",padding:"32px 16px",backgroundColor:C.bg,fontFamily:"inherit",overflowY:"auto"})},Xo=e=>{Object.assign(e.style,{fontSize:"3rem",fontWeight:"800",color:C.primary,margin:"0 0 8px 0",letterSpacing:"-0.02em"})},Ko=e=>{Object.assign(e.style,{fontSize:"1.5rem",fontWeight:"500",color:C.muted,margin:"0 0 40px 0"})},Zo=e=>{Object.assign(e.style,{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"24px",width:"100%",maxWidth:"800px"})},Jo=(e,t)=>{Object.assign(e.style,{backgroundColor:t,borderRadius:"16px",padding:"32px 24px",cursor:"pointer",border:"none",textAlign:"left",transition:"transform 0.15s ease, box-shadow 0.15s ease",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)"}),e.addEventListener("mouseenter",()=>{e.style.transform="scale(1.04)",e.style.boxShadow="0 8px 24px rgba(0, 0, 0, 0.15)"}),e.addEventListener("mouseleave",()=>{e.style.transform="scale(1)",e.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.1)"})},Qo=e=>{Object.assign(e.style,{fontSize:"1.6rem",fontWeight:"700",color:"#ffffff",margin:"0 0 8px 0"})},zo=e=>{Object.assign(e.style,{fontSize:"1.1rem",fontWeight:"400",color:"rgba(255, 255, 255, 0.9)",margin:"0",lineHeight:"1.4"})},xo=(e,t)=>{const o=A("p",{},e.name);Qo(o);const n=A("p",{},e.description);zo(n);const l=A("button",{},o,n);return Jo(l,Yo(t)),l.addEventListener("click",()=>{window.location.hash="#"+e.id}),l},el=e=>({id:"menu",name:"Accueil",description:"Choisis un jeu !",mount:l=>{In(l);const s=A("div",{});qo(s);const a=A("h1",{},"Ortho");Xo(a);const i=A("p",{},"Choisis un jeu !");Ko(i);const r=A("div",{});Zo(r),e.forEach((d,f)=>{r.appendChild(xo(d,f))}),s.appendChild(a),s.appendChild(i),s.appendChild(r),l.appendChild(s)},unmount:()=>{},update:l=>{}}),Re=(e,t,o)=>{for(let n=0;n<o.length;n++)e.setUint8(t+n,o.charCodeAt(n))},tl=(e,t)=>{const l=t*1*2,s=1*(16/8),a=e.length*(16/8),i=new ArrayBuffer(44+a),r=new DataView(i);Re(r,0,"RIFF"),r.setUint32(4,36+a,!0),Re(r,8,"WAVE"),Re(r,12,"fmt "),r.setUint32(16,16,!0),r.setUint16(20,1,!0),r.setUint16(22,1,!0),r.setUint32(24,t,!0),r.setUint32(28,l,!0),r.setUint16(32,s,!0),r.setUint16(34,16,!0),Re(r,36,"data"),r.setUint32(40,a,!0);let d=44;for(let f=0;f<e.length;f++){const h=Math.max(-1,Math.min(1,e[f]));r.setInt16(d,h*32767,!0),d+=2}return new Blob([i],{type:"audio/wav"})},vt=e=>{let t=!1,o=[],n=null,l=null,s=null,a=null;return{start:async()=>{t||(o=[],a=await navigator.mediaDevices.getUserMedia({audio:!0}),n=new AudioContext,l=n.createMediaStreamSource(a),s=n.createScriptProcessor(4096,1,1),s.onaudioprocess=f=>{const h=f.inputBuffer.getChannelData(0);o.push(new Float32Array(h))},l.connect(s),s.connect(n.destination),t=!0)},stop:()=>{if(!t)return;t=!1;const f=(n==null?void 0:n.sampleRate)??44100;a==null||a.getTracks().forEach(v=>v.stop()),s==null||s.disconnect(),l==null||l.disconnect(),n==null||n.close();const h=o.reduce((v,R)=>v+R.length,0),c=new Float32Array(h);let u=0;for(const v of o)c.set(v,u),u+=v.length;const b=tl(c,f);e(b),o=[],n=null,l=null,s=null,a=null},isRecording:()=>t}},Mt=(e,t)=>{const o=URL.createObjectURL(e),n=document.createElement("a");n.href=o,n.download=t,n.click(),URL.revokeObjectURL(o)},ge=["background: "+C.surface,"border-radius: 16px","padding: 24px","box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08)","display: flex","flex-direction: column","gap: 12px"].join("; "),me=["font-size: 14px","font-weight: 600","color: "+C.muted,"text-transform: uppercase","letter-spacing: 1px"].join("; "),Tt=["font-size: 32px","font-weight: 700","color: "+C.text].join("; "),nl=["display: grid","grid-template-columns: 1fr 1fr","gap: 20px","padding: 24px","max-width: 720px","margin: 0 auto","font-family: system-ui, -apple-system, sans-serif"].join("; "),ol=["display: flex","align-items: center","justify-content: center","position: relative","padding: 20px 24px 4px","max-width: 720px","margin: 0 auto"].join("; "),ll=["position: absolute","left: 24px","top: 20px","background: none","border: none","font-size: 16px","color: "+C.primary,"cursor: pointer","padding: 8px 12px","border-radius: 8px","font-weight: 600","transition: background 0.15s"].join("; "),al=["font-size: 24px","font-weight: 700","color: "+C.text,"margin: 0"].join("; "),sl=["width: 100%","height: 24px","background: "+C.bg,"border-radius: 12px","overflow: hidden"].join("; "),il=["height: 100%","border-radius: 12px","transition: width 0.05s linear, background 0.15s","width: 0%"].join("; "),rl=["width: 120px","height: 120px","border-radius: 50%","display: flex","align-items: center","justify-content: center","font-size: 48px","font-weight: 700","color: white","margin: 0 auto","transition: background-color 0.15s","background: "+C.bg].join("; "),cl=["display: flex","flex-wrap: wrap","gap: 6px","min-height: 32px","align-items: center"].join("; "),dl=["width: 28px","height: 28px","border-radius: 50%","display: flex","align-items: center","justify-content: center","font-size: 13px","font-weight: 700","color: white"].join("; "),fl=["position: fixed","bottom: 24px","left: 24px","width: 56px","height: 56px","border-radius: 50%","border: 3px solid #e53e3e","background: white","cursor: pointer","display: flex","align-items: center","justify-content: center","box-shadow: 0 2px 12px rgba(0,0,0,0.15)","z-index: 1000","transition: all 0.15s"].join("; "),hl=e=>{const t=Math.round(255*(1-e));return`rgb(${Math.round(255*e)}, ${t}, 80)`},ul=20,Pt={a:{f1:750,f2:1450,f3:2600},e:{f1:400,f2:2050,f3:2650},ɛ:{f1:600,f2:1750,f3:2600},i:{f1:250,f2:2250,f3:3e3},o:{f1:350,f2:750,f3:2550},u:{f1:300,f2:750,f3:2300},y:{f1:250,f2:1750,f3:2150}},pl=(e,t,o,n)=>{const l=window.devicePixelRatio||1,s=t.width/l,a=t.height/l;e.clearRect(0,0,s,a);const{magnitudes:i,sampleRate:r,fftSize:d}=o,f=3500,h=r/d,c=Math.min(i.length-1,Math.ceil(f/h));let u=0;for(let m=0;m<=c;m++){const y=Math.log10(1+i[m]*500);if(y>u&&(u=y),o.lpcEnvelope){const T=Math.log10(1+o.lpcEnvelope[m]*500);T>u&&(u=T)}}u===0&&(u=1);const b=e.createLinearGradient(0,0,0,a);b.addColorStop(0,g(C.primary,.8)),b.addColorStop(1,g(C.primary,.05)),e.beginPath(),e.moveTo(0,a);for(let m=0;m<=c;m++){const T=m*h/f*s,S=Math.log10(1+i[m]*500),E=a-S/u*(a-20);e.lineTo(T,E)}e.lineTo(c*h/f*s,a),e.closePath(),e.fillStyle=b,e.fill(),e.beginPath();for(let m=0;m<=c;m++){const T=m*h/f*s,S=Math.log10(1+i[m]*500),E=a-S/u*(a-20);m===0?e.moveTo(T,E):e.lineTo(T,E)}if(e.strokeStyle=C.primary,e.lineWidth=1.5,e.stroke(),o.lpcEnvelope){e.beginPath();for(let m=0;m<=c;m++){const T=m*h/f*s,S=Math.log10(1+o.lpcEnvelope[m]*500),E=a-S/u*(a-20);m===0?e.moveTo(T,E):e.lineTo(T,E)}e.strokeStyle="#ff6b35",e.lineWidth=2.5,e.stroke()}if(n&&Pt[n]){const m=Pt[n],y=Z[n]??C.primary,T=100,S=(m.f1-T)/f*s,E=(m.f1+T)/f*s;e.fillStyle=g(y,.18),e.fillRect(S,0,E-S,a);const O=(m.f2-T)/f*s,_=(m.f2+T)/f*s;e.fillStyle=g(y,.18),e.fillRect(O,0,_-O,a);const F=(m.f3-T)/f*s,k=(m.f3+T)/f*s;e.fillStyle=g(y,.18),e.fillRect(F,0,k-F,a),e.fillStyle=g(y,.7),e.font="11px system-ui, sans-serif",e.textAlign="center",e.fillText("F1 cible",(S+E)/2,14),e.fillText("F2 cible",(O+_)/2,14),e.fillText("F3 cible",(F+k)/2,14)}const{f1:v,f2:R,f3:I}=o,p=n&&Z[n]?Z[n]:C.primary,w=v/f*s;e.beginPath(),e.moveTo(w,0),e.lineTo(w,a),e.strokeStyle=p,e.lineWidth=2,e.stroke(),e.fillStyle=p,e.font="bold 11px system-ui, sans-serif",e.textAlign="left",e.fillText("F1: "+Math.round(v)+" Hz",w+4,30);const M=R/f*s;e.beginPath(),e.moveTo(M,0),e.lineTo(M,a),e.strokeStyle=p,e.lineWidth=2,e.stroke(),e.fillStyle=p,e.font="bold 11px system-ui, sans-serif",e.textAlign="right",e.fillText("F2: "+Math.round(R)+" Hz",M-4,30);const P=I/f*s;e.beginPath(),e.moveTo(P,0),e.lineTo(P,a),e.strokeStyle=p,e.lineWidth=2,e.stroke(),e.fillStyle=p,e.font="bold 11px system-ui, sans-serif",e.textAlign="right",e.fillText("F3: "+Math.round(I)+" Hz",P-4,44),e.fillStyle=C.muted,e.font="10px system-ui, sans-serif",e.textAlign="center";for(let m=500;m<=3e3;m+=500){const y=m/f*s;e.fillText(m+"",y,a-4)}},gl=()=>{let e=null,t=null,o=null,n=null,l=null,s=null,a=null,i=null,r=null;return{id:"dashboard",name:"Dashboard",description:"Tableau de bord diagnostique — visualise le pipeline audio en temps réel",mount:c=>{const u=A("div",{style:"background: "+C.bg+"; min-height: 100vh;"}),b=A("div",{style:ol}),v=A("button",{style:ll},"← Accueil");v.addEventListener("click",()=>{window.location.hash="#menu"}),v.addEventListener("mouseenter",()=>{v.style.background=g(C.primary,.1)}),v.addEventListener("mouseleave",()=>{v.style.background="none"});const R=A("h1",{style:al},"Dashboard");b.appendChild(v),b.appendChild(R),u.appendChild(b);const I=A("div",{style:nl}),p=A("div",{style:ge}),w=A("span",{style:me},"Volume"),M=A("div",{style:sl});e=A("div",{style:il}),M.appendChild(e),p.appendChild(w),p.appendChild(M);const P=A("div",{style:ge}),m=A("span",{style:me},"Pitch");t=A("span",{style:Tt},"—"),P.appendChild(m),P.appendChild(t);const y=A("div",{style:ge}),T=A("span",{style:me},"Voyelle");o=A("div",{style:rl}),n=A("span",{},"—"),o.appendChild(n),y.appendChild(T),y.appendChild(o);const S=A("div",{style:ge}),E=A("span",{style:me},"Durée");l=A("span",{style:Tt},"0.0 s"),S.appendChild(E),S.appendChild(l),I.appendChild(p),I.appendChild(P),I.appendChild(y),I.appendChild(S),u.appendChild(I);const O=A("div",{style:"padding: 0 24px 20px; max-width: 720px; margin: 0 auto;"}),_=A("div",{style:ge}),F=A("span",{style:me},"Spectre");a=document.createElement("canvas"),a.style.cssText="width: 100%; height: 180px; border-radius: 8px; background: "+C.bg;const k=window.devicePixelRatio||1;a.width=672*k,a.height=180*k;const D=a.getContext("2d");D&&D.scale(k,k),i=D,_.appendChild(F),_.appendChild(a),O.appendChild(_),u.appendChild(O);const U=new ResizeObserver(H=>{for(const $ of H){const q=$.contentRect;if(a&&i){const X=window.devicePixelRatio||1;a.width=q.width*X,a.height=180*X,i.scale(X,X)}}});U.observe(_),r=U;const L=A("div",{style:"padding: 0 24px 24px; max-width: 720px; margin: 0 auto;"}),W=A("div",{style:ge}),G=A("span",{style:me},"Historique voyelles");s=A("div",{style:cl}),W.appendChild(G),W.appendChild(s),L.appendChild(W),u.appendChild(L);{const H=A("button",{style:fl}),$=A("div",{style:"width: 24px; height: 24px; border-radius: 50%; background: #e53e3e; transition: all 0.15s;"});H.appendChild($);let q=vt(X=>{const K=new Date().toISOString().replace(/[:.]/g,"-");Mt(X,`sample-${K}.wav`)});H.addEventListener("click",()=>{q.isRecording()?(q.stop(),$.style.borderRadius="50%",$.style.background="#e53e3e",H.style.borderColor="#e53e3e"):(q=vt(X=>{const K=new Date().toISOString().replace(/[:.]/g,"-");Mt(X,`sample-${K}.wav`)}),q.start(),$.style.borderRadius="4px",$.style.background="#e53e3e",H.style.borderColor="#e53e3e")}),u.appendChild(H)}In(c),c.appendChild(u)},update:c=>{if(e){const u=Math.round(c.volume*100);e.style.width=u+"%",e.style.background=hl(c.volume)}if(t&&(t.textContent=c.pitch!==null?Math.round(c.pitch)+" Hz":"—"),o&&n)if(c.vowel!==null){const u=Z[c.vowel]??C.muted;o.style.background=u,n.textContent=c.vowel,n.style.color="white"}else o.style.background=C.bg,n.textContent="—",n.style.color=C.muted;if(l&&(l.textContent=c.duration.toFixed(1)+" s"),s&&c.vowel!==null){const u=Z[c.vowel]??C.muted,b=A("div",{style:dl+"; background: "+u},c.vowel);for(s.insertBefore(b,s.firstChild);s.children.length>ul;)s.removeChild(s.lastChild)}i&&a&&c.formants&&pl(i,a,c.formants,c.vowel)},unmount:()=>{r&&(r.disconnect(),r=null),e=null,t=null,o=null,n=null,l=null,s=null,a=null,i=null}}},ee=e=>{const t=document.createElement("canvas"),o=t.getContext("2d");if(!o)throw new Error("Failed to get 2D rendering context");e.appendChild(t);const{width:n,height:l}=Q(t,o);return{canvas:t,ctx:o,width:n,height:l}},le=(e,t,o)=>{e.clearRect(0,0,t,o)},Q=(e,t)=>{const o=e.parentElement;if(!o)throw new Error("Canvas must be mounted in a parent element");const n=window.devicePixelRatio||1,l=o.clientWidth,s=o.clientHeight;return e.width=l*n,e.height=s*n,e.style.width=`${l}px`,e.style.height=`${s}px`,t.setTransform(n,0,0,n,0,0),{width:l,height:s}},ml=6,bl=.003,yl=.05,Sl=10,wl=50,vl=-1,Ml=-3,Ct=.5,Tl=.3,Pl=.7,Cl=.8,At=(e,t)=>e+Math.random()*(t-e),Al=(e,t,o,n)=>({x:At(e*Tl,e*Pl),y:t,radius:Sl+o*wl,color:n&&Z[n]?Z[n]:C.primary,alpha:Cl,vy:vl+o*Ml,vx:At(-Ct,Ct)}),El=e=>({...e,y:e.y+e.vy,x:e.x+e.vx,alpha:e.alpha-bl,radius:e.radius+yl}),Il=e=>e.alpha>0&&e.y+e.radius>0,Rl=(e,t)=>{e.beginPath(),e.arc(t.x,t.y,t.radius,0,Math.PI*2),e.fillStyle=g(t.color,t.alpha),e.fill()},kl=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:C.bg})},Fl=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:C.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:g(C.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Ol=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:g(C.primary,.5),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},_l=()=>{let e=null,t=null,o=0,n=0,l=[],s=null,a=null,i=0,r=null;const d=()=>{if(t){le(t,o,n),l=l.map(El).filter(Il);for(const b of l)Rl(t,b);s=requestAnimationFrame(d)}},f=()=>{if(!e||!t)return;const b=Q(e,t);o=b.width,n=b.height};return{id:"bubbles",name:"Bulles",description:"Fais monter des bulles avec ta voix !",mount:b=>{const v=A("div",{});kl(v),a=A("button",{},"← Accueil"),Fl(a),a.addEventListener("click",()=>{window.location.hash="#menu"});const R=A("p",{},"Bulles");Ol(R),v.appendChild(a),v.appendChild(R),b.appendChild(v);const I=ee(v);e=I.canvas,t=I.ctx,o=I.width,n=I.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),r=f,window.addEventListener("resize",r),l=[],i=0,d()},unmount:()=>{s!==null&&(cancelAnimationFrame(s),s=null),r&&(window.removeEventListener("resize",r),r=null),e=null,t=null,a=null,l=[],i=0,o=0,n=0},update:b=>{if(!b.isVoicing){i=0;return}i+=1,i>=ml&&(i=0,l.push(Al(o,n,b.volume,b.vowel)))}}},Et=120,Bl=.08,Be=36,Rn=56,Ll=3,Dl=.03,It=3,Rt=2.5,Wl=3,Nl=8,kt=.08,Hl=.12,Gl=.08,kn="#0f0e2e",$l="#1a3a2a",Ul="#2d5a3a",Ft=["#ff6b35","#ffa500","#ffcc00","#ff4444","#ffee88"],jl=[{x:.78,y:.7,radius:18,color:"#66bb6a",label:"",ringColor:null},{x:.2,y:.5,radius:24,color:"#ffa726",label:"",ringColor:"#ffcc80"},{x:.82,y:.32,radius:20,color:"#ab47bc",label:"",ringColor:null},{x:.35,y:.15,radius:30,color:"#42a5f5",label:"",ringColor:"#90caf9"}],Vl=(e,t,o)=>e+(t-e)*o,de=(e,t)=>e+Math.random()*(t-e),Ot=e=>Array.from({length:e},()=>({x:Math.random(),y:Math.random(),size:de(.5,2.5),twinkleSpeed:de(.01,.04),twinkleOffset:Math.random()*Math.PI*2})),Yl=(e,t,o)=>({x:e+de(-Be*.3,Be*.3),y:t+de(0,4),vx:de(-It,It),vy:de(Rt*.5,Rt)*(.5+o*.5),life:1,size:de(Wl,Nl)*(.6+o*.8),color:Ft[Math.floor(Math.random()*Ft.length)]}),ql=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,life:e.life-Dl,size:e.size*.97}),Xl=e=>e.life>0&&e.size>.5,Kl=(e,t,o,n,l)=>{for(const s of t){const a=.4+.6*Math.abs(Math.sin(l*s.twinkleSpeed+s.twinkleOffset));e.beginPath(),e.arc(s.x*o,s.y*n,s.size,0,Math.PI*2),e.fillStyle=g("#ffffff",a),e.fill()}},Zl=(e,t,o,n)=>{const l=t.x*o,s=t.y*n,a=e.createRadialGradient(l,s,t.radius*.5,l,s,t.radius*2);a.addColorStop(0,g(t.color,.2)),a.addColorStop(1,g(t.color,0)),e.beginPath(),e.arc(l,s,t.radius*2,0,Math.PI*2),e.fillStyle=a,e.fill(),e.beginPath(),e.arc(l,s,t.radius,0,Math.PI*2),e.fillStyle=t.color,e.fill(),t.ringColor&&(e.beginPath(),e.ellipse(l,s,t.radius*1.8,t.radius*.35,-.3,0,Math.PI*2),e.strokeStyle=g(t.ringColor,.6),e.lineWidth=2,e.stroke())},Jl=(e,t,o)=>{const n=o*(1-kt);e.fillStyle=$l,e.fillRect(0,n,t,o*kt),e.fillStyle=Ul,e.fillRect(0,n,t,3)},Ql=(e,t,o)=>{const n=Be/2,l=Rn;e.save(),e.translate(t,o),e.beginPath(),e.moveTo(0,-l),e.lineTo(-n*.5,-l*.55),e.lineTo(n*.5,-l*.55),e.closePath(),e.fillStyle="#ef4444",e.fill(),e.beginPath(),e.moveTo(-n*.5,-l*.55),e.lineTo(-n*.5,0),e.lineTo(n*.5,0),e.lineTo(n*.5,-l*.55),e.closePath(),e.fillStyle="#e0e0e0",e.fill(),e.fillStyle=C.primary,e.fillRect(-n*.5,-l*.4,Be*.5,l*.12),e.beginPath(),e.arc(0,-l*.42,n*.28,0,Math.PI*2),e.fillStyle="#81d4fa",e.fill(),e.beginPath(),e.arc(0,-l*.42,n*.28,0,Math.PI*2),e.strokeStyle="#4fc3f7",e.lineWidth=1.5,e.stroke(),e.beginPath(),e.moveTo(-n*.5,-l*.08),e.lineTo(-n,l*.08),e.lineTo(-n*.5,0),e.closePath(),e.fillStyle="#ef4444",e.fill(),e.beginPath(),e.moveTo(n*.5,-l*.08),e.lineTo(n,l*.08),e.lineTo(n*.5,0),e.closePath(),e.fillStyle="#ef4444",e.fill(),e.beginPath(),e.moveTo(-n*.3,0),e.lineTo(-n*.2,l*.08),e.lineTo(n*.2,l*.08),e.lineTo(n*.3,0),e.closePath(),e.fillStyle="#78909c",e.fill(),e.restore()},zl=(e,t)=>{for(const o of t)e.beginPath(),e.arc(o.x,o.y,o.size,0,Math.PI*2),e.fillStyle=g(o.color,o.life*.8),e.fill()},xl=(e,t,o,n,l,s)=>{const a=1-(n-l)/(s-l),i=t-24,r=o*.08,d=o*.84,f=8;e.fillStyle=g("#ffffff",.1),e.beginPath(),e.roundRect(i-f/2,r,f,d,4),e.fill();const h=d*Math.max(0,Math.min(1,a)),c=e.createLinearGradient(0,r+d,0,r);c.addColorStop(0,"#34d399"),c.addColorStop(.5,"#fbbf24"),c.addColorStop(1,"#ef4444"),e.fillStyle=c,e.beginPath(),e.roundRect(i-f/2,r+d-h,f,h,4),e.fill()},ea=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:kn})},ta=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:"#a5b4fc",cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:g("#1e1b4b",.7),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},na=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:g("#a5b4fc",.6),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},oa=()=>{let e=null,t=null,o=0,n=0,l=null,s=null,a=[],i=0,r=0,d=[],f=0,h=!1,c=0;const u=()=>n*(1-Hl),b=()=>n*Gl+Rn,v=()=>o/2,R=()=>{if(t){if(c+=1,i=Vl(i,r,Bl),d=d.map(ql).filter(Xl),h&&f>.01){const P=Math.ceil(Ll*(.5+f*1.5));for(let m=0;m<P;m++)d.push(Yl(v(),i,f))}le(t,o,n),t.fillStyle=kn,t.fillRect(0,0,o,n),Kl(t,a,o,n,c);for(const P of jl)Zl(t,P,o,n);Jl(t,o,n),zl(t,d),Ql(t,v(),i),xl(t,o,n,i,b(),u()),l=requestAnimationFrame(R)}},I=()=>{if(!e||!t)return;const P=u(),m=b(),y=P>m?(i-m)/(P-m):1,T=Q(e,t);o=T.width,n=T.height;const S=u(),E=b();i=E+y*(S-E),r=i,a=Ot(Et)};return{id:"rocket",name:"Fusée",description:"Fais décoller la fusée avec ta voix !",mount:P=>{const m=A("div",{});ea(m);const y=A("button",{},"← Accueil");ta(y),y.addEventListener("click",()=>{window.location.hash="#menu"});const T=A("p",{},"Fusée");na(T),m.appendChild(y),m.appendChild(T),P.appendChild(m);const S=ee(m);e=S.canvas,t=S.ctx,o=S.width,n=S.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),a=Ot(Et),i=u(),r=i,d=[],f=0,h=!1,c=0,s=I,window.addEventListener("resize",s),R()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),s&&(window.removeEventListener("resize",s),s=null),e=null,t=null,a=[],d=[],f=0,h=!1,c=0,o=0,n=0},update:P=>{f=P.volume,h=P.isVoicing;const m=u(),y=b();if(P.isVoicing&&P.volume>.01){const T=Math.pow(P.volume,.3);r=m-T*(m-y)}else r=m}}},_t=["#f9a8d4","#a5b4fc","#86efac","#fcd34d","#fca5a5","#c4b5fd","#67e8f9","#fdba74","#d8b4fe","#6ee7b7"],Bt=["star","heart","butterfly","flower"],la=9,aa=15,Ge=20,sa=.45,ia=.06,ra=.25,Je="#0a0e1a",Lt=.04,ke=(e,t)=>e+Math.random()*(t-e),Dt=(e,t,o,n)=>Math.sqrt((o-e)**2+(n-t)**2),Wt=(e,t,o)=>Math.max(t,Math.min(o,e)),ca=(e,t)=>{const n=[];for(let l=0;l<la;l++)n.push({x:ke(60,e-60),y:ke(110,t-60),kind:Bt[l%Bt.length],color:_t[l%_t.length],size:ke(18,30),discovered:!1,glowPhase:ke(0,Math.PI*2)});return n},da=(e,t,o,n,l,s)=>{const i=n,r=n*.45;e.save(),e.globalAlpha=s,e.fillStyle=l,e.beginPath();for(let d=0;d<10;d++){const f=d%2===0?i:r,h=Math.PI*d/5-Math.PI/2,c=t+Math.cos(h)*f,u=o+Math.sin(h)*f;d===0?e.moveTo(c,u):e.lineTo(c,u)}e.closePath(),e.fill(),e.restore()},fa=(e,t,o,n,l,s)=>{const a=n*.6;e.save(),e.globalAlpha=s,e.fillStyle=l,e.beginPath(),e.moveTo(t,o+a*.3),e.bezierCurveTo(t,o-a*.3,t-a,o-a*.3,t-a,o+a*.1),e.bezierCurveTo(t-a,o+a*.6,t,o+a*.9,t,o+a*1.1),e.bezierCurveTo(t,o+a*.9,t+a,o+a*.6,t+a,o+a*.1),e.bezierCurveTo(t+a,o-a*.3,t,o-a*.3,t,o+a*.3),e.closePath(),e.fill(),e.restore()},ha=(e,t,o,n,l,s)=>{const a=n*.7;e.save(),e.globalAlpha=s,e.fillStyle=l,e.beginPath(),e.ellipse(t-a*.45,o-a*.25,a*.5,a*.35,-Math.PI/6,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(t+a*.45,o-a*.25,a*.5,a*.35,Math.PI/6,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(t-a*.35,o+a*.25,a*.35,a*.25,Math.PI/6,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(t+a*.35,o+a*.25,a*.35,a*.25,-Math.PI/6,0,Math.PI*2),e.fill(),e.fillStyle=g(l,s*.8),e.beginPath(),e.ellipse(t,o,a*.08,a*.45,0,0,Math.PI*2),e.fill(),e.restore()},ua=(e,t,o,n,l,s)=>{const i=n*.35,r=n*.2,d=n*.35;e.save(),e.globalAlpha=s,e.fillStyle=l;for(let f=0;f<6;f++){const h=Math.PI*2*f/6,c=t+Math.cos(h)*d,u=o+Math.sin(h)*d;e.beginPath(),e.arc(c,u,i,0,Math.PI*2),e.fill()}e.fillStyle=g("#fef08a",s),e.beginPath(),e.arc(t,o,r,0,Math.PI*2),e.fill(),e.restore()},pa=(e,t,o,n)=>{const l=t.size*n;({star:()=>da(e,t.x,t.y,l,t.color,o),heart:()=>fa(e,t.x,t.y,l,t.color,o),butterfly:()=>ha(e,t.x,t.y,l,t.color,o),flower:()=>ua(e,t.x,t.y,l,t.color,o)})[t.kind]()},ga=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:Je})},ma=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:"#a5b4fc",cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:g("#1e1b4b",.7),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},ba=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:g("#c7d2fe",.6),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},ya=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",fontSize:"1.1rem",fontWeight:"600",color:"#fcd34d",margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:g("#1e1b4b",.7),borderRadius:"8px"})},Sa=()=>{let e=null,t=null,o=0,n=0,l=[],s=null,a=null,i=null,r=0,d=0,f=0,h=0;const c=S=>{const E=Math.min(o,n)*sa,O=Math.pow(S,.3);return Ge+O*E},u=S=>{l=l.map(E=>{if(E.discovered)return E;const O=Dt(f,h,E.x,E.y),_=S-E.size-aa;return O<_?{...E,discovered:!0}:E})},b=()=>{if(!i)return;const S=l.filter(E=>E.discovered).length;i.textContent=`${S} / ${l.length}`},v=S=>{S.fillStyle=Je,S.fillRect(0,0,o,n)},R=(S,E)=>{if(E<=Ge)return;const O=S.createRadialGradient(f,h,0,f,h,E);O.addColorStop(0,g("#2a3a6a",.9)),O.addColorStop(.3,g("#1a2550",.7)),O.addColorStop(.7,g("#101830",.4)),O.addColorStop(1,g(Je,0)),S.save(),S.globalCompositeOperation="lighter",S.fillStyle=O,S.beginPath(),S.arc(f,h,E,0,Math.PI*2),S.fill(),S.restore()},I=(S,E,O)=>{for(const _ of l){const F=Dt(f,h,_.x,_.y);let k;if(_.discovered&&E<=Ge)k=Lt*3;else if(F>E+_.size)k=_.discovered?Lt*2:0;else if(F>E-_.size){const U=(E+_.size-F)/(_.size*2);k=Wt(U,0,1)*.9}else{const U=1-F/E*.3;k=Wt(U,.5,.95)}if(k<=0)continue;let D=1;_.discovered&&(D=1+Math.sin(O*ia+_.glowPhase)*ra,k=Math.min(k+.15,1)),pa(S,_,k,D)}},p=(S,E)=>{if(l.filter(F=>F.discovered).length>0)return;const _=.25+Math.sin(E*.03)*.1;S.save(),S.fillStyle=g("#c7d2fe",_),S.font="1.1rem system-ui, sans-serif",S.textAlign="center",S.fillText("Parle pour allumer la lampe !",o/2,n/2+60),S.restore()};let w=0;const M=()=>{t&&(w+=1,le(t,o,n),r+=(d-r)*.12,v(t),R(t,r),I(t,r,w),p(t,w),u(r),b(),s=requestAnimationFrame(M))},P=()=>{if(!e||!t)return;const S=Q(e,t);o=S.width,n=S.height,f=o/2,h=n/2};return{id:"lamp",name:"Lampe Magique",description:"Illumine l’obscurité avec ta voix pour découvrir des créatures cachées !",mount:S=>{const E=A("div",{});ga(E);const O=A("button",{},"← Accueil");ma(O),O.addEventListener("click",()=>{window.location.hash="#menu"});const _=A("p",{},"Lampe Magique");ba(_),i=A("p",{},"0 / 0"),ya(i),E.appendChild(O),E.appendChild(_),E.appendChild(i),S.appendChild(E);const F=ee(E);e=F.canvas,t=F.ctx,o=F.width,n=F.height,f=o/2,h=n/2,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),l=ca(o,n),r=0,d=0,w=0,a=P,window.addEventListener("resize",a),b(),M()},unmount:()=>{s!==null&&(cancelAnimationFrame(s),s=null),a&&(window.removeEventListener("resize",a),a=null),e=null,t=null,i=null,l=[],r=0,d=0,w=0,o=0,n=0},update:S=>{S.isVoicing?d=c(S.volume):d=0}}},Nt=7,wa=.15,va=60,Ma=1/va,Ta=.03,Pa=180,Ca=80,Aa=.08,Ea=.006,Ia=.3,Ra=.008,ka=8,Ht=.08,Fa=.12,Gt=["#fca5a5","#a5b4fc","#86efac","#fcd34d","#f9a8d4","#67e8f9","#fdba74"],$t=["#f472b6","#a78bfa","#34d399","#fbbf24","#60a5fa","#f87171","#2dd4bf","#fb923c"],Fn="#2d1b33",Oa="#4a2c2a",_a="#5c3a2e",Ba="#7a5040",J=(e,t)=>e+Math.random()*(t-e),Fe=(e,t,o)=>Math.max(t,Math.min(o,e)),La=e=>Array.from({length:e},(t,o)=>({x:0,bodyColor:Gt[o%Gt.length],flameScale:1,extinguished:!1,blowAccumulator:0})),Ut=(e,t)=>{const o=t*.12,n=(t-o*2)/(e.length-1);return e.map((l,s)=>({...l,x:o+s*n}))},Da=e=>{const t=e.findIndex(o=>!o.extinguished);return t===-1?null:t},Wa=(e,t)=>({x:e+J(-3,3),y:t-J(2,8),vx:J(-.3,.3),vy:J(-.8,-.3),alpha:J(.3,.6),size:J(3,6)}),Na=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,alpha:e.alpha-Ra,size:e.size+.03}),Ha=e=>e.alpha>0,Ga=(e,t)=>Array.from({length:Ca},()=>({x:J(0,e),y:J(-t*.3,t*.1),vx:J(-2,2),vy:J(1,3),rotation:J(0,Math.PI*2),rotationSpeed:J(-.1,.1),color:$t[Math.floor(Math.random()*$t.length)],alpha:1,width:J(6,12),height:J(3,6)})),$a=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,vy:e.vy+Aa,rotation:e.rotation+e.rotationSpeed,alpha:e.alpha-Ea}),Ua=e=>e.alpha>0,ja=(e,t,o)=>{const n=e.createLinearGradient(0,0,0,o);n.addColorStop(0,Fn),n.addColorStop(1,Oa),e.fillStyle=n,e.fillRect(0,0,t,o)},Va=(e,t,o,n)=>{const l=e.createLinearGradient(0,n,0,o);l.addColorStop(0,Ba),l.addColorStop(.15,_a),l.addColorStop(1,"#3d2518"),e.fillStyle=l,e.beginPath(),e.roundRect(0,n,t,o-n,[8,8,0,0]),e.fill(),e.strokeStyle=g("#a07050",.4),e.lineWidth=1.5,e.beginPath(),e.moveTo(0,n),e.lineTo(t,n),e.stroke()},Ya=(e,t,o,n,l,s)=>{const a=t-n/2,i=o-l;e.fillStyle=s,e.beginPath(),e.roundRect(a,i,n,l,[4,4,0,0]),e.fill(),e.fillStyle=g("#ffffff",.15),e.beginPath(),e.roundRect(a+2,i,n*.25,l,[3,0,0,0]),e.fill(),e.strokeStyle="#4a3728",e.lineWidth=2,e.beginPath(),e.moveTo(t,i),e.lineTo(t,i-8),e.stroke()},qa=(e,t,o,n,l)=>{if(n<=.01)return;const s=22*n,a=9*n,i=o-s,r=l*3*n;e.save();const d=20*n,f=e.createRadialGradient(t+r,o-s*.5,0,t+r,o-s*.5,d);f.addColorStop(0,g("#fef08a",.25*n)),f.addColorStop(1,g("#fef08a",0)),e.fillStyle=f,e.beginPath(),e.arc(t+r,o-s*.5,d,0,Math.PI*2),e.fill(),e.fillStyle=g("#fb923c",.85),e.beginPath(),e.moveTo(t-a*.6+r*.5,o),e.quadraticCurveTo(t-a+r*.8,o-s*.5,t+r,i),e.quadraticCurveTo(t+a+r*.8,o-s*.5,t+a*.6+r*.5,o),e.closePath(),e.fill();const h=.65;e.fillStyle=g("#fef08a",.9),e.beginPath(),e.moveTo(t-a*.35+r*.3,o),e.quadraticCurveTo(t-a*h+r*.5,o-s*.45,t+r*.7,i+s*.2),e.quadraticCurveTo(t+a*h+r*.5,o-s*.45,t+a*.35+r*.3,o),e.closePath(),e.fill();const c=e.createRadialGradient(t+r*.5,o-s*.2,0,t+r*.5,o-s*.2,a*.4);c.addColorStop(0,g("#ffffff",.6*n)),c.addColorStop(1,g("#fef9c3",0)),e.fillStyle=c,e.beginPath(),e.arc(t+r*.5,o-s*.2,a*.4,0,Math.PI*2),e.fill(),e.restore()},Xa=(e,t)=>{for(const o of t)e.beginPath(),e.arc(o.x,o.y,o.size,0,Math.PI*2),e.fillStyle=g("#9ca3af",o.alpha),e.fill()},Ka=(e,t)=>{for(const o of t)e.save(),e.translate(o.x,o.y),e.rotate(o.rotation),e.fillStyle=g(o.color,o.alpha),e.fillRect(-o.width/2,-o.height/2,o.width,o.height),e.restore()},Za=(e,t,o)=>{if(t<=0)return;const n=t===1?"1 fois":`${t} fois`;e.save(),e.font="600 1rem system-ui, sans-serif",e.textAlign="center";const l=e.measureText(n).width,s=12,a=o/2-l/2-s,i=50;e.fillStyle=g("#1e1b4b",.6),e.beginPath(),e.roundRect(a,i,l+s*2,32,8),e.fill(),e.fillStyle=g("#fcd34d",.85),e.fillText(n,o/2,i+22),e.restore()},Ja=(e,t,o,n,l)=>{if(l)return;const s=.3+Math.sin(n*.04)*.1;e.save(),e.fillStyle=g("#fef9c3",s),e.font="1.1rem system-ui, sans-serif",e.textAlign="center",e.fillText("Souffle pour éteindre les bougies !",t/2,o*.15),e.restore()},Qa=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:Fn})},za=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:"#fcd34d",cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:g("#1e1b4b",.7),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},xa=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:g("#fef9c3",.6),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},es=()=>{let e=null,t=null,o=0,n=0,l=null,s=null,a=[],i=new Map,r=[],d=0,f=0,h=!1,c=0,u=!1,b=0;const v=()=>n*.7,R=()=>Fe(o/(Nt*2.5),16,36),I=()=>Fe(n*.18,50,120),p=()=>{a=a.map(S=>({...S,flameScale:1,extinguished:!1,blowAccumulator:0})),i=new Map,h=!1,u=!1,c=0},w=()=>{u=!0,h=!0,c=0,d+=1,r=Ga(o,n)},M=()=>{if(!t)return;f+=1,le(t,o,n);const S=v(),E=R(),O=I(),_=S-O-8;ja(t,o,n),Va(t,o,n,S);for(const[F,k]of i.entries()){const D=k.map(Na).filter(Ha);D.length===0?i.delete(F):i.set(F,D)}for(let F=0;F<a.length;F++){const k=a[F];if(k.extinguished&&Math.random()<Ia){const D=i.get(F)??[];D.length<ka&&i.set(F,[...D,Wa(k.x,_)])}}for(let F=0;F<a.length;F++){const k=a[F];if(Ya(t,k.x,S,E,O,k.bodyColor),!k.extinguished){const U=Math.sin(f*Ht+F*1.7),L=Math.sin(f*Ht*1.6+F*2.3)*.5,W=(U+L)*Fa;qa(t,k.x,_,k.flameScale,W)}const D=i.get(F);D&&Xa(t,D)}a=a.map((F,k)=>{if(F.extinguished)return F;if(Da(a)===k&&b>wa){const H=F.blowAccumulator+1,$=Fe(1-H*Ma,0,1);return $<=0?{...F,flameScale:0,extinguished:!0,blowAccumulator:0}:{...F,flameScale:$,blowAccumulator:H}}const W=Fe(F.flameScale+Ta,0,1),G=Math.max(0,F.blowAccumulator-.5);return{...F,flameScale:W,blowAccumulator:G}}),!h&&a.every(F=>F.extinguished)&&w(),u&&(r=r.map($a).filter(Ua),Ka(t,r),c+=1,c>=Pa&&p()),Ja(t,o,n,f,h),Za(t,d,o),l=requestAnimationFrame(M)},P=()=>{if(!e||!t)return;const S=Q(e,t);o=S.width,n=S.height,a=Ut(a,o)};return{id:"candles",name:"Bougies",description:"Souffle pour éteindre les bougies",mount:S=>{const E=A("div",{});Qa(E);const O=A("button",{},"← Accueil");za(O),O.addEventListener("click",()=>{window.location.hash="#menu"});const _=A("p",{},"Bougies");xa(_),E.appendChild(O),E.appendChild(_),S.appendChild(E);const F=ee(E);e=F.canvas,t=F.ctx,o=F.width,n=F.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),a=Ut(La(Nt),o),i=new Map,r=[],d=0,f=0,h=!1,c=0,u=!1,b=0,s=P,window.addEventListener("resize",s),M()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),s&&(window.removeEventListener("resize",s),s=null),e=null,t=null,a=[],i=new Map,r=[],d=0,f=0,h=!1,c=0,u=!1,b=0,o=0,n=0},update:S=>{b=S.volume}}},On=80,ts=600,ns=ts-On,os=1.5,jt=4,ls=30,as=1.5,ss=.35,$e=["#ef4444","#f97316","#eab308","#22c55e","#06b6d4","#3b82f6","#8b5cf6"],_n=e=>Math.max(0,Math.min(1,(e-On)/ns)),is=(e,t)=>{const n=t-80,l=_n(e);return 40+n*(1-l)},rs=e=>{const t=_n(e),o=Math.min($e.length-1,Math.floor(t*$e.length));return $e[o]},cs=e=>jt+e*(ls-jt),ds=(e,t,o,n,l)=>{const s=e.createRadialGradient(t,o,0,t,o,n);s.addColorStop(0,g(l,.85)),s.addColorStop(.5,g(l,.5)),s.addColorStop(1,g(l,0)),e.beginPath(),e.arc(t,o,n,0,Math.PI*2),e.fillStyle=s,e.fill()},fs=(e,t,o)=>{e.beginPath(),e.moveTo(t,0),e.lineTo(t,o),e.strokeStyle=g(C.text,ss),e.lineWidth=as,e.stroke()},hs=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:C.bg})},us=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:C.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:g(C.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},ps=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:g(C.primary,.5),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},gs=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1rem",fontWeight:"600",color:C.secondary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:g(C.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},ms=()=>{let e=null,t=null,o=0,n=0,l=null,s=null,a=null,i=null,r=0,d=!0;const f=()=>{if(!e||(a||(a=document.createElement("canvas"),i=a.getContext("2d")),!a||!i))return;const p=window.devicePixelRatio||1;if(a.width!==e.width||a.height!==e.height){const w=document.createElement("canvas");w.width=a.width,w.height=a.height;const M=w.getContext("2d");M&&a.width>0&&a.height>0&&M.drawImage(a,0,0),a.width=e.width,a.height=e.height,i.setTransform(p,0,0,p,0,0),w.width>0&&w.height>0&&(i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(w,0,0,a.width,a.height),i.setTransform(p,0,0,p,0,0),i.restore())}},h=()=>{if(!i||!a)return;i.save(),i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,a.width,a.height),i.restore();const p=window.devicePixelRatio||1;i.setTransform(p,0,0,p,0,0),r=0,d=!0},c=()=>{if(!t||!a)return;t.fillStyle=C.bg,t.fillRect(0,0,o,n),t.save(),t.setTransform(1,0,0,1,0,0),t.drawImage(a,0,0),t.restore();const p=window.devicePixelRatio||1;t.setTransform(p,0,0,p,0,0),fs(t,r,n)},u=()=>{t&&(d&&(c(),d=!1),l=requestAnimationFrame(u))},b=()=>{if(!e||!t)return;const p=Q(e,t);o=p.width,n=p.height,f(),d=!0};return{id:"piano",name:"Piano Visuel",description:"Peins avec ta voix",mount:p=>{const w=A("div",{});hs(w);const M=A("button",{},"← Accueil");us(M),M.addEventListener("click",()=>{window.location.hash="#menu"});const P=A("p",{},"Piano Visuel");ps(P);const m=A("button",{},"Effacer");gs(m),m.addEventListener("click",h),w.appendChild(M),w.appendChild(P),w.appendChild(m),p.appendChild(w);const y=ee(w);e=y.canvas,t=y.ctx,o=y.width,n=y.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),f(),r=0,d=!0,s=b,window.addEventListener("resize",s),u()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),s&&(window.removeEventListener("resize",s),s=null),e=null,t=null,a=null,i=null,r=0,d=!1,o=0,n=0},update:p=>{if(i){if(r+=os,r>o&&(r=0),p.isVoicing&&p.pitch!==null){const w=is(p.pitch,n),M=cs(p.volume),P=rs(p.pitch);ds(i,r,w,M,P)}d=!0}}}},bs=1.3,ys=.06,Ss=.03,ws=.6,Vt=6,Yt=2.5,vs=.015,Ms=10,Bn=50,Ts=4,z=(e,t,o,n,l,s,a,i)=>{e.beginPath(),e.moveTo(t,o),e.lineTo(n,l),e.lineTo(s,a),e.closePath(),e.fillStyle=i,e.fill()},Le=(e,t,o,n,l,s)=>{e.beginPath(),e.ellipse(t,o,n,l,0,0,Math.PI*2),e.fillStyle=s,e.fill()},N=(e,t,o,n,l)=>{e.beginPath(),e.arc(t,o,n,0,Math.PI*2),e.fillStyle=l,e.fill()},Ps=(e,t,o,n,l)=>{N(e,t,o,n,l),z(e,t-n*.7,o-n*.4,t-n*.35,o-n*1.15,t-n*.05,o-n*.55,l),z(e,t+n*.05,o-n*.55,t+n*.35,o-n*1.15,t+n*.7,o-n*.4,l);const s=g("#fca5a5",.8);z(e,t-n*.58,o-n*.48,t-n*.38,o-n*.95,t-n*.15,o-n*.58,s),z(e,t+n*.15,o-n*.58,t+n*.38,o-n*.95,t+n*.58,o-n*.48,s),N(e,t-n*.3,o-n*.15,n*.13,"#2d3748"),N(e,t+n*.3,o-n*.15,n*.13,"#2d3748"),N(e,t-n*.26,o-n*.2,n*.045,"#ffffff"),N(e,t+n*.34,o-n*.2,n*.045,"#ffffff"),z(e,t,o+n*.05,t-n*.08,o+n*.15,t+n*.08,o+n*.15,"#f472b6"),e.beginPath(),e.moveTo(t,o+n*.15),e.lineTo(t-n*.12,o+n*.3),e.moveTo(t,o+n*.15),e.lineTo(t+n*.12,o+n*.3),e.strokeStyle="#2d3748",e.lineWidth=1.5,e.stroke(),e.beginPath(),e.moveTo(t-n*.3,o+n*.1),e.lineTo(t-n*.85,o+n*0),e.moveTo(t-n*.3,o+n*.2),e.lineTo(t-n*.85,o+n*.25),e.moveTo(t+n*.3,o+n*.1),e.lineTo(t+n*.85,o+n*0),e.moveTo(t+n*.3,o+n*.2),e.lineTo(t+n*.85,o+n*.25),e.strokeStyle="#94a3b8",e.lineWidth=1.2,e.stroke()},Cs=(e,t,o,n,l)=>{N(e,t,o,n,l),N(e,t,o+n*.2,n*.6,g("#fef3c7",.9));const s=n*.3;N(e,t-n*.32,o-n*.15,s,"#ffffff"),N(e,t+n*.32,o-n*.15,s,"#ffffff"),N(e,t-n*.32,o-n*.15,s*.55,"#2d3748"),N(e,t+n*.32,o-n*.15,s*.55,"#2d3748"),N(e,t-n*.26,o-n*.22,s*.2,"#ffffff"),N(e,t+n*.38,o-n*.22,s*.2,"#ffffff"),e.beginPath(),e.arc(t-n*.32,o-n*.15,s,0,Math.PI*2),e.strokeStyle=g("#2d3748",.3),e.lineWidth=1.5,e.stroke(),e.beginPath(),e.arc(t+n*.32,o-n*.15,s,0,Math.PI*2),e.stroke(),z(e,t,o+n*.05,t-n*.1,o+n*.2,t+n*.1,o+n*.2,"#f59e0b"),z(e,t-n*.55,o-n*.65,t-n*.35,o-n*1.1,t-n*.15,o-n*.65,l),z(e,t+n*.15,o-n*.65,t+n*.35,o-n*1.1,t+n*.55,o-n*.65,l)},As=(e,t,o,n,l)=>{N(e,t,o,n*.85,l),N(e,t-n*.6,o-n*.7,n*.5,l),N(e,t+n*.6,o-n*.7,n*.5,l),N(e,t-n*.6,o-n*.7,n*.32,g("#fca5a5",.7)),N(e,t+n*.6,o-n*.7,n*.32,g("#fca5a5",.7)),N(e,t-n*.25,o-n*.15,n*.12,"#2d3748"),N(e,t+n*.25,o-n*.15,n*.12,"#2d3748"),N(e,t-n*.21,o-n*.2,n*.04,"#ffffff"),N(e,t+n*.29,o-n*.2,n*.04,"#ffffff"),N(e,t,o+n*.15,n*.1,"#f472b6"),e.beginPath(),e.moveTo(t-n*.2,o+n*.15),e.lineTo(t-n*.75,o+n*.05),e.moveTo(t-n*.2,o+n*.22),e.lineTo(t-n*.75,o+n*.28),e.moveTo(t+n*.2,o+n*.15),e.lineTo(t+n*.75,o+n*.05),e.moveTo(t+n*.2,o+n*.22),e.lineTo(t+n*.75,o+n*.28),e.strokeStyle="#94a3b8",e.lineWidth=1,e.stroke(),e.beginPath(),e.moveTo(t+n*.5,o+n*.6),e.quadraticCurveTo(t+n*1.5,o+n*.2,t+n*1.3,o-n*.3),e.strokeStyle=l,e.lineWidth=2.5,e.lineCap="round",e.stroke()},Es=(e,t,o,n,l)=>{N(e,t-n*.65,o-n*.65,n*.32,l),N(e,t+n*.65,o-n*.65,n*.32,l),N(e,t-n*.65,o-n*.65,n*.18,g("#d4a574",.8)),N(e,t+n*.65,o-n*.65,n*.18,g("#d4a574",.8)),N(e,t,o,n,l),Le(e,t,o+n*.15,n*.4,n*.3,g("#d4a574",.7)),N(e,t-n*.3,o-n*.15,n*.11,"#2d3748"),N(e,t+n*.3,o-n*.15,n*.11,"#2d3748"),N(e,t-n*.27,o-n*.2,n*.04,"#ffffff"),N(e,t+n*.33,o-n*.2,n*.04,"#ffffff"),Le(e,t,o+n*.05,n*.11,n*.08,"#2d3748"),e.beginPath(),e.moveTo(t,o+n*.13),e.lineTo(t-n*.08,o+n*.25),e.moveTo(t,o+n*.13),e.lineTo(t+n*.08,o+n*.25),e.strokeStyle="#2d3748",e.lineWidth=1.2,e.stroke()},Is=(e,t,o,n,l)=>{Le(e,t,o,n*.9,n,l),Le(e,t,o+n*.2,n*.55,n*.55,g("#fef3c7",.8)),e.beginPath(),e.ellipse(t-n*.55,o-n*.05,n*.5,n*.28,-.3,0,Math.PI*2),e.fillStyle=g(l,.7),e.fill(),N(e,t+n*.15,o-n*.25,n*.12,"#2d3748"),N(e,t+n*.19,o-n*.3,n*.04,"#ffffff"),z(e,t+n*.55,o-n*.15,t+n*.55,o+n*.05,t+n*.95,o-n*.05,"#f59e0b"),z(e,t-n*.7,o-n*.3,t-n*1.15,o-n*.65,t-n*.5,o-n*.6,l),z(e,t-n*.75,o-n*.15,t-n*1.25,o-n*.35,t-n*.6,o-n*.45,g(l,.8))},ae=[{name:"Chat",vowel:"a",label:"AAA",draw:Ps},{name:"Hibou",vowel:"o",label:"OOO",draw:Cs},{name:"Souris",vowel:"i",label:"III",draw:As},{name:"Ours",vowel:"u",label:"UUU",draw:Es},{name:"Oiseau",vowel:"e",label:"EEE",draw:Is}],Rs=(e,t,o)=>{const n=[];for(let l=0;l<Vt;l++){const s=Math.PI*2*l/Vt+(Math.random()-.5)*.5;n.push({x:e,y:t-Bn,vx:Math.cos(s)*Yt*(.7+Math.random()*.6),vy:Math.sin(s)*Yt*(.7+Math.random()*.6)-1.5,alpha:1,size:Ms*(.7+Math.random()*.6),kind:Math.random()>.5?"heart":"star",color:o})}return n},ks=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,vy:e.vy+.04,alpha:e.alpha-vs}),Fs=e=>e.alpha>0,Os=(e,t,o,n,l,s)=>{e.save(),e.globalAlpha=s,e.fillStyle=l,e.beginPath();const a=n*.5;e.moveTo(t,o+a*.3),e.bezierCurveTo(t,o-a*.2,t-a,o-a*.5,t-a,o+a*.1),e.bezierCurveTo(t-a,o+a*.6,t,o+a*.9,t,o+a*1.1),e.bezierCurveTo(t,o+a*.9,t+a,o+a*.6,t+a,o+a*.1),e.bezierCurveTo(t+a,o-a*.5,t,o-a*.2,t,o+a*.3),e.fill(),e.restore()},_s=(e,t,o,n,l,s)=>{e.save(),e.globalAlpha=s,e.fillStyle=l,e.beginPath();const a=5,i=n*.5,r=i*.4;for(let d=0;d<a*2;d++){const f=d%2===0?i:r,h=Math.PI*d/a-Math.PI/2,c=t+Math.cos(h)*f,u=o+Math.sin(h)*f;d===0?e.moveTo(c,u):e.lineTo(c,u)}e.closePath(),e.fill(),e.restore()},Bs=(e,t)=>{t.kind==="heart"?Os(e,t.x,t.y,t.size,t.color,t.alpha):_s(e,t.x,t.y,t.size,t.color,t.alpha)},Ls=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:C.bg})},Ds=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:C.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:g(C.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Ws=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:C.text,margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},qt=(e,t,o)=>{const n=e/(o+1),l=t*.42,s=[];for(let a=0;a<o;a++)s.push({x:n*(a+1),y:l});return s},Ns=()=>{let e=null,t=null,o=0,n=0,l=null,s=null,a=ae.map(()=>({scale:1,targetScale:1,glowAlpha:0,feedCount:0,particles:[]})),i=0,r=null;const d=()=>{a=ae.map(()=>({scale:1,targetScale:1,glowAlpha:0,feedCount:0,particles:[]})),i=0,r=null},f=()=>{const p=o/(ae.length*2.5),w=n*.15;return Math.max(25,Math.min(Bn,p,w))},h=()=>{if(!t)return;le(t,o,n),t.fillStyle=C.bg,t.fillRect(0,0,o,n);const p=qt(o,n,ae.length),w=f();for(let M=0;M<ae.length;M++){const P=ae[M],m=a[M],y=p[M],T=Z[P.vowel]??C.primary;if(t.save(),m.glowAlpha>0){const _=w*1.6*m.scale,F=t.createRadialGradient(y.x,y.y,w*.3,y.x,y.y,_);F.addColorStop(0,g(T,m.glowAlpha*.5)),F.addColorStop(1,g(T,0)),t.fillStyle=F,t.fillRect(y.x-_,y.y-_,_*2,_*2)}t.translate(y.x,y.y),t.scale(m.scale,m.scale),t.translate(-y.x,-y.y),P.draw(t,y.x,y.y,w,T),t.restore();for(const _ of m.particles)Bs(t,_);const S=y.y+w*1.6;t.font=`bold ${Math.round(w*.55)}px system-ui, -apple-system, sans-serif`,t.textAlign="center",t.textBaseline="top",t.fillStyle=T,t.fillText(P.label,y.x,S);const E=y.y-w*1.5;t.font=`600 ${Math.round(w*.38)}px system-ui, -apple-system, sans-serif`,t.fillStyle=C.text,t.fillText(P.name,y.x,E);const O=y.y+w*1.6+w*.65;t.font=`600 ${Math.round(w*.32)}px system-ui, -apple-system, sans-serif`,t.fillStyle=C.muted,t.fillText(`${m.feedCount}`,y.x,O)}},c=()=>{a=a.map(p=>{const w=p.scale+(p.targetScale-p.scale)*ys*3,M=Math.max(0,p.glowAlpha-Ss),P=p.particles.map(ks).filter(Fs),m=Math.abs(p.scale-1)<.01&&p.targetScale>1||p.targetScale>1&&w>p.targetScale*.95?1:p.targetScale;return{...p,scale:w,targetScale:m,glowAlpha:M,particles:P}}),h(),l=requestAnimationFrame(c)},u=()=>{if(!e||!t)return;const p=Q(e,t);o=p.width,n=p.height},b=p=>{const w=ae[p],M=qt(o,n,ae.length)[p],P=Z[w.vowel]??C.primary;a=a.map((m,y)=>y!==p?m:{...m,targetScale:bs,glowAlpha:ws,feedCount:m.feedCount+1,particles:[...m.particles,...Rs(M.x,M.y,P)]})};return{id:"animals",name:"Nourrir les Animaux",description:"Nourris les animaux en prononçant la bonne voyelle !",mount:p=>{const w=A("div",{});Ls(w);const M=A("button",{},"← Accueil");Ds(M),M.addEventListener("click",()=>{window.location.hash="#menu"});const P=A("p",{},"Nourrir les Animaux");Ws(P),w.appendChild(M),w.appendChild(P),p.appendChild(w);const m=ee(w);e=m.canvas,t=m.ctx,o=m.width,n=m.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),s=u,window.addEventListener("resize",s),d(),c()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),s&&(window.removeEventListener("resize",s),s=null),e=null,t=null,o=0,n=0,d()},update:p=>{if(!p.isVoicing||p.vowel===null){i=0,r=null;return}if(i+=1,i>=Ts&&p.vowel!==r){const w=ae.findIndex(M=>M.vowel===p.vowel);w!==-1&&(b(w),r=p.vowel)}}}},re=["a","e","i","o","u"],De=5,Hs=.04,Xt=.18,Ln=.88,lt=.15,Dn=.04,Gs=.06,$s=.03,Us=2,js=Math.round(Us*60),Wn=.35,Nn=3,Kt=["#ef4444","#f59e0b","#22c55e","#3b82f6","#ec4899","#f97316"],Zt=["#f472b6","#c084fc","#67e8f9","#fbbf24","#a78bfa"],Jt=["#fbbf24","#fde047","#f59e0b","#fcd34d","#facc15"],Qt=["#93c5fd","#a5b4fc","#c4b5fd","#67e8f9","#7dd3fc"],Y=(e,t)=>e+Math.random()*(t-e),Ue=()=>re.map(e=>({vowel:e,color:Z[e]??C.primary,openAmount:0,isOpening:!1,surpriseTime:0,surpriseFrame:0})),We=(e,t,o)=>{const n=t*Hs,l=n*(De+1),s=(t-l)/De,a=n+e*(s+n),i=o*Xt,r=o*(Ln-Xt);return{x:a,y:i,w:s,h:r}},Vs=(e,t)=>{const o=[];for(let l=0;l<18;l++){const s=Math.PI*2*l/18+Y(-.2,.2),a=Y(1.5,4);o.push({x:e,y:t,vx:Math.cos(s)*a,vy:Math.sin(s)*a,color:Kt[Math.floor(Math.random()*Kt.length)],alpha:1,size:Y(3,7),life:1})}return o},Ys=(e,t,o)=>{const n=[];for(let s=0;s<8;s++)n.push({x:e+Y(-20,20),y:t+Y(0,o*.5),vx:Y(-.8,.8),vy:Y(-2,-.8),color:Zt[Math.floor(Math.random()*Zt.length)],alpha:1,size:Y(6,12),life:1});return n},qs=(e,t,o)=>{const n=[];for(let s=0;s<15;s++)n.push({x:e+Y(-o*.4,o*.4),y:t-Y(10,40),vx:Y(-.5,.5),vy:Y(1,3),color:Jt[Math.floor(Math.random()*Jt.length)],alpha:1,size:Y(4,8),life:1});return n},Xs=(e,t,o)=>{const n=[];for(let s=0;s<10;s++)n.push({x:e+Y(-15,15),y:t+Y(0,o*.5),vx:Y(-.3,.3),vy:Y(-2.5,-1),color:Qt[Math.floor(Math.random()*Qt.length)],alpha:.85,size:Y(5,14),life:1});return n},Ks=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,alpha:Math.max(0,e.alpha-.008),life:Math.max(0,e.life-.008)}),Zs=e=>e.life>0&&e.alpha>0,Hn=(e,t,o,n,l,s,a,i)=>{e.beginPath(),e.moveTo(t,o+l),e.lineTo(t,o+s),e.arcTo(t,o,t+n/2,o,s),e.arcTo(t+n,o,t+n,o+s,s),e.lineTo(t+n,o+l),e.closePath(),e.fillStyle=a,e.fill(),e.strokeStyle=i,e.lineWidth=Nn,e.stroke()},Gn=(e,t,o,n,l,s)=>{const a=t+n*.75,i=o+l*.52;e.beginPath(),e.arc(a,i,s,0,Math.PI*2),e.fillStyle="#d4af37",e.fill(),e.strokeStyle="#b8960c",e.lineWidth=1.5,e.stroke(),e.beginPath(),e.arc(a-s*.25,i-s*.25,s*.35,0,Math.PI*2),e.fillStyle=g("#ffffff",.5),e.fill()},$n=(e,t,o,n,l,s,a)=>{e.font=`bold ${a}px sans-serif`,e.textAlign="center",e.textBaseline="middle",e.fillStyle=g("#ffffff",.9),e.fillText(t.toUpperCase(),o+l/2,n+s*.45)},Js=(e,t,o,n,l)=>{const{x:s,y:a,w:i,h:r}=We(o,n,l),d=r*lt,f=i*Dn;Hn(e,s,a,i,r,d,t.color,g(t.color,.7)),Gn(e,s,a,i,r,f),$n(e,t.vowel,s,a,i,r,i*Wn)},Qs=(e,t,o,n,l,s,a)=>{e.beginPath(),e.moveTo(t,o+l),e.lineTo(t,o+s),e.arcTo(t,o,t+n/2,o,s),e.arcTo(t+n,o,t+n,o+s,s),e.lineTo(t+n,o+l),e.closePath(),e.fillStyle=g(a,.12),e.fill(),e.strokeStyle=g(a,.4),e.lineWidth=Nn,e.stroke()},zs=(e,t,o,n,l)=>{const{x:s,y:a,w:i,h:r}=We(o,n,l),d=r*lt,f=t.openAmount;Qs(e,s,a,i,r,d,t.color);const h=i*(1-f*.8),c=s+(i-h),u=h*Dn,b=g("#000000",f*.15);e.save(),Hn(e,c,a,h,r,d*(1-f*.3),t.color,g(t.color,.7)),e.beginPath(),e.moveTo(c,a+r),e.lineTo(c,a+d),e.arcTo(c,a,c+h/2,a,d*(1-f*.3)),e.arcTo(c+h,a,c+h,a+d,d*(1-f*.3)),e.lineTo(c+h,a+r),e.closePath(),e.fillStyle=b,e.fill(),f<.6&&(Gn(e,c,a,h,r,u),$n(e,t.vowel,c,a,h,r,h*Wn)),e.restore()},xs=(e,t)=>{e.beginPath(),e.arc(t.x,t.y,t.size,0,Math.PI*2),e.fillStyle=g(t.color,t.alpha),e.fill()},ei=(e,t,o)=>{const n=Math.sin(o*.15+t.x)*4;e.save(),e.translate(t.x,t.y),e.fillStyle=g(t.color,t.alpha),e.beginPath(),e.ellipse(-t.size*.4,0,t.size*.5,t.size*.3+n*.3,-.3,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(t.size*.4,0,t.size*.5,t.size*.3+n*.3,.3,0,Math.PI*2),e.fill(),e.beginPath(),e.ellipse(0,0,t.size*.12,t.size*.4,0,0,Math.PI*2),e.fillStyle=g("#4a3728",t.alpha),e.fill(),e.restore()},ti=(e,t,o)=>{const n=o*.03+t.x*.01,l=5,s=t.size,a=t.size*.45;e.save(),e.translate(t.x,t.y),e.rotate(n),e.beginPath();for(let i=0;i<l*2;i++){const r=Math.PI*i/l-Math.PI/2,d=i%2===0?s:a;i===0?e.moveTo(Math.cos(r)*d,Math.sin(r)*d):e.lineTo(Math.cos(r)*d,Math.sin(r)*d)}e.closePath(),e.fillStyle=g(t.color,t.alpha),e.fill(),e.restore()},ni=(e,t,o,n,l,s)=>{const a=["#ef4444","#f97316","#fbbf24","#22c55e","#3b82f6","#8b5cf6","#a855f7"],i=t+n/2,r=o+l*.8,d=n*.45,f=d/(a.length+2),h=Math.PI*Math.min(s,1);e.save(),e.beginPath(),e.rect(t,o,n,l),e.clip();for(let c=0;c<a.length;c++){const u=d-c*f;e.beginPath(),e.arc(i,r,u,Math.PI,Math.PI+h,!1),e.strokeStyle=g(a[c],.8),e.lineWidth=f*.9,e.lineCap="round",e.stroke()}e.restore()},oi=(e,t)=>{e.beginPath(),e.arc(t.x,t.y,t.size,0,Math.PI*2),e.fillStyle=g(t.color,t.alpha*.4),e.fill(),e.strokeStyle=g(t.color,t.alpha*.7),e.lineWidth=1.5,e.stroke(),e.beginPath(),e.arc(t.x-t.size*.25,t.y-t.size*.25,t.size*.25,0,Math.PI*2),e.fillStyle=g("#ffffff",t.alpha*.6),e.fill()},li=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:C.bg})},ai=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:C.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:g(C.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},si=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:g(C.primary,.5),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},ii=()=>{let e=null,t=null,o=0,n=0,l=null,s=null,a=[...Ue()],i=re.map(()=>[]),r=re.map(()=>!1);const d=p=>{const w=a[p];w.isOpening||(a[p]={...w,isOpening:!0,surpriseTime:js,surpriseFrame:0},r[p]=!1)},f=()=>{a=a.map((p,w)=>{if(p.isOpening){const M=Math.min(1,p.openAmount+Gs),P=p.surpriseTime-1,m=p.surpriseFrame+1;if(M>.4&&!r[w]){const y=We(w,o,n),T=y.x+y.w/2,S=y.y+y.h/2;switch(p.vowel){case"a":i[w]=Vs(T,S);break;case"e":i[w]=Ys(T,S,y.h);break;case"i":i[w]=qs(T,y.y,y.w);break;case"o":i[w]=[];break;case"u":i[w]=Xs(T,S,y.h);break}r[w]=!0}return P<=0?{...p,openAmount:M,isOpening:!1,surpriseTime:0,surpriseFrame:m}:{...p,openAmount:M,surpriseTime:P,surpriseFrame:m}}if(p.openAmount>0){const M=Math.max(0,p.openAmount-$s);return M===0&&(i[w]=[],r[w]=!1),{...p,openAmount:M,surpriseFrame:p.surpriseFrame+1}}return p}),i=i.map(p=>p.map(Ks).filter(Zs))},h=()=>{if(t)for(let p=0;p<De;p++){const w=a[p];if(w.openAmount<.3)continue;const M=We(p,o,n);t.save();const P=M.h*lt;switch(t.beginPath(),t.moveTo(M.x,M.y+M.h),t.lineTo(M.x,M.y+P),t.arcTo(M.x,M.y,M.x+M.w/2,M.y,P),t.arcTo(M.x+M.w,M.y,M.x+M.w,M.y+P,P),t.lineTo(M.x+M.w,M.y+M.h),t.closePath(),t.clip(),w.vowel){case"a":for(const m of i[p])xs(t,m);break;case"e":for(const m of i[p])ei(t,m,w.surpriseFrame);break;case"i":for(const m of i[p])ti(t,m,w.surpriseFrame);break;case"o":{const m=Math.min(1,w.surpriseFrame/40);ni(t,M.x,M.y,M.w,M.h,m);break}case"u":for(const m of i[p])oi(t,m);break}t.restore()}},c=()=>{if(!t)return;const p=n*Ln;t.fillStyle=g(C.muted,.15),t.fillRect(0,p,o,n-p),t.strokeStyle=g(C.muted,.25),t.lineWidth=1,t.beginPath(),t.moveTo(0,p),t.lineTo(o,p),t.stroke()},u=()=>{if(t){le(t,o,n),c(),f(),h();for(let p=0;p<De;p++){const w=a[p];w.openAmount>0?zs(t,w,p,o,n):Js(t,w,p,o,n)}l=requestAnimationFrame(u)}},b=()=>{if(!e||!t)return;const p=Q(e,t);o=p.width,n=p.height};return{id:"doors",name:"Portes Magiques",description:"Ouvre les portes magiques avec ta voix !",mount:p=>{const w=A("div",{});li(w);const M=A("button",{},"← Accueil");ai(M),M.addEventListener("click",()=>{window.location.hash="#menu"});const P=A("p",{},"Portes Magiques");si(P),w.appendChild(M),w.appendChild(P),p.appendChild(w);const m=ee(w);e=m.canvas,t=m.ctx,o=m.width,n=m.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),s=b,window.addEventListener("resize",s),a=[...Ue()],i=re.map(()=>[]),r=re.map(()=>!1),u()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),s&&(window.removeEventListener("resize",s),s=null),e=null,t=null,o=0,n=0,a=[...Ue()],i=re.map(()=>[]),r=re.map(()=>!1)},update:p=>{if(!p.isVoicing||p.vowel===null)return;const w=p.vowel,M=re.indexOf(w);M!==-1&&(p.volume<.05||d(M))}}},Me=.15,ri=4,Qe=.55,zt=18,xt=10,Se=8,ci=14,di=20,fi=.5,en=8,hi=60,te=40,tn=12,nn=20,at=3,st=.002,on=.3,Un=60,ln=8,je="#f472b6",we=(e,t)=>e+Math.random()*(t-e),ze=(e,t)=>Math.min(e/2,1)*t,an=(e,t,o)=>({x:e,stemHeight:0,maxDuration:t,color:o,petalCount:t>=4?8:5,hasLeaves:t>=1,hasBud:t>=2,isOpen:t>=3,isFullBloom:t>=4,hasSparkles:t>=5}),sn=(e,t)=>({x:e+we(-30,30),y:t+we(-30,10),size:we(2,5),alpha:1,vx:we(-.5,.5),vy:we(-1.5,-.3),life:Un}),rn=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,alpha:e.life/Un,life:e.life-1}),cn=e=>e.life>0,ui=(e,t,o)=>{const n=e.createLinearGradient(0,0,0,o);n.addColorStop(0,"#87CEEB"),n.addColorStop(.6,"#B0E0F0"),n.addColorStop(.85,"#d4f0d4"),e.fillStyle=n,e.fillRect(0,0,t,o)},pi=(e,t,o)=>{const n=o*(1-Me),l=e.createLinearGradient(0,n,0,o);l.addColorStop(0,"#5cb85c"),l.addColorStop(1,"#3a8a3a"),e.fillStyle=l,e.fillRect(0,n,t,o*Me),e.beginPath(),e.moveTo(0,n);for(let s=0;s<=t;s+=20){const a=n+Math.sin(s*.05)*4;e.lineTo(s,a)}e.lineTo(t,n+10),e.lineTo(0,n+10),e.closePath(),e.fillStyle="#5cb85c",e.fill()},gi=(e,t,o)=>{const n=t-70,l=70,s=1+Math.sin(o*.001)*.05,a=e.createRadialGradient(n,l,0,n,l,te*2);a.addColorStop(0,g("#FFD700",.3)),a.addColorStop(1,g("#FFD700",0)),e.fillStyle=a,e.fillRect(n-te*2,l-te*2,te*4,te*4),e.save(),e.translate(n,l),e.rotate(o*3e-4);for(let i=0;i<tn;i++){const r=i/tn*Math.PI*2;e.beginPath(),e.moveTo(Math.cos(r)*te*s,Math.sin(r)*te*s),e.lineTo(Math.cos(r)*(te+nn)*s,Math.sin(r)*(te+nn)*s),e.strokeStyle=g("#FFD700",.6),e.lineWidth=3,e.stroke()}e.restore(),e.beginPath(),e.arc(n,l,te*s,0,Math.PI*2),e.fillStyle="#FFD700",e.fill(),e.fillStyle="#E6A800",e.beginPath(),e.arc(n-12,l-8,4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(n+12,l-8,4,0,Math.PI*2),e.fill(),e.beginPath(),e.arc(n,l+2,14,.15*Math.PI,.85*Math.PI),e.strokeStyle="#E6A800",e.lineWidth=2.5,e.stroke()},mi=(e,t,o,n,l,s)=>{const a=o-n,i=Math.sin(l*st+s)*at,r=t+i,d=o-n*.5;e.beginPath(),e.moveTo(t,o),e.quadraticCurveTo(r,d,t+i,a),e.strokeStyle="#2d8a4e",e.lineWidth=ri,e.lineCap="round",e.stroke()},bi=(e,t,o,n,l,s)=>{const a=Math.sin(l*st+s)*at,i=o-n*.4,r=t+a*.4-2;e.save(),e.translate(r,i),e.rotate(-.6),e.beginPath(),e.ellipse(0,0,zt,xt,0,0,Math.PI*2),e.fillStyle="#34d399",e.fill(),e.restore();const d=o-n*.65,f=t+a*.65+2;e.save(),e.translate(f,d),e.rotate(.6),e.beginPath(),e.ellipse(0,0,zt,xt,0,0,Math.PI*2),e.fillStyle="#34d399",e.fill(),e.restore()},yi=(e,t,o,n)=>{e.save(),e.translate(t,o),e.beginPath(),e.ellipse(0,0,Se*.8,Se*1.2,0,0,Math.PI*2),e.fillStyle="#2d8a4e",e.fill(),e.beginPath(),e.ellipse(0,-Se*.3,Se*.5,Se*.5,0,0,Math.PI*2),e.fillStyle=g(n,.6),e.fill(),e.restore()},Si=(e,t,o,n,l,s,a)=>{const i=s?di:ci,r=i*fi,d=1+Math.sin(a*.003)*.03;e.save(),e.translate(t,o);for(let f=0;f<l;f++){const h=f/l*Math.PI*2;e.save(),e.rotate(h),e.beginPath(),e.ellipse(0,-i*.7*d,r*d,i*d,0,0,Math.PI*2),e.fillStyle=g(n,.85),e.fill(),e.beginPath(),e.ellipse(0,-i*.55*d,r*.5*d,i*.5*d,0,0,Math.PI*2),e.fillStyle=g("#ffffff",.25),e.fill(),e.restore()}e.beginPath(),e.arc(0,0,en*d,0,Math.PI*2),e.fillStyle="#FFD700",e.fill(),e.beginPath(),e.arc(-2,-2,en*.5*d,0,Math.PI*2),e.fillStyle=g("#ffffff",.4),e.fill(),e.restore()},wi=(e,t)=>{e.save(),e.globalAlpha=t.alpha;const o=t.size;e.fillStyle="#FFD700",e.beginPath(),e.moveTo(t.x,t.y-o),e.lineTo(t.x+o*.3,t.y-o*.3),e.lineTo(t.x+o,t.y),e.lineTo(t.x+o*.3,t.y+o*.3),e.lineTo(t.x,t.y+o),e.lineTo(t.x-o*.3,t.y+o*.3),e.lineTo(t.x-o,t.y),e.lineTo(t.x-o*.3,t.y-o*.3),e.closePath(),e.fill(),e.restore()},dn=(e,t,o,n,l)=>{const a=o*(1-Me)+5,i=o*Qe,r=ze(t.maxDuration,i),d=t.x*.1,f=Math.sin(n*st+d)*at,h=t.x+f,c=a-r;t.maxDuration>0&&mi(e,t.x,a,r,n,d),t.hasLeaves&&bi(e,t.x,a,r,n,d),t.hasBud&&!t.isOpen&&yi(e,h,c,t.color),t.isOpen&&Si(e,h,c,t.color,t.petalCount,t.isFullBloom,n);for(const u of l)wi(e,u)},vi=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden"})},Mi=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:C.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:g(C.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Ti=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:g(C.text,.7),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:g(C.surface,.6),borderRadius:"12px",backdropFilter:"blur(4px)"})},Pi=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",fontSize:"1.1rem",fontWeight:"600",color:C.text,margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:g(C.surface,.8),borderRadius:"12px",backdropFilter:"blur(4px)"})},Ci=(e,t)=>{if(e.length===0)return t/2;const o=t/2,n=e.length,l=n%2===0?1:-1,s=Math.ceil(n/2)*hi,a=o+l*s,i=40;return Math.max(i,Math.min(t-i,a))},Ai=()=>{let e=null,t=null,o=0,n=0,l=null,s=null,a=[],i=0,r=0,d=je,f=!1,h=!1,c=new Map,u=null,b=0;const v=()=>{if(!u)return;const P=a.length;u.textContent=P===0?"Jardin: 0 fleur":P===1?"Jardin: 1 fleur":`Jardin: ${P} fleurs`},R=()=>{if(!t)return;const P=performance.now()-b;le(t,o,n),ui(t,o,n),gi(t,o,P),pi(t,o,n);for(let m=0;m<a.length;m++){const y=a[m],T=c.get(m)??[];if(y.hasSparkles&&T.length<ln&&Math.random()<on){const E=n*(1-Me),O=n*Qe,_=ze(y.maxDuration,O),F=E+5-_;T.push(sn(y.x,F))}const S=T.map(rn).filter(cn);c.set(m,S),dn(t,y,n,P,S)}if(h&&r>0){const m=an(i,r,d),y=c.get(-1)??[];if(m.hasSparkles&&y.length<ln&&Math.random()<on){const S=n*(1-Me),E=n*Qe,O=ze(m.maxDuration,E),_=S+5-O;y.push(sn(i,_))}const T=y.map(rn).filter(cn);c.set(-1,T),dn(t,m,n,P,T)}l=requestAnimationFrame(R)},I=()=>{if(!e||!t)return;const P=Q(e,t);o=P.width,n=P.height};return{id:"flower",name:"Faire Pousser",description:"Fais pousser des fleurs avec ta voix !",mount:P=>{const m=A("div",{});vi(m);const y=A("button",{},"← Accueil");Mi(y),y.addEventListener("click",()=>{window.location.hash="#menu"});const T=A("p",{},"Faire Pousser");Ti(T),u=A("p",{},"Jardin: 0 fleur"),Pi(u),m.appendChild(y),m.appendChild(T),m.appendChild(u),P.appendChild(m);const S=ee(m);e=S.canvas,t=S.ctx,o=S.width,n=S.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),s=I,window.addEventListener("resize",s),a=[],c=new Map,r=0,d=je,f=!1,h=!1,i=o/2,b=performance.now(),v(),R()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),s&&(window.removeEventListener("resize",s),s=null),e=null,t=null,u=null,a=[],c=new Map,r=0,f=!1,h=!1,o=0,n=0},update:P=>{const m=P.isVoicing;if(m)f||(h=!0,i=Ci(a,o),r=0,d=je,c.delete(-1)),r=P.duration,P.vowel!==null&&Z[P.vowel]&&(d=Z[P.vowel]);else if(f&&h&&r>.1){const y=an(i,r,d);a.push(y);const T=c.get(-1)??[];c.set(a.length-1,T),c.delete(-1),h=!1,r=0,v()}else m||(h=!1,r=0,c.delete(-1));f=m}}},Ve=20,Ei=130,Ii=.72,Ri=100,ki=8,Fi=.003,fn=2,hn=3,se=3,ve=4,Oi=40,jn=80,_i=.12,un=["#ef4444","#f59e0b","#22c55e","#3b82f6","#8b5cf6","#ec4899","#f97316","#06b6d4","#FFD700","#ff6b6b"],Bi=5,Li=60,Di=2e3,Wi=-1.2,pn=.3,Ni="#87CEEB",Hi="#B0E0F0",Gi="#d4f0d4",$i="#ffffff",oe=(e,t)=>e+Math.random()*(t-e),ye=(e,t,o)=>Math.max(t,Math.min(o,e)),Ye=e=>{if(e<=0)return Ve;const t=ye(e/ve,0,1);return Ve+t*(Ei-Ve)},Ui=(e,t)=>{if(e<se)return t;const o=ye((e-se)/(ve-se),0,1),n=parseInt(t.slice(1,3),16),l=parseInt(t.slice(3,5),16),s=parseInt(t.slice(5,7),16),a=Math.round(n+(240-n)*o),i=Math.round(l+(80-l)*o),r=Math.round(s+(80-s)*o);return`rgb(${a}, ${i}, ${r})`},ji=(e,t)=>({x:e,y:t,vx:oe(-6,6),vy:oe(-10,-2),size:oe(4,10),color:un[Math.floor(Math.random()*un.length)],life:jn,gravity:_i,rotation:oe(0,Math.PI*2),rotationSpeed:oe(-.15,.15),shape:["circle","rect","star"][Math.floor(Math.random()*3)]}),Vi=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,vy:e.vy+e.gravity,vx:e.vx*.99,life:e.life-1,rotation:e.rotation+e.rotationSpeed}),Yi=e=>e.life>0,qi=(e,t,o)=>{const n=oe(0,Math.PI*2),l=oe(o*.6,o*1.2);return{x:e+Math.cos(n)*l,y:t+Math.sin(n)*l,size:oe(3,7),alpha:1,angle:n,speed:oe(.3,.8)}},Xi=e=>({...e,x:e.x+Math.cos(e.angle)*e.speed,y:e.y+Math.sin(e.angle)*e.speed,alpha:e.alpha-1/Li}),Ki=e=>e.alpha>0,Zi=e=>({...e,x:e.x+e.vx,y:e.y+e.vy,alpha:e.alpha-.004,stringAngle:e.stringAngle+.02}),Ji=e=>e.alpha>0&&e.y+e.radiusY>-50,Qi=(e,t,o)=>{const n=e.createLinearGradient(0,0,0,o);n.addColorStop(0,Ni),n.addColorStop(.6,Hi),n.addColorStop(1,Gi),e.fillStyle=n,e.fillRect(0,0,t,o)},qe=(e,t,o,n)=>{e.save(),e.translate(t,o),e.scale(n,n),e.fillStyle=g($i,.6);const l=[{cx:0,cy:0,r:25},{cx:-22,cy:5,r:20},{cx:22,cy:5,r:20},{cx:-10,cy:-12,r:18},{cx:12,cy:-10,r:16}];for(const s of l)e.beginPath(),e.arc(s.cx,s.cy,s.r,0,Math.PI*2),e.fill();e.restore()},zi=(e,t,o)=>{const n=o*.01;qe(e,(t*.15+n)%(t+100)-50,60,1),qe(e,(t*.55+n*.7)%(t+100)-50,90,.8),qe(e,(t*.85+n*.5)%(t+100)-50,45,1.2)},xi=(e,t,o)=>{const n=o*.88,l=e.createLinearGradient(0,n,0,o);l.addColorStop(0,"#5cb85c"),l.addColorStop(1,"#3a8a3a"),e.fillStyle=l,e.fillRect(0,n,t,o-n),e.beginPath(),e.moveTo(0,n);for(let s=0;s<=t;s+=20){const a=n+Math.sin(s*.05)*4;e.lineTo(s,a)}e.lineTo(t,n+10),e.lineTo(0,n+10),e.closePath(),e.fillStyle="#5cb85c",e.fill()},Vn=(e,t,o,n,l,s,a)=>{const i=(t+n)/2+Math.sin(s*Fi)*ki+a,r=(o+l)/2;e.beginPath(),e.moveTo(t,o),e.quadraticCurveTo(i,r,n,l),e.strokeStyle=g(C.text,.5),e.lineWidth=2,e.lineCap="round",e.stroke()},Yn=(e,t,o,n,l,s,a)=>{e.save(),e.translate(t,o),e.rotate(a*.05),e.beginPath(),e.ellipse(0,0,n,l,0,0,Math.PI*2);const i=e.createRadialGradient(-n*.3,-l*.3,n*.1,0,0,l);i.addColorStop(0,g("#ffffff",.6)),i.addColorStop(.3,s),i.addColorStop(1,g(s,.85)),e.fillStyle=i,e.fill(),e.beginPath(),e.ellipse(-n*.3,-l*.35,n*.2,l*.15,-.4,0,Math.PI*2),e.fillStyle=g("#ffffff",.4),e.fill(),e.beginPath(),e.moveTo(-4,l),e.lineTo(0,l+8),e.lineTo(4,l),e.closePath(),e.fillStyle=s,e.fill(),e.restore()},er=(e,t,o,n,l)=>{const s=1+Math.sin(l*.008)*.15,a=n*1.5*s,i=e.createRadialGradient(t,o,n*.8,t,o,a);i.addColorStop(0,g(C.green,.25)),i.addColorStop(1,g(C.green,0)),e.fillStyle=i,e.beginPath(),e.arc(t,o,a,0,Math.PI*2),e.fill()},tr=(e,t,o,n,l)=>{e.save(),e.globalAlpha=l,e.fillStyle="#FFD700",e.beginPath(),e.moveTo(t,o-n),e.lineTo(t+n*.3,o-n*.3),e.lineTo(t+n,o),e.lineTo(t+n*.3,o+n*.3),e.lineTo(t,o+n),e.lineTo(t-n*.3,o+n*.3),e.lineTo(t-n,o),e.lineTo(t-n*.3,o-n*.3),e.closePath(),e.fill(),e.restore()},nr=(e,t)=>{const o=ye(t.life/jn,0,1);if(e.save(),e.translate(t.x,t.y),e.rotate(t.rotation),e.globalAlpha=o,t.shape==="circle")e.beginPath(),e.arc(0,0,t.size/2,0,Math.PI*2),e.fillStyle=t.color,e.fill();else if(t.shape==="rect")e.fillStyle=t.color,e.fillRect(-t.size/2,-t.size/4,t.size,t.size/2);else{e.fillStyle=t.color,e.beginPath();for(let n=0;n<5;n++){const l=n*2*Math.PI/5-Math.PI/2,s=l+Math.PI/5,a=t.size/2,i=t.size/4;n===0?e.moveTo(Math.cos(l)*a,Math.sin(l)*a):e.lineTo(Math.cos(l)*a,Math.sin(l)*a),e.lineTo(Math.cos(s)*i,Math.sin(s)*i)}e.closePath(),e.fill()}e.restore()},or=(e,t,o)=>{e.save(),e.globalAlpha=t.alpha,Yn(e,t.x,t.y,t.radiusX,t.radiusY,t.color,0);const n=t.x+Math.sin(t.stringAngle)*15,l=t.y+t.radiusY+8+Ri*.6;Vn(e,t.x,t.y+t.radiusY+8,n,l,o,Math.sin(t.stringAngle)*5),e.restore()},lr=(e,t,o,n)=>{const l=1+n*.02,s=ye(1-n/40,0,1);s<=0||(e.save(),e.translate(t,o-20-n*1.5),e.scale(l,l),e.globalAlpha=s,e.font="bold 28px inherit",e.textAlign="center",e.textBaseline="middle",e.fillStyle="#FFD700",e.strokeStyle=g("#ffffff",.8),e.lineWidth=3,e.strokeText("POP!",0,0),e.fillText("POP!",0,0),e.restore())},ar=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden"})},sr=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:C.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:g(C.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},ir=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:g(C.text,.7),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:g(C.surface,.6),borderRadius:"12px",backdropFilter:"blur(4px)"})},rr=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",fontSize:"1.1rem",fontWeight:"600",color:C.text,margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:g(C.surface,.8),borderRadius:"12px",backdropFilter:"blur(4px)"})},cr=()=>{let e=null,t=null,o=0,n=0,l=null,s=null,a="idle",i=0,r=C.secondary,d=!1,f=0,h=null,c=[],u=[],b=[],v=0,R=0,I=0,p=!1,w=null,M=0;const P=()=>o/2,m=()=>n*Ii,y=()=>n*.88,T=()=>{h&&(h.textContent=f===0?"Ballons: 0":`Ballons: ${f}`)},S=()=>{w!==null&&clearTimeout(w),w=setTimeout(()=>{a="idle",i=0,p=!1,w=null},Di)},E=(L,W)=>{a="popped",R=L,I=W,v=0,p=!0;for(let G=0;G<Oi;G++)c.push(ji(L,W));S()},O=(L,W,G,H)=>{a="floating",f+=1,T(),b.push({x:L,y:W,radiusX:G,radiusY:H,color:r,alpha:1,vx:oe(-pn,pn),vy:Wi,stringAngle:0}),S()},_=()=>{if(!t)return;M+=1,le(t,o,n),Qi(t,o,n),zi(t,o,M),xi(t,o,n);const L=P(),W=m(),G=y();b=b.map(Zi).filter(Ji);for(const H of b)or(t,H,M);if(a==="inflating"||a==="idle"){const H=Ye(i),$=H*.85,q=H,X=W-q;let K=0;if(i>=se){const ie=ye((i-se)/(ve-se),0,1);K=Math.sin(M*.3)*ie*12}const pe=Ui(i,r);i>=fn&&i<hn&&er(t,L+K*.5,X,H,M);const Ee=W+8;Vn(t,L+K*.3,Ee,L,G,M,K*.2),Yn(t,L+K*.5,X,$,q,pe,K),i>=fn&&i<hn&&u.length<Bi&&Math.random()<.15&&u.push(qi(L,X,H)),u=u.map(Xi).filter(Ki);for(const ie of u)tr(t,ie.x,ie.y,ie.size,ie.alpha);if(i>=se){const ie=ye((i-se)/(ve-se),0,1);t.save(),t.globalAlpha=ie*.4,t.strokeStyle=g("#ffffff",.6),t.lineWidth=1.5;for(let Ne=0;Ne<3;Ne++){const rt=-.5+Ne*.5,ct=L+K*.5+Math.cos(rt)*$*.7,dt=X+Math.sin(rt)*q*.5;t.beginPath(),t.moveTo(ct-5,dt-3),t.lineTo(ct+5,dt+3),t.stroke()}t.restore()}}c=c.map(Vi).filter(Yi);for(const H of c)nr(t,H);p&&(v+=1,lr(t,R,I,v),v>50&&(p=!1)),l=requestAnimationFrame(_)},F=()=>{if(!e||!t)return;const L=Q(e,t);o=L.width,n=L.height};return{id:"balloon",name:"Ballon",description:"Gonfle le ballon sans le faire éclater",mount:L=>{const W=A("div",{});ar(W);const G=A("button",{},"← Accueil");sr(G),G.addEventListener("click",()=>{window.location.hash="#menu"});const H=A("p",{},"Ballon");ir(H),h=A("p",{},"Ballons: 0"),rr(h),W.appendChild(G),W.appendChild(H),W.appendChild(h),L.appendChild(W);const $=ee(W);e=$.canvas,t=$.ctx,o=$.width,n=$.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),s=F,window.addEventListener("resize",s),a="idle",i=0,r=C.secondary,d=!1,f=0,c=[],u=[],b=[],p=!1,v=0,M=0,T(),_()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),s&&(window.removeEventListener("resize",s),s=null),w!==null&&(clearTimeout(w),w=null),e=null,t=null,h=null,c=[],u=[],b=[],a="idle",i=0,d=!1,f=0,p=!1,M=0,o=0,n=0},update:L=>{const W=L.isVoicing;if(W){if(d||a==="idle"&&(a="inflating",i=0,u=[],r=C.secondary),a==="inflating"&&(i=L.duration,L.vowel!==null&&Z[L.vowel]&&(r=Z[L.vowel]),i>=ve)){const G=Ye(i),H=m()-G;E(P(),H)}}else if(d&&a==="inflating"&&i>.1){const G=Ye(i),H=G*.85,$=G,q=m()-$;O(P(),q,H,$)}else!W&&a==="inflating"&&(a="idle",i=0,u=[]);d=W}}},Ce=.1,dr=8,fr=20,hr=500,ur=8,pr=35,gr=-2.2,mr=.008,br=.06,yr=20,Sr=.08,wr=.06,vr="#1a6b8a",qn="#0a2a3a",Mr="#c2a66b",Tr="#a08850",Pr="#2d8a4e",Cr="#1d6a3e",Ar={a:"fish",e:"seahorse",i:"jellyfish",o:"starfish",u:"octopus",ɛ:"fish",y:"jellyfish"},Er={a:1.8,e:.5,i:.3,o:0,u:.6,ɛ:1.2,y:.4},V=(e,t)=>e+Math.random()*(t-e),Ir=(e,t,o)=>{const n=e.createLinearGradient(0,0,0,o);n.addColorStop(0,vr),n.addColorStop(1,qn),e.fillStyle=n,e.fillRect(0,0,t,o)},Rr=(e,t,o)=>{const n=o*(1-Ce),l=e.createLinearGradient(0,n,0,o);l.addColorStop(0,Mr),l.addColorStop(1,Tr),e.beginPath(),e.moveTo(0,o);for(let s=0;s<=t;s+=10){const a=n+Math.sin(s*.03)*3+Math.sin(s*.07)*2;e.lineTo(s,a)}e.lineTo(t,o),e.closePath(),e.fillStyle=l,e.fill()},gn=(e,t)=>{const o=[],n=t*(1-Ce);for(let l=0;l<yr;l++){const s=Math.floor(V(100,170));o.push({x:V(10,e-10),y:V(n+5,t-5),rx:V(3,7),ry:V(2,4),color:`rgb(${s}, ${s-10}, ${s-20})`})}return o},kr=(e,t)=>{for(const o of t)e.beginPath(),e.ellipse(o.x,o.y,o.rx,o.ry,0,0,Math.PI*2),e.fillStyle=o.color,e.fill()},mn=(e,t)=>{const o=[];for(let n=0;n<dr;n++)o.push({x:V(30,e-30),height:V(80,400),segments:Math.floor(V(6,12)),phaseOffset:V(0,Math.PI*2)});return o},Fr=(e,t,o,n,l)=>{const s=o*(1-Ce);for(const a of t){const i=a.height/a.segments;e.beginPath(),e.moveTo(a.x,s);for(let r=1;r<=a.segments;r++){const d=r/a.segments,f=Math.sin(n*.002+a.phaseOffset+r*.5)*(20*d)*l,h=a.x+f,c=s-r*i;e.lineTo(h,c)}e.lineWidth=4,e.strokeStyle=Pr,e.lineCap="round",e.lineJoin="round",e.stroke();for(let r=2;r<a.segments;r+=2){const d=r/a.segments,f=Math.sin(n*.002+a.phaseOffset+r*.5)*(20*d)*l,h=a.x+f,c=s-r*i,u=r%4===0?1:-1;e.beginPath(),e.ellipse(h+u*8,c,10,4,u*.4,0,Math.PI*2),e.fillStyle=Cr,e.fill()}}},Or=(e,t,o)=>({x:V(e*.15,e*.85),y:t*(1-Ce)-5,radius:ur+o*pr,alpha:.6,vy:gr-o*1.5,wobbleOffset:V(0,Math.PI*2),wobbleSpeed:V(.03,.06)}),_r=(e,t)=>({...e,y:e.y+e.vy,x:e.x+Math.sin(t*e.wobbleSpeed+e.wobbleOffset)*.5,alpha:e.alpha-mr}),Br=e=>e.alpha>0&&e.y>-e.radius,Lr=(e,t,o)=>{e.save(),e.globalAlpha=t.alpha*o,e.beginPath(),e.arc(t.x,t.y,t.radius,0,Math.PI*2),e.fillStyle=g("#a5d8ff",.4),e.fill(),e.strokeStyle=g("#74c0fc",.6),e.lineWidth=1,e.stroke(),e.beginPath(),e.arc(t.x-t.radius*.3,t.y-t.radius*.3,t.radius*.25,0,Math.PI*2),e.fillStyle=g("#ffffff",.7),e.fill(),e.restore()},Dr=(e,t,o,n,l,s,a)=>{const i=s?1:-1;e.save(),e.beginPath(),e.ellipse(t,o,n*1.2,n*.7,0,0,Math.PI*2),e.fillStyle=l,e.fill(),e.beginPath();const r=t-i*n*1.2,d=Math.sin(a*.008+t)*3;e.moveTo(r,o),e.lineTo(r-i*n*.7,o-n*.5+d),e.lineTo(r-i*n*.7,o+n*.5+d),e.closePath(),e.fillStyle=l,e.fill();const f=t+i*n*.5,h=o-n*.15;e.beginPath(),e.arc(f,h,n*.18,0,Math.PI*2),e.fillStyle="#ffffff",e.fill(),e.beginPath(),e.arc(f+i*n*.05,h,n*.1,0,Math.PI*2),e.fillStyle="#1a1a2e",e.fill(),e.beginPath(),e.moveTo(t-i*n*.2,o-n*.7),e.lineTo(t+i*n*.3,o-n*.7),e.lineTo(t+i*n*.1,o-n*.35),e.closePath(),e.fillStyle=g(l,.7),e.fill(),e.restore()},Wr=(e,t,o,n,l,s)=>{e.save(),e.beginPath(),e.arc(t,o-n*.8,n*.4,0,Math.PI*2),e.fillStyle=l,e.fill(),e.beginPath(),e.ellipse(t+n*.5,o-n*.8,n*.25,n*.12,0,0,Math.PI*2),e.fillStyle=l,e.fill();const a=Math.sin(s*.003+t*.1)*3;for(let d=0;d<6;d++){const f=d/5,h=t+a*f,c=o-n*.5+d*n*.3,u=n*(.35-f*.08);e.beginPath(),e.arc(h,c,u,0,Math.PI*2),e.fillStyle=g(l,1-f*.2),e.fill()}e.beginPath();const i=t+a*.8,r=o+n*1;e.arc(i+n*.2,r,n*.2,0,Math.PI*1.5),e.strokeStyle=l,e.lineWidth=3,e.lineCap="round",e.stroke(),e.beginPath(),e.arc(t+n*.15,o-n*.9,n*.08,0,Math.PI*2),e.fillStyle="#1a1a2e",e.fill();for(let d=0;d<3;d++)e.beginPath(),e.arc(t-n*.1+d*n*.15,o-n*1.2,n*.06,0,Math.PI*2),e.fillStyle=g(l,.7),e.fill();e.restore()},Nr=(e,t,o,n,l,s)=>{e.save();const a=1+Math.sin(s*.005+t)*.1;e.beginPath(),e.ellipse(t,o,n*.8*a,n*.5*a,0,Math.PI,0),e.fillStyle=g(l,.6),e.fill(),e.beginPath(),e.ellipse(t,o+n*.05,n*.5*a,n*.3*a,0,Math.PI,0),e.fillStyle=g(l,.3),e.fill();const i=6;for(let r=0;r<i;r++){const d=t-n*.6+r/(i-1)*n*1.2;e.beginPath(),e.moveTo(d,o);const f=n*(.8+Math.sin(r*1.5)*.3);for(let h=1;h<=4;h++){const c=h/4,u=d+Math.sin(s*.004+r*.8+h*.7)*(n*.15),b=o+c*f;e.lineTo(u,b)}e.strokeStyle=g(l,.5),e.lineWidth=2,e.lineCap="round",e.stroke()}for(let r=0;r<3;r++){const d=t-n*.3+r*n*.3,f=o-n*.15;e.beginPath(),e.arc(d,f,n*.05,0,Math.PI*2),e.fillStyle=g("#ffffff",.5),e.fill()}e.restore()},Hr=(e,t,o,n,l)=>{e.save();const s=5,a=n*.9,i=a*.4;e.beginPath();for(let r=0;r<s*2;r++){const d=r%2===0?a:i,f=Math.PI*r/s-Math.PI/2,h=t+Math.cos(f)*d,c=o+Math.sin(f)*d;r===0?e.moveTo(h,c):e.lineTo(h,c)}e.closePath(),e.fillStyle=l,e.fill(),e.beginPath(),e.arc(t,o,n*.15,0,Math.PI*2),e.fillStyle=g("#ffffff",.4),e.fill();for(let r=0;r<s;r++){const d=Math.PI*2*r/s-Math.PI/2,f=a*.55,h=t+Math.cos(d)*f,c=o+Math.sin(d)*f;e.beginPath(),e.arc(h,c,n*.06,0,Math.PI*2),e.fillStyle=g("#ffffff",.35),e.fill()}e.restore()},Gr=(e,t,o,n,l,s)=>{e.save(),e.beginPath(),e.arc(t,o-n*.3,n*.6,0,Math.PI*2),e.fillStyle=l,e.fill(),e.beginPath(),e.arc(t-n*.2,o-n*.4,n*.12,0,Math.PI*2),e.fillStyle="#ffffff",e.fill(),e.beginPath(),e.arc(t+n*.2,o-n*.4,n*.12,0,Math.PI*2),e.fillStyle="#ffffff",e.fill(),e.beginPath(),e.arc(t-n*.18,o-n*.38,n*.06,0,Math.PI*2),e.fillStyle="#1a1a2e",e.fill(),e.beginPath(),e.arc(t+n*.22,o-n*.38,n*.06,0,Math.PI*2),e.fillStyle="#1a1a2e",e.fill();const a=4;for(let i=0;i<a;i++){const r=t-n*.45+i/(a-1)*n*.9;e.beginPath(),e.moveTo(r,o+n*.1);for(let d=1;d<=5;d++){const f=d/5,h=r+Math.sin(s*.004+i*1.2+d*.8)*(n*.2),c=o+n*.1+f*n*.9;e.lineTo(h,c)}e.strokeStyle=l,e.lineWidth=3,e.lineCap="round",e.stroke()}e.beginPath(),e.arc(t,o-n*.15,n*.15,.1,Math.PI-.1),e.strokeStyle=g("#1a1a2e",.5),e.lineWidth=1.5,e.stroke(),e.restore()},$r=(e,t,o,n)=>{switch(e.save(),e.globalAlpha=t.alpha*n,t.kind){case"fish":Dr(e,t.x,t.y,t.size,t.color,t.vx>0,o);break;case"seahorse":Wr(e,t.x,t.y,t.size,t.color,o);break;case"jellyfish":Nr(e,t.x,t.y,t.size,t.color,o);break;case"starfish":Hr(e,t.x,t.y,t.size,t.color);break;case"octopus":Gr(e,t.x,t.y,t.size,t.color,o);break}e.restore()},Ur=(e,t,o)=>{const n=Ar[e]??"fish",l=Z[e]??"#6366f1",s=Er[e]??1,a=o*(1-Ce),i=V(14,22),r=Math.random()>.5?1:-1,d=r>0?-i*2:t+i*2;let f;switch(n){case"starfish":f=a-i*.5;break;case"jellyfish":f=V(o*.15,o*.5);break;case"seahorse":f=V(o*.3,o*.6);break;case"octopus":f=V(o*.5,a-i*1.5);break;default:f=V(o*.15,a-i*2)}return{x:n==="starfish"?V(i*2,t-i*2):d,y:f,vx:n==="starfish"?0:s*r,color:l,kind:n,age:0,alpha:n==="starfish"?0:1,size:i,phaseOffset:V(0,Math.PI*2)}},jr=(e,t,o)=>{const n=e.age+1,l=e.kind!=="starfish"?Math.sin(t*.003+e.phaseOffset)*.3:0;let s=e.x+e.vx,a=e.vx;e.kind!=="starfish"&&(s<-e.size*3?(s=-e.size*3,a=Math.abs(e.vx)):s>o+e.size*3&&(s=o+e.size*3,a=-Math.abs(e.vx)));let i=e.alpha;return e.kind==="starfish"&&e.alpha<1&&(i=Math.min(1,e.alpha+.02)),{...e,x:s,y:e.y+l,vx:a,age:n,alpha:i}},Vr=(e,t)=>e.kind==="starfish"?!0:e.x>-e.size*4&&e.x<t+e.size*4,Yr=(e,t)=>e.length<=t?e:e.map((o,n)=>n<e.length-t?{...o,alpha:o.alpha-br}:o).filter(o=>o.alpha>0),qr=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden",backgroundColor:qn})},Xr=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:"#7dd3fc",cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:g("#0a2a3a",.7),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},Kr=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:g("#7dd3fc",.7),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none"})},Zr=e=>{Object.assign(e.style,{position:"absolute",top:"16px",right:"16px",zIndex:"10",fontSize:"1.1rem",fontWeight:"600",color:"#7dd3fc",margin:"0",padding:"8px 12px",fontFamily:"inherit",borderRadius:"8px",backgroundColor:g("#0a2a3a",.7),backdropFilter:"blur(4px)",pointerEvents:"none"})},Jr=()=>{let e=null,t=null,o=0,n=0,l=null,s=null,a=[],i=[],r=[],d=[],f=null,h=0,c=0,u=0,b=0,v=!1;const R=4,I=()=>{if(!e||!t)return;const y=Q(e,t);o=y.width,n=y.height,r=mn(o),d=gn(o,n)},p=()=>{if(t){le(t,o,n),Ir(t,o,n),Rr(t,o,n),kr(t,d),Fr(t,r,n,u,b);for(const y of i)$r(t,y,u,b);for(const y of a)Lr(t,y,b)}},w=()=>{u=performance.now(),b=v?Math.min(1,b+Sr):Math.max(0,b-wr),a=a.map(y=>_r(y,u)).filter(Br),i=i.map(y=>jr(y,u,o)).filter(y=>Vr(y,o)),i=Yr(i,fr),f&&(f.textContent=`${i.length}`),p(),l=requestAnimationFrame(w)};return{id:"aquarium",name:"Aquarium",description:"Crée ton monde sous-marin avec ta voix",mount:y=>{const T=A("div",{});qr(T);const S=A("button",{},"← Accueil");Xr(S),S.addEventListener("click",()=>{window.location.hash="#menu"});const E=A("p",{},"Aquarium");Kr(E),f=A("p",{},"0"),Zr(f),T.appendChild(S),T.appendChild(E),T.appendChild(f),y.appendChild(T);const O=ee(T);e=O.canvas,t=O.ctx,o=O.width,n=O.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),r=mn(o),d=gn(o,n),s=I,window.addEventListener("resize",s),a=[],i=[],h=0,c=0,u=0,w()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),s&&(window.removeEventListener("resize",s),s=null),e=null,t=null,f=null,o=0,n=0,a=[],i=[],r=[],d=[],h=0,c=0,u=0,b=0,v=!1},update:y=>{v=y.isVoicing;const T=performance.now();y.isVoicing?(c+=1,c>=R&&(c=0,a.push(Or(o,n,y.volume)))):c=0,y.isVoicing&&y.vowel!==null&&T-h>=hr&&(i.push(Ur(y.vowel,o,n)),h=T)}}},x=.3,Qr=.035,it=.3,Te=.18,zr=120,xr=.3,bn=.03,ne=40,yn=12,Xe={summer:{skyTop:"#1E90FF",skyBottom:"#87CEEB",groundTop:"#4CAF50",groundBottom:"#2E7D32",treeCrown:"#2E8B57",treeHighlight:"#3CB371",label:"Été"},autumn:{skyTop:"#E8843C",skyBottom:"#F4A460",groundTop:"#8B6914",groundBottom:"#6B4E0A",treeCrown:"#D2691E",treeHighlight:"#E25822",label:"Automne"},winter:{skyTop:"#B0B8C8",skyBottom:"#D9DEE8",groundTop:"#E8E8F0",groundBottom:"#CFCFDF",treeCrown:"#8B7355",treeHighlight:"#A08060",label:"Hiver"},spring:{skyTop:"#89CFF0",skyBottom:"#B0E2FF",groundTop:"#5DBB63",groundBottom:"#3E9142",treeCrown:"#FFB7C5",treeHighlight:"#FFC0CB",label:"Printemps"}},e0={a:"summer",o:"autumn",i:"winter",u:"spring"},Ke=(e,t,o)=>e+(t-e)*o,xe=(e,t,o)=>Math.min(o,Math.max(t,e)),B=(e,t)=>e+Math.random()*(t-e),Sn=e=>({r:parseInt(e.slice(1,3),16),g:parseInt(e.slice(3,5),16),b:parseInt(e.slice(5,7),16)}),t0=(e,t,o)=>{const n=l=>xe(Math.round(l),0,255).toString(16).padStart(2,"0");return`#${n(e)}${n(t)}${n(o)}`},be=(e,t,o)=>{const n=Sn(e),l=Sn(t);return t0(Ke(n.r,l.r,o),Ke(n.g,l.g,o),Ke(n.b,l.b,o))},n0=(e,t,o)=>({skyTop:be(e.skyTop,t.skyTop,o),skyBottom:be(e.skyBottom,t.skyBottom,o),groundTop:be(e.groundTop,t.groundTop,o),groundBottom:be(e.groundBottom,t.groundBottom,o),treeCrown:be(e.treeCrown,t.treeCrown,o),treeHighlight:be(e.treeHighlight,t.treeHighlight,o)}),o0=e=>({skyTop:e.skyTop,skyBottom:e.skyBottom,groundTop:e.groundTop,groundBottom:e.groundBottom,treeCrown:e.treeCrown,treeHighlight:e.treeHighlight}),Oe={skyTop:"#7CA8D0",skyBottom:"#A8C8E8",groundTop:"#6B8E6B",groundBottom:"#4A6B4A",treeCrown:"#5A8A5A",treeHighlight:"#6B9B6B"},l0=(e,t,o)=>{const l=t*(1-x)-t*it-t*Te,s=["#D2691E","#CD853F","#B22222","#DAA520","#CC5500"];return{x:e*.5+B(-e*.15,e*.15),y:l+B(0,t*Te),vx:B(-1.5,1.5)*(1+o),vy:B(.3,1.5),size:B(5,10),rotation:B(0,Math.PI*2),rotationSpeed:B(-.05,.05),alpha:1,color:s[Math.floor(Math.random()*s.length)],life:0,maxLife:B(120,250)}},a0=(e,t,o)=>{const n=.3+o*.7;return{x:B(-20,e+20),y:B(-30,-5),vx:B(-.8,.8)*n,vy:B(.5,2.5)*n,size:B(2,6),rotation:0,rotationSpeed:0,alpha:B(.6,1),color:"#FFFFFF",life:0,maxLife:B(200,400)}},s0=(e,t,o)=>{const l=t*(1-x)-t*it-t*Te,s=["#FFB7C5","#FF69B4","#FFC0CB","#FFD1DC","#FADADD"];return{x:e*.5+B(-e*.15,e*.15),y:l+B(0,t*Te*.7),vx:B(-1,2)*(.5+o*.5),vy:B(-.5,1.2),size:B(4,8),rotation:B(0,Math.PI*2),rotationSpeed:B(-.04,.04),alpha:1,color:s[Math.floor(Math.random()*s.length)],life:0,maxLife:B(150,300)}},i0=(e,t,o)=>{const n=B(t*.1,t*.6);return{x:B(0,e),y:n,vx:B(-.2,.2),vy:B(-1,-.3)*(.5+o),size:B(2,5),rotation:0,rotationSpeed:0,alpha:B(.15,.4)*o,color:"#FFD700",life:0,maxLife:B(60,120)}},r0=(e,t,o)=>{const n=t*(1-x),l=["#FF6B9D","#C084FC","#60A5FA","#FBBF24","#FB923C"];return{x:B(e*.1,e*.9),y:n-B(20,120),vx:B(-1,1),vy:B(-1,.5),size:B(6,10),rotation:0,rotationSpeed:.1,alpha:1,color:l[Math.floor(Math.random()*l.length)],life:0,maxLife:B(200,400)}},c0=(e,t)=>{const o=t*(1-x),n=["#FF6B9D","#FBBF24","#A78BFA","#F87171","#34D399"];return{x:B(e*.05,e*.95),y:o+B(5,t*x*.5),vx:0,vy:0,size:B(4,8),rotation:B(0,Math.PI*2),rotationSpeed:0,alpha:1,color:n[Math.floor(Math.random()*n.length)],life:0,maxLife:9999}},d0=(e,t)=>{const o=e.life+1,n=o/e.maxLife,l=.7,s=t==="spring"&&e.vy<=.5&&e.size>=6,a=s?e.vx+Math.sin(o*.1)*.15:e.vx+B(-.05,.05),i=s?e.vy+Math.cos(o*.08)*.1:e.vy;return{...e,x:e.x+a,y:e.y+i,vx:a*.99,vy:i,rotation:e.rotation+e.rotationSpeed,alpha:n>l?e.alpha*(1-(n-l)/(1-l)):e.alpha,life:o}},f0=e=>e.life<e.maxLife&&e.alpha>.01,h0=(e,t,o,n)=>{const l=e.createLinearGradient(0,0,0,o*(1-x));l.addColorStop(0,n.skyTop),l.addColorStop(1,n.skyBottom),e.fillStyle=l,e.fillRect(0,0,t,o*(1-x)+2)},u0=(e,t,o,n,l)=>{const s=o*(1-x),a=e.createLinearGradient(0,s,0,o);a.addColorStop(0,n.groundTop),a.addColorStop(1,n.groundBottom),e.fillStyle=a,e.fillRect(0,s,t,o*x),e.beginPath(),e.moveTo(0,s);for(let i=0;i<=t;i+=15){const r=Math.sin(i*.03+l*5e-4)*3;e.lineTo(i,s+r)}e.lineTo(t,s+8),e.lineTo(0,s+8),e.closePath(),e.fillStyle=n.groundTop,e.fill()},p0=(e,t,o,n,l)=>{const s=t-80,a=70,i=1+Math.sin(o*.001)*.04,r=n==="winter"?.3:n==="autumn"?.7:1,d=n==="autumn"?"#FF8C42":"#FFD700",f=n==="summer"?.5+l*.5:.3;e.save(),e.globalAlpha=r;const h=e.createRadialGradient(s,a,0,s,a,ne*2.5);h.addColorStop(0,g(d,.3)),h.addColorStop(1,g(d,0)),e.fillStyle=h,e.fillRect(s-ne*3,a-ne*3,ne*6,ne*6),e.save(),e.translate(s,a),e.rotate(o*3e-4);const c=15+l*15;for(let u=0;u<yn;u++){const b=u/yn*Math.PI*2;e.beginPath(),e.moveTo(Math.cos(b)*ne*i,Math.sin(b)*ne*i),e.lineTo(Math.cos(b)*(ne+c)*i,Math.sin(b)*(ne+c)*i),e.strokeStyle=g(d,f),e.lineWidth=3,e.stroke()}e.restore(),e.beginPath(),e.arc(s,a,ne*i,0,Math.PI*2),e.fillStyle=d,e.fill(),e.restore()},g0=(e,t,o,n,l,s,a)=>{const i=o*(1-x),r=t*.5,d=t*Qr,f=o*it,h=i-f,c=o*Te,u=Math.sin(s*.0015)*(2+a*4);e.save(),e.beginPath(),e.moveTo(r-d/2,i),e.lineTo(r-d/3+u*.3,h+c*.3),e.lineTo(r+d/3+u*.3,h+c*.3),e.lineTo(r+d/2,i),e.closePath();const b=e.createLinearGradient(r-d/2,i,r+d/2,i);if(b.addColorStop(0,"#5D4037"),b.addColorStop(.5,"#795548"),b.addColorStop(1,"#5D4037"),e.fillStyle=b,e.fill(),l==="winter"){const v="#6D4C41";e.strokeStyle=v,e.lineWidth=3,e.lineCap="round",e.beginPath(),e.moveTo(r+u*.4,h+c*.5),e.quadraticCurveTo(r-c*.4+u*.5,h+c*.1,r-c*.7+u*.6,h-c*.2),e.stroke(),e.beginPath(),e.moveTo(r+u*.4,h+c*.4),e.quadraticCurveTo(r+c*.3+u*.5,h+c*.05,r+c*.65+u*.6,h-c*.15),e.stroke(),e.beginPath(),e.moveTo(r+u*.5,h+c*.2),e.quadraticCurveTo(r+c*.1+u*.6,h-c*.3,r-c*.1+u*.7,h-c*.6),e.stroke(),e.lineWidth=2,e.beginPath(),e.moveTo(r-c*.5+u*.55,h-c*.05),e.lineTo(r-c*.65+u*.6,h-c*.35),e.stroke(),e.beginPath(),e.moveTo(r+c*.45+u*.55,h),e.lineTo(r+c*.55+u*.6,h-c*.3),e.stroke()}if(l!=="winter"){const v=h-c*.2,R=r+u*.5;e.beginPath(),e.ellipse(R+3,v+5,c*1.05,c*.85,0,0,Math.PI*2),e.fillStyle=g("#000000",.08),e.fill();const I=(p,w,M,P,m)=>{e.beginPath(),e.ellipse(p,w,M,P,0,0,Math.PI*2),e.fillStyle=m,e.fill()};I(R,v,c,c*.8,n.treeCrown),I(R-c*.5,v+c*.1,c*.6,c*.55,n.treeCrown),I(R+c*.5,v+c*.15,c*.55,c*.5,n.treeCrown),I(R+c*.1,v-c*.4,c*.55,c*.5,n.treeHighlight),I(R-c*.2,v-c*.15,c*.45,c*.4,g(n.treeHighlight,.5))}e.restore()},wn=(e,t,o)=>{if(e.save(),e.globalAlpha=xe(t.alpha,0,1),e.translate(t.x,t.y),e.rotate(t.rotation),o==="autumn")e.beginPath(),e.ellipse(0,0,t.size,t.size*.5,0,0,Math.PI*2),e.fillStyle=t.color,e.fill(),e.beginPath(),e.moveTo(-t.size*.7,0),e.lineTo(t.size*.7,0),e.strokeStyle=g("#000000",.2),e.lineWidth=.5,e.stroke();else if(o==="winter"){const n=e.createRadialGradient(0,0,0,0,0,t.size);n.addColorStop(0,g("#FFFFFF",.9)),n.addColorStop(1,g("#FFFFFF",0)),e.fillStyle=n,e.fillRect(-t.size,-t.size,t.size*2,t.size*2),e.beginPath(),e.arc(0,0,t.size*.5,0,Math.PI*2),e.fillStyle="#FFFFFF",e.fill()}else if(o==="spring"&&t.size>=6&&t.maxLife>=200){const n=Math.sin(t.life*.15)*.4;e.fillStyle=t.color,e.save(),e.scale(1,1+n),e.beginPath(),e.ellipse(-t.size*.4,0,t.size*.5,t.size*.8,-.2,0,Math.PI*2),e.fill(),e.restore(),e.save(),e.scale(1,1-n),e.beginPath(),e.ellipse(t.size*.4,0,t.size*.5,t.size*.8,.2,0,Math.PI*2),e.fill(),e.restore(),e.beginPath(),e.ellipse(0,0,t.size*.12,t.size*.5,0,0,Math.PI*2),e.fillStyle="#333333",e.fill()}else if(o==="spring"&&t.vx===0&&t.vy===0){e.fillStyle=t.color;for(let l=0;l<5;l++){const s=l/5*Math.PI*2;e.beginPath(),e.ellipse(Math.cos(s)*t.size*.4,Math.sin(s)*t.size*.4,t.size*.35,t.size*.2,s,0,Math.PI*2),e.fill()}e.beginPath(),e.arc(0,0,t.size*.2,0,Math.PI*2),e.fillStyle="#FBBF24",e.fill()}else o==="spring"?(e.beginPath(),e.ellipse(0,0,t.size,t.size*.5,0,0,Math.PI*2),e.fillStyle=t.color,e.fill()):o==="summer"&&(e.beginPath(),e.arc(0,0,t.size,0,Math.PI*2),e.fillStyle=g(t.color,xe(t.alpha,0,.4)),e.fill());e.restore()},m0=(e,t,o,n)=>{e.save(),e.font="bold 20px system-ui, sans-serif",e.textAlign="right",e.textBaseline="bottom",e.fillStyle=g(C.text,.5),e.fillText(t,o-20,n-16),e.restore()},b0=(e,t,o,n,l)=>{const s=o*(1-x),a=8+n*6;e.beginPath(),e.moveTo(0,s);for(let i=0;i<=t;i+=20){const r=Math.sin(i*.02+l*3e-4)*3;e.lineTo(i,s-a+r)}e.lineTo(t,s+2),e.lineTo(0,s+2),e.closePath(),e.fillStyle=g("#FFFFFF",.7),e.fill()},y0=e=>{Object.assign(e.style,{position:"relative",width:"100%",height:"100%",overflow:"hidden"})},S0=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"16px",zIndex:"10",background:"none",border:"none",fontSize:"1.2rem",fontWeight:"600",color:C.primary,cursor:"pointer",fontFamily:"inherit",padding:"8px 12px",borderRadius:"8px",backgroundColor:g(C.surface,.8),backdropFilter:"blur(4px)",transition:"background-color 0.15s ease"})},w0=e=>{Object.assign(e.style,{position:"absolute",top:"16px",left:"50%",transform:"translateX(-50%)",zIndex:"10",fontSize:"1.4rem",fontWeight:"700",color:g(C.text,.7),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:g(C.surface,.6),borderRadius:"12px",backdropFilter:"blur(4px)"})},v0=e=>{Object.assign(e.style,{position:"absolute",bottom:"16px",right:"16px",zIndex:"10",fontSize:"1.3rem",fontWeight:"700",color:g(C.text,.6),margin:"0",padding:"8px 16px",fontFamily:"inherit",pointerEvents:"none",backgroundColor:g(C.surface,.6),borderRadius:"12px",backdropFilter:"blur(4px)"})},M0=()=>{let e=null,t=null,o=0,n=0,l=null,s=null,a=0,i=null,r=null,d={...Oe},f={...Oe},h=1,c=[],u=[],b=0,v=null;const R=(y,T,S)=>{const E=Math.min(S,zr-c.length);for(let O=0;O<E;O++)switch(y){case"summer":c.push(i0(o,n,T));break;case"autumn":c.push(l0(o,n,T));break;case"winter":c.push(a0(o,n,T));break;case"spring":c.push(s0(o,n,T)),T>.4&&Math.random()<.15&&c.push(r0(o,n));break}},I=y=>{y==="spring"&&u.length<12?Math.random()<.02&&u.push(c0(o,n)):y!=="spring"&&u.length>0&&(u=u.map(T=>({...T,alpha:T.alpha-.01})).filter(T=>T.alpha>.01))},p=()=>{if(!t)return;const y=performance.now()-a;le(t,o,n),h<1&&(h=Math.min(1,h+bn),d=n0(d,f,bn));const T=i??"summer";h0(t,o,n,d),p0(t,o,y,T,b),u0(t,o,n,d,y),T==="winter"&&b0(t,o,n,b,y);for(const S of u)wn(t,S,"spring");if(g0(t,o,n,d,T,y,b),i!==null){const S=xr+b*2;if(Math.random()<S){const E=Math.ceil(1+b*3);R(i,b,E)}}c=c.map(S=>d0(S,T)).filter(f0);for(const S of c)wn(t,S,T);if(I(T),i!==null){const S=Xe[i];m0(t,S.label,o,n)}l=requestAnimationFrame(p)},w=()=>{if(!e||!t)return;const y=Q(e,t);o=y.width,n=y.height};return{id:"seasons",name:"Saisons",description:"Change les saisons avec ta voix",mount:y=>{const T=A("div",{});y0(T);const S=A("button",{},"← Accueil");S0(S),S.addEventListener("click",()=>{window.location.hash="#menu"});const E=A("p",{},"Saisons");w0(E),v=A("p",{},""),v0(v),T.appendChild(S),T.appendChild(E),T.appendChild(v),y.appendChild(T);const O=ee(T);e=O.canvas,t=O.ctx,o=O.width,n=O.height,Object.assign(e.style,{position:"absolute",top:"0",left:"0"}),s=w,window.addEventListener("resize",s),i=null,r=null,d={...Oe},f={...Oe},h=1,c=[],u=[],b=0,a=performance.now(),p()},unmount:()=>{l!==null&&(cancelAnimationFrame(l),l=null),s&&(window.removeEventListener("resize",s),s=null),e=null,t=null,v=null,o=0,n=0,c=[],u=[],i=null,r=null,h=1,b=0},update:y=>{b=y.volume,y.duration;const T=y.vowel,S=T!==null?e0[T]??null:null;S!==null&&S!==r&&(r=S,f=o0(Xe[S]),h=0,i=S,v&&(v.textContent=Xe[S].label))}}},T0=Vo("#app"),Xn=$o(),Kn=Uo({volume:0,pitch:null,vowel:null,isVoicing:!1,duration:0,formants:null}),Zn=[oa(),Sa(),es(),ms(),Ns(),ii(),Ai(),cr(),Jr(),M0(),_l(),gl()],P0=el(Zn.map(e=>({id:e.id,name:e.name,description:e.description}))),C0=[P0,...Zn],A0=jo(T0,C0);Kn.subscribe(e=>{const t=A0.getCurrentGame();t&&t.update(e)});Xn.subscribe(e=>{Kn.set(e)});const Ae=document.createElement("div");Ae.style.cssText=`
  position: fixed; inset: 0; z-index: 1000;
  display: flex; align-items: center; justify-content: center; flex-direction: column;
  background: rgba(240, 244, 255, 0.95);
`;const ce=document.createElement("button");ce.textContent="🎤 Commencer";ce.style.cssText=`
  font-size: 2rem; padding: 24px 48px;
  border: none; border-radius: 16px;
  background: #6366f1; color: white;
  cursor: pointer; font-family: inherit;
  transition: transform 0.2s;
`;ce.addEventListener("mouseenter",()=>{ce.style.transform="scale(1.05)"});ce.addEventListener("mouseleave",()=>{ce.style.transform="scale(1)"});const Pe=document.createElement("p");Pe.textContent="Appuie pour activer le micro";Pe.style.cssText="margin-top: 16px; color: #64748b; font-size: 1.2rem;";Ae.appendChild(ce);Ae.appendChild(Pe);document.body.appendChild(Ae);ce.addEventListener("click",async()=>{try{await Xn.start(),Ae.remove()}catch(e){Pe.textContent="Erreur : impossible d'accéder au micro",Pe.style.color="#ef4444",console.error("Failed to start audio pipeline:",e)}});</script>
    <style rel="stylesheet" crossorigin>*,*:before,*:after{box-sizing:border-box}*{margin:0;padding:0}html{-webkit-text-size-adjust:100%;-moz-text-size-adjust:100%;text-size-adjust:100%}body{line-height:1.5;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}img,picture,video,canvas,svg{display:block;max-width:100%}input,button,textarea,select{font:inherit;color:inherit}p,h1,h2,h3,h4,h5,h6{overflow-wrap:break-word}ol,ul{list-style:none}a{text-decoration:none;color:inherit}table{border-collapse:collapse;border-spacing:0}:root{--color-bg: #f0f4ff;--color-text: #2d3748;--color-primary: #6366f1;--color-secondary: #f472b6;--color-accent: #34d399;--color-surface: #ffffff;--font-family: "Segoe UI", system-ui, sans-serif;--radius: 12px;--transition-speed: .3s}body{width:100%;height:100vh;height:100dvh;font-family:var(--font-family);background-color:var(--color-bg);color:var(--color-text);overflow:hidden}#app{width:100%;height:100%;display:flex;flex-direction:column}.game-container{flex:1;position:relative;overflow:hidden}*,*:before,*:after{transition-timing-function:ease-in-out}@media(prefers-reduced-motion:reduce){*,*:before,*:after{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important;scroll-behavior:auto!important}}</style>
  </head>
  <body>
    <div id="app"></div>
  </body>
</html>
